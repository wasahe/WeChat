{template 'common/header'}
<ul class="nav nav-tabs">
    <li><a href="{php echo  $this->createWebUrl('Servetype', array());}">服务类别管理</a></li>
    <li class="active"><a href="">修改服务类别</a></li>
</ul>

<div class="clearfix">    
    <form id="theform" class="form form-horizontal" action="{php echo $this->createWebUrl('servechildeditok', array());}" method="post">
    <input type="hidden" name="id" value="{$item['id']}"  />
    <input type="hidden" name="old_parentid" value="{$item['parent_id']}"  />
        <div class="panel panel-default">
            <div class="panel-heading">
                修改服务类别
            </div>
            <div class="panel-body">
            
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">所属父类</label>
                    <div class="col-sm-9 col-xs-12">
                        <select name="parent_id" id="parent_id" class="form-control  input-s-lg" onchange="check()">
                            <option value="0" {if $item['parent_id'] == 0} selected {/if}>--做为根类别--</option>
                            {loop $list1 $vo1}
                            <option value="{$vo1['id']}" {if $item['parent_id']==$vo1['id']} selected {/if}>{$vo1['type_name']}</option>
                            {/loop}
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">类别名称</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="type_name" id="type_name" value="{$item['type_name']}" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">显示图标[智能设备端]</label>
                    <div class="col-sm-9 col-xs-12">
                        {php echo tpl_form_field_image('icon',$item['icon']);}
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">显示图标[PC端]</label>
                    <div class="col-sm-9 col-xs-12">
                        {php echo tpl_form_field_image('icon_pc',$item['icon_pc']);}
                    </div>
                </div>
				
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">显示排序</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="top" id="top" value="{$item['top']}" class="form-control">
						<span class="help-block">数字越小越靠前</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">类别描述</label>
                    <div class="col-sm-9 col-xs-12">
                        <textarea name="remark" id="remark" class="form-control" rows="5">{$item['remark']}</textarea>
						<span class="help-block">对类别的描述</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">模板名称</label>
                    <div class="col-sm-9 col-xs-12">
                        <select name="temp_id" id="temp_id" class="form-control  input-s-lg">
                            <option value="">选择模板</option>
                            {loop $list2 $vo2}
                            <option value="{$vo2['id']}" {if $vo2['id'] == $item['temp_id']} selected="selected" {/if}>{$vo2['temp_name']}</option>
                            {/loop}
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">市场价格</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="price" id="price" value="{$item[price]}" class="form-control">
						<span class="help-block">服务项目的市场价格</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">优惠价格</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="price_unit" id="price_unit" value="{$item[price_unit]}" class="form-control">
						<span class="help-block">服务项目的优惠价格</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">单位</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="unit" id="unit" value="{$item['unit']}" class="form-control">
						<span class="help-block">及服务项目的计算单位，如：小时、单、次</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">平台佣金方式</label>
                    <div class="col-sm-9 col-xs-12">
                    	<div>
                            <input type="radio" name="gettype" value="1" onclick="check1(1)" {if $item['gettype'] == 1} checked {/if}>按百分比
                            <input type="text" name="bili_bai" id="bili_bai" value="{$item['bili_bai']}">%
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <input type="radio" name="gettype" value="0" onclick="check1(2)" {if $item['gettype'] == 0} checked {/if}>按每单收费
                            <input type="text" name="bili_money" id="bili_money" value="{$item['bili_money']}">元/单
                        </div>
                    </div>
                </div>
                
				
				<div id="show1">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">平台佣金峰值</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="start" id="start" value="{$item['start']}" >元
                        --
                        <input type="text" name="end" id="end" value="{$item['end']}" >元
                        <span class="help-block" style="color:red;">平台最低佣金与平台最高佣金[注意：只需在平台佣金方式按百分比计算时填写，默认为0]</span>
                    </div>
                </div>
				</div>
            
				
				
				<div id="show2">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">平台佣金结算</label>
                    <div class="col-sm-9 col-xs-12">
                    	<div>
                            <label class="radio-inline">
                                <input type="radio" name="times" value="1" {if $item['times'] == 1} checked {/if}>在选定人员时结算
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="times" value="0" {if $item['times'] == 0} checked {/if}>在付款是结算
                            </label>
                        </div>
						<span class="help-block">本选项仅对平台佣金方式为按单计算生效</span>
                    </div>
                </div>
				</div>
				
				<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">抢单余额下限</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="basemoney" id="basemoney" value="{$item[basemoney]}" class="form-control">
						<span class="help-block">服务人员余额低于此处设定值时不能抢单，设为0则可以一直抢单,设为负数服务人员可以欠款抢单</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">订单推送模板消息[给服务人员]</label>
                    <div class="col-sm-9 col-xs-12">
                    	<select name="otmpmsg_id" id="otmpmsg_id" class="form-control  input-s-lg">
                            <option value="0">选择模板消息</option>
                            {loop $list $vo}
                            <option value="{$vo[id]}" {if $item['otmpmsg_id'] == $vo[id]} selected {/if}>{$vo[message_name]}</option>
                            {/loop}
                        </select>
                        
                     <span class="help_block">当没有指定模板消息时使用指定的默认模板消息</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">抢单模板消息[给用户]</label>
                    <div class="col-sm-9 col-xs-12">
                    	<select name="qtmpmsg_id" id="qtmpmsg_id" class="form-control  input-s-lg">
                            <option value="0">选择模板消息</option>
                            {loop $list $vo}
                            <option value="{$vo[id]}" {if $item['qtmpmsg_id'] == $vo[id]} selected {/if}>{$vo[message_name]}</option>
                            {/loop}
                        </select>
                        
                     <span class="help_block">当没有指定模板消息时使用指定的默认模板消息</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">选定服务人员模板消息[给服务人员]</label>
                    <div class="col-sm-9 col-xs-12">
                    	<select name="xtmpmsg_id" id="xtmpmsg_id" class="form-control  input-s-lg">
                            <option value="0">选择模板消息</option>
                            {loop $list $vo}
                            <option value="{$vo[id]}" {if $item['xtmpmsg_id'] == $vo[id]} selected {/if}>{$vo[message_name]}</option>
                            {/loop}
                        </select>
                        
                     <span class="help_block">当没有指定模板消息时使用指定的默认模板消息</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">是否显示</label>
                    <div class="col-sm-9 col-xs-12">
                    	<div>
                            <label class="radio-inline">
                                <input type="radio" name="stop" value="1" {if $item['stop'] == 1} checked {/if}>是
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="stop" value="0" {if $item['stop'] == 0} checked {/if}>否
                            </label>
                        </div>
						<span class="help-block">可以控制此类型是否在页面显示</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-md-2 col-lg-1">
                        <input name="submit" type="submit" value="保存" class="btn btn-primary btn-block" />
                        <input type="hidden" name="token" value="{$_W['token']}" />
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript" src="{MODULE_URL}/template/mobile/js/main.js"></script>
<script type="text/javascript" src="{MODULE_URL}/template/mobile/js/jquery_min.js"></script>
<script>
$(document).ready(function(){  
	init();
}); 

function init(){
	var value="";
	var radio=document.getElementsByName("gettype");
	for(var i=0;i<radio.length;i++){
		if(radio[i].checked==true){
			value=radio[i].value;
		break;
		}
	}
	if(value==1){
		document.getElementById('show1').style.display = 'block';
		document.getElementById('show2').style.display = 'none';
	}else{
		document.getElementById('show1').style.display = 'none';
		document.getElementById('show2').style.display = 'block';
	}
}

function check1(id){
	if(id == 1){
		document.getElementById('show1').style.display = 'block';
		document.getElementById('show2').style.display = 'none';
	}else{
		document.getElementById('show1').style.display = 'none';
		document.getElementById('show2').style.display = 'block';
	}
}

function check(){
	var r = document.getElementById('parent_id').value;
	$.ajax({
		url: "{php echo $this->createWebUrl('checktype', array());}",
		type:"POST",
		data:{"id":r},
		dataType:"json",
		success: function(res){
			if(res > 0){
				location.reload();
				alert('您选择的所属父类下还有子类别，不能移动！');
			}
		}
	});
}

function check1(id){
	if(id == 1){
		document.getElementById('show1').style.display = 'block';
		document.getElementById('show2').style.display = 'none';
	}else{
		document.getElementById('show1').style.display = 'none';
		document.getElementById('show2').style.display = 'block';
	}
}
</script>
</script>

{template 'common/footer'}