<link href="{RES}css/style.css?v={TIMESTAMP}" rel="stylesheet" type="text/css">
<style type="text/css">

	.jun-menu
	{
		position: absolute;
		top: 100%;
		left: 0px;
		height: 46px;
		margin-top:-65px;
		width: 500px;
		z-index: 10002;
		-webkit-box-sizing: border-box;
	}

	.jun-menu-item
	{
		position: relative;
		float: left;
		width: 100px;
		height: 100%;
		line-height: 46px;
		text-align: center;
		font-size: 16pt;
		border: 1px solid #E1E1E1;
		border-radius: 24px;
		color: {if $cfg['fontbtns']}{$cfg['fontbtns']}{else}#fff{/if};
		margin-left: 20px;
		-webkit-box-sizing: border-box;
	}
	.jun-opacity-back
	{
		position: absolute;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		z-index: -1;
		background-color: {if $cfg['bgbtns']}{$cfg['bgbtns']}{else}#000{/if};
		border-radius: 24px;
		opacity: 0.6;
		-webkit-box-sizing: border-box;
	}
	#jun-wind
	{
		position: absolute;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		background-color: white;
		overflow: hidden;
		z-index: 10001;
		-webkit-box-sizing: border-box;
	}

	#jun-wind-title
	{
		position: relative;
		width: 100%;
		height: 60px;
		font-size: 18pt;
		line-height: 60px;
		padding-left: 4%;
		-webkit-box-sizing: border-box;
		background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}

	#jun-wind-close
	{
		position: absolute;
		top: 0px;
		float: right;
		right: 20px;
		height: 100%;
		line-height: 60px;
		font-size: 40pt;
		-webkit-box-sizing: border-box;
	}

	#jun-wind-content
	{
		width: 100%;
		height: 100%;
		overflow-y:auto;
		-webkit-overflow-scrolling: touch;
		-webkit-box-sizing: border-box;
	}

	.jun-template-item
	{
		position: relative;
		float: left;
		width: 140px;
		margin:20px 0 0 20px;
		height: 180px;
		border-left:1px solid #dddddd;
		border-top: 1px solid #dddddd;
		box-shadow:2px 2px 3px #dddddd;
		padding: 5px;
		-webkit-box-sizing: border-box;
	}

	.jun-template-item img
	{
		width: 100%;
		-webkit-box-sizing: border-box;
	}
	.jun-template-item span
	{
		width: 100%;
		line-height: 50px;
		text-align: center;
		display: block;
		font-size: 15pt;
		font-family: '微软雅黑';
	}

	.jun-content-bottom
	{
		position: relative;
		float: left;
		width: 500px;
		height: 120px;
		-webkit-box-sizing: border-box;
	}

	#jun-music-menu,#jun-template-menu
	{
		width: 100%;
		height: 50px;
		line-height: 50px;
		background:-webkit-gradient(linear, 0% 50%, 100% 50%,from(rgb(93,81,65)), to(rgb(75,65,63)));
		-webkit-box-sizing: border-box;
	}

	#jun-music-menu div
	{
		padding-left: 20px;
		position: relative;
		float: left;
		color: white;
		font-size: 15pt;
		-webkit-box-sizing: border-box;
	}
	#jun-template-menu div
	{
		padding-left: 28px;
		position: relative;
		float: left;
		color: white;
		font-size: 15pt;
		-webkit-box-sizing: border-box;
	}
	#jun-mp3box,#jun-template-box
	{
		position: absolute;
		height: 600px;
		width: 500px;
		overflow-y:auto;
		-webkit-overflow-scrolling: touch;
		-webkit-box-sizing: border-box;
	}

	.jun-mp3box-item
	{
		position: relative;
		height: 80px;
		width: 100%;
		border-bottom: 2px ridge #E5E5E5;
		-webkit-box-sizing: border-box;
	}

	.jun-mp3box-item-img
	{
		position: relative;
		float: left;
		margin:24px 0 0 20px;
		-webkit-box-sizing: border-box;
	}

	.jun-mp3box-item-title
	{
		position: relative;
		float: left;
		text-align:left;
		margin-left:10px;
		width:68%;
		font-size:17pt;
		font-weight:bold;
		color:black;
		height:80px;
		line-height:80px;
		overflow: hidden;
		-webkit-box-sizing: border-box;
	}

	.jun-mp3box-item-ok,.search-mp3box-item-ok
	{
		position: relative;
		display: none;
		float: right;
		text-align: center;
		height:40px;
		line-height:40px;
		margin: 20px 20px 0 0 ;
		text-align:center;
		font-size:18pt;
		font-weight:bold;
		width:65px;
		background-color:#FF2D52;
		color:white;
		border-radius:7px 7px 7px 7px;
		-webkit-box-sizing: border-box;
	}

	.jun-addpic-btn
	{
		width: 200px;
		height: 50px;
		line-height: 50px;
		text-align: center;
		margin: 20px 0 0 150px;
		font-size: 18pt;
		border-radius: 30px;
		-webkit-box-sizing: border-box;
		background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}

	.jun-addpic-tip
	{
		position: absolute;
		width: 460px;
		left: 20px;
		height: 400px;
		background-color: white;
		display: none;
		z-index: 1;
		top: 130px;
		-webkit-box-sizing: border-box;
		text-align: center;
	}

	.jun-addpic-tip span
	{
		display: block;
		width: 400px;
		text-align: center;
		font-size: 15pt;
		line-height: 30px;
		font-weight: bold;
		margin: 20px 0 5px 30px;
		-webkit-box-sizing: border-box;
	}

	.jun-addpic-tip div
	{
		position: relative;
		float: left;
		width: 110px;
		height: 40px;
		line-height: 40px;
		text-align: center;
		border-radius: 30px;
		margin-left: 80px;
		margin-top: 5px;
		font-size: 15pt;
		-webkit-box-sizing: border-box;
		background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}
	.jun-del-pic-b{
		position: relative;
	    width: 29%;
	    display: inline-block;
	    margin-right: 10px;
	}
	.jun-del-pic
	{
		position: relative;
		float: left;
		width: 100%;
		margin:20px 0 0 20px;
		height: 140px;
		background-size: cover;
		border:1px solid #BFBFBF;
		box-shadow:2px 2px 3px #aaaaaa;
		-webkit-box-sizing: border-box;
	}

	.jun-del-ok
	{
		position: absolute;
		width: 35px;
		height: 35px;
		line-height: 35px;
		font-size: 25pt;
		-webkit-box-sizing: border-box;
		top: 20px;
		left: 20px;
	}

	.jun-del-ok > div
	{
		border-radius: 50% !important;
		z-index: 0 !important;
		position: absolute;
		color: white;
		text-align: center;
		width: 100%;
		height: 100%;
		-webkit-box-sizing: border-box;
	}

	.jun-share-words , .jun-share-title , .jun-share-ok
	{
		position: relative;
		float: left;
		width:450px;
		left: 25px;
		margin-top: 40px;
		-webkit-border-radius: 7px;
		background-color:#e3e3e3;
		-webkit-box-sizing: border-box;
	}

	#jun-share-words , #jun-share-title
	{
		line-height:33px;
		width:440px;
		padding-left:10px;
		-webkit-background-clip: padding-box;
		background: rgba(227, 227, 227,1);
		-webkit-border-radius: 7px;
		font-size:18pt;
		resize:none;
		border:none;
		outline:none;
		-webkit-box-sizing: border-box;
	}

	#jun-share-title
	{
		line-height: 65px;
		-webkit-box-sizing: border-box;
	}

	.jun-share-ok
	{
		color: white;
		font-size: 18pt;
		font-weight: bold;
		height: 70px;
		line-height: 70px;
		text-align: center;
		background-color: rgb(250,97,65);
		-webkit-box-sizing: border-box;
	}
	#jun-rechoose-music
	{
	    position: absolute;
	    top: 17px;
	    left: 100px;
	    background-color: #FDAE00;
	    border-radius: 7px;
	    color: #fff;
	    width: 70px;
	    height: 30px;
	    font-size: 14px;
	    line-height: 30px;
	    text-align: center;
	    /*opacity: 0;*/
	}
	.title-ok{
		background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FF2D51{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}
	
	.musicbox-item-done{
		background: url("{if $cfg['icon_done']}{php echo toimage($cfg['icon_done'])}{else}{RES}img/music_tick.png{/if}");
		position: absolute;
	    width: 32px;
	    height: 32px;
	    background-size: 100% 100%;
	    top: 30%;
	    right: 5%;
	}
	
	.musicbox-item-play{
		background: url("{if $cfg['icon_play']}{php echo toimage($cfg['icon_play'])}{else}{RES}img/music_on.png{/if}");
		position: absolute;
	    width: 32px;
	    height: 32px;
	    background-size: 100% 100%;
	    top: 30%;
	    right: 15%;
	}
	
	.musicbox-item-play.on{
		background: url("{if $cfg['icon_pause']}{php echo toimage($cfg['icon_pause'])}{else}{RES}img/music_off.png{/if}");
		width: 32px;
	    height: 32px;
	    background-size: 100% 100%;
	}
	
	#music-menu, #style-menu{
		background: {if $cfg['bgcate']}{$cfg['bgcate']}{else}#4B413F{/if};
	}
	#style-menu,#music-menu div{
		color: {if $cfg['fontcate']}{$cfg['fontcate']}{else}#fff{/if};
	}
	div.active{
		color: {if $cfg['fontcateon']}{$cfg['fontcateon']}{else}#FF2D51{/if} !important;
	}
	
	.com_avatar{
    	width: 32px;
	    vertical-align: top;
	    border-radius: 50%;
	}
	.com_word{
		font-size: 18px;
    	line-height: 24px;
	}
	
	.com_item{
		display: inline-block;
	    opacity: 0.8;
	    border-radius: 10px;
	    padding: 5px 15px;
	    line-height: 24px;
	}
	#head-search{
	    position: absolute;
	    top: 7px;
	    right: 20%;
	    height: 45px;
	    line-height: 45px;
	    padding: 0 5px;
	    border-radius: 5px;		
	    display: none;
	    border: 1px solid {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}
	.search{
		font-size: 20px;
	    padding: 10px;
	    border: 0;
	    border-radius: 5px;
	    width: 19%;
	    margin-left: 1%;
	    background: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
	    color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};
	}
	
	.style_price {
		text-align: center;
	    font-size: 12pt;
	    color:rgb(250,97,65);
	    margin-top: -7px;
	}
	.squaredTwo {
	  width: 28px;
	  height: 29px;
	  float: left;
	  position: relative;
	  margin-left: 25px;
    	margin-right: 10px;
	}
	.squaredTwo label {
	  width: 25px;
	  height: 25px;
	  cursor: pointer;
	  position: absolute;
	  left: 4px;
	  border-radius: 50%;
	  background: gray;
	}
	.squaredTwo label.on {
		background: #09BB07;
	}
	.squaredTwo label:after {
	  content: '';
	  width: 9px;
	  height: 5px;
	  position: absolute;
	  top: 6px;
	  left: 6px;
	  border: 3px solid #fcfff4;
	  border-top: none;
	  border-right: none;
	  background: transparent;
	  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=30);
	  opacity: 0.3;
	  -moz-transform: rotate(-45deg);
	  -ms-transform: rotate(-45deg);
	  -webkit-transform: rotate(-45deg);
	  transform: rotate(-45deg);
	}
	.squaredTwo input[type=checkbox] {
	  visibility: hidden;
	}
	.squaredTwo input[type=checkbox]:checked + label:after {
	  filter: progid:DXImageTransform.Microsoft.Alpha(enabled=false);
	  opacity: 1;
	}
	
	.imgadjust {
		width: 100%;
		height: 34px;
		background: rgba(0,0,0,0.6)!important;
		float: left;
		margin-left: 20px;
	}
	
	.imgadjust .imgleft, .imgadjust .imgright {
		height: 34px;
		width: 50%;
		display: block;
		float: left;
		background: url({RES}img/leftorright.png) 5px center no-repeat;
		background-size: 50% 80%;
	}
	
	.imgadjust .imgright {
		-webkit-transform: rotate(180deg);
		-moz-transform: rotate(180deg);
	}
</style>
{if $_GPC['op'] == 'edit'}
{if $preview}
{template 'buy'}
{/if}
<div class="jun-menu">
	<div class="jun-menu-item" onclick="style_template_sel(1)">
		<div>选模板</div>
		<div class="jun-opacity-back"></div>
	</div>
	<div class="jun-menu-item" onclick="music_sel(2)">
		<div>选音乐</div>
		<div class="jun-opacity-back"></div>
	</div>
	<div class="jun-menu-item" onclick="edit_pic(3)">
		<div>增删图</div>
		<div class="jun-opacity-back"></div>
	</div>
	<div class="jun-menu-item" onclick="edit_title(4)">
		<div>保存</div>
		<div class="jun-opacity-back"></div>
	</div>
</div>
<div id="jun-wind" style="display:none">
	<div id="jun-wind-title">
		<div id="head-title">选择模板</div>
		<div id="head-search">搜索歌曲</div>
		<div id="jun-wind-close" onclick="reflush()">×</div>
	</div>
	<div id="jun-wind-content">
		<div id="jun-content-1">
			<div id="style-menu">
				<div id="style-type-0" onclick="style_click(0,this)" class="active">热门</div>
				{loop $stylecates $c}
				<div id="style-type-{$c['id']}" onclick="style_click({$c['id']},this)">{$c['title']}</div>
				{/loop}
			</div>
			<div id="style-box" style="padding-bottom: 60px;">
				<div id="template-0">
					{loop $shots $s}
					<div class="style-item" onclick="style_sel({$s['id']},{$s['price']})">
						<img src="{$s['path']}/img/preview.jpg">
						<span>{$s['title']}</span>
						{if $s['price'] > 0}
							{if !empty($own_style) && in_array($s['id'],$own_style)}
							<p class="style_price">已购买</p>
							{else}
							<p class="style_price">{$s['price']} 元</p>
							{/if}
						{else}
						<p class="style_price" style="color:#ccc;">免费</p>
						{/if}
					</div>
					{/loop}
				</div>
				{loop $stylecates $cs}
				<div id="template-{$cs['id']}" style="display: none;">
					{loop $cs['list'] $s}
					<div class="style-item" onclick="style_sel({$s['id']},{$s['price']})">
						<img src="{$s['path']}/img/preview.jpg">
						<span>{$s['title']}</span>
						{if $s['price'] > 0}
							{if !empty($own_style) && in_array($s['id'],$own_style)}
							<p class="style_price">已购买</p>
							{else}
							<p class="style_price">{$s['price']} 元</p>
							{/if}
						{else}
						<p class="style_price" style="color:#ccc;">免费</p>
						{/if}
					</div>
					{/loop}
				</div>
				{/loop}
				<div class="jun-content-bottom"></div>
			</div>
		</div>
		<div id="jun-content-2">
			<div id="music-menu">
				<div id="music-type-0" onclick="music_click(0,this)" class="active">热门</div>
				{loop $musiccates $c}
				<div id="music-type-{$c['id']}" onclick="music_click({$c['id']},this)">{$c['title']}</div>
				{/loop}
			</div>
			<div id="musicbox">
				<div id='music-0' style="padding-bottom: 180px;">
					{loop $mhots $k $m}
					<div class="musicbox-item">
						<div class="musicbox-item-title">{$m['title']}</div>
						<div class="musicbox-item-play" onclick="music_choose('{php echo toimage($m['url'])}',this)"></div>
						<div class="musicbox-item-done" onclick="music_select({$m['id']},'{php echo toimage($m['url'])}')"></div>
					</div>
					{/loop}
				</div>
				{loop $musiccates $ms}
				<div id='music-{$ms["id"]}' style="display: none;padding-bottom: 180px;">
					{loop $ms['list'] $k $m}
					<div class="musicbox-item">
						<div class="musicbox-item-title">{$m['title']}</div>
						<div class="musicbox-item-play" onclick="music_choose('{php echo toimage($m['url'])}',this)"></div>
						<div class="musicbox-item-done" onclick="music_select({$m['id']},'{php echo toimage($m['url'])}')"></div>
					</div>
					{/loop}
				</div>
				{/loop}
			</div>
		</div>
		<div id="jun-content-3">
			<div class="jun-addpic-btn" onclick="jun_add_pic()">新增图片</div>
			<div class="jun-addpic-tip" id="jun-addpic-tip">
				<span>返回公众号输入界面，并点击下方”添加图片“按钮，来增加图片。</span>
				<img src="../addons/junsion_album/template/mobile/img/help2.jpg">
				<span>确定增加图片吗？</span>
				<div onclick="jun_addpic_ok()">确定</div>
				<div onclick="jun_addpic_cancle()">取消</div>
			</div>
			<div id="jun-pics-content"></div>
			<div class="jun-addpic-btn" style="margin-bottom:190px" onclick="reflush()">完成</div>
		</div>
		<div id="jun-content-4">
			<div class="album-title">
				<textarea id="album-title" maxlength="30" rows="3" placeholder="标题文字(限30字)...">{$album['title']}</textarea>
			</div>
			<div style="height: 31px;line-height: 31px;margin-top: 20px;font-size: 18px;">
				<div class="squaredTwo">
			      <input type="checkbox" value="1" id="squaredTwo" name="opening" {if ($cfg['sqshare'] && $album['lasttime']==0) || $album['opening']}checked{/if}/>
			      <label for="squaredTwo" {if ($cfg['sqshare'] && $album['lasttime']==0) || $album['opening']}class="on"{/if} onclick="$(this).toggleClass('on')"></label> 
			    </div>
			    分享到相册广场获得更多的赞和打赏
			</div>
			<div class="title-ok" onclick="title_sure()">确定</div>
		</div>
		<div id="jun-content-5">
			<div id="music-menu" style="padding: 1px 1%;text-align: center;">
				<input type="text" id="kw" style="width: 75%;padding: 10px;font-size: 20px;border: 0;border-radius: 5px;"><button class="search" onclick="searchMusic()">搜索</button>
			</div>
			<div id="musicbox" style="margin-bottom: 180px;">
				<div></div>
			</div>
		</div>
	</div>
</div>
{template 'loading'}
<script>
//下拉加载
var pageNo = 1;
var loading = false;
var key = '';
var range = 50; 
var content = $('#jun-content-5 #musicbox').find('div');
function getList(){
	LOADING(true);
	$.ajax({
		url:"{php echo $this->createMobileUrl('search')}",
		type:'post',
		data:{kw:key,pageNo:pageNo,limit:15},
		success:function(data){
			if(data != '1'){
				data = JSON.parse(data);
				if(pageNo == 1) content.empty();
				var str = '';
				$.each(data,function(k,v){
					var title = v['title'];
					var url = v['url'];
					str += '<div class="musicbox-item"><div class="musicbox-item-title">'+title+'</div>';
					str += '<div class="musicbox-item-play" onclick="music_choose(\''+url+'\',this)"></div>';
					str += '<div class="musicbox-item-done" onclick="music_select(\''+url+'\',\''+url+'\')"></div></div>';
				});
				content.append(str);
				LOADING(false);
				pageNo++;
			}else pageNo = 0;
			loading = false;
		}
	});
}
$(function(){
	$('#jun-content-5 #musicbox').scroll(function(){
		if(loading) return;
	    var srollPos = $('#jun-content-5 #musicbox').scrollTop(); //滚动条距顶部距离(页面超出窗口的高度)
	    totalheight = parseFloat($('#jun-content-5 #musicbox').height()) + parseFloat(srollPos);
	    if((content.height()-range) <= totalheight && pageNo > 1) {
	    	loading = true;
	    	getList();
	    }            
	});
});

function searchMusic(){
	key = $.trim($('#kw').val());
	if(key == '') return;
	pageNo = 1;
	getList();
}

var urls = new Array();
for(var i = 0; i < slider_images_url.length; i++) urls.push(slider_images_url[i]);
function onImgClick(index){
	wx.ready(function(){
		wx.previewImage({
		      current: slider_images_url[index],
		      urls:urls,
		});
	});
}

function style_sel(sid,price){
	if(price == 0){
		var url ="{php echo $this->createMobileUrl('style',array('aid'=>$_GPC['aid']))}";
	}else{
		var url ="{php echo $this->createMobileUrl('buystyle',array('aid'=>$_GPC['aid']))}";
	}
	$.ajax({
		url:url,
		type:'post',
		data:{sid:sid},
		success:function(data){
			if(price == 0){
				if(data == '1') location.reload();
			}else{
				if(data == '2'){
					location.reload();
				}else{
					var uu = "{php echo $this->createMobileUrl('album',array('aid'=>$_GPC['aid'],'op'=>'edit'))}";
					location.href = uu;
				}
			}
		}
	});
}

function music_select(mid,url){
	$.ajax({
		url:"{php echo $this->createMobileUrl('music',array('aid'=>$_GPC['aid']))}",
		type:'post',
		data:{mid:mid},
		success:function(data){
			tool_close();
			jun_music_player.src = url;
			jun_music_player.play();
			if (objid('sound_image')) {
				objid('sound_image').style.webkitAnimation = "zhuan 1s linear infinite";
			}
			jun_close_wind();
		}
	});
}

function music_click(index,obj){
	$('#musicbox .musicbox-item').parent().hide();
	$('#music-'+index).show();
	$('#music-menu div').removeClass('active');
	$(obj).addClass('active');
}

function style_click(index,obj){
	$('#style-box .style-item').parent().hide();
	$('#template-'+index).show();
	$('#style-menu div').removeClass('active');
	$(obj).addClass('active');
}
var reloadindex = 0;
	function reflush() {
		//修改图片顺序
		if(reloadindex != 0) return '';
		reloadindex++;
		var img_order_edit = false;
		var order = '';
		$.each($('.jun-del-pic-b'),function(k,v){
			var o = $(v).attr('data-order');
			order += o+",";
			if(o != k) img_order_edit = true;
		})
		if(img_order_edit){
			$.ajax({
				url:"{php echo $this->createMobileUrl('order',array('aid'=>$_GPC['aid']))}",
				type:'post',
				data:{order:order},
				success:function(){
					location.reload();
				}
			});
		}else location.reload();
	}

	function jun_close_wind() {
		tool_close();
		objid('jun-wind').style.display = 'none';
		if (objid('music_player')) {
			objid('music_player').pause();
		}
	}
	var titles = ["选模板", "选音乐", "更换图片", "写相册的标题",'搜索歌曲'];

	function jun_open_wind(index) {
		tool_open();
		var wind = objid('jun-wind');
		wind.style.display = 'block';
		for (var i = 1; i <= titles.length; i++) {
			objid('jun-content-' + i).style.display = 'none';
		}
		$('#head-search').hide();
		if(index == 2) $('#head-search').show();
		objid('jun-content-' + index).style.display = 'block';
		objid('head-title').innerHTML = titles[index - 1];
	}
	$('#head-search').click(function(){
		jun_close_wind();
		jun_open_wind(5);
	});
	
	//
	function style_template_sel(index) {
		jun_close_wind();
		jun_open_wind(index);
	}
	//音乐
	var jun_music_page = 0;
	var jun_music_num = 20;
	var jun_music_type = 'pop';

	function tool_open() {
		document.ontouchmove = null;
	}

	function tool_close() {
		document.ontouchmove = function(e) {
			e.preventDefault();
		}
	}

	function music_sel(index) {
		jun_close_wind();
		jun_open_wind(index);
	}


	function music_choose(url,obj) {
		$('.musicbox-item-play').removeClass('on');
		$(obj).addClass('on');
		if (jun_music_player != null) {
			jun_music_player.pause();
			if (objid('sound_image')) {
				objid('sound_image').style.webkitAnimation = "";
			}
		}
		if (objid('music_player') == null) {
			var player = document.createElement('audio');
			player.id = 'music_player';
			player.src = url;
			player.loop = 'loop';
			player.play();
			document.body.appendChild(player);
		} else if (objid('music_player').src == url) {
			if (objid('music_player').paused) {
				objid('music_player').play();
			} else {
				objid('music_player').pause();
			}
		} else {
			objid('music_player').src = url;
			objid('music_player').play();  
		}
	}

	//删图
	function edit_pic(index) {
		jun_close_wind();
		jun_open_wind(index);
		var obj = objid('jun-pics-content');
		obj.innerHTML = '';
		for (var i = 0; i < slider_images_url.length; i++) {
			var str = "<div class='jun-del-pic-b' data-order='"+i+"'>";
			str += "<div id='jun-del-pic-"+i+"' onclick='onImgClick("+i+")' class='jun-del-pic' style='background:url(" + slider_images_url[i] + ");background-size:100% 100%'></div>";
			var photo_id = slider_images_url[i];
			str += '<div class="jun-del-ok" onclick="jun_del_pic(this, \'' + photo_id + '\')"><div class="jun-opacity-back"></div><div>×</div></div>';
			str += '<div class="imgadjust"><a class="imgleft">&nbsp;</a><a class="imgright">&nbsp;</a></div>';
			str += "</div>";
			$(obj).append(str);
		}
		obj.style.overflow = 'auto';
		var parent = document.getElementById("jun-content-3");
		parent.style.overflow = 'auto';
		
		$('.imgleft').click(function(){
			var curImg = $(this).parent().parent();
			var preImg = curImg.prev();
			console.log(preImg)
			if(preImg){
				curImg.insertBefore(preImg);
				preImg.insertAfter(curImg);
			}
		});
		$('.imgright').click(function(){
			var curImg = $(this).parent().parent();
			var neImg = curImg.next();
			console.log(neImg)
			if(neImg){
				neImg.insertBefore(curImg);
				curImg.insertAfter(neImg);
			}
		});
	}

	var images = new Array();
	var loadNum = 0;
	var needLoadNum = 0;
	
	function jun_add_pic() {
		{if $cfg['netcreate']}
		//拍照或从手机相册中选图接口
		wx.chooseImage({
		    count: 9, // 默认9
		    success: function (res) {
		    	for(var i in res.localIds){
		    		needLoadNum++;
		    		images.push(res.localIds[i]); // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
		    	}
		    	$('#loadingToast .weui_toast_content').text("上传中("+0+"/"+needLoadNum+")");
		    	LOADING(true);
		    	upload();
		    }
		});
		return '';
		{/if}
		objid('jun-addpic-tip').style.display = 'block';
	}
	
	var pics = new Array();	
	function upload(){
		wx.uploadImage({
			localId : images[loadNum], // 需要上传的图片的本地ID，由chooseImage接口获得
			isShowProgressTips : 0, // 默认为1，显示进度提示
			success : function(res) {
				$.ajax({
					type:"POST",
					url:"{php echo $this->createMobileUrl('upload')}",
					data:{imgid:res.serverId},
					success:function(data){
						var data = $.parseJSON(data);
						if(data.code == 1){
							loadNum++;
							$('#loadingToast .weui_toast_content').text("上传相片中("+loadNum+"/"+needLoadNum+")");
							pics.push(data.thumb);
							slider_images_url.push(data.thumb);
							urls.push(data.thumb);
							if(needLoadNum == loadNum){//最后一个图片
								$.ajax({
									url:"{php echo $this->createMobileUrl('addpic',array('aid'=>$_GPC['aid']))}",
									type:'post',
									data:{pics:JSON.stringify(pics)},
									success:function(data){
										data = JSON.parse(data);
										$('#loadingToast .weui_toast_content').text("数据加载中");
										LOADING(false);
										if(data.code==0){
											alert(data.msg);
										}else{
											edit_pic(3);
										}
									}
								});
							}
						}
						upload();
					}
				});
			},
		});
		return false;
	}	

	function jun_addpic_ok() {
			$.ajax({
				url:"{php echo $this->createMobileUrl('curalbum',array('aid'=>$_GPC['aid']))}",
				success:function(){
					wx.closeWindow();
				}
			});
	}

	function jun_addpic_cancle() {
		objid('jun-addpic-tip').style.display = 'none';
	}

	function jun_del_pic(obj, photo_id) {
		if (!confirm('确定要删除该照片吗？')) {
			return;
		}
		var index = $(obj).parent().index()
		console.log(index)
		$('.jun-del-pic-b').eq($(obj).parent().index()).remove();
		var photo_urls = slider_images_url.splice(index, 1);
		
		var id = "{$_GPC['aid']}";
		
		$.ajax({
			url:"{php echo $this->createMobileUrl('delpic',array('aid'=>$_GPC['aid']))}",
			type:'post',
			data:{key:index},
		});
	}
	//标题
	function edit_title(index) {
		jun_close_wind();
		jun_open_wind(index);
		if (atitle == '音乐相册，打开看看')
			objid('album-title').value = '';
		else
			objid('album-title').value = atitle;
	}

	function title_sure() {
		var obj = objid('album-title');
		if (obj.value == "") {
			alert('文字不能为空噢~');
		} else {
			atitle = obj.value;
			$.ajax({
				url:"{php echo $this->createMobileUrl('title',array('aid'=>$_GPC['aid']))}",
				type:'post',
				data:{title:atitle,open:$('#squaredTwo').prop('checked')?1:0},
				success:function(data){
					location.reload();
				}
			});
		}
	}
</script>
{/if}
<script>
function showjubao () 
{

	objid('jubao-content').style.display = 'block';		
}
function hidejubao ()
{
	objid('jubao-content').style.display = 'none';
}
var bjubao_type = false;
function showjubaoimg (num) 
{
	var img = objid('jubaoimg-'+num);
	if(img.style.display == 'none')
	{
		
		var imgarr = document.getElementsByClassName('jubao-radio');
		for(var i=0;i<imgarr.length;i++)
		{
			imgarr[i].style.display = 'none';
		}
		img.style.display = 'block';
		if(objid("jubao-detail").value >=5)
		{
			objid('jubao-submit').style.display = 'block';
		}
		bjubao_type = true;
	}
	else
	{
		img.style.display = 'none';
		objid('jubao-submit').style.display = 'none';
		bjubao_type = false;

	}
}
function showjubaoimg2()
{
	if(objid("jubao-detail").value.length >= 5 && bjubao_type){
		$("#jubao-submit").show();
	}
	else
	{
		$("#jubao-submit").hide();
	}
}

$(function(){
	$("#zan").click(function(){
		var that = $(this);
		var aid = $(this).attr('data-aid');
		$.ajax({
			url:"{php echo $this->createMobileUrl('zan')}",
    		type:'post',
    		data:{aid:aid},
    		success:function(data){
    			if(data == 1){
    				$('.is_zan').attr('src','../addons/junsion_album/template/mobile/img/zan1.png');
    				var num = $("#zan_num").html();
    				$("#zan_num").html(parseInt(num)+1);
    			}else if (data == 2){
    				$('.is_zan').attr('src','../addons/junsion_album/template/mobile/img/zan.png');
    				var num = $("#zan_num").html();
    				if(parseInt(num) - 1 <= 0){
    					num = 0;
    				}else{
    					num = parseInt(num) - 1;
    				}
    				$("#zan_num").html(num);
    			}else{
    				alert('点赞失败，请重试');
    			}
    			$("#jubao-content").hide();
    		},error:function(){
    			alert("网络错误");
    		}
		});
	});
	
	
	$("#jubao-submit").click(function(){
		if(objid("jubao-detail").value.length < 5)
		{
			alert("问题描述字数太少！");
			return;
		}
		var img_arr = document.getElementsByClassName('jubao-radio');
		var jubao_type = 0;
		while(img_arr[jubao_type].style.display == 'none')
		{
			jubao_type++;
		}
		var aid = $(this).attr('data-aid');
		var detail = encodeURIComponent(objid("jubao-detail").value);
		
		$.ajax({
			url:"{php echo $this->createMobileUrl('feedback')}",
    		type:'post',
    		data:{aid:aid,jubao_type:jubao_type,detail:detail},
    		success:function(data){
    			if(data == 1){
    				alert('反馈提交成功！');
    				$("#fankui").css("background-color","rgba(0, 255, 0, 0.5)");
    			}else if (data == 2){
    				alert('自己不能反馈自己的相册');
    			}else if (data == 4){
    				alert('您已经反馈该相册了，不能重复反馈');
    			}else{
    				alert('反馈失败');
    			}
    			$("#jubao-content").hide();
    		},error:function(){
    			alert("网络错误");
    		}
		});
		
	});
	
	
$("#comment-submit").click(function(){
		var aid = $(this).attr('data-aid');
		var detail = $.trim($("#comment-detail").val());
		if(detail == '') return '';
		var content = encodeURIComponent(detail);
		var len = 0 ;
		$.ajax({
			type:'post',
			url:"{php echo $this->createMobileUrl('comment')}",
			data:{aid:aid,content:content},
			success:function(data){
				data = $.parseJSON(data);
				//console.log(data);
				if(data.errorcode == '1'){
					$("#comment-content").hide();
					$("#is_open").empty();
    				var txt = '弹幕 开';
    				$("#is_open").append(txt);
    				$("#is_open").css("background-color","rgba(255, 0, 0, 0.5)");
					$("#is_open").attr("data-open",'2');
					
					if($("#dm").hide()){
						$("#dm").toggle(1000);
					}
					$('.dm-main').empty();
					var str = {};
					for(var i = 0, t;t = data.allcomment[i++];){
						var now_style = parseInt(Math.random()*11) + parseInt(i);
						var top = Math.random()*5; 
						
						var right = parseFloat(Math.random()*75);
						if(now_style <= 11){
							var style_font = now_style;
						}else{
							var style_font = Math.round(now_style/11);
						}
						top = parseInt(top);
						if(!str[i%7]) str[i%7] = '';
						str[i%7] += '<div style="margin-top:'+top+'px;margin-right: '+right+'%;" class="com_item w_word w_word'+style_font+'"><img class="com_avatar" src="'+t.avatar+'" /><em class="com_word"> '+t.content+'</em></div>';
					}
					$.each(str,function(k,v){
						$('.dm-main').append("<marquee scrollamount='"+GetRandomNum(8,15)+"'  behavior='scroll' loop='-1' style='white-space: nowrap;' >"+v+"</marquee>");
					});
				}else{
					alert(data.msg);
				}
				
			},error:function(){
				alert("网络错误，请重试");
			}
		});
	});
	
	$("#is_open").click(function(){
		var that = $(this);
		var aid = $(this).attr('data-aid');
		var is_open = $(this).attr('data-open');
		if(is_open == 2){
			that.empty();
			var txt = '弹幕 关';
			that.append(txt);
			$("#is_open").css("background-color","rgba(0, 0, 0, 0.5)");
			that.attr("data-open",'1');
			$("#dm").fadeToggle(1000);
			return false;
		}
		var m = $('.dm-main marquee');
		var len = 0 ;
		$.ajax({
			type:'post',
			url:"{php echo $this->createMobileUrl('comment',array('op'=>'open'))}",
			data:{aid:aid,is_open:is_open},
			success:function(data){
				data = $.parseJSON(data);
				if(data.errorcode == '1'){
					if(is_open == 1){
						if($("#dm").hide()){
							$("#dm").fadeToggle(1000);
						}
						that.empty();
	    				var txt = '弹幕 开';
	    				that.append(txt);
	    				$("#is_open").css("background-color","rgba(255, 0, 0, 0.5)");
						that.attr("data-open",'2');
						$('.dm-main').empty();
						var str = {};
						for(var i = 0, t;t = data.allcomment[i++];){
							var now_style = parseInt(Math.random()*11) + parseInt(i);
							var top = Math.random()*5; 
							
							var right = parseFloat(Math.random()*75);
							if(now_style <= 11){
								var style_font = now_style;
							}else{
								var style_font = Math.round(now_style/11);
							}
							top = parseInt(top);
							if(!str[i%7]) str[i%7] = '';
							str[i%7] += '<div style="margin-top:'+top+'px;margin-right: '+right+'%;" class="com_item w_word w_word'+style_font+'"><img class="com_avatar" src="'+t.avatar+'" /><em class="com_word"> '+t.content+'</em></div>';
						}
						$.each(str,function(k,v){
							$('.dm-main').append("<marquee scrollamount='"+GetRandomNum(8,15)+"'  behavior='scroll' loop='-1' style='white-space: nowrap;' >"+v+"</marquee>");
						});
					}
				}else{
					alert(data.msg);
				}
			},error:function(){
				alert("网络错误，请重试");
			}
		});
	});
	{if $cnum}$("#is_open").click();{/if}
	

	$("#comment-cancel").click(function(){
		$("#comment-content").hide();
	});
});
function GetRandomNum(Min,Max)
{   
	var Range = Max - Min;   
	var Rand = Math.random();   
	return(Min + Math.round(Rand * Range));   
}   

</script>
<style>
#dm{width:100%;height:100%;position:absolute;top:0;left:0;display:none; z-index: 20; background: none;}
#dm span.user_img{ width: 30px; height: 30px; display: block; float: left; margin-right: 5px; overflow: hidden; border-radius: 50%; -webkit-border-radius: 50%; -moz-border-radius: 50%;}
#dm span.user_img img{ width: 100%; height: 100%; display: block;}
#dm .send{ position: absolute; z-index: 220; left: 0px; bottom: 0px; background: #fff; width: 100%; padding: 8px 0px; height: auto; overflow: hidden; display: box; display: -webkit-box; display: -moz-box;}
#dm .s_fiter{width: 100%; box-flex:1; -webkit-box-flex:1; -moz-box-flex:1; margin-left: 8px; border: 1px solid #ccc; padding: 5px; height: 36px;}
#dm .s_fiter textarea{ width: 100%; height: 100%; outline: none; border: 0; background: none; line-height: 18px;}
#dm .s_con{ width: 60px; height: auto; margin: 0px 8px;}
#dm .s_con input{ width:100%; text-align: center; height: 46px; line-height: 46px; color: #fff; background: #00aaec; border: 0;}

.dm-main marquee{margin-bottom: 6%;}
.dm-main marquee:first-child{margin-top: 10px;}
.dm-main marquee div{line-height: 32px;display: inline-block;margin-right: 40%;}

.w_word{color: white;font-size:18px;}
.w_word1{background:#666; }
.w_word2{background:#006699; }
.w_word3{background:#666; }
.w_word4{background:#0099CC; }
.w_word5{background:#428bca; }
.w_word6{background:#c00; }
.w_word7{background:#44b549; }
.w_word8{background:#bb4046; }
.w_word9{background:#428bca; }
.w_word10{background:#FD9A00; }
.w_word11{background:#006699; }
</style>

<!--弹幕提示层-->
<div class="barrageLayer">
	<div class="barrageLayerL">
		<marquee scrollamount='9'>
			<div style="display: inline-block;margin-right: 40%;">
				<span>
					<img src="{$s['avatar']}" />
				</span>
				<em></em>
			</div>
		</marquee>
	</div>
</div>
<!--弹幕提示层 end-->
<!--dm start-->
<div id="dm">
	<div class="dm-main">
	<marquee class="dm_main" scrollamount='{php echo mt_rand (5,20)}' behavior="scroll" loop="-1" style="white-space: nowrap;">
		<div class=""><span class="user_img"><img src="" /></span></div>
	</marquee>
	</div>
</div>
<!--end dm-->

<style>
.comment-detail {position: relative; float: left;width: 360px; margin-left: 20px;}
.comment-detail textarea { width: 360px; height: 80px; font-size: 20px;resize: none;line-height: 40px;margin-top:15px;border: none; background-color: #eee;border-radius: 10px;padding-left: 10px;}
</style>
{if $_GPC['op'] != 'edit'}
<div id="comment_click" style='height:50px;position:absolute;bottom:20px;color:white;text-shadow:1px 1px 1px #000;z-index:255;'>
	{if !empty($_W['openid'])}
		<div id="zan" data-aid="{$aid}" style="position:absolute;left:400px;top:-70px;z-index:101;text-shadow: none;background-color: rgba(0, 0, 0, 0.5);width: 80px;height: 45px;border-radius: 5px;font-size: 16px;line-height: 45px;text-align: center;color:#fff;">
		{if $iszan['isshow'] == 1}<img class="is_zan" style="width:25px;margin-top: 10px;" src="../addons/junsion_album/template/mobile/img/zan1.png">
		{else}
		<img class="is_zan" style="width:25px;margin-top: 10px;" src="../addons/junsion_album/template/mobile/img/zan.png">
		{/if}
		<span id="zan_num" style="font-size:20px;margin-left:5px;vertical-align: top;">{$zan_num}</span>
		</div>
		<div {if empty($fans_avatar)}onclick="location.href='{php echo $this->createMobileUrl('isoauth',array('aid'=>$_GPC['aid'],'mid'=>$_GPC['mid'],'op'=>'comment'))}'"{else}onclick="$('#comment-content').show();"{/if} style="position:absolute;left:15px;top:-16px;z-index:101;text-shadow: none;background-color: rgba(0, 0, 0, 0.5);width: 80px;height: 45px;border-radius: 5px;font-size: 20px;line-height: 45px;text-align: center;color:#fff;">
		<!-- <img style="width:25px;margin-top: 13px;" src="../addons/junsion_album/template/mobile/img/ping.png"> -->
		评论
		</div>
	{/if}
	<div id="is_open" data-aid="{$aid}" data-open="1" style="position:absolute;left:15px;top:-70px;text-shadow: none;background-color: rgba(0, 0, 0, 0.5);width: 80px;height: 45px;border-radius: 5px;font-size: 20px;line-height: 45px;text-align: center;color:#fff;">
	弹幕 关
	</div>

</div>
<div id='comment-content' style='{if $_GPC['is_show']!=2}display:none;{/if}position:absolute;width:400px;background-color:#fff;height:250px;top:200px;left:50px;z-index:15000;'>
	<div style='width:400px;height:45px;text-align:center;font-size:22px;line-height:45px;background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};'>*^_^*&nbsp;评　论&nbsp;*^_^*</div>
	<div class="comment-detail">
 		<textarea id="comment-detail" placeholder="请输入评论" maxlength="100"></textarea>
 	</div>
 	<div id='comment-cancel' style='position:absolute;width:120px;height:40px;background-color:#ACABAB;left:47px;top:180px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;'>取消</div>
	<div id='comment-submit' data-aid="{$aid}" style='position:absolute;width:120px;height:40px;left:229px;top:180px;border-radius:5px;font-size:20px;line-height:40px;text-align:center;background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};'>提交</div>
</div>
{/if}
{if $is_maker == 0}
{if $cfg['selfurl']}
<a id="guanzhu_container" href="{$cfg['selfurl']}" class="large button" style="padding:0;text-align:center;line-height:45px;font-size:22px;position:absolute;bottom:40px;left:150px;width:200px;height:45px;z-index:9999;-webkit-animation:guangzhu_ani 0.8s linear infinite alternate;background-color: {if $cfg['bgself']}{$cfg['bgself']}{else}#91bd09{/if};
		color: {if $cfg['fontself']}{$cfg['fontself']}{else}white{/if};">自己做相册</a>
{/if}
{if !empty($_W['openid'])}
<div id='jubao-click' style='height:50px;position:absolute;bottom:20px;color:white;text-shadow:1px 1px 1px #000;z-index:201;width: 100%;'>
	<div style='position:absolute;width: 100%;text-align:center;top:35px;text-decoration:none;font-size:12px;opacity:0.5;'>该相册为用户个人作品，非公众号发布</div>
	<div id="fankui" {if empty($fans_avatar)}onclick="location.href='{php echo $this->createMobileUrl('isoauth',array('aid'=>$_GPC['aid'],'mid'=>$_GPC['mid'],'op'=>'feedback'))}'"{else}onclick="$('#jubao-content').show();"{/if} style="position:absolute;left:400px;top:-16px;text-shadow: none; background-color: rgba(0, 0, 0, 0.5);width: 80px;height: 45px;border-radius: 5px;font-size: 20px;line-height: 45px;text-align: center;color:#fff;">
	反馈
	</div>
</div>
 <div id='jubao-content' style='position:absolute;width:400px;background-color:#fff;height:540px;top:100px;left:50px;display:none;z-index:15000'>
 	<div style='width:400px;height:45px;;text-align:center;font-size:22px;line-height:45px;background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};'>意见反馈或投诉</div>
 	<div id='jubao-1' class='jubao-item' onclick='showjubaoimg(0)'>色情低俗<img id='jubaoimg-0' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div id='jubao-2' class='jubao-item' onclick='showjubaoimg(1)'>谣言<img id='jubaoimg-1' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div id='jubao-3' class='jubao-item' onclick='showjubaoimg(2)'>诱导分享<img id='jubaoimg-2' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div id='jubao-4' class='jubao-item' onclick='showjubaoimg(3)'>政治敏感<img id='jubaoimg-3' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div id='jubao-5' class='jubao-item' onclick='showjubaoimg(4)'>冒用或诽谤他人<img id='jubaoimg-4' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div id='jubao-6' class='jubao-item' onclick='showjubaoimg(5)'>相册播放有问题<img id='jubaoimg-5' class='jubao-radio' style='display:none;top: 15px;' src='{RES}img/music_tick.png'></div>
 	<div class="jubao-detail">
 		<textarea id="jubao-detail" placeholder="问题描述（必填，至少5个字）" oninput="showjubaoimg2()" maxlength="100"></textarea>
 	</div>
 	<div onclick='hidejubao()' id='jubao-cancel' style='position:absolute;width:120px;height:40px;background-color:#ACABAB;left:47px;top:480px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;'>取消</div>
	<div style='position:absolute;width:120px;height:40px;background-color:#ACABAB;left:229px;top:480px;color:white;border-radius:5px;font-size:20px;line-height:40px;text-align:center;'>提交</div>
	<div onclick='submitjubao()' id='jubao-submit' data-aid="{$aid}" style='position:absolute;width:120px;height:40px;left:229px;top:480px;border-radius:5px;font-size:20px;line-height:40px;text-align:center;display:none;
	background-color: {if $cfg['bgtheme']}{$cfg['bgtheme']}{else}#FA6141{/if};
		color: {if $cfg['fonttheme']}{$cfg['fonttheme']}{else}white{/if};'>提交</div>
 </div>
{/if}
{/if}
<script>
var is_show = "{$_GPC['is_show']}";
if(is_show == 1){
	$("#jubao-content").show();
}
if(is_show == 2){
	$("#comment-content").show();
}

</script>