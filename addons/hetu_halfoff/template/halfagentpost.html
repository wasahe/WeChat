{template 'common/header'}
<div class="main">
	<ul class="nav nav-tabs">
		<li ><a href="{php echo $this->createWebUrl('halfoffagent', array('op'=>'list'));}">代理商列表</a></li>
		<li {if empty($item['id'])} class="active"{/if} ><a href="{php echo $this->createWebUrl('halfoffagent', array('op'=>'post'));}">代理商添加</a></li>
		{if $item['id']}
		  <li  class="active" ><a href="{php echo $this->createWebUrl('halfoffagent', array('op'=>'post', 'id' => $item['id']));}">代理商编辑</a></li>
		{/if}
	</ul>
<div class="main">
    <form action="" class="form-horizontal form" method="post" enctype="multipart/form-data" onsubmit="return formcheck()">
		<input type="hidden" name="id"  id="id" value="{$item['id']}">
		<div class="panel panel-default">
			<div class="panel-heading">代理商基本信息</div>
			<div class="panel-body"> 
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商名称：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="name" id="name"  class="form-control" value="{$item['name']}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商密码：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="password" name="password" id="password"  class="form-control" value="">
						{if $item['id']}
							<div class="help-block">如不修改，可留空！</div>
						{/if}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商确认密码：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="password" name="confirmpassword" id="confirmpassword"  class="form-control" value="" onblur="checkpwd();">
						{if $item['id']}
							<div class="help-block">如不修改，可留空！</div>
						{/if}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商手机号码：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="phone" id="phone"  class="form-control" value="{$item['phone']}">
						<span style="color:red;">此联系方式为代理商WEB登录账号，请填写手机号码</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商详细地址：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="address" id="address"  class="form-control" value="{$item['address']}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">状态：</label>
					<div class="col-sm-9 col-xs-12">
						<label class="radio-inline">
							<input type="radio" name="status" value="0" {if $item['status'] == 0}checked{/if}/>隐藏
						</label>
						<label class="radio-inline">
							<input type="radio" name="status" value="1" {if $item['status'] == 1}checked{/if}/>显示
						</label>
						<span class='help-block'>手机前台是否显示</span>
					</div>
				</div>
			</div>
  	             <div class="panel-heading">代理商首页基本信息
                   <span style="color:red;">&nbsp;【注意：如不填写，将默认参数设置】</span>
                   </div>
                 <div class="panel-body"> 
                    <div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">首页幻灯片：</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_multi_image('banner', $banner)}
						<div class="help-block">
							<code>幻灯片图片尺寸大小建议：600 * 200</code>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">幻灯片链接：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="imgurl" id="imgurl" class="form-control" value="{$item['imgurl']}">
						<div class="help-block">
							<code>根据幻灯片图片排序填写。用英文“,”分离</code>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">首页广告一：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="left_title" id="left_title"  class="form-control" value="{$item['left_title']}" placeholder="a">
						<input type="text" name="left_word" id="left_word"  class="form-control" value="{if $item['left_word']}{$item['left_word']}{else}24,24,24{/if}" placeholder="左侧广告关键字">
						<span class='help-block'>
							<code>三个字 以英文","隔开。默认为“24,24,24”</code>
						</span>
						<input type="text" name="left_tleson" id="left_tleson" style="margin-top:5px;"  class="form-control" value="{$item['left_tleson']}" placeholder="副标题">
						<input type="text" name="left_url" id="left_url" style="margin-top:5px;margin-bottom:5px;"  class="form-control" value="{$item['left_url']}" placeholder="链接URL">
						{php echo tpl_form_field_image('left_img', $item['left_img']);}
					</div>
				</div> 
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">首页广告二：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="top_title" id="top_title" class="form-control" value="{$item['top_title']}" placeholder="主标题">
						<input type="text" name="top_tleson" id="top_tleson" style="margin-top:5px;margin-bottom:5px;"  class="form-control" value="{$item['top_tleson']}" placeholder="副标题">
						<input type="text" name="top_url" id="top_url" style="margin-top:5px;margin-bottom:5px;"  class="form-control" value="{$item['top_url']}" placeholder="链接URL">
						{php echo tpl_form_field_image('top_img', $item['top_img']);}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">首页广告三：</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="bottom_title" id="bottom_title" class="form-control" value="{$item['bottom_title']}" placeholder="主标题">
						<input type="text" name="bottom_tleson" id="bottom_tleson" style="margin-top:5px;margin-bottom:5px;"  class="form-control" value="{$item['bottom_tleson']}" placeholder="副标题">
						<input type="text" name="bottom_url" id="bottom_url" style="margin-top:5px;margin-bottom:5px;"  class="form-control" value="{$item['bottom_url']}" placeholder="链接URL">
						{php echo tpl_form_field_image('bottom_img', $item['bottom_img']);}
					</div>
				</div>
                 </div>
			<div class="panel-heading">代理区域信息
			<span style="color:red;">&nbsp;【注意：每个代理商代理一个区/县】</span>
			</div>
			<div class="panel-body">
				<!-- <div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">代理商代理等级：</label>
					<div class="col-sm-9 col-xs-12">
						<label class="radio-inline">
							<input type="radio" name="limit_condition" class="limit_condition" onclick="limit(1);" value="1" {if empty($item['limit_condition'])} checked {else if $item['limit_condition'] == 1} checked {/if}/>省级
						</label>
						<label class="radio-inline">
							<input type="radio" name="limit_condition" class="limit_condition" onclick="limit(2);" value="2" {if $item['limit_condition'] == 2} checked {/if}/>市级
						</label>
						<label class="radio-inline">
							<input type="radio" name="limit_condition" class="limit_condition" onclick="limit(3);" value="3" {if $item['limit_condition'] == 3} checked {/if}/>区/县
						</label>
						<div class="help-block">
							<code>注：请不要省市县/区一起选</code>
						</div>
					</div>
				</div> -->
				<div class="form-group" id="form_group_birth">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label" for="">代理商代理城市列表：</label>
					<div class="col-sm-7">
						<div class="row row-fix tpl-district-container">
							{php echo $this->halfoff_district('birth', '', array('province'=>$province_id, 'city'=>$city_id, 'district'=>$district_id))}									
							<!-- <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
								<span id="cityadd" title="添加" class="btn btn-primary">添加</span>
							</div> -->
						</div>		
						<!-- <div class="help-block">
							<div class="well" id="citylist">
                            
								{loop $city_list $c}
									<span onclick="removeCity(this);">
										<input type="hidden" name="citylist[]" value="{$c}"/>
										<span class="label label-success"> {php echo $this->get_city($c);}</span>&nbsp;&nbsp;&nbsp;
									</span>
								{/loop}
							</div>
							<input type="hidden" id="hidden_city_list" value=""/>
						</div> -->
					</div>
					<script>
						$("#cityadd").click(function(){
							var limit_condition = $(".limit_condition:checked").val();
							var id = '';
							if(limit_condition == 1){
								id = $(".tpl-province").val();
							}else if(limit_condition == 2){
								id = $(".tpl-city").val();
							}else if(limit_condition == 3){
								id = $(".tpl-district").val();
							}
                            
                           var $did = $('#id').val();
                          
                           if(!$did){
                                $did = 0;
                           }
					      	var data = {
								"id" : id,
                                did : $did
							};
                            $.ajax({
								url : "{php echo $this->createWebUrl('halfoffagent',array('op'=>'cidajax'));}",
								type : "GET",
								data : data,
								cache : false,
								dataType : "JSON",
								success : function(res){
								 if(res == 1){
								   if(is_addCity(id)){
								        getCityNameAJAX(id);
							         }
								 }else{
								    util.message('当前城市已有代理商！','','error'); 
								 }
                                    
							 }
                            });
						});
						//判断是否添加过改城市
						function is_addCity(id){
							var city = $('#hidden_city_list').val();
							var temp_str = id + ",";
							if(city.indexOf(temp_str) > -1){
								return false;
							}else {
								return true;
							}
						}
					
						function removeCity(obj){
							$(obj).remove();
							$("#hidden_city_list").val(''); //将hidden信息清空
						}
						
						//id 省市县区id
						function getCityNameAJAX(id){
							var data = {
								"id" : id
							};
							$.ajax({
								url : "{php echo $this->createWebUrl('GetCityNameAJAX');}",
								type : "POST",
								data : data,
								cache : false,
								dataType : "JSON",
								success : function(res){
									if(id != "" && res != ''){
										html = '<span onclick="removeCity(this);"><input type="hidden" name="citylist[]" value="'+id+'"/><span class="label label-success">'+res+'</span>&nbsp;&nbsp;&nbsp;</span>';
										$("#citylist").append(html);
										var temp_val = $("#hidden_city_list").val();
										var temp_id = id + ',' + temp_val;
										$("#hidden_city_list").val(temp_id);
									}
								}
							});
						}
						$(".limit_condition").change(function(){
						//	$("#citylist").html(''); //更换等级的时候清空城市列表
							$("#hidden_city_list").val(''); //将hidden信息清空
							var limit_condition = $(".limit_condition:checked").val();
							if(limit_condition == 1){ //省
								$("#hetu_city").hide();
								$("#hetu_district").hide();
							}else if(limit_condition == 2){ //市
								$("#hetu_city").show();
								$("#hetu_district").hide();
							}else if(limit_condition == 3){ //县区
								$("#hetu_city").show();
								$("#hetu_district").show();
							}								
						});
						$(".limit_condition").change();
					</script>
				</div>
			</div>
       	</div>      
		<div class="form-group col-sm-12">
			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
		</div>
	</form>
</div>
<script type="text/javascript">
require(['jquery', 'util'], function($, util){
	$(function(){
		util.clip($('#needCopy')[0], $('#needCopy').text());
	});
});
</script>
<script type="text/javascript">
function limit(val){
	if(val == 0){
		$("#form_group_birth").hide();
	}else {
		$("#form_group_birth").show();
	}
}
	
function checkpwd(){
	var pwd = $("#password").val().trim();
	var confirmpwd = $("#confirmpassword").val().trim();
	if(pwd != '' && confirmpwd != '' && pwd != confirmpwd){
		util.message('两次密码输入不一致，请重新输入！','','error');
	}
}
	
$(function() {
	$("select[name='category']").change(function() {
		var cat_id = $.trim($("select[name='category']").val());
		// alert(cat_id);
		var data = {
			'category_id':cat_id
		} 
		$.ajax({
			url: "{php echo $this->createMobileUrl('HalfcategoryAjax')}",
			type: "POST",
			data: data,
			cache:false,
			dataType: "JSON",
			success: function (res) {
				$("#fl_son").html(res);
			}
		});  
	});
});
  
function formcheck() {
	if ($("#name").val().trim() == '') {
		util.message('请填写代理商名称','','error');
		return false;
	}
	var id = $("#id").val();
	if(!id){
		if ($("#password").val().trim() == '') {
			util.message('请填写代理商登陆密码','','error');
			return false;
		}
	}
	if ($("#phone").val().trim() == '') {
		util.message('请填写代理商电话','','error');
		return false;
	}
	if ($("#address").val().trim() == '') {
		util.message('请填写代理商详细地址','','error');
		return false;
	}
    if($("#hetu_district").val().trim() == ''){
       util.message('请选择代理城市','','error');
		return false; 
        
    }
    /**
	var province = $.trim($("select[name='district[][province]']").val());
	if (!province) {
		util.message('请选择省/直辖市','','error');
		return false;
	}
	var city = $.trim($("select[name='district[][city]']").val());
	if (!city) {
		util.message('请选择市','','error');
		return false;
	} 
	var district = $.trim($("select[name='district[][district]']").val());
	if (!district) {
		util.message('请选择县/区','','error');
		return false;
	} 
    **/
	return true;
}
</script>

<script type="text/javascript">
	require(['bootstrap']);
	$('.js-clip').each(function(){
		util.clip(this, $(this).attr('data-url'));
	});
</script>
{template 'common/footer'}
