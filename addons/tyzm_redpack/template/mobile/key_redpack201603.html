{template 'header'}

	<style>

.div-img{

	position: relative;

	width: 60px;

	height: 60px;

	margin: 0 auto;

	overflow: hidden;

	border-radius: 50%;margin-top: 20px;

}



.box{

	position: relative;

	width: 100%;

	height: auto;

	margin: 0px;

	overflow: hidden;

}	

	.pop-box{

	position: relative;

	width: 60px;

	height: 60px;

	margin: 0 auto;

	overflow: hidden;

	border: 3px solid #FF5500;

	border-radius: 50%;margin-top: 10px;

}

/*摇晃动画*/

.dh {

	animation: myfirst 3s infinite;

	-moz-animation: myfirst 3s infinite;

	/* Firefox */

	-webkit-animation: myfirst 3s infinite;

	/* Safari and Chrome */

	-o-animation: myfirst 3s infinite;

	/* Opera */

}





@keyframes myfirst {

	0% {

margin-left: 0px;

	}

	30% {

		margin-right: 30px;

	}

	40% {

		margin-left: 0px;

	}

	50% {

		margin-left: 60px;

	}

	60% {

		margin-left: 0px;

	}

	70% {

		margin-left: 60px;

	}

	80% {

		margin-left: 0px;

	}

	90% {

		margin-left: 60px;

	}

	100% {

		margin-right: 0px;

	}

}



@-moz-keyframes myfirst {

	0% {

margin-left: 0px;

	}

	30% {

		margin-right: 30px;

	}

	40% {

		margin-left: 0px;

	}

	50% {

		margin-left: 60px;

	}

	60% {

		margin-left: 0px;

	}

	70% {

		margin-left: 60px;

	}

	80% {

		margin-left: 0px;

	}

	90% {

		margin-left: 60px;

	}

	100% {

		margin-right: 0px;

	}

}



@-webkit-keyframes myfirst {

	0% {

margin-left: 0px;

	}

	30% {

		margin-right: 30px;

	}

	40% {

		margin-left: 0px;

	}

	50% {

		margin-left: 60px;

	}

	60% {

		margin-left: 0px;

	}

	70% {

		margin-left: 60px;

	}

	80% {

		margin-left: 0px;

	}

	90% {

		margin-left: 60px;

	}

	100% {

		margin-right: 0px;

	}

}



@-o-keyframes  myfirst {

	0% {

margin-left: 0px;

	}

	30% {

		margin-right: 30px;

	}

	40% {

		margin-left: 0px;

	}

	50% {

		margin-left: 60px;

	}

	60% {

		margin-left: 0px;

	}

	70% {

		margin-left: 60px;

	}

	80% {

		margin-left: 0px;

	}

	90% {

		margin-left: 60px;

	}

	100% {

		margin-right: 0px;

	}

}

.plus_box{

	position: absolute;

	height: 27px;

	font-size: 12px;

    LINE-HEIGHT: 27PX;

	padding:0 5px;

	color: white;

	bottom: 3px;

	left: 20px;

	border-radius: 2px;

	background: rgba(0,0,0,.6);

}

.edit{

	position: absolute;

	padding: 4px 6px;

	font-size: 12px;

	color: white;

	bottom: 3px;

	right: 20px;

	border-radius: 2px;

	background: rgba(0,0,0,.6);

}

.close{

	position: absolute;

	top:0;

	left:0;

	width: 32px;

	height: 32px;

	color: #d7bc8e;

	font-weight: bolder;

	

	border-radius: 50%;

	text-align: center; line-height: 32px;

}




@-webkit-keyframes onvoice_mic{

    0% {width:80px;height:80px;}

	20% {width:85px;height:85px;}

	40% {width:90px;height:90px;}

	60% {width:90px;height:90px;}

	80% {width:85px;height:85px;}

	100% {width:80px;height:80px;}

}

.onvoice{-webkit-animation:onvoice_mic 1s infinite linear;background-color: #0083BD !important;}

.key_box{margin: 0 auto;width: 100%;z-index:60;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;    padding: 8px 0;}

.key_box span{width: auto;background: rgba(0,0,0,.6);color: #FFFFFF;padding: 3px 10px;border-radius: 2px;font-size: 12px;box-shadow: 0px 0px 2px rgb(154, 154, 154);}

.voice_box{width:80px;height:80px;border-radius: 50%;margin: 0 auto;background: url({php echo MODULE_URL;}/template/static/images/voice_mic.png) no-repeat; background-color: #29B7F7; background-size: 100%; margin-top:10px;    box-shadow: 0px 0px 5px rgb(154, 154, 154);}

.hint{color: #FFF;text-align: left;font-weight: bold;font-size: 14px;1px solid rgba(0, 129, 187, 0.78);border-radius: 2px;height: auto;padding: 8px;background: #dd514c;;text-align: center;z-index: 60;position: relative;width: 100%;margin-bottom: 10px;}

.hint span{ margin-right:5px; color:#D7FE00;font-size:12px;}
 .add_img{ width: 100%;
    max-height: 200px;
    margin: o auto;
    text-align: center;
    background: #ccc;}
	
	
	/*    */
.red_top{    border-bottom: 10px solid #FFFFFF;border-top: 20px solid #ebe5d2;background: #fff;width: 88.88888889%;margin: 0 auto;position: fixed;top: 0;    left: 5.5555555556%;    z-index:20;} 
.red_main{width:88.88888889%;  margin: 0 auto; padding:10px 10px 30px 10px; background:#fff;    min-height: 550px;}
.red_main .add_img{ width: 100%;
    max-height: 200px;
    margin: o auto;
    text-align: center;
    background: #ccc;}
#list_content{ text-align:left;}
.red_bottom{position: fixed;
    bottom: 0;}
.red_bottom img{width:100%}
	
#my-modal-loading .am-modal-dialog {
    background: rgba(255, 255, 255, 0);
}
#my-modal-loading .am-text-secondary {
    color: rgb(255, 255, 255);
}	
	
.footer{ display:none}

	</style>

</head>

<body id="main" style="background-color:#ebe5d2;" >

<!--[if lte IE 9]>

<p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a

  href="http://browsehappy.com/" target="_blank">升级浏览器</a>

  以获得更好的体验！</p>

<![endif]-->



<div class="red_top"></div>
	
<div class="red_main">
<div style="position: fixed;right: 0;bottom: 0;width: 100%;height: 100%;background-color: rgba(0,0,0,.6);opacity: 1; display:none;z-index: 3;" id="mask" ></div>

    <div style="max-height:250px; overflow:hidden;position:relative;    padding-top: 20px;z-index:8;border-radius: 2px;" onclick="Count_succes('adclick');">
		<div class="hint">
		    <span class="am-text-primary"><i class="am-icon-key"></i>红包口令：</span>{$redata['secret_key']}
	</div>
	{if !empty($redata['adurl'])}
	<div  style="position: absolute; right: 0px; bottom: 0px; width: auto; color: white; background: rgba(0,0,0,.6);; color: #888888; padding: 0px 8px; border-radius: 2px 0px 0px 0px; font-size: 12px;" >活动详情</div>
    {/if}
    <img src="{$redata['adbg']}" class="add_img" />
	</div>
	<div class="am-g am-text-center" style="position: relative;bottom: 0;">	

<div class="div-img">

					<img src="{$redata['addimg']}" width="100%" height="100%">	</div>

	<div style="color: #c4ae7e; padding-top:5px">{$redata['act_name']}</div>

	<div class="am-text" style="color: #d5c3a1;">{$redata['wishing']}</div>



	




</div>
</div>
<div class="am-g am-text-center voice_boxmain" style="position: relative;position: fixed;bottom: 0;    padding-bottom: 46px;" ontouchstart = "return false;"> 	
<div class="key_box"><span class="am-text-sm am-text-center">按住话筒，喊口令，抢红包</span></div>
    <div  class="voice_box"  id="luyin"></div>

</div>



<div class="red_bottom">
{if $issend==1}
<div class="edit" onclick="window.location.href='{php echo $this->createMobileUrl('Plus')}'" style="">我也要发</div>
{/if}
<div class="plus_box" onclick="window.location.href='{php echo $this->createMobileUrl('Mypack',array('ty'=>'lucky'))}'" style="">我的红包</div>
<img src="{php echo MODULE_URL;}/template/static/images/rebbottom.png"/>

</div>








<!--div class="am-g am-text-center" style="position: relative;position: fixed;bottom: 0;background: url({php echo MODULE_URL;}/template/static/images/showredbag.png);background-size: 100%;line-height: 25px;" ontouchstart = "return false;"> 	

    <div  class="voice_box div-img"  id="luyin"></div>

	<div class="key_box"><span class="am-text-sm am-text-center">按住，喊出上面红包口令</span></div>
	<div style="font-size: 12px; margin-bottom: 8px; text-align: center;color: #BABABA;">

	 {$_W['account']['name']}提醒：记得分享给小伙伴们一起喊哦

	</div>

	

	

</div -->



<!--隐藏的领取红包开始-->

	<div class="am-modal am-modal-alert" id="openpacket">



		<div class="am-g" style="position: relative; height: auto; background: url({php echo MODULE_URL;}/template/static/images/packet_bg.jpg) no-repeat; background-color: rgb(237, 237, 237); background-size: 100%; border-radius: 8px; overflow:hidden;">

	    <div class="box" id="gg_img">

		    	<div class="pop-box">

					<img src="{$redata['addimg']}" width="100%" height="100%">	</div>

	<div style="color: #FFFFFF;font-weight: bold;font-size: 1rem;padding: 5px 0;}">{$redata['act_name']}</div>

	<div style="color: #dfb771;font-size: 1.2rem;">{$redata['wishing']}</div>

		    			    	

		    	

	    </div>



	    <div class="am-u-sm-12" style="padding: 0px 8px;color: white;">



	    	<div class="box tip_box" style="padding: 30px 0px;color: #505050; font-size:1.5em;">

	    		<span style="color: #D03020;">已领过，不要太贪心哦</span>

			</div>

	    	{if $issend==1}
           <button onclick="window.location.href='{php echo $this->createMobileUrl('Plus')}'" class="am-margin-bottom-sm am-radius am-btn am-btn-block" style="background-color: #D03020;">我也要发带广告红包</button>
	    	{/if}

	    	<div onclick="window.location.href='{php echo $this->createMobileUrl('Redpack',array('ty'=>'lucky','tid'=>$_GPC['tid'],'tokenkey'=>$_GPC['tokenkey']))}'" class="box" style="color: #D03020; font-size: 12px; margin-bottom: 8px; text-align: center;"> 

	    		看看大家的手气

	    	</div>

	    

	    </div>

	    

	    <div onclick="$('#openpacket').modal('close');" class="close"><i class="am-icon-close"></i></div>



	  </div>



	</div>

	

	

<div class="am-modal am-modal-alert" id="alert">

		<div class="am-modal-dialog" style="border-radius: 3px;">

			<div class="am-modal-hd" id="alert_title"></div>

	    <div class="am-modal-bd" id="alert_content">



	    </div>

			<div class="am-modal-footer">

	      <span class="am-modal-btn">确定</span>

	    </div>

		</div>

</div>

	





<!--二维码关注开始-->

<div class="am-modal am-modal-alert" tabindex="-1" id="plus_box">

  <div class="am-modal-dialog" style="border-radius: 2px;">

    <div class="am-modal-bd">

    	<div class="am-g am-text-center">

    		<div class="am-u-sm-12 am-text-center am-text-sm" style="text-align: justify;">
{if $issend==1}
			    <button class="am-btn am-btn-secondary am-radius am-btn-block" style="margin-top: 20px;" onclick="window.location.href='{php echo $this->createMobileUrl('Mypack')}'">我已发的红包</button>
{/if}
    			<button onclick="$('#share').modal('open');$('#plus_box').modal('close');" class="am-margin-top-sm am-btn am-btn-success am-radius am-btn-block"style="margin-top: 20px; color: white; ">转给我的朋友们</button>	
				{if $issend==1}
				<button onclick="window.location.href='{php echo $this->createMobileUrl('Plus')}'" class="am-btn am-radius am-btn-block" style="margin: 20px 0; color: white; background-color: #ff8610;">我也要发红包</button>
{/if}
    		</div>

    	</div>

    </div>

  </div>

</div>

<!--二维码关注结束-->

<!--隐藏的分享开始-->

<div class="am-modal-actions" style="top: 0px;" id="share" onclick="$('#share').modal('close')" >

		<img width="100%"  src="{php echo MODULE_URL;}/template/static/images/share.png">

</div>

<!--二维码关注开始-->

<div class="am-modal am-modal-alert" tabindex="-1" id="two_code">

  <div class="am-modal-dialog" style="border-radius: 2px;">

    <div class="am-modal-bd">

    	<div class="am-g am-text-center">

    		<div class="am-u-sm-12 am-padding-top am-text-center am-text-sm" style="text-align: justify;">

    			<img src="{php echo $_W['account']['qrcode'];}" width="80%">

					<div class="am-margin-top am-text-xs">长按关注【{$_W['account']['name']}】，参加抢红包</div>

    		</div>

    	</div>

    </div>

  </div>

</div>
	<!--隐藏的回话弹出层结束-->

	<div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1" id="my-modal-loading">
		<div class="am-modal-dialog">
			<div class="am-modal-bd am-text-secondary">      
	    	<span class="am-icon-spinner am-icon-spin"></span>
		    	<p>努力奔跑...</p>
		    </div>
		</div>
	</div>
<!--二维码关注结束-->

<!--隐藏的分享结束-->

<script type="text/javascript">

//界面优化

$('#gg_img').css("max-height", ($(window).height()*0.6)+'px');

$('.red_main').css("min-height", $(window).height()+'px');



wx.ready(function () {

	wx.showOptionMenu();

});



/*关闭刷新方法*/

function openpacket_close(){

	$('#openpacket').modal('close');

}



function alertwindow(content) {

	$('#alert_content').text(content);

	$('#alert').modal('open');

}





var browser = {
versions: function () {
var u = navigator.userAgent, app = navigator.appVersion;
return { //移动终端浏览器版本信息 
ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端 
android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器 
iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器 
iPad: u.indexOf('iPad') > -1, //是否iPad 
};
}(),
}



//$('#luyin').click( function () {

$('#luyin').on("touchstart",function(event){
   event.preventDefault();
   $(this).addClass('onvoice');
   $('.red_top').css("z-index","2");
   $('.voice_boxmain').css("z-index","4");
   $('#mask').show();
   if (browser.versions.android) {
     $('.key_box span').text('松开，点击空白处，停止录音');
   }else{
     $('.key_box span').text('松开停止录音');
   }
   
   wx.startRecord();
}).on("touchend",function(){
   $(this).removeClass('onvoice');
   $('.red_top').css("z-index","20");
   $('.voice_boxmain').css("z-index","0");
   $('#mask').hide();

   $('.key_box span').text('按住话筒，喊口令，抢红包');

   wx.stopRecord({

    success: function (res) {

        var localId = res.localId;

		{if $isexist==1}

		   $("#openpacket").modal('open');

		   wx.playVoice({

             localId:localId // 需要播放的音频的本地ID，由stopRecord接口获得

           });

		   return false;

        {/if}

		wx.translateVoice({

			localId: localId, // 需要识别的音频的本地Id，由录音相关接口获得

			isShowProgressTips: 1, // 默认为1，显示进度提示

			success: function (res) {

			    //alert(res.translateResult); // 语音识别的结果

				if(res.translateResult==""){

				   alertwindow("语音太短，无法识别！");return false;

				}

				openpacket(res.translateResult,localId);

			}

		});

		

    }

});

}); 

$('#mask').click(function(){
   $(this).removeClass('onvoice');
   $('.red_top').css("z-index","20");
   $('.voice_boxmain').css("z-index","0");
   $('#mask').hide();

   $('.key_box span').text('按住话筒，喊口令，抢红包');

   wx.stopRecord({

    success: function (res) {

        var localId = res.localId;

		{if $isexist==1}

		   $("#openpacket").modal('open');

		   wx.playVoice({

             localId:localId // 需要播放的音频的本地ID，由stopRecord接口获得

           });

		   return false;

        {/if}

		wx.translateVoice({

			localId: localId, // 需要识别的音频的本地Id，由录音相关接口获得

			isShowProgressTips: 1, // 默认为1，显示进度提示

			success: function (res) {

			    //alert(res.translateResult); // 语音识别的结果

				if(res.translateResult==""){

				   alertwindow("语音太短，无法识别！");return false;

				}

				openpacket(res.translateResult,localId);

			}

		});

		

    }

});

});


//拆红包

function openpacket(key,localId){

	$.ajax({

		type : "post",

		url : "{php echo $this->createMobileUrl('Openpack',array('tid'=>$_GPC['tid'],'tokenkey'=>$_GPC['tokenkey']))}",

		data : {

		    localId:localId,

			key : key,

			{if $_GPC['ticket']!=""}

			ticket : '{php echo $_GPC['ticket'];}',

			{/if}

		},

		dataType : "json",

		beforeSend : function(XMLHttpRequest) {
            $("#my-modal-loading").modal('open');   
		},

		success : function(res) {

			$("#my-modal-loading").modal('close');

			

			if (res.status == 200 || res.status == 201) {

				window.location.href = "{php echo $this->createMobileUrl('Redpack',array('ty'=>'show','tid'=>$_GPC['tid'],'tokenkey'=>$_GPC['tokenkey']))}";

			}else if(res.status == 0){

			   $('.tip_box span').text(res.errmsg);

               $("#openpacket").modal('open');

			}else if(res.status == 501){

			   $("#two_code").modal('open');

			}else{

			   $('.tip_box span').text(res.errmsg);

			   $("#openpacket").modal('open');

			}

		},

		error : function(res, type) {

			$("#my-modal-loading").modal('close');

			alertwindow("服务器君好忙，再试一下");

		}

	});

}



/**

 * 转发统计

 */

function Count_succes(ty){

	$.ajax({

		type : "post",

		url : "{php echo $this->createMobileUrl('Count',array('tid'=>$_GPC['tid'],'tokenkey'=>$_GPC['tokenkey']))}",

		data : {

			ty:ty,

		},

		dataType : "json",

		beforeSend : function(XMLHttpRequest) {

		},

		success : function(res) {

		},

		error : function(res, type) {

		}

	});



	{if !empty($redata['adurl'])}

		window.location.href="{$redata['adurl']}"; 

	{else}

	    var imgArray = [];

		var itemSrc = "{$redata['adbg']}";

		imgArray.push(itemSrc);

	    wx.previewImage({

                current: itemSrc,

                urls: imgArray

        });

	{/if}

}

</script>







{template 'footer'}