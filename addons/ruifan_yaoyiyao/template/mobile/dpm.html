<!DOCTYPE html>
<html class="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,user-scalable=no,maximum-scale=1,initial-scale=1"/>
    <title>{$base['title']}</title>
    <link type="text/css" rel="stylesheet" href="../addons/ruifan_yaoyiyao/images/index.css?v=143003">
    <script src="../addons/ruifan_yaoyiyao/images/jquery-2.1.4.min.js"></script>
    <script src="../addons/ruifan_yaoyiyao/images/jquery.carouFredSel.js"></script>
    <style>
        #loading{background-color: #f0c600;height: 100%;width: 100%;position: fixed;z-index: 1;margin-top: 0px;top: 0px;}
        #loading-center{width: 100%;height: 100%;position: relative;}
        #loading-center-absolute {position: absolute;left: 50%;top: 50%;height: 150px;width: 150px;margin-top: -75px;margin-left: -75px;-moz-border-radius: 50% 50% 50% 50%;-webkit-border-radius: 50% 50% 50% 50%;border-radius: 50% 50% 50% 50%;}
        .object{width: 20px;height: 20px;background-color: #FFF;position: absolute;-moz-border-radius: 50% 50% 50% 50%;-webkit-border-radius: 50% 50% 50% 50%;border-radius: 50% 50% 50% 50%;-webkit-animation: animate 0.8s infinite;animation: animate 0.8s infinite;}
        #object_one {top: 19px;left: 19px;}
        #object_two {top: 0px;left: 65px;-webkit-animation-delay: 0.1s;animation-delay: 0.1s;}
        #object_three {top: 19px;left: 111px;-webkit-animation-delay: 0.2s;animation-delay: 0.2s;}
        #object_four {top: 65px;left: 130px;-webkit-animation-delay: 0.3s;animation-delay: 0.3s;}
        #object_five {top: 111px;left: 111px;-webkit-animation-delay: 0.4s;animation-delay: 0.4s;}
        #object_six {top: 130px;left: 65px;-webkit-animation-delay: 0.5s;animation-delay: 0.5s;}
        #object_seven {top: 111px;left: 19px;-webkit-animation-delay: 0.6s;animation-delay: 0.6s;}
        #object_eight {top: 65px;left: 0px;-webkit-animation-delay: 0.7s;animation-delay: 0.7s;}
        @-webkit-keyframes animate {25% {-ms-transform: scale(1.5);-webkit-transform: scale(1.5);transform: scale(1.5);}75% {-ms-transform: scale(0);-webkit-transform: scale(0);transform: scale(0);}}
        @keyframes animate {50% {-ms-transform: scale(1.5,1.5);-webkit-transform: scale(1.5,1.5);transform: scale(1.5,1.5);}100% {-ms-transform: scale(1,1);-webkit-transform: scale(1,1);transform: scale(1,1);}}
    </style>

{if $nofollow != 1}
<script>
    $(document).ready(function(){
        $("#loading").delay(1000).fadeOut(500);
    })
</script>
{/if}
</head>
<body>
{if $nofollow != 1}
<div id="loading">
    <div id="loading-center">
        <div id="loading-center-absolute">
            <div class="object" id="object_one"></div>
            <div class="object" id="object_two"></div>
            <div class="object" id="object_three"></div>
            <div class="object" id="object_four"></div>
            <div class="object" id="object_five"></div>
            <div class="object" id="object_six"></div>
            <div class="object" id="object_seven"></div>
            <div class="object" id="object_eight"></div>
        </div>
    </div>
</div>
{/if}

<app>

    <view name="shake-cross" class="shown">
        <section>
            <div class="container">
                <div class="card-list">

                    <div class="card" id="4" card_index="1" style="display: block;">
                        <div class="font" style="border-radius: 0px; background-image: url({if empty($base['backpicurl'])}../addons/ruifan_yaoyiyao/images/defaultbg.jpg{else}{php echo tomedia($base['backpicurl'])}{/if});">

                            <div class="icon">
                                <ul style="list-style: none;">
                                    <li style="padding-bottom: 5px;"><a href="{php echo $this->createMobileUrl('awardlist', array('id' => $id))}"><img src="../addons/ruifan_yaoyiyao/images/iconfont-next.png" style="width: 100%;height: 100%;"></a></li>
                                    <li style="padding-bottom: 5px;"><a href="{php echo $this->createMobileUrl('myaward', array('id' => $id))}"><img src="../addons/ruifan_yaoyiyao/images/iconfont-gantanhao.png" style="width: 100%;height: 100%;"></a></li>
                                    <li ><img id="rulesimg" src="../addons/ruifan_yaoyiyao/images/iconfont-dianhua.png" style="width: 100%;height: 100%;"></li>
                                </ul>
                            </div>
                            {if $base['isemail']==1}
                            <div class="yaoyiyaobg">
                                <img class="yaoyiyao" src="../addons/ruifan_yaoyiyao/images/iphone2.png" alt="">
                            </div>
                            {/if}


                            <div class="ticker">
                                <h3>摇一摇， 摇出惊喜 <i></i></h3>
                                <h4><a style="color:#FFF89E;" id="gamenum" href="#">{if $shenyu == 9999}本活动不限次数{else}还剩<span id="gamespan" class="count">{$shenyu}</span>次机会{/if}</a></h4>
                            </div>

                            <power>
                                <div class="wrapper">
                                    <dl id="ticker-1">
                                        {loop $award $row}
                                        <dt><img src="{if empty($row['avatar'])}../addons/ruifan_yaoyiyao/images/default.jpg{else}{php echo tomedia($row['avatar'])}{/if}"></dt>
                                        <dd>恭喜{if empty($row['fname'])}匿名网友{else}{$row['fname']}{/if}，赢得{$row['prizetype']}（{php echo date("m-d H:i", $row['createtime'])}）</dd>
                                        {/loop}

                                    </dl>
                                </div>
                            </power>
                        </div>

                        <div id="gohome" class="back prepared">
                            <article class="open-redpack pack">
                                <header class="vbox box-vc" id="ad">
                                    <a href=""><img id="adimg" src="../addons/ruifan_yaoyiyao/images/ad1.jpg" alt="loading" {if $base['isadshow']==1}style="width: 100%;height: auto"{else}style="width: 180px;height: auto;margin-left: auto;margin-right: auto;margin-top: 30%;"{/if}></a>
                                </header>
                                <content class="vbox box-vc">
                                    <h4 class="pack-title" id="patitle">哎呀，就差一点点，继续</h4>
                                    <vs style="height:1rem"></vs>
                                    <h4 class="pack-subtitle"></h4>
                                    <!--<vs style="height: 3rem"></vs>-->
                                </content>
                                <footer>
                                    <go id="again" class="button" action="complete">再试试手气</go>
                                    <go id="again2" class="button" action="complete" style="display: none;">打开卡券礼包</go>
                                </footer>
                            </article>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </view>

</app>


<div id="bg-flower">
    <audio preload="auto" id="audio_male" src="../addons/ruifan_yaoyiyao/audio/male.mp3"></audio>
    <audio preload="auto" id="audio_match" src="../addons/ruifan_yaoyiyao/audio/match.mp3"></audio>
</div>


<div id="shadow" {if $nofollow == 1 || $isshow == 0} style="display: block" {/if}></div>
<div class="phone_tip" id="phone_tip">
    <div class="share" style="width: 90%;margin-left: auto;margin-right: auto;height: 100%;overflow-y: auto;">
        <div class="r" style="margin-top: 30%">
            <p style="color:#eede04;font-size: 24px;">填写兑奖信息</p>
            <div class="formitem">
                <input type="text" name="tel" value="" id="tel" placeholder="填写您的手机号码">
            </div>
            <div class="formitem">
                <input type="text" name="realname" value="" id="realname" placeholder="填写您的昵称">
            </div>
            <div class="formitem">
                <input type="text" name="addr" value="" id="addr" placeholder="填写联系地址">
            </div>

        </div>
        <div class="yes" id="phoneyes" style="margin-bottom: 30px">
            <button class="back" onclick="check()"  type="submit">提交信息</button>
        </div>

    </div>
</div>






<div class="time_tip" id="time_tip" {if $isshow == 0}style="display: block" {/if}>
    <div class="share" style="width: 100%;margin-left: auto;margin-right: auto;height: 100%;">
        <div class="rbg" {if $isshow == 0}style="display: block" {/if}>
            {if $base['starttime'] > time()}
                别着急，亲！<br/>
            {php echo date("m月d日 H点i分", $base['starttime'])}
            <br/>才开始摇一摇活动哦。

            {else}
                亲活动已经结束了<br/>
                请下次再来哦！
            {/if}
        </div>
    </div>
</div>




<div class="rules_tip" id="rules_tip" {if $nofollow == 1}style="display: block" {/if}>
    <div class="share" style="width: 90%;height: 100%;overflow-y: auto;margin-left: 5%;margin-right: 5%">
        <div class="r" style="margin-top: 20px;">
            {if $nofollow != 1}
            <p style="color:#eede04;font-size: 24px;text-align: center;margin-bottom: 20px;">活动规则</p>

            {$base['rules']}

            {else}

            <div style="text-align: center;margin-top: 40%;">
                <img src="{$erwemaimg}" style="width: 60%;height: auto" alt="">
                <span style="display: inline-block;width: 62%;line-height: 24px;margin-top: 15px;">{$erwemaword}</span>
            </div>


            {/if}
        </div>
        {if $nofollow != 1}
        <div class="yes" id="phoneyes" style="margin-bottom: 30px">
            <button class="back" id="rulesclose">关闭</button>
        </div>
        {/if}
    </div>
</div>

</body>



<script>

    var isYao = true;

   /* {if $nofollow != 1}
        $(".ticker").bind("click", function() {
            getrp()
        });
    {/if}*/

    $("#again").bind("click", function() {
        $("#4").addClass("remove");
        setTimeout(function() {
            $("#4").removeClass("remove");
            $("#4").removeClass("get-redpack");
            $("#4").removeClass("get-redpack-coming");
        }, 50);
        setTimeout(function() {
            $("#4").addClass("get-redpack-coming");
        }, 50);

        isYao = true;
    });


    $("#again2").bind("click", function() {
        setTimeout(function () {

            jumpCardUrl();

            setTimeout(function () {

                location.href="{php echo $this->createMobileUrl('index', array('id' => $id))}";

            },600);

        },1000);
    });

    {if $nofollow != 1}

    /*开始抽奖*/
    function getrp() {

        if(isYao){

            isYao = false;

        $.get("{php echo $this->createMobileUrl('gamestart', array('id' => $id,'cardrowid'=>$card_rowid))}", function(data) {

            if(data.runcode == 2){
                alert(data.msg);
                return false;
            }

            if(data.runcode == 5){

                $("#shadow").show();
                $("#phone_tip").show();
                return false;

            }

            var imgurl = data.imgurl;

            if(imgurl == "" || imgurl == undefined || imgurl == null){
                var imgurl = "../addons/ruifan_yaoyiyao/images/lose1.png";
            }

            $("#ad").find("img").attr("src", imgurl);
            $("#ad").find("a").attr("href", data.adurl);

            audio_male.play();
            setTimeout(function(){
                audio_match.play();
                $("#gohome").addClass("prepared");
                $("#4").addClass("get-redpack");

            },1200);

            if (data.runcode == 1) {

                $("#patitle").html("恭喜您！获得 <span>" + data.name + "</span>");


            }else if(data.runcode == 11){

                $("#patitle").html("恭喜您！获得 <span>" + data.name + "</span>");

                $("#again").hide();
                $("#again2").show();

            }else{

            }
        },"json")

        }
    };
        {/if}

</script>

{if $nofollow != 1}
<script>

    var SHAKE_THRESHOLD = 3000;
    var last_update = 0;
    var x = y = z = last_x = last_y = last_z = 0;
    if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion', function(eventData){
            var acceleration = eventData.accelerationIncludingGravity;
            var curTime = new Date().getTime();
            if ((curTime - last_update) > 100) {
                var diffTime = curTime - last_update;
                last_update = curTime;
                x = acceleration.x;
                y = acceleration.y;
                z = acceleration.z;
                var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
                if (speed > SHAKE_THRESHOLD) {
//                               alert(4314324234);
                    getrp()
                }
                last_x = x;
                last_y = y;
                last_z = z;
            }
        }, false);
    }else{
        alert("错误")
    }

</script>
{/if}

<script type="text/javascript">


    //横向滚动
    var _scroll = {
        delay: 1000,
        easing: 'linear',
        items: 1,
        duration: 0.04,
        timeoutDuration: 0,
        pauseOnHover: false
    };
    $('#ticker-1').carouFredSel({
        width: 1000,
        align: false,
        items: {
            width: 'variable',
            height: 35,
            visible: 1
        },
        scroll: _scroll
    });
    $('.caroufredsel_wrapper').css('width', '100%');

    {if $nofollow != 1}

    setInterval(function(){
        $.ajax({
            url:"{php echo $this->createMobileUrl('haishen', array('id' => $id))}",
            dataType:'json',
            success:function(data){
                var runcode = data['runcode'];
                var shenyu = data['shenyu'];
                if(runcode == 99){
                    if(shenyu == 9999){
                        $('#gamenum').html("本活动不限次数");
                    }else{
                        $('#gamespan').html(shenyu);
                    }
                }else{
                    if(shenyu == 9999){
                        $('#gamenum').html("本活动不限次数");
                    }else{
                        $('#gamespan').html(shenyu);
                    }
                }
            }
        })
    },4000);

        {/if}

    $("#rulesimg").bind("click", function() {
        $("#shadow").show();
        $("#rules_tip").show();
    });

    $("#rulesclose").bind("click", function() {
        $("#shadow").hide();
        $("#rules_tip").hide();
    });


    // form check
    function check() {

        var tel = $("#tel").val();
        var realname = $("#realname").val();
        var addr = $("#addr").val();
        var bValidate = RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|14[57])[0-9]{8}$/);
        if (tel == '' || realname == '') {
            alert("请输入手机号码和姓名");
            return;
        }
        if(!bValidate.test(tel)){
            alert("请输入正确手机格式");;
            return;
        }

        var submitData = {
            tel: tel,
            realname: realname,
            addr: addr,
            ac: "settel"
        };
        $.post('{php echo $this->createMobileUrl('phone', array('id' => $id))}', submitData, function(idata) {
            if (idata.success == 1) {
                location.href="{php echo $this->createMobileUrl('index', array('id' => $id))}";
            } else {
                alert(idata.msg);
                location.href="{php echo $this->createMobileUrl('index', array('id' => $id))}";
            }
        },"json");
    }


</script>




<!-- 微信分享设置 -->
<script>var require = { urlArgs: 'v={php echo date('YmdH');}' };</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
    // jssdk config 对象
    jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
    // 是否启用调试
    jssdkconfig.debug = false;
    jssdkconfig.jsApiList = [
        'checkJsApi',
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'showOptionMenu'
    ];

    wx.config(jssdkconfig);
    var sharedata = {
        "imgUrl" : "{$shareimg}",
        "link" : "{$sharelink}",
        "desc" : "{$sharedesc}",
        "title" : "{$sharetitle}"
    };

    wx.ready(function () {
        wx.showOptionMenu();
        //wx.hideOptionMenu();
        wx.onMenuShareAppMessage(sharedata);
        wx.onMenuShareTimeline(sharedata);
        wx.onMenuShareQQ(sharedata);
        wx.onMenuShareWeibo(sharedata);
    });


    function jumpCardUrl(){
        var temp = '{$cardArry['cardId']}';
        if(temp == null || temp == '' || temp == undefined){
            return;
        }
        wx.addCard({
            cardList: [{
                cardId: '{$cardArry['cardId']}',
                cardExt: '{"code": "", "openid": "{$cardArry['openid']}", "timestamp": "{$cardArry['timestamp']}","nonce_str":"{$cardArry['nonceStr']}", "signature":"{$cardArry['signature']}"}'
            }], // 需要添加的卡券列表
            success: function (res) {
                var cardList = res.cardList; // 添加的卡券列表信息
            }
        });
    }

</script>



</html>