<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
{php echo register_jssdk();}
<title>排行榜</title>
<style type="text/css">
html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; outline: none; }
body { font-family: Microsoft YaHei, Helvitica, Verdana, Tohoma, Arial, san-serif; -webkit-text-size-adjust: none; }
article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; }
ol, ul { list-style: none; }
blockquote, q { quotes: none; }
blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; }
strong { font-weight: bold; }
a, button, input { -webkit-tap-highlight-color: rgba(255,0,0,0); }
input, textarea, select, button { -webkit-border-radius: 0; -webkit-appearance: none; outline: none; }
input[type="button"], input[type="submit"], input[type="reset"] { -webkit-appearance: none; }
table { border-collapse: collapse; border-spacing: 0; }
img { border: 0; }
a { text-decoration: none; }
a:hover { text-decoration: none; }
.clearfix:before, .container:after { content: ""; display: table; }
.clearfix:after { clear: both; }
.left { float: left; }
.right { float: right; }
/**/
body { background-color: #ffffff; }
.vgy_user { display: block; margin: 0; padding: 0; text-align: center; overflow: hidden; }
.vgy_user_bg { width: 100%; opacity: 0.15; }
.vgy_user .info2 { display: block; padding: 40px 0 0 0; background: url({MODULE_URL}/template/mobile/image/background_1.png) top; background-size: cover; background-size: cover }
.vgy_user .info2 .touxiang { width: 100px; height: 100px; border-radius: 100%; background-color: #FFF; box-shadow: 0 0 0 3px rgba(255, 255, 255, 1), 0 0 10px 2px rgba(0, 0, 0, 0.3); }

.name { font-size: 16px; margin: 10px 0 10px 0; color:#409f10; }
.dhm{ font-size:14px; color:#409f10; line-height:18px;}
.info2 a { color: #fff; }
.infotext { text-align: center; display: block; font-size: 48px; color: #fff; }
.infotext .syuan { font-size: 12px; }
.red { color: #F30 }
.time { font-size: 12px; color: #666 }

.bgs { background: -webkit-gradient(linear, 0% 100%, 0% 45%, from(#fff), to(rgba(255,255,255,0))) }
.bgt { width: 100%; opacity: 0 }
.Ranking { color: rgba(126, 184, 152, 0.92);
padding: 5px 10px;
height: 26px;
line-height: 26px;
font-size: 12px;
background-color: rgba(242, 242, 242, 0.57);}
.list ul li { position: relative; border-bottom: 1px solid rgba(0, 0, 0, 0.05); padding: 6px 10px; overflow: hidden; position: relative; padding: 10px 0 10px 70px; }
.list ul li .Head { position: absolute; background: url({MODULE_URL}/template/mobile/image/head.jpg); background-size: 100% 100%; left:50px; z-index:0; }
.list ul li .Head img { width: 42px; height:42px;overflow: hidden; border-radius: 100%; border: 0; box-shadow: 0 0 0 3px rgba(255, 255, 255, 1);  }
.list ul li .text { margin: 0 8px; color: #aeaeae; font-size: 12px; text-align: left; }
.list ul li .text h1 {  font-size: 16px; color: #000000; line-height: 24px; }
.list ul li .text span{ color:#CCC; font-size:12px;}
.list ul li .text p { float:left; font-size: 14px; color:#FFB100; line-height: 28px; padding:5px; }
.list ul li .text h2 { font-size: 12px; color: #B8B8B8;  }
.list ul li .his{  float:left;position: relative;left: 4%;}
.list ul li .gift{ float:right;margin-left: 10px; }
.list ul li.more { padding: 10px; text-align: center; font-size: 14px; color: #666; display: block;}
.list ul li.more a { color: #666; }
.list ul li .NO{  z-index:1; font-size:20PX; position:absolute; left:10px; background-color:#e2f1e6; color:#44a310; padding:4px 2px; border-radius:2px;}
.list ul li:nth-child(-n+3){ background-color:rgba(255, 253, 240, 0.57);}
.list ul li:nth-child(-n+3) .no{ background-color:#FC9; color:#fff;}
.sjbutton { background-color: #49c249; border-radius: 5px; border: 0; text-align: center; padding: 0 15px; height: 30px; line-height: 32px; color: #fff; font-family: Microsoft YaHei, Helvitica, Verdana, Tohoma, Arial, san-serif; }
.update { cursor: pointer; border-radius: 100%; background: rgba(255, 255, 255, 0.15); width: 18px; height: 18px; padding: 8px; position: absolute; right: 10px; top: 10px; text-align: center; }
.update img { width: 18px; height: 18px; }

.vgy_user ul {border-top: 1px solid rgba(255, 255, 255, 0.54); margin: auto; display: block; width: 100%; height: 48px; display: -webkit-box; display: box; -webkit-box-orient: horizontal; background-color: rgba(18, 99, 21, 0.07);}
.vgy_user ul li { width: auto!important; height: 100%; position: static; margin: 0; border-radius: 0; -webkit-box-sizing: border-box; box-sizing: border-box; -webkit-box-flex: 1; box-flex: 1; -webkit-box-sizing: border-box; box-shadow: none; background: none;padding: 5px 0 0 0;border-left: 1px solid rgba(255, 255, 255, 0.54);}
.vgy_user ul li:first-child {border-left: 0;}

.vgy_user ul li span { color:#1B9D3A}
.vgy_user ul li p { margin: 2px 0 0 0; font-size: 12px; display: block ; line-height: 16px; text-align: center; color: rgba(27, 157, 58, 0.59);}
.vgy_user .tx{width: 120px;
display: inline-block;
font-size: 12px;
color: #188F4B;
border-radius: 40px;
padding: 6px 0;
margin: 0 5px 15px 0;
border: 1px solid #2EAE4D;
background-color: transparent;}
.vgy_user .tx:active{background-color: #2EAE4D;border:1px solid #2EAE4D; color:#Fff;}

.back { left: 10px; top: 10px; }
footer{ background-color: #F6F6F6; color:#999; text-align:center; font-size:12px; padding:20px 0px;border-top: 1px solid #eaeaea; bottom:0; position:absolute; width:100%;}
</style>
</head>

<body>

<div class="vgy_user">
 <?php
                $userinfo =  mc_fansinfo($openid);
                if(!empty($userinfo)){
                $avatar = $userinfo['tag']['avatar'];
                }
                ?>

  <div class="info2"> <a href="{php echo $this->createMobileUrl('index',array('id'=>$id));}"><div class="update back"><img src="{MODULE_URL}/template/mobile/image/back.png"></div></a><img class="touxiang" src="{$avatar}">

    <p class="name">{$userinfo['tag']['nickname']}</p>
     
    <a href="{php echo $this->createMobileUrl('rec',array('id'=>$id));}" class="tx">我的记录</a>
    <ul>
	<li><span>{$best_score}</span><p>最高分数</p></li>
    <li><span>{$rank}</span>
      <p>排行</p></li>
</ul>
    <div class="Ranking">
      <div class="left">参与人数：{$total}人</div>
    </div>
  </div>
  
</div>
<div class="list">
    <ul id="rank_list">
    {loop $list $item}
        <?php
                $userinfo1 = mc_fansinfo($item['from_user']);
                if(!empty($userinfo1)){
                    $avatar1 = $userinfo1['tag']['avatar'];
                }
                if(!empty($item['best_score'])){
                    $i++;
                    $cishu = $reply['total_times'] - $item['total_times'] - $item['sharelottery_times'] + $item['totalshare_times'] * $reply['sharelottery_times'];
        ?>
        <li>

            <div>
                <div class="NO">{$i}</div>
                <div class="Head"><img src="{$avatar1}" width="100%" height="100%"></div>
                <div class="text">
                    <div class="his"> <p> {$userinfo1['tag']['nickname']} <span>({$cishu}次)</span></p>
                    </div>
                    <div class="gift"> <p>{$item['best_score']}<span>分</span></p></div>
                </div>
            </div>
        </li>
        <?php
      }
      ?>
     {/loop}
        </ul>
        <ul id="more_ul">
      <li class="more"><a href="javascript:;" id="more">点击查看更多...</a></li>
    </ul>
      </div>
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$(function() {
			var page = 2;
			var maxpage = '39';
			var isLoading = false;
			$("#more").click(function() {
				if(maxpage > page) {
					if(isLoading) return;
					isLoading = true;
					$.ajax({
						type : "GET",
						url : 'index.php?act=rank&op=getrank&id=926fe795f5afb8d610c8e241b3a7e672&c_id=27&page='+page,
						contentType: "application/x-www-form-urlencoded; charset=utf-8",
						dataType : "json",
						success : function(data) {
							if(data.done == 'true') {
								$("#rank_list").append(data.html);
								page++;	
							} else {
								$("#more_ul").remove();	
							}
							isLoading = false;
						},
						timeout : 15000
					});
				}
			});
		});
	</script>
<script type="text/javascript">
    wx.ready(function () {
        sharedata = {
            title: '{$share_title}',
            desc: '{$share_desc}',
            link: '{$share_url}',
            imgUrl: '{$share_image}',
            success: function(){
                var url = "{php echo $this->createMobileUrl('share', array('id' => $id), true)}";
                $.ajax
                ({
                    url: url,
                    type:'POST',
                    data: {},
                    dataType:'json',
                    error: function () {
                        alert('网络通讯异常，请稍后再试！');
                    },
                    success: function (result) {
                        alert(result.msg);
                        setTimeout('time_jump()', 1000);
                    }
                });
            },
            cancel: function(){
                alert('您真的要取消分享么？就差一步就可以破纪录啦！');
            }
        };
        wx.onMenuShareAppMessage(sharedata);
        wx.onMenuShareTimeline(sharedata);
    });
  function time_jump() {
    var url = "{php echo $this->createMobileUrl('index', array('id' => $id), true)}";
    location.href = url;
  }
</script>
</body>
</html>
