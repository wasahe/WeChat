!function(E){function K(M){M.touches||(M.touches=M.originalEvent.touches)}function L(M,N){N._startY=M.touches[0].pageY,N.touchScrollTop=N.$scrollArea.scrollTop()}function A(M,N){N._curY=M.touches[0].pageY,N._moveY=N._curY-N._startY,N._moveY>0?N.direction="down":N._moveY<0&&(N.direction="up");var O=Math.abs(N._moveY);""!=N.opts.loadUpFn&&N.touchScrollTop<=0&&"down"==N.direction&&!N.isLockUp&&(M.preventDefault(),N.$domUp=E("."+N.opts.domUp.domClass),N.upInsertDOM||(N.$element.prepend('<div class="'+N.opts.domUp.domClass+'"></div>'),N.upInsertDOM=!0),D(N.$domUp,0),O<=N.opts.distance?(N._offsetY=O,N.$domUp.html(N.opts.domUp.domRefresh)):O>N.opts.distance&&O<=2*N.opts.distance?(N._offsetY=N.opts.distance+0.5*(O-N.opts.distance),N.$domUp.html(N.opts.domUp.domUpdate)):N._offsetY=N.opts.distance+0.5*N.opts.distance+0.2*(O-2*N.opts.distance),N.$domUp.css({height:N._offsetY}))}function B(M){var N=Math.abs(M._moveY);""!=M.opts.loadUpFn&&M.touchScrollTop<=0&&"down"==M.direction&&!M.isLockUp&&(D(M.$domUp,300),N>M.opts.distance?(M.$domUp.css({height:M.$domUp.children().height()}),M.$domUp.html(M.opts.domUp.domLoad),M.loading=!0,M.opts.loadUpFn(M)):M.$domUp.css({height:"0"}).on("webkitTransitionEnd transitionend",function(){M.upInsertDOM=!1,E(this).remove()}),M._moveY=0)}function C(M){M._scrollContentHeight=M.opts.scrollArea==F?I.height():M.$element[0].scrollHeight}function D(M,N){M.css({"-webkit-transition":"all "+N+"ms",transition:"all "+N+"ms"})}var J,F=window,G=document,H=E(F),I=E(G);E.fn.dropload=function(M){return new J(this,M)},J=function(M,N){var O=this;O.$element=E(M),O.upInsertDOM=!1,O.loading=!1,O.isLockUp=!1,O.isLockDown=!1,O.isData=!0,O._scrollTop=0,O.init(N)},J.prototype.init=function(N){function O(){M.direction="up",M.$domDown.html(M.opts.domDown.domLoad),M.loading=!0,M.opts.loadDownFn(M)}var M=this;M.opts=E.extend({},{scrollArea:M.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},distance:50,threshold:"",loadUpFn:"",loadDownFn:""},N),""!=M.opts.loadDownFn&&(M.$element.append('<div class="'+M.opts.domDown.domClass+'">'+M.opts.domDown.domRefresh+"</div>"),M.$domDown=E("."+M.opts.domDown.domClass)),M.opts.scrollArea==F?(M.$scrollArea=H,M._scrollContentHeight=I.height(),M._scrollWindowHeight=G.documentElement.clientHeight):(M.$scrollArea=M.opts.scrollArea,M._scrollContentHeight=M.$element[0].scrollHeight,M._scrollWindowHeight=M.$element.height()),M._scrollContentHeight<=M._scrollWindowHeight&&O(),H.on("resize",function(){M._scrollWindowHeight=M.opts.scrollArea==F?F.innerHeight:M.$element.height()}),M.$element.on("touchstart",function(P){M.loading||(K(P),L(P,M))}),M.$element.on("touchmove",function(P){M.loading||(K(P,M),A(P,M))}),M.$element.on("touchend",function(){M.loading||B(M)}),M.$scrollArea.on("scroll",function(){M._scrollTop=M.$scrollArea.scrollTop(),M._threshold=""===M.opts.threshold?Math.floor(1*M.$domDown.height()/3):M.opts.threshold,""!=M.opts.loadDownFn&&!M.loading&&!M.isLockDown&&M._scrollContentHeight-M._threshold<=M._scrollWindowHeight+M._scrollTop&&O()})},J.prototype.lock=function(M){var N=this;void 0===M?"up"==N.direction?N.isLockDown=!0:"down"==N.direction?N.isLockUp=!0:(N.isLockUp=!0,N.isLockDown=!0):"up"==M?N.isLockUp=!0:"down"==M&&(N.isLockDown=!0)},J.prototype.unlock=function(){var M=this;M.isLockUp=!1,M.isLockDown=!1},J.prototype.noData=function(){var M=this;M.isData=!1},J.prototype.resetload=function(){var M=this;"down"==M.direction&&M.upInsertDOM?M.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){M.loading=!1,M.upInsertDOM=!1,E(this).remove(),C(M)}):"up"==M.direction&&(M.loading=!1,M.isData?(M.$domDown.html(M.opts.domDown.domRefresh),C(M)):M.$domDown.html(M.opts.domDown.domNoData))}}(window.Zepto||window.jQuery);