$(function(){function H(){$(".j_prePage").on("click tap",function(){1>=window.history.length?window.location.href=window.location.href:window.history.go(-1)});$(".j_preStep").on("click tap",function(){var e=$("#mrsPage"),c=$("#bookPage"),a=$("#couponPage"),m=$("#pkgPage");e.addClass("hide");a.addClass("hide");m.hasClass("hide")||(m.addClass("hide"),I());c.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){c.attr("class","");$("#bookBtn").css("visibility","visible")},
400)})}function J(){var g=$("#j_setTime"),c=$("#location").val(),a=$("#store_id").val(),m=$("#totalTime").val(),t=$("#city_id").val(),k=$("#orderDate"),h=$("#project_id"),n=0==$("#j_setMrs").length?$("#bid").val():"",q=$("#loading");g.on("click tap",function(){c?(q.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp"),$.ajax({url:"/BeauticianApi/getBookAvailableTime/",type:"GET",data:{location:c,store_id:a,orderDate:k.val(),
totalTime:m,project:h.val(),city_id:t,bid:n},dataType:"json",success:function(a){a&&!a.status&&a.data?(q.addClass("hide"),z=a.data,w&&w.gotoPage(w.currentNum),x&&x.gotoPage(x.currentNum),E(),A=!0):e(a.info,"failure")},error:function(a,c){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})):e("\u8bf7\u60a8\u70b9\u51fb\u4e0a\u65b9\u6309\u94ae\u6dfb\u52a0\u65b0\u5730\u5740\uff01","fail")})}function E(){var e=$("#timeMb"),c=$("#selectTime");e.removeClass("hide");c.removeClass("hide");
c.css("-webkit-transform","translate3d(0, -"+c.height()+"px, 0)")}function K(){var g=$("#timeMb"),c=$("#selectTime"),a=document.querySelector("#timeSelect"),m=document.querySelector("#dateSelect"),t=c.find(".fl"),k=c.find(".fr"),h={},n={},q=$("#orderDate"),p=$("#startTime");n.callback=function(a,c,d){a=$("#timeSelect").find("li");d=$("#dateSelect").find("li").eq(c);d.parent().children().removeClass("active");d.addClass("active");A&&q.val(d.data("value"));if(z)for(d=0;d<a.length;d++){var e=z[c].detail;
a.eq(d).removeClass("booked");"1"==e[d+18]&&a.eq(d).addClass("booked")}$("#timeSelect").find(".active").hasClass("booked")?k.addClass("not"):k.removeClass("not")};h.callback=function(a,c,e){a=$("#timeSelect").find("li").eq(c);a.parent().children().removeClass("active");a.addClass("active");!a.hasClass("booked")&&A?(k.removeClass("not"),p.val(a.data("value"))):k.addClass("not")};x=new Swiper(a,h);w=new Swiper(m,n);g.on("click tap",function(){var a=$(this);c.css("-webkit-transform","translate3d(0, 0, 0)");
setTimeout(function(){c.addClass("hide");a.addClass("hide")},300)});t.on("click tap",function(){c.css("-webkit-transform","translate3d(0, 0, 0)");setTimeout(function(){c.addClass("hide");g.addClass("hide")},300)});k.on("click tap",function(){var a=$("#timeSelect"),h=$("#dateSelect"),d=$("#startTime"),l=$("#orderDate"),f=$("#j_setTime");if(!$(this).hasClass("not")){c.css("-webkit-transform","translate3d(0, 0, 0)");setTimeout(function(){c.addClass("hide");g.addClass("hide")},300);var r=d.val(),b=l.val(),
B=a.find(".active").data("value"),y=h.find(".active").data("value"),a=h.find(".active").html()+" "+a.find(".active").html();$("#bookBtn");$("#bookForm");var L=$("#location");$(".agreement").find("input").eq(0);var C=$("#loading"),k=$("#store_id"),m=$("#city_id").val(),M=$("#totalTime");$("#bid");var l=$("#orderDate"),N=$("#bookPage"),n=$("#mrsPage"),h=$("#mrsList"),p=h.find(".loading").eq(0),q=$("#project_id");d.val(B);l.val(y);f.html(a);(r&&r!=B||b&&b!=y)&&$("#bid").val()&&0<$("#j_setMrs").length&&
(h.find("a").remove(),e("\u8bf7\u60a8\u91cd\u65b0\u9009\u62e9\u7f8e\u5bb9\u5e08\uff01","fail"),setTimeout(function(){C.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp");$.ajax({url:"/BeauticianApi/getBeauticianListOnTime/",type:"GET",data:{location:L.val(),totalTime:M.val(),store_id:k.val(),page:1,pageSize:7,project:q.val(),orderDate:l.val(),startTime:d.val(),city_id:m,isHalf:$("#isHalf").val(),serviceType:$("#serviceType").val()},
dataType:"json",success:function(b){if(b&&!b.status&&b.data.list){for(var a=0;a<b.data.list.length;a++)$('<a href="javascript:void(0);" data-homeid="'+b.data.home_id+'" data-id="'+b.data.list[a].bid+'" data-name="'+b.data.list[a].name+'"><dl><dt><img src="http://dimg.365vmei.cn'+b.data.list[a].avatar+'" alt="'+b.data.list[a].name+'"></dt><dd><h3 class="'+(b.data.list[a].have_served?"served":"")+'">'+b.data.list[a].name+"</h3><p>"+b.data.list[a].short_intro+"</p><p><i></i>\u8ba2\u5355\u6570\uff08"+
b.data.list[a].order_count+"\uff09<i></i>\u597d\u8bc4\u6570\uff08"+b.data.list[a].assessmentCount+"\uff09</p></dd></dl></a>").insertBefore(p);1==b.data.total&&p.data("loaded",1);C.addClass("hide");N.addClass("hide");$("#bookBtn").css("visibility","hidden");n.removeClass("hide").addClass("animated").addClass("fadeInRight");setTimeout(function(){n.attr("class","")},400)}else e(b.info,"failure")},error:function(b,a){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})},1E3))}})}
function e(e,c){var a=$("#loading");"failure"!=c?(a.html('<span class="'+c+'"></span>'+e).removeClass("hide").addClass("animated").addClass("fadeInUp"),setTimeout(function(){a.addClass("hide").html("").attr("class","hide")},1E3)):(a.html('<span class="fail"></span>'+e).removeClass("hide").addClass("animated").addClass("fadeInUp"),setTimeout(function(){a.addClass("hide").html("").attr("class","hide")},3E3))}function O(){var g=$("#bookBtn"),c=$("#bookForm"),a=$("#location"),m=$("#startTime"),t=$(".agreement").find("input").eq(0),
k=$("#loading"),h=$("#store_id"),n=$("#totalTime"),q=$("#bid"),p=$("#orderDate"),u=$("#bookPage"),v=$("#mrsPage"),d=$("#mrsList").find(".loading").eq(0),l=$("#city_id").val(),f=$("#project_id"),r=parseInt($("#serviceType").val()),b=$("#storeUserName"),B=$("#storeUserTel"),y=/^1\d{10}$/i;g.on("click tap",function(){var g=$(this);if("yes"!==g.data("loading"))if(a.val()||1!=r)if(0<$(".fault").length&&1==r)e($(".fault").eq(0).html(),"fail");else if(m.val()||1!=r)if(q.val()||1!=r)if(b.val()||2!=r)if(y.test(B.val())||
2!=r)if(t.attr("checked")){for(var C={},F=c.find("input").not('[type="checkbox"]'),D=0;D<F.length;D++)C[F.eq(D).attr("name")]=F.eq(D).val();g.data("loading","yes");$.ajax({url:"/OrderApi/add",type:"POST",dataType:"json",data:C,success:function(b){0==b.status&&b.data&&b.data.url?(sessionStorage.removeItem("store_location"),document.location.href=b.data.url):2==b.status&&b.data&&b.data.url?(sessionStorage.removeItem("store_location"),e(b.info,"succ"),setTimeout(function(){document.location.href=b.data.url},
1500)):(-1==b.status?e(b.info,"failure"):e("\u63d0\u4ea4\u8ba2\u5355\u5931\u8d25\uff01\u8bf7\u7a0d\u540e\u518d\u8bd5~","fail"),g.data("loading","no"))},error:function(b,a){e("\u63d0\u4ea4\u8ba2\u5355\u5931\u8d25\uff01\u8bf7\u7a0d\u540e\u518d\u8bd5~","fail");g.data("loading","no")}})}else e("\u8bf7\u60a8\u9605\u8bfb\u5e76\u540c\u610f\u300a\u7f8e\u9053\u5bb6\u5e73\u53f0\u670d\u52a1\u534f\u8bae\u300b\uff01","fail");else e("\u8bf7\u6b63\u786e\u8f93\u5165\u9884\u7ea6\u4eba\u7535\u8bdd\uff01","fail"),B.focus();
else e("\u8bf7\u8f93\u5165\u9884\u7ea6\u4eba\u59d3\u540d\uff01","fail"),b.focus();else e("\u8bf7\u60a8\u9009\u62e9\u7f8e\u5bb9\u5e08\uff01","fail"),$("#mrsList").find("a").remove(),setTimeout(function(){k.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp");$.ajax({url:"/BeauticianApi/getBeauticianListOnTime/",type:"GET",data:{location:a.val(),totalTime:n.val(),store_id:h.val(),page:1,pageSize:7,project:f.val(),
orderDate:p.val(),startTime:m.val(),city_id:l,isHalf:$("#isHalf").val(),serviceType:$("#serviceType").val()},dataType:"json",success:function(b){if(b&&!b.status&&b.data.list){for(var a=0;a<b.data.list.length;a++)$('<a href="javascript:void(0);" data-homeid="'+b.data.home_id+'" data-id="'+b.data.list[a].bid+'" data-name="'+b.data.list[a].name+'"><dl><dt><img src="http://dimg.365vmei.cn'+b.data.list[a].avatar+'" alt="'+b.data.list[a].name+'"></dt><dd><h3 class="'+(b.data.list[a].have_served?"served":
"")+'">'+b.data.list[a].name+"</h3><p>"+b.data.list[a].short_intro+"</p><p><i></i>\u8ba2\u5355\u6570\uff08"+b.data.list[a].order_count+"\uff09<i></i>\u597d\u8bc4\u6570\uff08"+b.data.list[a].assessmentCount+"\uff09</p></dd></dl></a>").insertBefore(d);1==b.data.total&&d.data("loaded",1);k.addClass("hide");u.addClass("hide");$("#bookBtn").css("visibility","hidden");v.removeClass("hide").addClass("animated").addClass("fadeInRight");setTimeout(function(){v.attr("class","")},400)}else e(b.info,"failure")},
error:function(b,a){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})},1E3);else e("\u8bf7\u5148\u9009\u62e9\u670d\u52a1\u65f6\u95f4\uff01","fail"),setTimeout(function(){k.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp");$.ajax({url:"/BeauticianApi/getBookAvailableTime/",type:"GET",data:{location:a.val(),store_id:h.val(),totalTime:n.val(),project:f.val(),city_id:l,bid:0==$("#j_setMrs").length?
$("#bid").val():""},dataType:"json",success:function(b){b&&!b.status&&b.data?(k.addClass("hide"),z=b.data,w&&w.gotoPage(w.currentNum),x&&x.gotoPage(x.currentNum),E(),A=!0):e(b.info,"failure")},error:function(b,a){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})},1E3);else e("\u8bf7\u5148\u8bbe\u7f6e\u4e0a\u95e8\u5730\u5740\uff01","fail"),setTimeout(function(){document.location.href=$(".addAdr").eq(0).attr("href")},1E3)})}function P(){var g=document.documentElement.scrollTop||
document.body.scrollTop,c=$("#mrsPage"),a=$("#couponPage"),m=c.height(),t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;$("#loading");var k=$("#location"),h=$("#store_id").val(),n=$("#startTime"),q=$("#totalTime").val(),p=$("#orderDate"),u=$("#project_id"),v=$("#coupon_project_id"),d=-1==u.val().indexOf(",")?1:0,l=$("#city_id");$("#coupon_id").val();if(!c.hasClass("hide")&&g+t>=m-100){var f=$(".loading");if(!f.data("loaded")){f.parent();var r=f.data("page")||
2;if("yes"==f.data("loading"))return;f.data("loading","yes").show();$.ajax({type:"GET",url:"/BeauticianApi/getBeauticianListOnTime/",data:{page:r,pageSize:7,location:k.val(),store_id:h,orderDate:p.val(),totalTime:q,project:u.val(),startTime:n.val(),city_id:l,isHalf:$("#isHalf").val(),serviceType:$("#serviceType").val()},dataType:"json",timeout:1E4,success:function(b){f.hide().data("loading","no");if(b&&!b.status&&b.data&&0<b.data.list.length){for(var a=0;a<b.data.list.length;a++)$('<a href="javascript:void(0);" data-homeid="'+
b.data.home_id+'" data-id="'+b.data.list[a].bid+'" data-name="'+b.data.list[a].name+'"><dl><dt><img src="http://dimg.365vmei.cn'+b.data.list[a].avatar+'" alt="'+b.data.list[a].name+'"></dt><dd><h3 class="'+(b.data.list[a].have_served?"served":"")+'">'+b.data.list[a].name+"</h3><p>"+b.data.list[a].short_intro+"</p><p><i></i>\u8ba2\u5355\u6570\uff08"+b.data.list[a].order_count+"\uff09<i></i>\u597d\u8bc4\u6570\uff08"+b.data.list[a].assessmentCount+"\uff09</p></dd></dl></a>").insertBefore(f);r++;f.data("page",
r);r>b.data.total&&f.data("loaded",1)}else e(b.info,"failure")},error:function(b,a){f.hide().data("loading","no");e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})}}!a.hasClass("hide")&&g+t>=m-100&&$("._loading").each(function(){if(!$(this).data("loaded")){var b=$(this);b.parent();var a=b.data("page")||2;"yes"!=b.data("loading")&&(b.data("loading","yes").show(),$.ajax({url:"/UserCenter/getChoseCouponAj",type:"POST",data:{city:l.val(),project:v.val(),page:a,isSingle:d},dataType:"json",
success:function(f){b.hide().data("loading","no");if(f&&!f.status&&f.data.list){for(var c=0;c<f.data.list.length;c++){var d=f.data.list[c];$('<dl class="carditem '+d.couponState+" "+d.serviceType+'" data-percent="'+d.salePercent+'" data-id="'+d.couponId+'" data-type="'+d.couponType+'" data-price="'+d.saleSum+'"><dt>'+(2==d.couponType?"<span>"+d.salePercent+"</span><span>\u6298</span>":"<span>"+d.saleSum+"</span><span>\u5143</span>")+"</dt><dd><h4>"+d.title+"</h4><p>"+d.appScope+"</p><p>\u6709\u6548\u65f6\u95f4\uff1a"+
d.startDate+"-"+d.endDate+'</p><a class="j_cardDetail" href="javascript:void(0);"><i></i></a><code>'+d.serviceTypeDesc+"</code></dd><dd>"+d.couponDesc+"</dd></dl>").insertBefore(load)}a++;b.data("page",a);a>f.data.total&&b.data("loaded",1)}else e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")},error:function(a,f){b.hide().data("loading","no");e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}}))}})}function Q(){var g=$("#j_setMrs"),c=$("#location"),
a=$("#store_id").val(),m=$("#startTime"),t=$("#orderDate"),k=$("#loading"),h=$("#totalTime").val(),n=$("#project_id"),q=$("#bookPage"),p=$("#mrsPage"),u=$("#mrsList"),v=$("#city_id").val(),d=0==$("#j_setMrs").length?$("#bid").val():"",l=u.find(".loading").eq(0);g.on("click tap",function(){c.val()?m.val()?($("#mrsList").find("a").remove(),k.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp"),$.ajax({url:"/BeauticianApi/getBeauticianListOnTime/",
type:"GET",data:{location:c.val(),totalTime:h,store_id:a,page:1,pageSize:7,project:n.val(),orderDate:t.val(),startTime:m.val(),city_id:v,isHalf:$("#isHalf").val(),serviceType:$("#serviceType").val()},dataType:"json",success:function(a){if(a&&!a.status&&a.data.list){for(var d=0;d<a.data.list.length;d++)$('<a href="javascript:void(0);" data-homeid="'+a.data.home_id+'" data-id="'+a.data.list[d].bid+'" data-name="'+a.data.list[d].name+'"><dl><dt><img src="http://dimg.365vmei.cn'+a.data.list[d].avatar+
'" alt="'+a.data.list[d].name+'"></dt><dd><h3 class="'+(a.data.list[d].have_served?"served":"")+'">'+a.data.list[d].name+"</h3><p>"+a.data.list[d].short_intro+"</p><p><i></i>\u8ba2\u5355\u6570\uff08"+a.data.list[d].order_count+"\uff09<i></i>\u597d\u8bc4\u6570\uff08"+a.data.list[d].assessmentCount+"\uff09</p></dd></dl></a>").insertBefore(l);1==a.data.total&&l.data("loaded",1);k.addClass("hide");q.addClass("hide");$("#bookBtn").css("visibility","hidden");p.removeClass("hide").addClass("animated").addClass("fadeInRight");
setTimeout(function(){p.attr("class","")},400)}else a&&2==a.status?(e("\u6682\u65e0\u53ef\u9884\u7ea6\u7f8e\u5bb9\u5e08\uff01\u4e0d\u59a8\u6362\u4e2a\u65f6\u95f4\u6bb5\u5427\u4eb2~","fail"),g.html("\u6682\u65e0\u53ef\u9884\u7ea6\u7f8e\u5bb9\u5e08")):e(a.info,"failure")},error:function(a,d){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})):(e("\u8bf7\u5148\u9009\u62e9\u670d\u52a1\u65f6\u95f4\uff01","fail"),setTimeout(function(){k.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp");
$.ajax({url:"/BeauticianApi/getBookAvailableTime/",type:"GET",data:{location:c.val(),store_id:a,totalTime:h,project:n.val(),city_id:v,bid:d},dataType:"json",success:function(a){a&&!a.status&&a.data?(k.addClass("hide"),z=a.data,w&&w.gotoPage(w.currentNum),x&&x.gotoPage(x.currentNum),E(),A=!0):e(a.info,"failure")},error:function(a,d){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}})},1E3)):(e("\u8bf7\u5148\u8bbe\u7f6e\u4e0a\u95e8\u5730\u5740\uff01","fail"),setTimeout(function(){document.location.href=
$(".addAdr").eq(0).attr("href")},1E3))});$(document).on("click tap","#mrsList a",function(){var a=$(this),d=a.data("id"),b=a.data("name"),c=a.data("homeid"),y=$("#bid"),e=$("#home_id"),g=$("#mrsPage"),h=$("#bookPage"),l=$("#j_setMrs");a.siblings().removeClass("cur");a.addClass("cur");y.val(d);e.val(c);l.html(b);g.addClass("hide");h.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){h.attr("class","");$("#bookBtn").css("visibility","visible")},400)});$(window).on("scroll",
P)}function R(){var g=$("#setCoupon"),c=$("#bookPage"),a=$("#couponPage"),m=$("#noCoupon");$("#couponList");var t=$("#city_id"),k=$("#project_id"),h=$("#coupon_project_id"),n=-1==k.val().indexOf(",")?1:0,q=$("._loading"),p=$("#loading"),u=$("#coupon_id"),v=$("#couponType");$("#coupon_id").val();g.on("click tap",function(){$(this).hasClass("disabled")||(q.parent().find(".carditem").remove(),p.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp"),
$.ajax({url:"/UserCenter/getChoseCouponAj",type:"POST",data:{city:t.val(),project:h.val(),page:1,isSingle:n,serviceType:$("#serviceType").val(),home_id:$("#home_id")?$("#home_id").val():""},dataType:"json",success:function(d){if(d&&!d.status&&d.data.list){for(var g=0;g<d.data.list.length;g++){var f=d.data.list[g];$('<dl class="carditem '+f.couponState+" "+f.serviceType+'" data-percent="'+f.salePercent+'" data-id="'+f.couponId+'" data-type="'+f.couponType+'" data-price="'+f.saleSum+'"><dt>'+("percent"===
f.couponType?"<span>"+f.salePercent+"</span><span>\u6298</span>":"<span>"+f.saleSum+"</span><span>\u5143</span>")+"</dt><dd><h4>"+f.title+"</h4><p>"+f.appScope+"</p><p>\u6709\u6548\u65f6\u95f4\uff1a"+f.startDate+"-"+f.endDate+'</p><a class="j_cardDetail" href="javascript:void(0);"><i></i></a><code>'+f.serviceTypeDesc+"</code></dd><dd>"+f.couponDesc+"</dd></dl>").insertBefore(q)}1==d.data.total&&q.data("loaded",1);p.addClass("hide");c.addClass("hide");$("#bookBtn").css("visibility","hidden");a.removeClass("hide").addClass("animated").addClass("fadeInRight");
setTimeout(function(){a.attr("class","")},400)}else e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")},error:function(a,c){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}}))});$(document).on("click tap","#couponList dd",function(){var d=$(this).parent(),l=d.data("id");d.data("price");var f=d.data("type");d.data("percent");var k=$("#realPrice"),b=$('input[name="realPrice"]');d.hasClass("out")||(u.val(l),v.val(f),$.ajax({url:"/UserCenter/useCouponAjax",
type:"POST",data:{city:t.val(),projects:h.val(),coupon:l,serviceType:$("#serviceType").val()},dataType:"json",success:function(d){d&&!d.status?(k.html("<code>\uffe5</code>"+d.data.price),b.val(d.data.price),g.html("\u4f18\u60e0\u5238:<i>"+d.data.title+"</i>")):e("\u4f7f\u7528\u4f18\u60e0\u5238\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");a.addClass("hide");c.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){c.attr("class","");$("#bookBtn").css("visibility",
"visible")},400)},error:function(b,d){e("\u4f7f\u7528\u4f18\u60e0\u5238\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");a.addClass("hide");c.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){c.attr("class","");$("#bookBtn").css("visibility","visible")},400)}}))});m.on("click tap",function(){u.val();var d=$("#couponPrice").val(),e=$("#realPrice"),f=$('input[name="realPrice"]');e.html("<code>\uffe5</code>"+d);f.val(d);u.val("");v.val("");g.html("\u4f18\u60e0\u5238:<i>\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238</i>");
a.addClass("hide");c.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){c.attr("class","");$("#bookBtn").css("visibility","visible")},400)});$(document).on("click tap",".j_cardDetail",function(){var a=$(this),c=a.next().next();a.hasClass("unfold")?(a.removeClass("unfold"),c.hide()):(a.addClass("unfold"),c.show())})}function S(){var e=$(".pay").find("li"),c=$("#payment");e.on("click tap",function(){var a=$(this),m=a.data("value");a.hasClass("active")||(e.removeClass("active"),
a.addClass("active"),c.val(m))})}function T(){var g=$("#city_id").val(),c=$("#project_id").val(),a=$("#bookPage"),m=$("#itemlist"),t=$("#pkgs"),k=$("#usePkg");$("#enterPkg");var h=$("#pkgPage");$("#noPkg");var n=$("#myPkg"),q=$("#loading"),p=[],u=$("#realPrice"),v=$('input[name="realPrice"]'),d=$("#couponPrice"),l=$("#setCoupon"),f=$("#coupon_id"),r=$("#couponType");n.on("click tap",function(){G?(a.addClass("hide"),$("#bookBtn").css("visibility","hidden"),h.removeClass("hide").addClass("animated").addClass("fadeInRight"),
setTimeout(function(){h.attr("class","")},400)):(q.html("<span></span>\u52aa\u529b\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...").removeClass("hide").addClass("animated").addClass("fadeInUp"),$.ajax({url:"/PackageApi/getAvailabe",type:"GET",data:{city_id:g,items:c,serviceType:$("#serviceType").val()},dataType:"json",success:function(b){if(b&&!b.status&&b.data&&0<b.data.length){b=b.data;for(var d="",c=0,d="";c<b.length;c++){0<parseInt(b[c].use_num)&&m.append($('<dl class="item"><dt><img src="'+b[c].img+
'" alt="'+b[c].project_name+'"></dt><dd><h3>'+b[c].project_name+"</h3><p>\u6570\u91cf\uff1a"+b[c].project_num+'</p><p>\u5957\u9910\u62b5\u7528<span data-id="'+b[c].project_id+'" data-total="'+b[c].project_num+'" class="j_pkgnum" data-num="'+b[c].use_num+'">'+b[c].use_num+"</span>\u6b21</p></dd><dd></dd></dl>"));var f=b[c].package;if(0<parseInt(b[c].use_num)){for(var d=d+('<div class="usepkgitem"><h4>'+b[c].project_name+'<span class="j_pkgnum" data-num="'+b[c].use_num+'">'+b[c].use_num+"</span><span>\u00d7</span></h4>"),
g=0;g<f.length;g++)d+='<div class="pkgitem"><p>'+f[g].package_name+"</p><p>\u4f7f\u7528\u671f\u9650\uff1a\u8fd8\u6709<span>"+f[g].expire_day+"</span>\u5929&nbsp;\u5269\u4f59<span>"+f[g].package_num+"</span>\u6b21</p><p"+(0==parseInt(f[g].use_num)?' class="fold"':"")+'><a class="add odd" href="javascript:void(0);">+</a><span data-itemid="'+b[c].project_id+'" data-pkgid="'+f[g].package_id+'" data-remain="'+f[g].package_num+'" data-num="'+f[g].use_num+'" class="j_pkgnum">'+f[g].use_num+'</span><a class="minus" href="javascript:void(0);"></a></p></div>';
d+="</div>"}}t.html(d);q.addClass("hide");a.addClass("hide");$("#bookBtn").css("visibility","hidden");h.removeClass("hide").addClass("animated").addClass("fadeInRight");setTimeout(function(){h.attr("class","")},400);G=!0}else e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")},error:function(a,d){e("\u52a0\u8f7d\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail")}}))});$(document).on("click tap","#pkgPage .add",function(){if(!$(this).hasClass("odd")&&"yes"!=$(this).data("loading")){var a=
$(this),d=a.parent(),c=a.next(),e=parseInt(c.html()),f=c.data("itemid");c.data("pkgid");var g=parseInt(c.data("remain")),h=$(".itemlist").find('span[data-id="'+f+'"]').eq(0),k=parseInt(h.data("total")),l=parseInt(h.html());a.data("loading","yes");c.html(++e);h.html(++l);d.removeClass("fold");e==g&&a.addClass("odd");l==k&&$(".pkgList").find('span[data-itemid="'+f+'"]').each(function(){$(this).prev().addClass("odd")});a.closest(".usepkgitem").find("span").eq(0).html(l);a.data("loading","no")}});$(document).on("click tap",
"#pkgPage .minus",function(){if("yes"!=$(this).data("loading")){var a=$(this),d=a.parent(),c=a.prev(),e=parseInt(c.html()),f=c.data("itemid");c.data("pkgid");parseInt(c.data("remain"));var g=$(".itemlist").find('span[data-id="'+f+'"]').eq(0);parseInt(g.data("total"));var h=parseInt(g.html());a.data("loading","yes");c.html(--e);g.html(--h);0==e&&d.addClass("fold");$(".pkgList").find('span[data-itemid="'+f+'"]').each(function(){$(this).html()!=$(this).data("remain")&&$(this).prev().removeClass("odd")});
a.closest(".usepkgitem").find("span").eq(0).html(h);a.data("loading","no")}});$("#enterPkg").on("click tap",function(){var b=t.find(".add"),m=0;p.length=0;b.each(function(){var a=$(this).next(),b=parseInt(a.html()),c=a.data("itemid"),a=a.data("pkgid");0<b&&(p.push(c+"_"+a+"_"+b),m+=b)});p.join(",")!=k.val()?$.ajax({url:"/PackageApi/save",type:"GET",data:{city_id:g,items:c,package:p.join(","),serviceType:$("#serviceType").val()},dataType:"json",success:function(b){b&&!b.status&&b.data?(0<p.length?
n.html("\u6211\u7684\u5957\u9910\uff1a<i>\u9009\u7528<span>"+m+"</span>\u6b21</i>"):n.html("\u6211\u7684\u5957\u9910\uff1a<i>\u4e0d\u4f7f\u7528\u5957\u9910</i>"),k.val(p.join(",")),$(".j_pkgnum").each(function(){$(this).data("num",$(this).html())}),d.val(b.data.couponPrice),u.html("<code>\uffe5</code>"+b.data.price),v.val(b.data.price),l.html("\u4f18\u60e0\u5238\uff1a<i>"+b.data.couponName+"</i>"),f.val(b.data.couponId),b.data.couponId?l.removeClass("disabled"):l.addClass("disabled"),r.val(b.data.couponType),
$("#coupon_project_id").val(b.data.coupon_project_id)):e("\u5957\u9910\u4fee\u6539\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");h.addClass("hide");a.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){a.attr("class","");$("#bookBtn").css("visibility","visible")},400)},error:function(b,c){e("\u5957\u9910\u4fee\u6539\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");h.addClass("hide");a.removeClass("hide").addClass("animated").addClass("fadeInLeft");
setTimeout(function(){a.attr("class","");$("#bookBtn").css("visibility","visible")},400)}}):(h.addClass("hide"),a.removeClass("hide").addClass("animated").addClass("fadeInLeft"),setTimeout(function(){a.attr("class","");$("#bookBtn").css("visibility","visible")},400))});$("#noPkg").on("click tap",function(){$.ajax({url:"/PackageApi/save",type:"GET",data:{city_id:g,items:c,package:"",serviceType:$("#serviceType").val()},dataType:"json",success:function(b){b&&!b.status&&b.data?(h.find(".j_pkgnum").each(function(){$(this).html(0).data("num",
0)}),h.find(".odd").each(function(){$(this).removeClass("odd")}),h.find(".add").each(function(){$(this).parent().addClass("fold")}),n.html("\u6211\u7684\u5957\u9910\uff1a<i>\u4e0d\u4f7f\u7528\u5957\u9910</i>"),k.val(""),d.val(b.data.couponPrice),u.html("<code>\uffe5</code>"+b.data.price),v.val(b.data.price),l.html("\u4f18\u60e0\u5238\uff1a<i>"+b.data.couponName+"</i>"),f.val(b.data.couponId),r.val(b.data.couponType),b.data.couponId?l.removeClass("disabled"):l.addClass("disabled"),$("#coupon_project_id").val(b.data.coupon_project_id)):
e("\u5957\u9910\u4fee\u6539\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");h.addClass("hide");a.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){a.attr("class","");$("#bookBtn").css("visibility","visible")},400)},error:function(b,c){e("\u5957\u9910\u4fee\u6539\u5931\u8d25\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5~","fail");h.addClass("hide");a.removeClass("hide").addClass("animated").addClass("fadeInLeft");setTimeout(function(){a.attr("class","");$("#bookBtn").css("visibility",
"visible")},400)}})})}function I(){$(".j_pkgnum").each(function(){var e=$(this),c=parseInt(e.data("num"));e.html(c);if(e.data("id")){var a=e.data("id");parseInt(e.data("total"))==c&&$(".pkgList").find('span[data-itemid="'+a+'"]').each(function(){$(this).prev().addClass("odd")});0==c&&$(".pkgList").find('span[data-itemid="'+a+'"]').each(function(){$(this).parent().addClass("fold")})}else a=e.data("itemid"),a=$(".itemlist").find('span[data-id="'+a+'"]').eq(0),parseInt(a.data("total")),a=parseInt(e.data("remain")),
0==c?e.parent().addClass("fold"):c==a&&e.prev().addClass("odd")})}var z=null,x=null,w=null,A=!1,G=!1;setTimeout(function(){$("#loading").css("top",Math.ceil((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0)/2)+"px");K();H();J();Q();R();T();S();O()},300)});