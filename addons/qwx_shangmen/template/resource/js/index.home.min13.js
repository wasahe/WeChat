(function(g){function k(z){var y=window.location.search.match(new RegExp("[?&]"+z+"=([^&]+)","i"));if(y==null||y.length<0){return""}return y[1]}function h(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}function l(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0}function m(){return document.documentElement.scrollTop||document.body.scrollTop}function r(y,A){var z=365;var B=new Date();B.setTime(B.getTime()+z*24*60*60*1000);document.cookie=y+"="+escape(A)+";expires="+B.toGMTString()+";path=/"}function v(z){var y=document.cookie.match(new RegExp("(^| )"+z+"=([^;]*)(;|$)"));if(y!=null){return(y[2])}else{return""}}function c(){setTimeout(function(){if(!k("loc")){navigator.geolocation.getCurrentPosition(function z(A){locationStr=String(A.coords.longitude)+","+String(A.coords.latitude);f(locationStr)},function y(A){},{maximumAge:0,timeout:10000})}},300)}function f(A){var y="/BaiDuMapApi/getPlaceList",z=v("_cityId");g.ajax({url:y,type:"GET",dataType:"json",data:{location:A},success:function(C){if(C.status==0&&C.data&&C.data.city_id){var E=C.data.city,D=C.data.city_id;if(z!=D){var B=confirm("系统定位到您在"+E+"，需要切换城市吗？");if(B){r("_cityId",D);setTimeout(function(){document.location.href="/Index/lists/?loc="+D},100)}}}},error:function(C,B){}})}function a(){var B=g("#cityPage"),A=g(".homePage").eq(0),C=g(".j_cityEntrance"),y=Math.max(h(),B.height()),z=g("#anchors");B.css("height",y+"px");B.css("-webkit-transform","translate3d(0, "+(-y*2)+"px, 0)");C.on("click tap",function(){B.removeClass("hide").css("-webkit-transform","translate3d(0, 0, 0)");A.addClass("hide");z.removeClass("hide");g("body").css("height",y+"px")});g(".j_cityExit").on("click tap",function(){B.css("-webkit-transform","translate3d(0, "+(-y*2)+"px, 0)");A.removeClass("hide");z.addClass("hide");g("body").css("height","auto")});g("#hotCities a").on("click tap",function(){var D=g(this),E=D.data("city")||"";if(E){r("_cityId",E);setTimeout(function(){document.location.href="/Index/lists/?loc="+E},100)}});g("#cities span").on("click tap",function(){var D=g(this),E=D.parent().data("city")||"";if(E){r("_cityId",E);setTimeout(function(){document.location.href="/Index/lists/?loc="+E},100)}});g("#cities .range").on("click tap",function(){var E=g(this),H=E.parent().data("city")||"",D=E.prev().html(),G=g("#mb"),F=g("#mapWrap");if(H&&D){x.clearOverlays();g.ajax({url:"/Address/getArea",type:"GET",data:{cityId:H},dataType:"json",success:function(N){if(N&&!N.status&&N.data.length>0){var M=N.data,O=0,K=0,L=0;for(var J=0;J<M.length;J++){if(M[J].points&&M[J].points.length>0){q(M[J]);if(H=="1224"){for(var I=0;I<M[J].points.length;I++){if(M[J].areaId=="58"){O+=Number(M[J].points[I].lat);K+=Number(M[J].points[I].lng);L++}}}else{for(var I=0;I<M[J].points.length;I++){O+=Number(M[J].points[I].lat);K+=Number(M[J].points[I].lng);L++}}}}x.centerAndZoom(new BMap.Point(K/L-0.38,O/L+0.38),10);G.removeClass("hide");F.removeClass("hide").addClass("animated").addClass("fadeInUp");setTimeout(function(){for(var P=0;P<M.length;P++){if(M[P].points&&M[P].points.length>0){q(M[P])}}},1000)}else{if(!N.status){}}},error:function(J,I){}})}});g("#closeMap").on("click tap",function(){var E=g("#mb"),D=g("#mapWrap");E.addClass("hide");D.attr("class","hide")});g("#mb").on("click tap",function(){var E=g("#mb"),D=g("#mapWrap");E.addClass("hide");D.attr("class","hide")})}function q(B){var A=[],z;for(var y=0;y<B.points.length;y++){A.push(new BMap.Point(B.points[y].lng,B.points[y].lat))}z=new BMap.Polygon(A,{fillColor:"#e92c00",strokeColor:"#ff6060",strokeWeight:2,strokeOpacity:1,fillOpacity:0.12});x.addOverlay(z)}function o(){g(document).on("touchmove",function(y){if(!g("#mb").hasClass("hide")){y.preventDefault()}})}function n(z){var C=null,A=g("#"+z),D=A.find("img"),F=D.length,y=A.find("li"),F=D.length,B=F-2,E=1,G=0;C=new Swipe(document.getElementById(z),{startSlide:G,auto:4000,speed:300,callback:function(H,I){var K,J;y.removeClass("active");y.eq(H).addClass("active");if(H>=1){if(H==F-1&&G==0||H<G){K=D.eq(H-1);J=K.parent().parent()}else{if(H>G){K=D.eq(H+1);J=K.parent().parent()}}}G=H;if(K&&J&&J.data("loaded")=="0"){K.attr("src",K.data("src"));J.data("loaded","1")}}})}function e(A,z,y){if(!document.addEventListener){A.attachEvent(z,y)}else{A.addEventListener(z,y,false)}}function d(A,z,y){if(!document.removeEventListener){A.detachEvent(z,y)}else{A.removeEventListener(z,y,false)}}var w=function(y){this.wrap=document.getElementById(y);this.parentW=0;this.scrollItem=this.wrap.children;this.len=this.scrollItem.length;this._width=this.scrollItem[0].getBoundingClientRect().width||this.scrollItem[0].offsetWidth;this._height=this.scrollItem[0].getBoundingClientRect().height||this.scrollItem[0].offsetHeight;this.actualW=this._width*this.len;this.currentPos=0;this.X=0;this.curX=0;this.Y=0;this.curY=0;this.isScrolling=false;this.init()};w.prototype={init:function(){var z=this;this.parentW=this.wrap.offsetWidth;z.wrap.style["width"]=z.actualW+"px";z.wrap.style["height"]=z._height+"px";for(var y=0;y<z.len;y++){z.scrollItem[y].style["width"]=z._width+"px"}if(z.actualW>z.parentW){z.addEvent()}else{this.currentPos=0}z.setAnimation()},touchX:function(y){if(y.touches){return y.touches[0].pageX}else{return y.pageX}},touchY:function(y){if(y.touches){return y.touches[0].pageY}else{return y.pageY}},setAnimation:function(){var z=this,y=z.wrap;y.style["-webkit-transition"]="-webkit-transform 0.3s ease-in-out";y.style["-webkit-transform"]="translate3d("+z.currentPos+"px, 0, 0)"},slide:function(y){var A=this,z=A.wrap;z.style["-webkit-transition-duration"]="0s";z.style["-webkit-transform"]="translate3d("+(A.currentPos+y)+"px, 0, 0)"},addEvent:function(){var y=this.wrap,z=this;e(y,"touchstart",function(A){z._touchstart(A)});e(y,"touchmove",function(A){z._touchmove(A)});e(y,"touchend",function(A){z._touchend(A)})},_touchstart:function(y){this.X=this.touchX(y);this.Y=this.touchY(y);this.isScrolling=undefined},_touchmove:function(A){var B=this,z,y;B.curX=B.touchX(A);B.curY=B.touchY(A);z=B.curX-B.X;y=B.curY-B.Y;if(typeof B.isScrolling=="undefined"){B.isScrolling=!!(B.isScrolling||Math.abs(z)<Math.abs(y))}if(!B.isScrolling){A.preventDefault();if(B.currentPos+z>30){B.slide(30-B.currentPos)}else{if(B.currentPos+z<B.parentW-B.actualW-30){B.slide(B.parentW-B.actualW-30-B.currentPos)}else{B.slide(z)}}}},_touchend:function(B){var C=this,z=C.wrap,A=0,y=0;if(C.curX==0){C.curX=C.X}if(C.curY==0){C.curY=C.Y}A=C.curX-C.X;y=C.curY-C.Y;C.curX=0;C.curY=0;if(Math.abs(A)>Math.abs(y)){if(C.currentPos+A>0){C.currentPos=0}else{C.currentPos=Math.max(C.currentPos+A,C.parentW-C.actualW)}C.setAnimation()}d(z,"touchstart",function(D){C._touchstart(D)});d(z,"touchmove",function(D){C._touchmove(D)})}};var p=[];function j(){var z=g(".j_scroll");for(var y=0;y<z.length;y++){z[y].id="iScroll"+y;var A=new w("iScroll"+y);p.push(A)}}function t(){B=g("#scrollTop");B.on("click tap",function(){to_top_sec=new Date().getSeconds();window.scrollTo(0,0);B.addClass("hide")})}function i(){var y=m(),A=g(document).height(),z=h(),C=g("#loading"),B=g("#scrollTop");if(y+z>=A-100){g(".loading").each(function(){if(!g(this).parent().hasClass("hide")&&!g(this).data("loaded")&&g(this).data("page")){var E=g(this),G=E.parent(),F=E.data("page")||2,D=E.data("cate")||0;if(E.data("loading")=="yes"){return}else{E.data("loading","yes").show();g.ajax({type:"GET",url:"/Index/getProjectListForWap/",data:{pageSize:5,page:F,cate:D},dataType:"json",timeout:10000,success:function(M){E.hide().data("loading","no");if(!M.status&&M.data&&M.data.list.length>0){var K=M.data.list;for(var N=0;N<K.length;N++){var O='<div class="item '+K[N].saleType+'"><a href="'+K[N].url+'" title="'+K[N].title+'"><dl><dt><img src="'+K[N].img+'" alt="'+K[N].title+'" /></dt><dd><h3>'+K[N].title+'</h3><p class="effects">';for(var L=0;L<K[N].effects.length;L++){O+=K[N].effects[L]+(L!=K[N].effects.length-1?"，":"")}var P=0;if(!K[N].saleType||K[N].isSoldout=="yes"||K[N].isTimeout=="yes"||(parseInt(K[N].remainTime)==0&&K[N].isTimeout=="no")){P=K[N].price}else{P=K[N].sPrice}var S="";if(K[N].orderType=="online"){S='<cite class="online">上门</cite>'}else{if(K[N].orderType=="store"){S="<cite>到店</cite>"}else{if(K[N].orderType=="both"){S='<cite>到店</cite><cite class="online">上门</cite>'}}}O+='</p><p class="duration"><i></i>'+K[N].duration+S+'</p><p class="price"><i>￥</i>'+P+"<span>"+K[N].bPrice+"</span>"+(K[N].serveNum?"<b>"+K[N].serveNum+"人做过</b>":"")+"</p></dd><dd>";if(K[N].saleType){if(K[N].isSoldout=="no"&&((K[N].isTimeout=="no"&&parseInt(K[N].remainTime)!=0)||!K[N].isTimeout)){O+='<p class="sold"><span>已抢'+K[N].soldPercent+'</span><span><i style="width:'+K[N].soldPercent+'"></i></span><span>已抢'+K[N].soldNum+"份</span></p>"}else{if(K[N].isSoldout=="yes"&&(K[N].isTimeout=="no"||!K[N].isTimeout)){O+='<p class="out"><i>'+K[N].sPrice+"元特惠</i>已抢完</p>"}}if(parseInt(K[N].remainTime)==0&&K[N].isTimeout=="no"){O+='<p class="startTime"><span><i>'+K[N].sPrice+"元特惠</i>"+K[N].startTime+"开抢</span></p>"}else{if(parseInt(K[N].remainTime)==0&&K[N].isTimeout=="yes"){O+='<p class="out"><i>'+K[N].sPrice+"元特惠</i>已抢完</p>"}else{if(parseInt(K[N].remainTime)>0){var R=parseInt(K[N].remainTime),H=R%60,I=((R-H)/60)%60,J=((R-H-I*60)/3600)%24,Q=(R-H-I*60-J*3600)/86400;O+='<p class="timeline j_time">距离结束还有'+(Q>0?'<span class="j_day" data-num="'+Q+'">'+Q+"</span><i>天</i>":"")+'<span class="j_hour" data-num="'+J+'">'+(J>9?J:"0"+J)+'</span><i>:</i><span class="j_minute" data-num="'+I+'">'+(I>9?I:"0"+I)+'</span><i>:</i><span class="j_second" data-num="'+H+'">'+(H>9?H:"0"+H)+"</span></p>"}}}}O+="</dd></dl></a></div>";g(O).insertBefore(E);E.prev().find(".j_time").length>0&&s(E.prev().find(".j_time").eq(0))}F++;E.data("page",F);if(F>M.data.total){E.data("loaded",1)}}else{C.html('<span class="fail"></span>'+M.message).removeClass("hide").addClass("animated").addClass("fadeInUp");setTimeout(function(){C.attr("class","hide").html("")},400)}},error:function(I,H){E.hide().data("loading","no");C.html('<span class="fail"></span>加载失败，请稍后再试~').removeClass("hide").addClass("animated").addClass("fadeInUp");setTimeout(function(){C.attr("class","hide").html("")},1000)}})}}})}if(y>0){B.removeClass("hide")}else{B.addClass("hide")}}function u(y){return y<10?"0"+y:y}function s(E){if(E){var B=E,G=B.find(".j_day").eq(0),D=B.find(".j_hour").eq(0),C=B.find(".j_minute").eq(0),A=B.find(".j_second").eq(0),I=G?parseInt(G.data("num")):0,y=parseInt(D.data("num")),H=parseInt(C.data("num")),F=parseInt(A.data("num")),z=null;z=setInterval(function(){if(F>0){F--;A.data("num",F).html(u(F))}else{if(H>0){F=59;A.data("num",F).html(u(F));H--;C.data("num",H).html(u(H))}else{if(y>0){F=59;A.data("num",F).html(u(F));H=59;C.data("num",H).html(u(H));y--;D.data("num",y).html(u(y))}else{if(I>0){F=59;A.data("num",F).html(u(F));H=59;C.data("num",H).html(u(H));y=23;D.data("num",y).html(u(y));I--;if(I>0){G.data("num",I).html(I)}else{G.next().remove();G.remove()}}else{g('<p class="out">特惠已结束</p>').insertBefore(B);B.parent().find(".sold").remove();B.remove();clearInterval(z)}}}}},1000)}else{g(".j_time").each(function(){var M=g(this),Q=M.find(".j_day").eq(0),O=M.find(".j_hour").eq(0),N=M.find(".j_minute").eq(0),L=M.find(".j_second").eq(0),S=Q?parseInt(Q.data("num")):0,J=parseInt(O.data("num")),R=parseInt(N.data("num")),P=parseInt(L.data("num")),K=null;K=setInterval(function(){if(P>0){P--;L.data("num",P).html(u(P))}else{if(R>0){P=59;L.data("num",P).html(u(P));R--;N.data("num",R).html(u(R))}else{if(J>0){P=59;L.data("num",P).html(u(P));R=59;N.data("num",R).html(u(R));J--;O.data("num",J).html(u(J))}else{if(S>0){P=59;L.data("num",P).html(u(P));R=59;N.data("num",R).html(u(R));J=23;O.data("num",J).html(u(J));S--;if(S>0){Q.data("num",S).html(S)}else{Q.next().remove();Q.remove()}}else{g('<p class="out">特惠已结束</p>').insertBefore(M);M.parent().find(".sold").remove();M.remove();clearInterval(K)}}}}},1000)})}}function b(){g(".menu").on("click tap",function(){g(this).next().toggleClass("hide")})}setTimeout(function(){a();t();g(window).on("scroll",i)},300)})(window.Zepto);