(function(){var callPhoneObj=$(".pubilc-phone-module"),floatBtn=$(".pubilc-phone-floatbtn"),floatBtnA=floatBtn.find(".phone-btn-1"),telBtn=$("[data-tel]"),infoBtn=floatBtn.find(".phone-btn").html(),nighttips=$(".pubilc-phone-nighttips"),dataDetail=$("[data-telModule]").attr("data-telModule"),isNightUI=false,ajaxURL="/phone/appointment",countURL="/log/collect",nowObj="";$(window).bind("touchstart",function(){initFn()});if(isAndroidFn()){callEvent()}else{for(var i=0;i<telBtn.length;i++){var _obj=telBtn.eq(i);_obj.attr("href",_obj.attr("data-tel"))}iosCountDataFn()}if(!isNightFn()){nightCallFn()}function initFn(){if(isNightFn()){if(infoBtn){floatBtn.css("display","-webkit-box")}}else{isNightUI=true;if(dataDetail){nighttips.show()}}$(window).unbind("touchstart")}function callEvent(){var startbtn=$(".pubilc-phone-startbtn"),isGoBtn=$(".pubilc-phone-user"),isCancel=false,isThat=true,isFloat=false;_telNum="",_timer=null,_nowNum="",(function(){var _numberBtn=$('[data-call="tel"]');var _dataAmount=$('[data-amount="true"]');for(var i=0;i<_numberBtn.length;i++){var _obj=_numberBtn.eq(i),_num=_obj.attr("data-tel");if(_num.indexOf(",")===-1){_obj.attr("href",_num);_obj.removeAttr("data-call");_obj.removeAttr("data-tel");_obj.on("click",function(){countDataFn(getCityPyFn(),_obj.attr("data-telId"),_obj.attr("href").substr(4))})}}if(_dataAmount.length>0){isCancel=true}})();floatBtnA.on("click",function(e){isFloat=true;nowObj=$(this);if($(this).attr("href").indexOf("tel")===0){e.stopPropagation();return}if(isThat){_anzCallFn(e,$(this))}else{e.stopPropagation()}});$(".phone-btn-1").on("click",function(e){e.stopPropagation()});$('[data-call="tel"]').on("click",function(e){e.stopPropagation();if(isFloat){return}var _obj=$(this);nowObj=$(this);floatBtn.css("display","-webkit-box");_anzCallFn(e,_obj);isThat=false});callPhoneObj.on("click",function(e){var _phone=_nowNum||nowObj.attr("data-tel");if(isNightUI){return false}sildeShowFn(startbtn,130);floatBtn.css("display","none");if(!isCancel){if(!isNightUI){sildeShowFn(isGoBtn,0);if(!_timer){_autoCloseFn()}}}else{if(isNightFn()){floatBtn.css("display","-webkit-box")}_reBtnInfo()}e.stopPropagation()});isGoBtn.find(".phone-cancel").on("click",function(e){_cancelTelFn(e)});isGoBtn.find(".phone-going").on("click",function(e){clearInterval(_timer);sildeShowFn(isGoBtn,168);floatBtn.css("display","-webkit-box");setTimeout(function(){sildeShowFn(startbtn,5)},300);isCancel=true;e.stopPropagation()});function _anzCallFn(e,obj){_startCallFn();_telNum=obj.attr("data-tel");isNightUI=false;countDataFn(getCityPyFn(),obj.attr("data-telId"),_telNum.substr(4));if(!isNightUI){nighttips.hide()}setTimeout(function(){floatBtn.find(".phone-btn").attr({href:_telNum,"data-zhuji":obj.attr("data-zhuji"),"data-fenji":obj.attr("data-fenji"),"data-groupid":obj.attr("data-groupid")})},500);floatBtn.find(".number").html(_telNum.split(",")[1]);e.stopPropagation()}function _autoCloseFn(){var _iNow=20;_timer=setInterval(function(){_iNow=_iNow-1;isGoBtn.find(".content-close .seconds").html(_iNow);if(_iNow===0){_cancelTelFn()}},1000)}function _cancelTelFn(e){clearInterval(_timer);sildeShowFn(isGoBtn,168);isCancel=true;_reBtnInfo();if(e){e.stopPropagation()}}function _reBtnInfo(){isFloat=false;callPhoneObj.removeClass("pubilc-phone-module2");floatBtn.find(".phone-btn").html(infoBtn).removeAttr("href");if(!isNightFn()){if(!isNightUI&&dataDetail){nighttips.show()}}else{isThat=true;if(infoBtn){floatBtn.css("display","-webkit-box")}else{floatBtn.css("display","none")}}}function _startCallFn(){callPhoneObj.addClass("pubilc-phone-module2");floatBtn.find(".phone-btn").html("立即拨打");setTimeout(function(){sildeShowFn(startbtn,5)},100)}}function nightCallFn(){var bookBtn=$(".pubilc-phone-nighttips .booking"),nightui=$(".pubilc-phone-nightui"),booktime=$(".nightui-module-booktime .time"),submitBtn=$(".nightui-module-bookbtn"),errorTips=$(".nightui-module-error"),bookphone=$(".nightui-module-bookphone"),inputTxt=bookphone.find("input"),inputIco=bookphone.find(".icon"),bookinfo=$(".nightui-module-bookinfo"),phonelabel=bookinfo.find(".bookphone label"),timelabel=bookinfo.find(".bookptime label");bookBtn.on("click",function(e){e.stopPropagation();isNightUI=true;sildeShowFn(nighttips,50);callPhoneObj.addClass("pubilc-phone-module2");nightui.show()});nightui.find(".nightui-closeBtn").on("touchstart",function(e){e.stopPropagation();setTimeout(function(){closeNighttipsFn()},400)});booktime.on("touchstart",function(){var _iNow=$(this).index()-1;booktime.removeClass("selected");booktime.eq(_iNow).addClass("selected")});submitBtn.find(".bookbtn").on("touchstart",function(){var _phone=inputTxt.val(),_time=$(".nightui-module-booktime .selected").html();if(_phone.length!==11||!_phone.match(/^1[3|4|5|8][0-9]\d{4,8}$/)){errorTips.show();bookphone.addClass("nightui-module-bookphone-error");return false}else{var _data={cityId:focusjs.data.jsp.city.cityId,groupId:focusjs.data.jsp.groupId,time:_time,phone:_phone};ajaxBookFn(_data)}});inputTxt.on("focus",function(){errorTips.hide();inputIco.addClass("icon2");bookphone.removeClass("nightui-module-bookphone-error");bookphone.addClass("nightui-module-bookphone2");if(isQQFn()){sildeShowFn(nightui,-100)}}).on("blur",function(){inputIco.removeClass("icon2");bookphone.removeClass("nightui-module-bookphone2");if(isQQFn()){sildeShowFn(nightui,0)}});submitBtn.find(".closebtn").on("touchstart",function(){closeNighttipsFn()});function closeNighttipsFn(){nightui.hide();callPhoneObj.removeClass("pubilc-phone-module2");sildeShowFn(nighttips,0);$("#nightui-module1").show();$("#nightui-module2").hide();inputTxt.val("");booktime.removeClass("selected");booktime.eq(0).addClass("selected")}function ajaxBookFn(param){$.ajax({type:"GET",url:ajaxURL,data:{cityId:param.cityId,groupId:param.groupId,time:param.time,mobile:param.phone},async:true,dataType:"json",success:function(str){str=str.data;if(str.status===0){successBooxFn(param.phone,param.time)}else{alert("重复预约")}}})}function successBooxFn(num,date){var oDate=new Date();phonelabel.eq(0).html(num.substr(0,3));phonelabel.eq(1).html(num.substr(7,4));timelabel.eq(0).html((oDate.getMonth()+1)+"月"+(oDate.getDate()+1)+"日");timelabel.eq(1).html(date);$("#nightui-module1").removeClass("show");$("#nightui-module2").show()}}function isNightFn(){var _time=12;if(dataDetail){_time=phonepagetime}if(_time<19&&_time>8){return true}else{return false}}function sildeShowFn(obj,target){obj.css("-webkit-transform","translate(0px, "+target+"px)");obj.css("transform","translate(0px, "+target+"px)")}function isAndroidFn(){if(window.navigator.userAgent.toLowerCase().indexOf("android")===-1){return false}else{return true}}function isQQFn(){if(window.navigator.userAgent.toLowerCase().indexOf("mqqbrowser")===-1){return false}else{return true}}function countDataFn(name,id,phone){$.ajax({type:"POST",url:countURL,data:{cityName:name,groupId:id,phone400:phone}})}function getCityPyFn(){return document.URL.split("/")[3]}function iosCountDataFn(){$('[data-call="tel"]').on("touchstart",function(){countDataFn(getCityPyFn(),$(this).attr("data-telId"),$(this).attr("data-tel").substr(4))})}})();