{template 'common/header'}

<ul class="nav nav-tabs">
	<li><a href="{php echo $this->createWebUrl('rank')}">管理圈子</a></li>
	<li class="active"><a href="javascript:location.reload();">管理员管理</a></li>
	<li><a href="javascript:;"  onclick="user_to_admin('{php echo $this->createWebUrl('admin', array('cmd'=>'add','rank_id' => $_GPC['rank_id']))}');">新增管理员</a></li>
</ul>

<div class="panel panel-default">
	<nav role="navigation" class="navbar navbar-default navbar-static-top" style="margin-bottom:0;">
		<div class="container-fluid">
			<div class="navbar-header">
				<a href="javascript:;" class="navbar-brand">管理员</a>
			</div>
		</div>
	</nav>


	<div class="panel-body table-responsive" style="overflow:visible;">
		<table class="table table-hover">
			<thead class="navbar-inner">
				<tr>
					<th style="width:5%;">UID</th>
					<th style="width:20%;">管理员</th>
					<th style="width:20%;">等级</th>
					<th style="text-align:right; width:10%;">操作</th>
				</tr>
			</thead>
			<tbody>
				{loop $list $item}
				<tr>
					<td>{$item['uid']}</td>
					<td><img style="width:50px;" src="{php echo VP_AVATAR($item['_user']['avatar'])}"/> {$item['_user']['nickname']}</td>
					<td>{$item['admin']}</td>

					<td style="text-align:right;overflow:visible;">
						<a href="{php echo $this->createWebUrl('admin', array('cmd'=>'delete','rank_id' => $_GPC['rank_id'],'uid' => $item['uid']))}" onclick="return confirm('此操作不可恢复，确认删除？');return false;" class="btn btn-default btn-sm" data-toggle="tooltip" data-placement="top" title="删除"><i class="fa fa-times"></i></a>
					</td>
				</tr>
				{/loop}

			</tbody>
		</table>
		{$pager}
	</div>
	</div>
</div>
<script type="text/javascript">
	require(['bootstrap'],function($){
		$('.btn').hover(function(){
			$(this).tooltip('show');
		},function(){
			$(this).tooltip('hide');
		});
	});

	function user_to_admin(url) {
		require(['jquery', 'util'], function($, u) {
			var content =  '	<div class="form-group">';
				content += '	<h4>用户ID：</h4>';
                content += '	<input type="text" name="uid" class="uid form-control" />';
				content += '	</div>';

			var footer =
					'<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>' +
					'<button type="button" class="btn btn-success">设为管理员</button>';
			var diaobj = u.dialog('添加管理员', content, footer);
			diaobj.find('.btn-default').click(function() {
				diaobj.modal('hide');
			});
			diaobj.find('.btn-success').click(function() {
				$.post(url,{
					uid:diaobj.find('.uid').val()
				},function(resp) {
					if(resp.status==1){
						alert(resp.info);
					}else{
						alert(resp.info);
						location.reload();
					}
				});
			});
			diaobj.modal('show');
		});
	}
</script>

{template 'common/footer'}
