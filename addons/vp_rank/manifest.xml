<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns="http://www.012wz.com" versionCode="0.6,0.7">
	<application setting="true">
		<name><![CDATA[评评圈]]></name>
		<identifie><![CDATA[vp_rank]]></identifie>
		<version><![CDATA[0.4]]></version>
		<type><![CDATA[other]]></type>
		<ability><![CDATA[评评圈]]></ability>
		<description><![CDATA[评评圈]]></description>
		<author><![CDATA[折翼天使资源社区]]></author>
		<url><![CDATA[http://www.012wz.com/]]></url>
	</application>
	<platform>
		<subscribes>
			<message type="subscribe" />
			<message type="unsubscribe" />
		</subscribes>
		<handles>
			<message type="subscribe" />
			<message type="unsubscribe" />
		</handles>
		<rule embed="false" />
		<card embed="false" />
	</platform>
	<bindings>
		<menu>
			<entry title="圈子管理" do="rank" state="" direct="false" />
		</menu>
	</bindings>
	<permissions>
	</permissions>
	<install><![CDATA[
		CREATE TABLE IF NOT EXISTS `ims_vp_rank` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `name` varchar(64) NOT NULL,
		  `type` tinyint(1) NOT NULL COMMENT '1:美食，2房产',
		  `settings` text NOT NULL,
		  `lang` text,
		  `authoritys` text COMMENT '权威等级设置',
		  `menus` text COMMENT '菜单设置',
		  `create_time` int(11) NOT NULL,
		  `update_time` int(11) NOT NULL,
		  PRIMARY KEY (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_feed` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `user_info` text COMMENT '发布者用户序列化信息（为了提高效率冗余存储）',
		  `type` tinyint(1) NOT NULL COMMENT '1:红 2：黑',
		  `title` varchar(255) DEFAULT NULL COMMENT '标题',
		  `content` text NOT NULL COMMENT '内容',
		  `images` text COMMENT '图片',
		  `video` varchar(500) DEFAULT NULL COMMENT '视频地址',
		  `link` varchar(255) DEFAULT NULL COMMENT '链接',
		  `merchant_id` int(11) DEFAULT NULL COMMENT '该评价的商户ID',
		  `merchant_name` varchar(255) DEFAULT NULL COMMENT '该评价的商户名称',
		  `top_level` int(11) NOT NULL COMMENT '置顶级别，超过置顶线的piece，置顶级别即为总金额数，否则为0',
		  `status` tinyint(1) NOT NULL COMMENT '0:未生效，1：有效，2：删除',
		  `views` int(11) NOT NULL COMMENT '被查看的次数',
		  `links` int(11) NOT NULL COMMENT '链接被点击的次数',
		  `replys` int(11) NOT NULL COMMENT '被回复的次数',
		  `agrees` int(11) NOT NULL COMMENT '被赞数',
		  `agreers` text COMMENT '点赞的用户ids,逗号分隔',
		  `disagrees` int(11) NOT NULL COMMENT '被踩数',
		  `disagreers` text COMMENT '踩的用户ids,逗号分隔',
		  `create_time` int(11) NOT NULL COMMENT '该记录创建时间',
		  `update_time` int(11) NOT NULL,
		  `op` tinyint(1) NOT NULL COMMENT '管理员操作（0：未审核，1：正常，2：禁止访问）',
		  `op_remark` text COMMENT '操作说明',
		  `op_admin` int(11) DEFAULT NULL COMMENT '操作的管理员user_id',
		  PRIMARY KEY (`id`),
		  UNIQUE KEY `id` (`id`),
		  UNIQUE KEY `id_uniacid_rank_id_uid` (`id`,`uniacid`,`rank_id`,`uid`) USING BTREE,
		  UNIQUE KEY `id_uniacid_rank_id` (`id`,`uniacid`,`rank_id`) USING BTREE,
		  KEY `uniacid_rank_id` (`uniacid`,`rank_id`) USING BTREE
		) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_gree` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `feed_id` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `gree_uid` int(11) NOT NULL,
		  `gree` tinyint(1) NOT NULL COMMENT '1:赞同，2：反对',
		  `create_time` int(11) NOT NULL,
		  PRIMARY KEY (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_merchant` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `name` varchar(255) NOT NULL,
		  `telephone` varchar(32) DEFAULT NULL,
		  `address` varchar(80) DEFAULT NULL,
		  `lat` double DEFAULT NULL,
		  `lng` double DEFAULT NULL,
		  `create_uid` int(11) DEFAULT NULL COMMENT '创建人uid,0为后台创建',
		  `create_time` int(11) NOT NULL,
		  `status` int(11) NOT NULL COMMENT '0:未审核,1:已审核',
		  `status_time` int(11) NOT NULL,
		  `score` int(11) NOT NULL COMMENT '总综合评分',
		  `goods` int(11) NOT NULL COMMENT '总好评数',
		  `bads` int(11) NOT NULL COMMENT '总差评数',
		  PRIMARY KEY (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_order` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `biz` varchar(32) NOT NULL COMMENT '业务代号',
		  `biz_id` int(11) NOT NULL COMMENT '业务商品ID',
		  `uid` int(11) NOT NULL COMMENT '购买者用户ID',
		  `rank_id` int(11) NOT NULL COMMENT '购买时所在圈子ID(可以为0，为0表示所购项目与圈子无关)',
		  `fee` int(11) NOT NULL COMMENT '应付钱（分）',
		  `detail` text COMMENT '订单详情',
		  `status` tinyint(1) NOT NULL COMMENT '1:发起，2：已付款, 3:业务已处理',
		  `create_time` int(11) NOT NULL,
		  `pay` int(11) DEFAULT NULL,
		  `pay_time` int(11) DEFAULT NULL,
		  PRIMARY KEY (`id`),
		  UNIQUE KEY `id` (`id`),
		  KEY `urs` (`uniacid`,`rank_id`,`status`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_outcash` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `openid` varchar(100) NOT NULL COMMENT '用户的openid',
		  `money` int(11) NOT NULL COMMENT '提现金额（分）',
		  `money_before` int(11) NOT NULL COMMENT '提现前账户金额',
		  `money_after` int(11) NOT NULL COMMENT '提现后账户金额',
		  `cash` int(11) NOT NULL COMMENT '用户实际获得金额',
		  `rate` float NOT NULL COMMENT '服务费比例',
		  `tax` int(11) NOT NULL COMMENT '扣除服务费金额（分）',
		  `status` tinyint(1) NOT NULL COMMENT '0：发起\n1：成功\n2：失败（未退帐）\n3：失败（已退帐）',
		  `channel` tinyint(1) DEFAULT NULL COMMENT '1:微信红包，2：企业转账',
		  `mch_billno` varchar(50) DEFAULT NULL COMMENT '商户订单号（本系统内业务订单号）',
		  `out_billno` varchar(50) DEFAULT NULL COMMENT '外部订单号（对接系统的订单号）',
		  `out_money` int(11) DEFAULT NULL COMMENT '接口交易订单中的实际金额（分）',
		  `tag` text COMMENT '接口订单信息序列化存储',
		  `remark` text,
		  `fedback` text COMMENT '处理反馈',
		  `create_time` int(11) NOT NULL COMMENT '创建时间',
		  `update_time` int(11) NOT NULL COMMENT '更新时间',
		  PRIMARY KEY (`id`),
		  UNIQUE KEY `id` (`id`),
		  KEY `ur` (`uniacid`,`rank_id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='用户提现记录表';

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_reply` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `feed_id` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `content` text,
		  `create_time` int(11) NOT NULL,
		  `update_time` int(11) NOT NULL,
		  `status` tinyint(1) NOT NULL COMMENT '0：未审核 1：审核通过 2：审核不通过',
		  `status_time` int(11) DEFAULT NULL,
		  `op_id` int(11) DEFAULT NULL,
		  `op_time` int(11) DEFAULT NULL,
		  `likes` int(11) NOT NULL COMMENT '被赞数',
		  `likers` text COMMENT '点赞人uid,逗号分隔',
		  PRIMARY KEY (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_report` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `feed_id` int(11) NOT NULL,
		  `reply_id` int(11) NOT NULL,
		  `to_uid` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `type` varchar(80) NOT NULL COMMENT '举报分类',
		  `content` text CHARACTER SET gbk COMMENT '举报内容',
		  `create_time` int(11) NOT NULL,
		  `status` tinyint(1) NOT NULL COMMENT '举报状态：1：未处理，2：已处理',
		  `status_time` int(11) DEFAULT NULL,
		  `op_admin` int(11) DEFAULT NULL,
		  PRIMARY KEY (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_user` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL,
		  `uid` int(11) NOT NULL,
		  `nickname` varchar(80) DEFAULT NULL,
		  `avatar` varchar(255) DEFAULT NULL,
		  `followed` tinyint(1) NOT NULL COMMENT '是否关注过了（未：0,1：已关注过）。这个量仅用于结合fan[''fllow'']一起判断是否首次关注',
		  `follow` tinyint(1) NOT NULL DEFAULT '-1' COMMENT '是否正在关注（-1:未知，未：0,1：正关注）。这个量用于优化性能，不使用查询fan表来实现了解用户是否正关注公众号',
		  `in_position` tinyint(1) DEFAULT NULL COMMENT '0:未定位 1:在范围内 2：不在范围内',
		  `last_city` varchar(60) DEFAULT NULL COMMENT '上次定位所在城市',
		  `last_position` text NOT NULL COMMENT '上次定位所在地',
		  `last_position_exp` int(11) NOT NULL COMMENT '上次定位过期时间',
		  `create_time` int(11) NOT NULL COMMENT '该用户记录创建时间',
		  `black` tinyint(1) NOT NULL COMMENT '0:非黑名单,1:黑名单',
		  `black_why` varchar(255) DEFAULT NULL COMMENT '被列入黑名单的原因',
		  `admin` tinyint(1) NOT NULL COMMENT '是否是管理员：0否，大于0，是',
		  `authority` int(11) NOT NULL COMMENT '权威',
		  `agreeds` int(11) NOT NULL COMMENT '被赞同数',
		  `disagreeds` int(11) NOT NULL COMMENT '被反对数',
		  `money` int(11) NOT NULL COMMENT '我的余额（人民币：分）',
		  `income` int(11) NOT NULL COMMENT '我的收入累计（人民币：分）',
		  `outcash` int(11) NOT NULL COMMENT '我的提现总和',
		  PRIMARY KEY (`id`),
		  UNIQUE KEY `id` (`id`)
		) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

		CREATE TABLE IF NOT EXISTS `ims_vp_rank_ward` (
		  `id` int(11) NOT NULL AUTO_INCREMENT,
		  `uniacid` int(11) NOT NULL,
		  `rank_id` int(11) NOT NULL COMMENT '圈子ID',
		  `uid` int(11) NOT NULL COMMENT '打赏者用户ID',
		  `nickname` varchar(255) DEFAULT NULL COMMENT '打赏者用户昵称',
		  `avatar` varchar(255) DEFAULT NULL COMMENT '打赏者用户头像',
		  `ward_uid` int(11) NOT NULL COMMENT '被打赏者用户ID',
		  `feed_id` int(11) NOT NULL COMMENT '打赏所在内容ID',
		  `reply_id` int(11) NOT NULL COMMENT '打赏所在回复ID',
		  `money` int(11) NOT NULL COMMENT '打赏金额（分）',
		  `detail` text COMMENT '打赏详情',
		  `create_time` int(11) NOT NULL,
		  PRIMARY KEY (`id`),
		  UNIQUE KEY `id` (`id`)
		) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
	]]></install>
	<uninstall><![CDATA[]]></uninstall>
	<upgrade><![CDATA[]]></upgrade>
</manifest>