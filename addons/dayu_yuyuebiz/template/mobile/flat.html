{template 'headers'}
    <script src="{TEMPLATE_PATH}time/js/mobiscroll_002.js" type="text/javascript"></script>
	<script src="{TEMPLATE_PATH}time/js/mobiscroll_004.js" type="text/javascript"></script>
	<link href="{TEMPLATE_PATH}time/css/mobiscroll_002.css" rel="stylesheet" type="text/css">
	<script src="{TEMPLATE_PATH}time/js/mobiscroll.js" type="text/javascript"></script>
	<script src="{TEMPLATE_PATH}time/js/mobiscroll_003.js" type="text/javascript"></script>
	<script src="{TEMPLATE_PATH}time/js/mobiscroll_005.js" type="text/javascript"></script>
	<link href="{TEMPLATE_PATH}time/css/mobiscroll_003.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="{TEMPLATE_PATH}css/submit.css">
<script type="text/javascript">
	function validate(){
		if(empty({$address})){
				alert('联系方式不能为空');
		}
		return true;
	}
</script>
<style>
.am-g{background-color:#f2f2f2;font-weight:300;}
.am-g .am-form-group{padding:0.5rem 0 0.5rem 0;margin:0 0 1px;background-color:#fff;width:100%;}
.am-g .am-form-group:last-child{background-color:transparent;}
.am-g .am-form-group label.am-u-sm-3 {line-height:3rem;}

.am-u-sm-3{padding:0;width:28%;font-size:1.4rem;font-weight:500;text-align:right;padding: 0.5rem 0.5rem 0.5rem 0;line-height:1.8rem;margin:0;color:#999;}
.am-u-sm-9{border-bottom: 0px solid #ccc;width:72%;}

.am-form-group .am-u-sm-12{margin:0;}

.description{font-size:1.2rem;line-height:1.6rem;padding:0.5rem 0.5rem 0;}
.am-thumbnails{margin-left:-2.8rem;}
.am-thumbnails > li {float:left;padding:0;margin:0;line-height:2rem;height:3.8rem;min-width:50%;list-style:none}
.am-thumbnails > li .am-checkbox-inline, .am-thumbnails > li .am-radio-inline{background-color:transparent;padding: 0 0 0 2rem;height:1rem;line-height:2rem;font-size:1.5rem}

.am-u-sm-6{padding:0;}
.am-u-sm-6:first-child{padding-right:0.5rem;}

.am-form-icon [class*='am-icon-'] {left: 2rem;}

.checkbox{padding-top:0.5rem;}
.dw {
    position: absolute;
    top: 0;height:25rem;
    left: 0;
}
.am-u-sm-12 .am-u-sm-10 p{padding:0 0 0.2rem 0;line-height:120%;margin:0;}
.am-form .am-u-sm-9 input[type="number"]{padding: 0 1rem;color:#f46a04}
.am-form .am-u-sm-9 .num{color:#f46a04}
font.iconfont{font-size:2rem;}

.am-form input.xiangmu[disabled]{
  cursor: not-allowed;
  background-color: #fff;color:#000;
}
</style>
		<header data-am-widget="header" id="header" class="am-header am-topbar-inverse am-header-fixed pro">
            <div class="am-header-left am-header-nav">
              <a href="javascript:history.go(-1);"><font class="am-icon iconfont">&#xe60c;</font></a>
            </div>
            <div class="am-header-right am-header-nav">
            <img src="{if !empty($fans['tag']['avatar'])}{$fans['tag']['avatar']}{else}resource/images/noavatar_middle.gif{/if}" class="am-circle"> <font>{$fans['nickname']}</font>
            </div>
		</header>
		
	<div class="am-intro" style="margin-top:-5rem">
		<ul class="am-slides">
			<li><img src="{$activity['thumb']}" style="width:100%;"></li>	
		<div class="head-nav">
			<a class="head-nav-list" href="javascript:;">{$creditnames[$behavior['activity']]['title']}<span>{$credits[$behavior['activity']]}</span></a>
			<a class="head-nav-list" href="javascript:;">{$creditnames[$behavior['currency']]['title']}<span>{$credits[$behavior['currency']]}</span></a>
			<!--<a class="head-nav-list line" href="{php echo url('entry', array('m' => 'recharge', 'do' => 'pay'));}">余额充值</a>-->
			<a class="head-nav-list line" href="javascript:;" data-am-modal="{target: '#explain'}">门店简介</a>
		</div>		
		</ul>
		<div class="am-popup" id="explain">
		<div class="am-popup-inner">
			<div class="am-popup-hd">
			<h4 class="am-popup-title">{$activity['title']}</h4>
			<span data-am-modal-close class="am-close">&times;</span>
			</div>
			<div class="am-popup-bd">
			{php echo htmlspecialchars_decode($activity['content'])}
			</div>
		</div>
		</div>
	</div>
	
<div class="am-container">
<div class="am-g">
	<form action="" class="am-form am-form-inline am-form-horizontal" enctype="multipart/form-data" method="POST" id="form" onsubmit="return validate();" data-am-validator>
	<input type="hidden" name="repeat" value="<?php echo md5(sha1(time())); ?>">
	{if $activity['is_addr']==1}
	<div class="am-u-sm-12 am-text-xs am-table" style="border-bottom: 0.5rem solid #efeff4;padding-bottom:1rem;">
			{if !empty($address)}
        <div class="am-alert" style="margin-top:10px;float:left;margin-bottom:0.5rem;" id="address_{$address['id']}" onclick="changeAddress()">
		<div class="am-u-sm-2" style="padding:0;">
			<img src="{if !empty($fans['tag']['avatar'])}{$fans['tag']['avatar']}{else}resource/images/noavatar_middle.gif{/if}" class="am-radius" alt="{$fans['nickname']}" width="100%"/>
		</div>		
		<div class="am-u-sm-10 am-vertical-align">
		<div class="am-text-sm">{$address['username']}<span class="am-text-middle am-fr"><i class="am-icon iconfont" style="font-size:1.2rem;">&#xe601;</i> {$address['mobile']}</span></div>
		<div class="am-vertical-align" style="height: 2rem;line-height:1.3rem;">
			<div class="am-vertical-align-middle am-text-xs">{$address['province']} {$address['city']} {$address['district']} {$address['address']}</div>
		</div>
		</div>		
		</div>
		
			<div class="am-u-sm-12">
				<a href="{php echo $this->createMobileUrl('mydayu_yuyuepay', array('weid' => $weid, 'id' => $reid))}" class="am-badge am-badge-success am-radius am-text-sm am-fl">{$activity['mname']}</a>
				<a href="{php echo $this->createMobileUrl('address', array('from'=>'dayu_yuyuepay','pcate'=>$_GPC['pcate'],'returnurl' => $returnUrl))}" class="am-badge am-badge-success am-radius am-text-sm am-fr">管理联系方式</a>
			</div>
			{else}
			<div class="am-u-sm-12 am-text-right" style="margin-top:1rem;">
		<div class="am-u-sm-2" style="padding:0;">
			<img src="{if !empty($fans['tag']['avatar'])}{$fans['tag']['avatar']}{else}resource/images/noavatar_middle.gif{/if}" class="am-radius" alt="{$fans['nickname']}" width="100%"/>
		</div>		
				<a href="{php echo $this->createMobileUrl('address',array('from'=>'dayu_yuyuepay','returnurl'=> $returnUrl))}" class="am-badge am-text-default am-badge-success am-radius">添加联系方式</a>
			</div>
			{/if}
	</div>
	{else}
	<div class="am-form-group">				
				<label class="am-u-sm-3">姓名:</label>
				<div class="am-u-sm-9">
			<input type="text" class="am-form-field" name="member" id="member" value="{$profile['realname']}" placeholder="请输入您的姓名" required>
		</div>
	</div>
	<div class="am-form-group">
				<label class="am-u-sm-3">手机:</label>
				<div class="am-u-sm-9">
			<input type="number" class="am-form-field" name="mobile" id="mobile" value="{$profile['mobile']}" placeholder="请输入手机号码" required>
		</div>
	</div>
	{if $setting['smsid']!=0}
	<div class="am-form-group">
		<input type="hidden" id="htel">
		<input type="hidden" id="hsms">
				<label class="am-u-sm-3">验证码<span>*</span></label>
				<div class="am-u-sm-9 am-input-group">
			<input type="number" class="am-form-field" id="sms" name="sms" type="tel" placeholder="请输入验证码" required>
			<span class="am-input-group-btn">
			<input type="button" id="sendsms" class="am-btn am-btn-primary" value="获取">
			</span>
		</div>
	</div>
	{/if}
	{/if}
	{if $activity['endtime'] < TIMESTAMP}
	<div class="am-form-group" style="margin:1rem 0 1rem;">
		<div class="am-u-sm-12">
			<input type="submit" class="am-btn am-btn-warning am-btn-lg am-btn-block" value="预约活动已结束" name="submit" disabled>
		</div>
	</div>
	{else}
	<div class="am-form-group">
		<label class="am-u-sm-3">{$activity['xmname']}</label>
		<div class="am-u-sm-9">
				{if $sid}
			<input type="hidden" class="am-form-field xiangmu" name="xmid" id="xmid" value="{$sid}" required readonly><span class="am-form-field">{$xiangmu['title']}<a href="{php echo $this->createMobileUrl('list');}" class="am-fr am-link-muted am-text-sm">重选</a></span>
				{else}
				<select name="xmid" id="xmid" onchange="fetchgetjs(this)" required>
					<option value="">请选择{$activity['xmname']}</option>
					{loop $xms $xm}
					<option value="{$xm['id']}" label="{$xm['title']}" {if $sid==$xm['id']}selected="selected"{/if}>{$xm['title']}</option>
					{/loop}
				</select>
				{/if}
		</div>
	</div>
		{if !empty($activity['is_num'])}
<style>
div.p_num {padding:0;margin:0;}
div.p_num input{text-align:center;}
</style>
	<div class="am-form-group" id="nums">
		<label class="am-u-sm-3">{$activity['numname']}</label>
		<div class="am-u-sm-9">
		<ol id="rmb" style="display:none">0</ol>
			<div class="am-input-group am-input-group-secondary p_num">
			<span class="sy_minus am-input-group-label" id="sy_minus_gid1">-</span>
			<input type="text" name="num" class="am-form-field" id="sy_num_gid1" value="1" placeholder="请输入数量" min="1" onkeypress="return event.keyCode>=48&&event.keyCode<=57" onpaste="return !clipboardData.getData('text').match(/\D/)" ondragenter="return false" readonly required>
			<span class="sy_plus am-input-group-label" id="sy_plus_gid1">+</span>
			</div>
        <div style="display:none">：0元</div>
		</div>
	</div>
		{/if}
	<div class="am-form-group">
				<label class="am-u-sm-3">支付方式</label>	
				<div class="am-u-sm-9 checkbox">
				<ul class="am-thumbnails">
					<li><label class="am-radio-inline"><input type="radio" name="paytype" value="1" data-am-ucheck checked> 在线支付</label></li>
					{if $activity['pay'] == 1}
					<li><label class="am-radio-inline"><input type="radio" name="paytype" value="9" data-am-ucheck> 线下付款</label></li>
					{/if}
				</ul>
				</div>
	</div>
	<div class="am-form-group">
				<label class="am-u-sm-3">{$activity['yuyuename']}</label>	
				<div class="am-u-sm-9 am-form-icon"><a href="javascript:history.go(-1)">
				<i class="am-icon iconfont">&#xe622;</i>
				<input name="restime" class="am-form-field" type="hidden" id="restime" data-prompt-position="bottomLeft" readonly value="{$srvtime}" required>
				<span class="am-form-field">{$srvtime}</span></a>
		</div>
	</div>
				{loop $ds $fields}
	<div class="am-form-group">
				
				{if $fields['type'] == 'text'}
		<label class="am-u-sm-3">{$fields['title']}</label>	
		<div class="am-u-sm-9">
			<input type="text" class="am-form-field" name="field_{$fields['refid']}_{$fields['bind']}" value="{$fields['default']}" placeholder="请输入{$fields['title']}" {if $fields['essential']}required{/if}>
		</div>
				{/if}
						{if $fields['type'] == 'email'}
		<label class="am-u-sm-3">{$fields['title']}</label>	
		<div class="am-u-sm-9 iconfont">&#xe61b;</i>
			<input type="text" class="am-form-field" name="field_{$fields['refid']}_{$fields['bind']}" value="{$fields['default']}" placeholder="请输入{$fields['title']}" {if $fields['essential']}required{/if}>
		</div>
						{/if}
				{if $fields['type'] == 'number'}
		<label class="am-u-sm-3">{$fields['title']}</label>	
		<div class="am-u-sm-9">
			<input type="number" class="am-form-field" name="field_{$fields['refid']}_{$fields['bind']}" value="{$fields['default']}" placeholder="请输入{$fields['title']}" {if $fields['essential']}required{/if}>
		</div>
				{/if}
						{if $fields['type'] == 'textarea'}
		<div class="am-u-sm-12">
			<textarea name="field_{$fields['refid']}_{$fields['bind']}" rows="3" placeholder="请填写{$fields['title']}" {if $fields['essential']}required{/if}>{$fields['default']}</textarea>
		</div>
						{/if}
				
						{if $fields['type'] == 'radio'}
				<label class="am-u-sm-3">{$fields['title']}</label>	
				<div class="am-u-sm-9 checkbox">
				<ul class="am-thumbnails">
					{loop $fields['options'] $v}
					<li><label class="am-radio-inline"><input type="radio" name="field_{$fields['refid']}_{$fields['bind']}" value="{$v}" data-am-ucheck {if $v == $fields['default']}checked{/if}> {$v}</label></li>
					{/loop}
				</ul>
				</div>
						{/if}

						{if $fields['type'] == 'image'}
				<label class="am-u-sm-3">{$fields['title']}</label>	
				<div class="am-u-sm-9 am-form-file">
                    <input id="field_{$fields['refid']}" class="am-input-sm am-fr upload" type="file" name="field_{$fields['refid']}_{$fields['bind']}" accept="image/*" capture="camera" {if $fields['essential']}required{/if} />
                    <div class="am-text-center" style="height:10rem;overflow: hidden;margin-top:-2rem;" id="showfield_{$fields['refid']}"><span class="am-icon iconfont" style="font-size:8rem;">&#xe602;</span></div>
				</div>
			
    <script type="text/javascript">
    $(function(){
        $('#field_{$fields['refid']}').change(function(){
            var file = this.files[0]; //选择上传的文件
            var r = new FileReader();
            r.readAsDataURL(file); //Base64
            $(r).load(function(){
                $("#showfield_{$fields['refid']}").html();
                $('#showfield_{$fields['refid']}').html('<img class="am-radius" height="100%" src="'+ this.result +'" alt="" />');
            });
        });
    });
    </script>
						{/if}						
				
						{if $fields['type'] == 'checkbox'}
		<label class="am-u-sm-3">{$fields['title']}</label>
		<div class="am-u-sm-9">
				<ul class="am-thumbnails">
					{loop $fields['options'] $v}
					<li><label class="am-checkbox-inline"><input type="checkbox" name="field_{$fields['refid']}_{$fields['bind']}[]" value="{$v}" data-am-ucheck {if $v == $fields['default']}checked{/if}> {$v}</label></li>
					{/loop}
				</ul>
				</div>
						{/if}
						
						{if $fields['type'] == 'select'}
		<label class="am-u-sm-3">{$fields['title']}</label>
		<div class="am-u-sm-9">
			<select name="field_{$fields['refid']}_{$fields['bind']}" {if $fields['essential']}required{/if}>
				{loop $fields['options'] $v}
					<option value="{$v}" {if $v == $fields['default']} selected="selected"{/if}>{$v}</option>
				{/loop}
			</select>
		</div>
						{/if}
						
						
						{if $fields['type'] == 'calendar'}
		<div class="am-u-sm-12 am-form-icon">
				<i class="am-icon iconfont">&#xe621;</i>
				{if $fields['bind'] == 'birth'}
					<input type="text" name="field_{$fields['refid']}_{$fields['bind']}" class="am-form-field" value="{$profile['birthyear']}-{$profile['birthmonth']}-{$profile['birthday']}" data-am-datepicker="{theme: 'success'}" placeholder="请选择{$fields['title']}" data-am-datepicker readonly {if $fields['essential']}required{/if}/>
				{else}
					<input type="text" name="field_{$fields['refid']}_{$fields['bind']}" class="am-form-field" data-am-datepicker="{theme: 'success'}" placeholder="请选择{$fields['title']}" data-am-datepicker readonly {if $fields['essential']}required{/if}/>
				{/if}
				</div>
						{/if}

						{if $fields['type'] == 'range'}
		<div class="am-u-sm-12 am-form-icon">
				<i class="am-icon iconfont">&#xe60a;</i>
			<select name="field_{$fields['refid']}_{$fields['bind']}" class="am-form-field" {if $fields['essential']}required{/if}>
							<option value="0:00-1:00" >0:00-1:00</option>
							<option value="1:00-2:00">1:00-2:00</option>
							<option value="2:00-3:00">2:00-3:00</option>
							<option value="3:00-4:00">3:00-4:00</option>
							<option value="4:00-5:00">4:00-5:00</option>
							<option value="5:00-6:00">5:00-6:00</option>
							<option value="6:00-7:00">6:00-7:00</option>
							<option value="7:00-8:00">7:00-8:00</option>
							<option value="8:00-9:00">8:00-9:00</option>
							<option value="9:00-10:00">9:00-10:00</option>
							<option value="10:00-11:00">10:00-11:00</option>
							<option value="11:00-12:00">11:00-12:00</option>
							<option value="12:00-13:00">12:00-13:00</option>
							<option value="13:00-14:00">13:00-14:00</option>
							<option value="14:00-15:00">14:00-15:00</option>
							<option value="15:00-16:00">15:00-16:00</option>
							<option value="16:00-17:00">16:00-17:00</option>
							<option value="17:00-18:00">17:00-18:00</option>
							<option value="18:00-19:00">18:00-19:00</option>
							<option value="19:00-20:00">19:00-20:00</option>
							<option value="20:00-21:00">20:00-21:00</option>
							<option value="21:00-22:00">21:00-22:00</option>
							<option value="22:00-23:00">22:00-23:00</option>
							<option value="23:00-24:00">23:00-24:00</option>
			</select>
		</div>
						{/if}
						
						{if $fields['type'] == 'reside'}
		<script src="{TEMPLATE_PATH}js/amazeui.chosen.js" type="text/javascript" charset="utf-8"></script>
		<script src="{TEMPLATE_PATH}js/jquery.citiesChange.js"></script>
		<div class="am-u-sm-12">
				<div class="am-u-sm-6">
					<select name="reside[province]" id="province" {if $fields['essential']}required{/if}>
						<option>{$resideprovince}</option>
					</select>
				</div>
				
				<div class="am-u-sm-6">
					<select name="reside[city]" id="city" {if $fields['essential']}required{/if}>
						<option>{$residecity}</option>
					</select>
				</div>
		<script type="text/javascript">
			$(function() {
				$.initProv("#province", "#city");
			})
		</script>
				</div>
						{/if}
				
		{if !empty($fields['description'])}
		<div class="am-u-sm-12 description am-text-right am-link-muted" style="padding:0 1rem;color:#c9a68c">{php echo urldecode($fields['description']);}</div>
		{/if}
	</div>
				{/loop}
	<div class="am-form-group am-topbar-fixed-bottom" style="margin:0;padding:0;background-color:#fff;border-top: 1px solid #efeff4">
		<div class="am-u-sm-12" style="padding:0;">
		<div class="am-u-sm-7" style="padding:0;">
		{if $sid}
			<div name="jsids" id="jsids" class="am-text-warning am-text-sm" style="padding:0;height:4rem;line-height:5rem;text-indent:1rem;overflow:hidden;">单价：<span class="am-icon am-text-danger iconfont">&#xe61a; {$xiangmu['price']}</span></div>
		{elseif !empty($activity['is_num'])}
			<div name="jsids" id="jsids" class="am-text-warning am-text-sm" style="padding:0;height:4rem;line-height:5rem;text-indent:1rem;overflow:hidden;">请选择{$activity['xmname']}</div>
		{else}
			<div name="jsid" id="jsid" class="am-text-warning am-text-sm" style="padding:0;height:4rem;line-height:5rem;text-indent:1rem;overflow:hidden;">请选择{$activity['xmname']}</div>
		{/if}
		</div>
		<div class="am-u-sm-5" style="padding:0;">
			<input type="hidden" name="token" value="{$_W['token']}" />
			<input type="submit" class="am-btn am-btn-warning am-btn-lg am-btn-block" {if $setting['submitbg']}style="background-color:{$setting['submitbg']};"{/if} value="提 交" name="submit">
		</div>
		</div>
	</div>
	{/if}
	</form>
	
</div>
</div>
{if $setting['smsid']!=0}
<script type="text/javascript">
		var wait=60;  
		function time(o) {
			if (wait == 0) {
				o.removeAttribute("disabled");
				o.value="获取验证码";
				wait = 60;
			} else {
				o.setAttribute("disabled", true);
				o.value="重新发送(" + wait + ")";
				wait--;  
				setTimeout(function() {
					time(o)
				},
            1000)
			}
		}
	$("#sendsms").bind("click",function(){
		var checktel = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
			if($.trim($(':input[name="mobile"]').val())=='' || !checktel.test($.trim($('input[name="mobile"]').val()))){
				$('#mobile').attr("readonly",false);
				$.toast("请输入正确的手机号码", "cancel");
				return false;
			}else{
				$('#mobile').attr('readonly',true);
				var submitData = {};
				$.post("{php echo murl('entry', array('do' => 'SendSms', 'id' => $setting['smsid'], 'm' => 'dayu_sms'), true, true)}"+"&mobile="+$("#mobile").val(), submitData,function(data){
					if(data.message.state == 1) {
						$("#htel").val(data.message.mobile);
						$("#hsms").val(data.message.yzm);
						$.toast(data.message.msg, "success");
					}else{
						$.toast(data.message.msg, "cancel");
					}
				},"json");
				time(this);
			}
	});
	
	$('#form').submit(function(){
       var member = /^[\u4E00-\u9FA5]{1,6}$/;
			if($.trim($(':input[name="member"]').val())=='' || !member.test($.trim($('input[name="member"]').val()))){
				$.toast("请正确输入姓名", "cancel");
				return false;
			}
       var mobile = /^(((13[0-9]{1})|(14[7-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
			if($.trim($(':input[name="mobile"]').val())=='' || !mobile.test($.trim($('input[name="mobile"]').val()))){
				$.toast("请输入正确的手机号码", "cancel");
				return false;
			}
		var htel=$("#htel").val();
		var hsms=$("#hsms").val();
		var tel=$("#mobile").val();
		var sms=$("#sms").val();
		if(htel==tel){
			if(hsms==sms){
			}else{
				alert("请输入正确验证码", "cancel");
				return false;
			}
		}else{
			alert("请获取验证码", "cancel");
			return false;
		}
		return true;
	});
</script>
{/if}
	<script type="text/javascript">
	var xmid=$('#xmid').val();
		if(xmid!=0){
			$('#nums').css('display','block');
		}else{
			$('#nums').css('display','none');
		}
	$('#xmid').change(function(){
		var xmid=$(this).val();
		if(xmid!=0){
			$('#nums').css('display','block');
		}else{
			$('#nums').css('display','none');
		}
	});
	function fetchgetjs(obj) {
		if (!$(obj).val()) {
			return false;
		}

		$.getJSON('{php echo $this->createMobileUrl('getprice')}', {'xmid' : $(obj).val()}, function(s){
			if (s.message.status == 0) {
				alert(s.message.price, '', 'error');
				return;
			}
			$('#rmb').empty();
			$('#jsids').empty();
			$('#jsid').empty();
			if (s.message.price) {
				for (i in s.message.price) {
					$('#rmb').append(s.message.price[i].price);
//					$('#jsids').append('单价：'+s.message.price[i].price+'元');
					$('#jsids').append('单价：<span class="am-icon am-text-danger iconfont">&#xe61a; '+s.message.price[i].price+'</span>');
					$('#jsid').append('合计：<span class="am-icon am-text-danger iconfont">&#xe61a; '+s.message.price[i].price+'</span>');
				}
			} 
		});
	}
    </script>
{php $footer_off = 1;}
{template 'footers'}