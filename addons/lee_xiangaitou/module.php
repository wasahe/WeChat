<?php
//decode by QQ:270656184 http://www.yunlu99.com/
defined('IN_IA')or exit('Access Denied');class Lee_xiangaitouModule extends WeModule {public function fieldsFormDisplay($rid =0){global $_W;if (!empty($rid)){$reply =pdo_fetch("SELECT * FROM".tablename('lee_xiangaitou')."WHERE rid = :rid",array(":rid" => $rid));$reply['starttime'] =date("Y-m-d  H:i", $reply['starttime']);$reply['endtime'] =date("Y-m-d  H:i", $reply['endtime']);}load()->func('tpl');include $this->template('form');}public function fieldsFormValidate($rid =0){global $_GPC, $_W;$p0=$_GPC['prize_p_0'];$p1=$_GPC['prize_p_1'];$p2=$_GPC['prize_p_2'];$p3=$_GPC['prize_p_3'];$p4=$_GPC['prize_p_4'];$p5=$_GPC['prize_p_5'];$p_total=$p0+$p1+$p2+$p3+$p4+$p5;if($p_total!=100){return '请检您设置的奖品概率总和是否为100';}return '';}public function fieldsFormSubmit($rid){global $_GPC, $_W;$uniacid =$_W['uniacid'];$xgtid =$_GPC['xgtid'];$data =array('rid' => $rid, 'uniacid' => $uniacid, 'title' => $_GPC['title'], 'starttime' => strtotime($_GPC['starttime']), 'endtime' => strtotime($_GPC['endtime']), 'rule' => htmlspecialchars_decode($_GPC['rule']), 'follow_url' => $_GPC['follow_url'], 'copyright' => $_GPC['copyright'], 'day_play_count' => $_GPC['day_play_count'], 'award_count'=>$_GPC['award_count'], 'prize_name_0' => $_GPC['prize_name_0'], 'prize_p_0' => $_GPC['prize_p_0'], 'prize_level_1' => $_GPC['prize_level_1'], 'prize_name_1' => $_GPC['prize_name_1'], 'prize_p_1' => $_GPC['prize_p_1'], 'prize_num_1' => $_GPC['prize_num_1'], 'prize_level_2' => $_GPC['prize_level_2'], 'prize_name_2' => $_GPC['prize_name_2'], 'prize_p_2' => $_GPC['prize_p_2'], 'prize_num_2' => $_GPC['prize_num_2'], 'prize_level_3' => $_GPC['prize_level_3'], 'prize_name_3' => $_GPC['prize_name_3'], 'prize_p_3' => $_GPC['prize_p_3'], 'prize_num_3' => $_GPC['prize_num_3'], 'prize_level_4' => $_GPC['prize_level_4'], 'prize_name_4' => $_GPC['prize_name_4'], 'prize_p_4' => $_GPC['prize_p_4'], 'prize_num_4' => $_GPC['prize_num_4'], 'prize_level_5' => $_GPC['prize_level_5'], 'prize_name_5' => $_GPC['prize_name_5'], 'prize_p_5' => $_GPC['prize_p_5'], 'prize_num_5' => $_GPC['prize_num_5'], 'new_title' => $_GPC['new_title'], 'new_pic' => $_GPC['new_pic'], 'new_content' => $_GPC['new_content'], 'share_title' => $_GPC['share_title'], 'share_icon' => $_GPC['share_icon'], 'share_content' => $_GPC['share_content'], 'createtime' => TIMESTAMP );if (empty($xgtid)){pdo_insert('lee_xiangaitou',$data);}else {pdo_update('lee_xiangaitou', $data, array('id'=>$xgtid));}return true;}public function ruleDeleted($rid){$xgt =pdo_fetch("SELECT * FROM".tablename('lee_xiangaitou')."WHERE rid = :rid",array(":rid" => $rid));pdo_delete('lee_xiangaitou', array('id' => $xgt['id']));}public function settingsDisplay($settings){global $_GPC, $_W;if (checksubmit()){$cfg =array('appid' => $_GPC['appid'], 'secret'=>$_GPC['secret'] );if ($this->saveSettings($cfg)){message('保存成功', 'refresh');}}include $this->template('setting');}}