{template 'header'}
{template 'header-common'}
<link type="text/css" rel="stylesheet" href="{$_W['siteroot']}addons/superman_house/template/mobile/css/home.css">
<link type="text/css" rel="stylesheet" href="{$_W['siteroot']}addons/superman_house/template/mobile/css/house-list.css">
<div class="margin">
	<div class="row">
		<div class="col-xs-12 home_slide">
			{template 'common/slide'}
		</div>
	</div>
	<div class="card fourgrid border-1px">
		<div class="row">
			<div class="col-xs-3">
				<a href="{php echo $this->createMobileUrl('house', array('act' => 'list'))}" class="new_color">
					<img class="img-responsive" src="{$_W['siteroot']}addons/superman_house/template/mobile/images/ui1.png"/>
					<span class="text-center house_title">楼盘</span>
				</a>
			</div>
			{if $this->module['config']['looking']['switch']}
			<div class="col-xs-3">
				<a href="{php echo $this->createMobileUrl('looking', array('act' => 'list'))}" class="new_color">
					<img class="img-responsive" src="{$_W['siteroot']}addons/superman_house/template/mobile/images/ui2.png"/>
					<span class="text-center house_title">看房团</span>
				</a>
			</div>
			{/if}
			<div class="col-xs-3">
				<a href="{php echo $this->createMobileUrl('partner', array('act' => 'index'))}" class="new_color">
					<img class="img-responsive" src="{$_W['siteroot']}addons/superman_house/template/mobile/images/ui3.png"/>
					<span class="text-center house_title">经纪人</span>
				</a>
			</div>
			<div class="col-xs-3">
				<a href="{$calculator_url}" class="new_color">
					<img class="img-responsive" src="{$_W['siteroot']}addons/superman_house/template/mobile/images/ui4.png"/>
					<span class="text-center house_title">计算器</span>
				</a>
			</div>
		</div>
	</div>
	{if $this->module['config']['looking']['switch']}
	<div class="card home-housegroup border-1px">
		<div class="row">
			{if $this->module['config']['base']['notice_title']}
			<div class="col-xs-12">
				<a class="new_color home_house_notice text-overflow" href="{if !$this->module['config']['base']['notice_url']}#{else}{php echo $this->module['config']['base']['notice_url']}{/if}">
					<i class="fa fa-lightbulb-o fontcolor"></i> {php echo $this->module['config']['base']['notice_title']}
					{if $this->module['config']['base']['notice_url']}
					<i class="fa fa-angle-right"></i>
					{/if}
				</a>
			</div>
			{/if}
			<table class="table table-bordered">
				<tr>
					{if isset($look_list[0]) && !empty($look_list[0])}
					<td class="home-housegroup-row">
						<a href="{php echo $this->createMobileUrl('looking', array('act' => 'form','_id'=>$look_list[0][id]))}" class="new_color superman_house_block">
							<div class="row">
								<div class="col-xs-9 nopadding">
									<span class="superman_house_block house_title">{$look_list[0]['name']}</span>
									<span class="house_desc">已有<span class="highlight">{$look_list[0]['user_count']}</span>人报名</span>
								</div>
								<div class="col-xs-3 nopadding">
									<div class="looking_week pull-right">
										{$look_list[0]['week']}
									</div>
								</div>
							</div>
						</a>
					</td>
					{/if}
					{if isset($look_list[1]) && !empty($look_list[1])}
					<td class="home-housegroup-row">
						<a href="{php echo $this->createMobileUrl('looking', array('act' => 'form','_id'=>$look_list[1][id]))}" class="new_color superman_house_block">
							<div class="row">
								<div class="col-xs-9 nopadding">
									<span class="superman_house_block house_title">{$look_list[1]['name']}</span>
									<span class="house_desc">已有<span class="highlight">{$look_list[1]['user_count']}</span>人报名</span>
								</div>
								<div class="col-xs-3 nopadding">
									<div class="looking_week pull-right">
										{$look_list[1]['week']}
									</div>
								</div>
							</div>
						</a>
					</td>
					{/if}
				</tr>
				<tr>
					{if isset($look_list[2]) && !empty($look_list[2])}
					<td class="home-housegroup-row">
						<a href="{php echo $this->createMobileUrl('looking', array('act' => 'form','_id'=>$look_list[2][id]))}" class="new_color superman_house_block">
							<div class="row">
								<div class="col-xs-9 nopadding">
									<span class="superman_house_block house_title">{$look_list[2]['name']}</span>
									<span class="house_desc">已有<span class="highlight">{$look_list[2]['user_count']}</span>人报名</span>
								</div>
								<div class="col-xs-3 nopadding">
									<div class="looking_week pull-right">
										{$look_list[2]['week']}
									</div>
								</div>
							</div>
						</a>
					</td>
					{/if}
					{if isset($look_list[3]) && !empty($look_list[3])}
					<td class="home-housegroup-row">
						<a href="{php echo $this->createMobileUrl('looking', array('act' => 'form','_id'=>$look_list[3][id]))}" class="new_color superman_house_block">
							<div class="row">
								<div class="col-xs-9 nopadding">
									<span class="superman_house_block house_title">{$look_list[3]['name']}</span>
									<span class="house_desc">已有<span  class="highlight">{$look_list[3]['user_count']}</span>人报名</span>
								</div>
								<div class="col-xs-3 nopadding">
									<div class="looking_week pull-right">
										{$look_list[3]['week']}
									</div>
								</div>
							</div>
						</a>
					</td>
					{/if}
				</tr>
			</table>
		</div>
	</div>
	{/if}
	<div class="card house-list-content house_home_wrap">
		<hr />
		{loop $house_list $hlist}
		<div class="row house-list-project">
			<a href="{php echo $this->createMobileUrl('house', array('act' => 'detail', 'id' => $hlist['id']))}" class="new_color">
				<div class="col-xs-4 house-list-thumb">
					<img class="img-responsive" src="{$hlist['coverimg']}" onerror="this.src='{php echo superman_img_placeholder()}'"/>
					<span class="house-list-price">{$hlist['format_price']}元/㎡</span>
				</div>
				<div class="col-xs-8 house-list-txt clearfix">
					<span class="house-list-title text-overflow superman_house_block house_title">{$hlist['name']}</span>
					<span class="house-list-description house_desc">{$hlist['format_desc']}</span>
					{if $hlist['address']}
					<div>
						<span class="house_desc text-overflow superman_house_block">
							<span class="house-list-address glyphicon glyphicon-map-marker"></span>
							{$hlist['address']}
						</span>
					</div>
					{/if}
				</div>
			</a>
		</div>
		<hr class="nopadding_btm" />
		{/loop}
	</div>
	<div class="row home-more-btn">
		<div class="col-xs-12 text-center">
			<button type="button" class="btn btn-default btn-block house_more_limit" data-page="1">
				点击加载更多
			</button>
		</div>
	</div>
</div>
<script>
	require(['jquery', 'util'], function($, u){
		function addItems(data) {
			var html = '', item;
			var detail = "{php echo $this->createMobileUrl('house', array('act' => 'detail'))}";
			for (var i=0; i<data.length; i++) {
				item = data[i];
				var detail_url = detail+'&id='+item['id'];
				html += '<div class="row house-list-project">';
				html += '<a href="'+detail_url+'" class="new_color">';
				html += '<div class="col-xs-4 house-list-thumb">';
				html += '<img class="img-responsive" src="'+item['coverimg']+'" onerror="this.src=\'{php echo superman_img_placeholder()}\'"/>';
				html += '<span class="house-list-price">'+item['format_price']+'元/㎡</span>';
				html += '</div>';
				html += '<div class="col-xs-8 house-list-txt clearfix">';
				html += '<span class="house-list-title text-overflow superman_house_block house_title">'+item['name']+'</span>';
				html += '<span class="house-list-description house_desc">'+item['format_desc']+'</span>';
				if (item['address']) {
					html += '<div><span class="house_desc text-overflow superman_house_block"><span class="house-list-address glyphicon glyphicon-map-marker"></span>'+item['address']+'</span></div>';
				}
				html += '</div>';
				html += '</a>';
				html += '</div>';
				html += '<hr class="nopadding_btm" />';
			}
			$('.house_home_wrap').append(html);
		}
		$('.house_more_limit').click(function(){
			var t = this;
			$(t).attr('disabled', true).html('加载中...');
			var pageno = $(t).attr('data-page');
			pageno = parseInt(pageno) + 1;
			var url = '{php echo $this->createMobileUrl("home");}';
			url += '&page='+pageno;
			$.ajax({
				url: url,
				dataType: 'json',
				success:function(resp){
					$(t).removeAttr('disabled').html('点击加载更多');
					if (resp.length > 0) {
						addItems(resp);
						$(t).attr('data-page', pageno);
					} else {
						$(t).remove();
					}
				}
			});
		});
	});
</script>
{template 'footer-common'}
{template 'footer'}