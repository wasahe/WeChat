<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,user-scalable=no,maximum-scale=1,initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no">
    <title>{$reply['title']}</title>
    <link href="../addons/haoman_voice/images/base.css?v=2016071823541" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../addons/haoman_voice/images/jquery-2.1.4.min.js?v=2016071822351"></script>
    <link rel="stylesheet" href="../addons/haoman_voice/images/swiper.min.css">
    <script src="../addons/haoman_voice/images/swiper.min.js"></script>
    <script>
        if (location.href.indexOf('#') > 0) {
            location.href = location.href.substring(0, location.href.indexOf('#'));
        }
        window.yyhb = {
            hasPlay: false,
            again: (location.href.indexOf('again=true') > 0),
            hasChance: true,
            hasPrize: false,
        };
        window.currPlayer = {
            headimg: '{php echo tomedia($avatar)}',
            commandUrl: '',
            commandId: '',
            score: null,
            amount: null,
            type: null,
            surplusHbCount: null
        };
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: {if empty($reply['backcolor'])}#ca1946{else}{$reply['backcolor']}{/if};
        }
        .swiper-container {

            margin: 0 auto;
        }
        .swiper-slide {
            text-align: center;
            font-size: 18px;
            background: #fff;
            width: 33%;


        }
        #prizeshow p{margin: 0;padding: 0}
    </style>



</head>

<body>
<div id="load" style="width: 100%;height: 100%;background: rgba(0,0,0,0.9);z-index: 999999;position: fixed;top: 0px;bottom:
0px;">
    <div id="circle"></div><div id="circle1"></div>
</div>

{if $reply['isallowip']!=1&&$reply['isappkey']!=1}
<script>
    jQuery(window).load(function() {
        $("#load").fadeOut(10);
        $("#circle").fadeOut(10);
        $("#circle1").fadeOut(10);
    });
</script>
{/if}
    <!--首页container -->
    <div class="container_index">
        <img class="bg imgs" src="{if empty($reply['backpicurl'])}../addons/haoman_voice/images/index_bg2.jpg{else}{php echo tomedia($reply['backpicurl'])}{/if}" style="margin-bottom: -1.2%;">
        <!-- <img class="btn imgs" style="top: 68%;left: 32%;width: 36%;" src="../addons/haoman_voice/images/index_get_hb.png"> -->
        <div class="introduce_mask"></div>
        <div class="introduce">
            <div style="height: 63%;word-wrap:break-word;word-break:break-all;" class="p">
                <span style='font-size: 1rem;color: #883100;display: inline-block;margin-bottom: 0.3rem;'>活动时间：{php echo date('m-d H:i:s',$reply['starttime'])}~{php echo date('m-d H:i:s',$reply['endtime'])}</span>
                <div style="color: #883100;font-size: 1.4rem;">
                    {$reply['rules']}
                </div>
            </div>
        </div>
        <div class="introduce_confirm" style="top: 90.5%;"></div>
    </div>



    <!--录音container -->
    <div class="container" >

        <img class="bg" src="{if empty($reply['qjbpic'])}../addons/haoman_voice/images/game_bg2.jpg{else}{php echo tomedia($reply['qjbpic'])}{/if}">
        <div class="transparentMask" style="top: 0;left: 0;width: 100%;"></div>
        <img class="top" style="top: 18%;" src="../addons/haoman_voice/images/game_top.png">
        <img class="top_left" style="top: 7.5%;" src="../addons/haoman_voice/images/game_top_left.png">
        <img class="top_right" style="top: 12.5%;" src="../addons/haoman_voice/images/game_top_right.png">
        <div class="wxname" style="top: 11%;height: 6.2%;">请大声喊出下面的</div>
        <div class="say_text" style="top: 25%;">{$data_keys}</div>



        <div class="chat_wrap" style="top: 59%;left: 19%;width: 62%;height: 23%;">
       <p style="margin-top: -11%;">
     
              {if $Lcount ==99999}
        <div class="number">您很幸运，本次抽奖不限次数</div>
        {else}
        <div class="number">还有{$Lcount}次尝试机会</div>
        {/if}
        </p>
            <p>
                <span style="color:#6990D6;font-weight:bolder;">领取秘籍：</span>长按按钮，用普通话读出口令，匹配度达<span class="Bold">{$reply['match']}%</span>就有机会拆红包，你只有<span class="Bold">15秒</span>的时间哦！
            </p>
        </div>


        <div class="record" style="overflow:hidden;">
            <div class="time_less">
                倒计时：<span>15</span>''
            </div>
            <img class="r1 visible" src="../addons/haoman_voice/images/rn5.png">
            <img class="r2" src="../addons/haoman_voice/images/rn4.png">
            <img class="r3" src="../addons/haoman_voice/images/rn3.png">
            <img class="r4" src="../addons/haoman_voice/images/rn2.png">
            <img class="r5" src="../addons/haoman_voice/images/rn1.png">
            <br>
            <span style="color: #8A0017;width: 100%;display: inline-block;margin-left: -3.5%;">松开结束</span>
        </div>

        <div class="start" style="background-image:url(../addons/haoman_voice/images/game_init.png);background-size: 90%;height: 13.5%;background-repeat: no-repeat;top: 78%;left: 33.6%;"></div>
        <img class="say" style="top: 93%;left: 30%" src="../addons/haoman_voice/images/act_say.png">
        <img class="gift" style="top: 93%;width: 15%;left: 55%" src="../addons/haoman_voice/images/act_gift.png">


        <!--活动说明-->
        <div class="active_say" style="display: none;position: fixed;top:0px;left: 0px;right: 0px;bottom: 0px;height: 100%;width: 100%;z-index: 999;background: rgba(0,0,0,0.7)">
            <div class="introduce_mask" style="display: none"></div>
            <div class="introduce" style="height: 113%;display: block;background: url('../addons/haoman_voice/images/act_introduce.png');width: 90%;height: 100%;background-size: 100%;background-repeat: no-repeat;">
                <div style="height: 50%;word-wrap:break-word;word-break:break-all;" class="p">
                    <span style='font-size: 1rem;color: #883100;display: inline-block;margin-bottom: 0.3rem;'>活动时间：{php echo date('m-d H:i:s',$reply['starttime'])}~{php echo date('m-d H:i:s',$reply['endtime'])}</span>
                    <div style="color: #883100;">
                        {$reply['rules']}
                    </div>
                </div>
            </div>
            <div class="introduce_confirm" style="top:75%;display: block"></div>
        </div>

        <!--我的奖品-->
        <div class="my_gift" style="display: none;position: fixed;top:0px;left: 0px;right: 0px;bottom: 0px;height: 100%;width: 100%;z-index: 999;background: rgba(0,0,0,0.7)">
            <div class="introduce_mask" style="display: none"></div>
            <div class="introduce" style="display: block;background: url('../addons/haoman_voice/images/my_gift.png'); width: 90%;height: 100%;background-size: 100%;background-repeat: no-repeat;">
                <div class="p" style="height: 50%;">
                        <ul style="display: inline-block;width: 100%;list-style: none;height: 45px;margin: 0px;padding: 0px;border-bottom: 1px solid #999;position: relative;top: 0px;">
                            <li style="float: left;width: 33.333%;height: 45px;line-height: 45px;text-align: center">账户余额：</li>
                            <li style="float: left;width: 33.333%;height: 45px;line-height: 45px;color: red;" ><span id="money">{php echo $fans['totalnum']/100}</span>元</li>
                            <li style="float: left;width: 33.333%;height: 45px;line-height: 45px;">{if $fans['totalnum']>=$num}<button class="btn btn-success" id="butt" style="background: green;color: #fff;">提现</button>{/if}</li>
                        </ul>
                    {if $numx!=0}
                    <div style="width: 100%;"><label style="width: 33.33%;display: inline-block;text-align: center">提现中金额：</label><span style="color: #fff;">{php echo $numx/100}元</span></div>
                    {/if}
                    <div style="color:#444;padding:0px 0px 10px 0px;line-height:1.7;font-size:15px">
                        <div class="fans-list" style="padding-top: 0px;">
                            <table class="table">
                                <tbody>
                                {loop $award $row}
                                <tr>
                                    <td width="78">
                                        <div class="pic" style="background: none;"><img src="{if empty($row['awardsimg'])}../addons/haoman_voice/images/sharemoney.png{else}{php echo tomedia($row['awardsimg'])}{/if}"></div>
                                    </td>
                                    <td class="msg">
                                        <p style="font-size: 16px;">{$row['awardname']}</p>
                                        <div>{if $row['status']==2}已领取{else}未领取{/if}&nbsp;&nbsp;<small>{php echo date("m-d H:i", $row['createtime'])}</small></div>
                                    </td>
                                    <td width="60"><strong>{if $row['prizetype']==2&&$row['status']!=2}<button class="btn btn-success duijiang" data-id="{$row['id']}" style="background: #d9534f;color: #fff;">兑奖</button>{else}{if !empty($row['credit'])}¥{php echo $row['credit']/100}{/if}{/if}</strong></td>
                                </tr>
                                {/loop}
                                </tbody>
                            </table>
                            {if empty($award)}<div class="no-data">暂无中奖记录...</div>{/if}
                        </div>
                    </div>
                </div>
            </div>
            <div class="introduce_confirm" style="top: 75%;display: block"></div>
        </div>

    </div>

    <!--结果container -->
    <div class="container_res">
        <img class="bg" src="{if empty($reply['adpic'])}../addons/haoman_voice/images/game_res_bg.png{else}{php echo tomedia($reply['adpic'])}{/if}">
        <div class="curr_voice">
            <span class="header_wrap"><img class="headerimg"></span>
            <img class="voice" src="../addons/haoman_voice/images/top_chat_wrap.png">
            <span class="voice_play_wrap"><span class="voice_play" audio-url=""></span></span>
            <span class="second"></span>
        </div>
        <div class="voice_text">
            语音识别：<span style="color: inherit;">-</span>
        </div>
        <div class="voice_match">
            匹配度：<span style="color: inherit;">100%</span>
        </div>
        <div class="voice_match_succ">
            <p class="l1">获得<span onclick="location.href='#'" style="text-decoration:underline;color: #333;">{if empty($reply['copyright'])} &copy;{$_W['account']['name']}{else}&copy;{$reply['copyright']}{/if}</span>发的<span class="type">红包</span></p>
            <p class="l2">1.00元</p>
            <p class="l3">还有奖品喔，快邀好友一起拆</p>
        </div>
        <div class="voice_match_notry">
            <p class="l1">你的机会已经用完</p>
            <p class="l3">还有3个红包喔，快邀好友帮你拆</p>
        </div>
        <div class="voice_match_sorry">
            红包正在赶来的路上
            <br>再喊它一次
            <!--手慢了<br>红包已经发完了-->
        </div>

        <div class="want_retry_wrap">
            <img class="retry" src="../addons/haoman_voice/images/retry.png">
            <img class="want_help" src="../addons/haoman_voice/images/want_help.png">
            {if $Lcount ==99999}
            <div class="retry_tip">您很幸运，本次抽奖不限次数</div>
            {else}
            <div class="retry_tip">还有3次尝试机会</div>
            {/if}

        </div>

        <!--分享-->
        <div class="share_mask" style="background: rgba(0,0,0,0.9)"></div>
        <div class="share_content" style="z-index: 100000">

            <img class="retry" src="../addons/haoman_voice/images/share_text.png">
            <img class="retry qrcode" style="padding-top: 5%;margin-left: 1%;">
        </div>
    </div>



<!--抽奖记录-->
    <div class="container_list has_prize" style="display: none">


        <!--奖品展示区域-->
        {if $reply['is_show_prize']==0}
        <div id="prizeshow" style="margin-top: -10px;margin-bottom: 15px">
            <img src="../addons/haoman_voice/images/prize.png" style="position: relative;top: 20px;left:20px;width:25%;z-index:2">
            <!-- Swiper -->
            <div class="swiper-container" style="margin-left: 10px;margin-bottom: 5px;">
                <div class="swiper-wrapper">

                    {loop $prize $rows}
                    <div class="swiper-slide" style="padding: 10px;height: 165px;border-radius: 3px;">
                        <img src="{php echo tomedia($rows['awardsimg'])}" style="width:100%;height: 100px;margin-top: 15px;">
                        {if $reply['is_show_prize_num']==0}
                        <p style="font-size:0.8rem;color: #666;margin-top: 5px;">剩余({php echo $rows['awardstotal'] - $rows['prizedraw']})份</p>
                        {/if}
                        <p style="font-size:0.8rem;color: #666;margin-top: 5px;">{$rows['prizename']}</p>
                    </div>
                    {/loop}


                </div>
            </div>
        </div>
        {/if}


        <div class="header" style="font-size:1.1rem;">已抽中奖品{$num01}个(只显示最近{$reply['rec_show']}名玩家)</div>
        <div class="list">

            {loop $awardlist $row}
            <div class="item">
                <img class="headerimg" src="{if empty($row['avatar'])}../addons/haoman_voice/images/item2.jpg{else}{php echo tomedia($row['avatar'])}{/if}">
                <img class="voice" src="../addons/haoman_voice/images/game_voice.png">
                <span class="voice_play_wrap"><span class="voice_play" audio-url="" commandId="{$row['localId']}"></span></span>
                <span class="second"></span>
                <span class="info">
			匹配度：{$row['match']}%<br>
                    {if $row['prizetype'] ==0}
                    获得 {php echo $row['credit']/100}元
                    {else}
                    获得 {$row['awardname']}
                    {/if}

			</span>
            </div>
            {/loop}
        </div>
        <div class="list" {if $style == 1}style = "display: block;"{else}style = "display: none;"{/if}>
            <p style="text-align: center;padding-top: 0.9rem;margin-top: 1rem;padding-bottom: 1rem;font-size: 1rem;color: #F2CC00;">暂无数据</p>
        </div>

        <div style="width:100%;text-align: center;padding: 15px;">
            {if empty($reply['copyright'])} &copy;{$_W['account']['name']}{else}&copy;{$reply['copyright']}{/if}
        </div>
    </div>




     <div class="ing_mask">
         <!--<div class="seconed" ><span style="color: #F8AB47;" id="Count">{if $reply['count_time']==0}8{else}{$reply['count_time']}{/if}</span>''</div>-->
         <input type="hidden" value="10" id="seconds">
         <div class="ing_mask_loading">
            智能识别中...
            <img src="../addons/haoman_voice/images/ing.png">
        </div>

    </div>

    <div class="valid_code_mask">
        <div class="valid_code_mask_loading">
            <img class="valid_text" src="../addons/haoman_voice/images/valid_text.png">
            <div class="valid_input" style="position: absolute;text-align: left;top: 28%;left: 6%;width: 90%;height: 18%;">
                <div class="one"><label>姓名</label><input class="valid_val realname" placeholder="请输入姓名" id="realname"></div>
                <div class="one"><label>电话</label><input class="valid_val mobile" placeholder="请输入手机号码" id="mobile"></div>
                {if $reply['credit1']==0}
                <div class="one"><label>地址</label><input class="valid_val address" placeholder="请输入地址" id="address"></div>
                {/if}
            </div>
            <img class="valid_btn" src="../addons/haoman_voice/images/valid_btn.png">
            <div class="valid_tip">
                请尽快输入，不能离开游戏，否则红包会消失哦!
            </div>
        </div>
    </div>


    <!--兑奖密码-->
    <div class="mask" style="z-index: 999998;position: fixed;top: 0px;left: 0px;right: 0px;bottom: 0px;background: rgba(0,0,0,0.8);display: none;width: 100%;height: 100%"></div>
    <div style="z-index: 999999;width:60% ;margin-left:-30%;position: absolute;top: 35%;left: 50%;text-align: center;height: 140px;background: rgba(255, 255, 255, 0.6);padding-top: 20px;display: none;border-radius: 3px;"class="point">
        <a class="cpgzclose close"></a>
        <input type="number" placeholder="确定兑换奖品" style="background: #fff;height: 30px;border: none;width: 80%;border-radius: 2px;margin-top: 30px;"  {if $reply['password']==0} disable {/if} class="numx">
        <br>
        <input type="button" id="btn0" value="确认兑奖" style="margin-top: 20px;height:30px;width: 80px;border: none;border-radius: 3px;margin-right: 10px;">
        <input type="button" id="btn1" value="取消兑奖" style="margin-top: 20px;height:30px;width: 80px;border: none;border-radius: 3px;">
    </div>
    <div class="defeat" style="width: 80%;height: 36px;background: rgba(0,0,0,0.6);border-radius: 18px;position: fixed;bottom: 20px;left:50%;margin-left:-40%;line-height:36px;z-index: 999999;text-align: center;display: none;color: #fff">提现失败，请联系管理员</div>
    <div class="succeed" style="width: 80%;height: 36px;background:rgba(0,0,0,0.6);border-radius: 18px;position: fixed;bottom: 20px;left:50%;margin-left:-40%;line-height:36px;z-index: 999999;text-align: center;display: none;color: #fff;">兑奖成功，谢谢参与</div>

    <!--强制分享-->
    <div class="act-rule-wrap" id="share" style="background: rgba(0,0,0,0.6);position: fixed;top: 0px;left: 0px;bottom: 0px;right: 0px;width: 100%;height: 100%;display: none;">
        <div class="modal-backdrop">
            <img src="../addons/haoman_voice/images/guide2.png" style="margin-top: 10%;width: 95%;text-align: center;height: auto;margin-left: 6%">
            <div class="title">您需要分享本活动页面到朋友圈后才能抽奖哦。</div>
        </div>
    </div>


    <!--分享朋友圈送红包-->
    <div style="width: 100%;height: 100%;position: fixed;top: 0px;left: 0px;right: 0px;bottom: 0px;background: rgba(0,0,0,0.8);z-index: 99999;display: none" class="sharebg">
        <div class="sharemoney">
            <!--<img src="../addons/haoman_voice/images/item2.jpg" style="display: block;position: absolute;top:3%;left: 50%;;margin-left:-25px;width: 50px;height: 50px;border-radius: 50%;">-->
            <img class="share_gold" src="../addons/haoman_voice/images/gold-y.png" style="display: block;position: absolute;top:19%;left: 50%;;margin-left:-40px;width:80px;height:80px;border-radius: 50%;">
            <img class="share_gold2" src="../addons/haoman_voice/images/gold-q2.gif" style="display: none;position: absolute;top:19%;left: 50%;;margin-left:-40px;width:80px;height:80px;border-radius: 50%;">
            <span style="color: #fff;font-size: 1em;position: absolute;top:45%;left: 50%;margin-left:-45%;width:90%;display: block;text-align: center;" class="ck">点击拆开</span>
            <span style="color: #fff;font-size: 1em;position: absolute;top: 50%;left: 50%;margin-left:-45%;width:90%;display: block;text-align: center;">恭喜获得红包一个，金额随机</span>
            <span style="color: #fff;font-size: 1.4em;position: absolute;top: 55%;left: 0px;display:block;left: 50%;margin-left:-45%;width:90%;display: block;text-align: center;">恭喜发财，大吉大利</span>
        </div>
    </div>

    <!--分享中奖结果弹窗-->
    <div class="act-rule-wraps" id="result" style="background: rgba(0,0,0,0.6);position: fixed;top: 0px;left: 0px;bottom: 0px;right: 0px;width: 100%;height: 100%;display: none;z-index: 999">
        <div class="modal-backdrop">
            <div class="wdeg" id="resbg" style="background: url('../addons/haoman_voice/images/win.png') no-repeat;background-size: 100% 100%;height: 70%;margin-top: 5%;text-align: center;"></div>
            <img id="resimg" src="../addons/haoman_voice/images/noumi.png">
            <div style="position: absolute;color: #fff;bottom: 30%;font-size: 18px;width: 100%;text-align: center;">
                <span id="restitle" style="color: #fff">恭喜您中了现金红包6元</span>
                <br />
                <span id="nothing"></span>
            </div>
            <a class="close_b">关闭</a>
        </div>
    </div>

     <!--<audio id="curr_audio" src=""></audio>-->

    <script type="text/javascript">
        function showValidCodeMask() {
            $('.valid_code_mask').show();
        }

        function hideValidCodeMask() {
            $('.valid_code_mask').hide();
        }

        function showIngMask() {
            $('.ing_mask').show();
            $('.ing_mask .ing_mask_loading img').addClass('rotate');

        }

        function hideIngMask() {
            $('.ing_mask').hide();
        }


        function Countdown(){

         //   var times = $("#seconed");

               timess = setInterval(function() {
                var contents = $("#seconds").val();
                   contents--;
                if (contents == 0) {
                    hideIngMask();
                    alert('识别失败，请重试！！')
                    if (location.href.indexOf('again=true') > 0) {
                        location.reload();
                    } else {
                        location.href = location.href + '&again=true';
                    }
                    return;
                }
                   $("#seconds").val(contents);
            },1000);
        }
    </script>



    <!-- 微信分享设置 -->
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript">

        wx.config({
            debug:false,
            appId: '{$package["appId"]}',
            timestamp: '{$package["timestamp"]}',
            nonceStr: '{$package["nonceStr"]}',
            signature: '{$package["signature"]}',
            jsApiList: [
                'checkJsApi',
                'onMenuShareAppMessage',
                'onMenuShareTimeline',
                'translateVoice',
                'startRecord',
                'stopRecord',
                'onRecordEnd',
                'playVoice',
                'pauseVoice',
                'stopVoice',
                'uploadVoice',
                'downloadVoice',
                'showMenuItems',
                'hideMenuItems',
                'showOptionMenu',
                'hideAllNonBaseMenuItem'
        ]
        });
        var sharedata = {
            "imgUrl" : "{$shareimg}",
            "link" : "{$sharelink}",
            "desc" : "{$sharedesc}",
            "title" : "{$sharetitle}"
        };

        wx.ready(function () {
            {if $reply['isallowip']==1||$reply['isappkey']==1}

            wx.getLocation({
                type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'


                success: function (res) {

                    var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                    var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                    var speed = res.speed; // 速度，以米/每秒计
                    var accuracy = res.accuracy; // 位置精度



                    var submitData = {
                        lat: latitude,
                        lon: longitude,
                        lbsip: "{$reply['allowip']}",
                        appkey: "{$reply['appkey']}"
                    };

                    {if $reply['isallowip']==1}

                    $.post('{php echo $this->createMobileUrl('getlbs',array('id' => $rid))}', submitData, function(idata) {

                        if (idata.success == 1) {
                            jQuery("#load").fadeOut(10);
                            jQuery("#circle").fadeOut(10);
                            jQuery("#circle1").fadeOut(10);
                        } else {
                            alert(idata.msg);
                            location.href = "{php echo $this->createMobileUrl('other', array('id' => $rid,'type'=>2))}";

                        }
                    },"json");

                    {/if}

                    {if $reply['isappkey']==1}

                    $.post('{php echo $this->createMobileUrl('appkey',array('id' => $rid))}', submitData, function(idata) {

                        if (idata.success == 1) {
                            //alert(idata.msg);
                            jQuery("#load").fadeOut(10);
                            jQuery("#circle").fadeOut(10);
                            jQuery("#circle1").fadeOut(10);
                        } else {
                            alert(idata.msg);
                            location.href = "{php echo $this->createMobileUrl('other', array('id' => $rid,'type'=>2))}";

                        }
                    },"json");
                    {/if}



                },
                fail: function () {
                    alert("获取位置失败,请打开GPS功能！");
                    location.href = "{php echo $this->createMobileUrl('index', array('id' => $rid))}";

                }
            });
            {/if}

            {if $reply['share_type'] == 2}
            wx.hideOptionMenu();
            {else if $reply['share_type'] == 1}
            wx.showOptionMenu();
            wx.onMenuShareAppMessage(sharedata);
            wx.onMenuShareTimeline({
                title: '{$sharetitle}', // 分享标题
                link: '{$sharelink}', // 分享链接
                imgUrl: '{$shareimg}', // 分享图标
                success: function () {
                    var submitData = {
                        isshare: 1,
                    };
                    $.post('{php echo $this->createMobileUrl('setshare', array('rid' => $rid))}', submitData, function(data) {
                        if (data.success == 1) {
                            {if $reply['turntable'] == 9&&$fans['isshare']!=1}
                            $(".sharebg").show();
                            {else}
                            location.href="{php echo $this->createMobileUrl('index', array('rid' => $rid))}";
                            {/if}

                        } else {
                            alert(data.msg);
                            return
                        }
                    },"json")
                },
                cancel: function () {
                    alert("您没有成功分享到朋友圈！");
                }
            });
            wx.onMenuShareQQ(sharedata);
            wx.onMenuShareWeibo(sharedata);
            {else}
            wx.showOptionMenu();
            wx.onMenuShareAppMessage(sharedata);
            wx.onMenuShareTimeline({
                title: '{$sharetitle}', // 分享标题
                link: '{$sharelink}', // 分享链接
                imgUrl: '{$shareimg}', // 分享图标
                success: function () {
                    var submitData = {
                        isshare: 1,
                    };
                    $.post('{php echo $this->createMobileUrl('setshare', array('rid' => $rid))}', submitData, function(data) {
                        if (data.success == 1) {
                            {if $reply['turntable'] == 9&&$fans['isshare']!=1}
                            $(".sharebg").show();
                            {else}
                            location.href="{php echo $this->createMobileUrl('index', array('rid' => $rid))}";
                            {/if}

                        } else {
                            alert(data.msg);
                            return
                        }
                    },"json")
                },
                cancel: function () {
                    alert("您没有成功分享到朋友圈！");
                }
            });
            wx.onMenuShareQQ(sharedata);
            wx.onMenuShareWeibo(sharedata);
            {/if}

            $(function() {


                var initItv_stop = null;

                function selectView() {
                  //  $('html,body').css('backgroundColor', '#F55E1F');
                    $('.container_index').hide();
                    if (window.yyhb.hasPrize) {
                        //如果已经中奖了
                        $('.container_res').show();
                        if ($('.container_list.my p').length > 0 && $('.container_list.has_prize p').length == 0) {
                            $('.container_list.has_prize').show();
                        } else {
                            $('.container_list.my').show();
                        }
                        setResView();
                        $('.container_res .voice_match_succ').show();
                        $('.container_res .want_help_wrap').show();
                        var iCount = 0;
                        var initItv = setInterval(function() {
                            if (newVersionInitFinish) {
                                translateVoice('null', function(res) {
                                    middleText(res);
                                });
                                clearInterval(initItv);
                            }
                            iCount++;
                            if (iCount >= 500) {
                                clearInterval(initItv);
                            }
                        }, 10);
                    } else {
                        if (window.yyhb.hasChance) {
                            //如果还有机会，正常玩
                         //   $('html,body').css('backgroundColor', 'rgb(244, 106, 34)');
                            $('.container').show();
                            $('.container_list.has_prize').show();

                                var swiper = new Swiper('.swiper-container', {
                                pagination: '.swiper-pagination',
                                slidesPerView: 3,
                                paginationClickable: true,
                                spaceBetween: 10,
                                freeMode: true
                                 });

                            var iCount = 0;
                            var initItv = setInterval(function() {
                                if (newVersionInitFinish) {
                                    wx.startRecord();
                                    initItv_stop = setInterval(function() {
                                        try {
                                            wx.stopRecord({
                                                success: function(res) {
                                                    clearInterval(initItv_stop);
                                                }
                                            });
                                        } catch (e) {}
                                    }, 100);
                                    clearInterval(initItv);
                                }
                                iCount++;
                                if (iCount >= 500) {
                                    clearInterval(initItv);
                                }
                            }, 10);
                        } else {
                            //如果没机会了
                            $('.container_res').show();
                            if ($('.container_list.my p').length > 0 && $('.container_list.has_prize p').length == 0) {
                                $('.container_list.has_prize').show();
                            } else {
                                $('.container_list.my').show();
                            }
                            setResView();
                            $('.container_res .voice_match_notry').show();
                            $('.container_res .want_help_wrap').show();
                            var iCount = 0;
                            var initItv = setInterval(function() {
                                if (newVersionInitFinish) {
                                    translateVoice('null', function(res) {
                                        middleText(res);
                                    });
                                    clearInterval(initItv);
                                }
                                iCount++;
                                if (iCount >= 500) {
                                    clearInterval(initItv);
                                }
                            }, 10);
                        }
                    }
                }

                function setResView() {
                    $('.container_res .curr_voice .header_wrap .headerimg').attr('src', window.currPlayer.headimg);
                    $('.container_res .curr_voice .voice_play').attr('audio-url', window.currPlayer.commandUrl);
                    if (window.currPlayer.commandId) {
                        $('.container_res .curr_voice .voice_play').attr('commandId', window.currPlayer.commandId);
                    }
                    $('.container_res .voice_match>span').html(window.currPlayer.score);
                    $('.container_res .voice_match_succ .l2').html(window.currPlayer.amount);
                    $('.container_res .voice_match_succ .type').html(window.currPlayer.type);
                    }

                function translateVoice(localId, callback) {
                    wx.translateVoice({
                        localId: localId, // 需要识别的音频的本地Id，由录音相关接口获得
                        isShowProgressTips: 0, // 默认为1，显示进度提示
                        success: function(res) {
                            if (callback && typeof callback == 'function') {
                                callback(res.translateResult);
                            }
                        }
                    });
                }

                function middleText(text) {
                    var $el = $('.container_res .voice_text');
                    $el.css('visibility', 'hidden');
                    $el.html('语音识别语音识别语音识别语音识别语音识别语音识别语音识别语音识别语音');
                    var maxH = $el.height();
                    setTimeout(function() {
                        $el.html('语音识别：<span style="color: inherit;">' + text + '</span>');
                        if ($el.height() < maxH) {
                            $el.css('top', '25.5%');
                        } else {
                            $el.css('top', '23.5%');
                        }
                        $el.css('visibility', 'visible');
                    }, 10);
                }

                //loadImg(imgArr,function(){

                setTimeout(function() {
                    if (window.yyhb.again) {
                        //再来一次
                        selectView();
                    } else {
                        //直接打开
                        $('.container_index').show();
                    }
                }, 100);
                //活动弹框
                $('.container_index .introduce_confirm').click(function() {
                    $('.container_index .introduce_confirm,.container_index .introduce,.container_index .introduce_mask').fadeOut(200);
                });
                $('.container_index .say').click(function() {
                    $('.container_index .introduce_confirm,.container_index .introduce,.container_index .introduce_mask').fadeIn(200);
                });
                $('.container .active_say .introduce_confirm').click(function() {
                    $('.container .active_say').fadeOut(200);
                });
                $('.container .my_gift .introduce_confirm').click(function() {
                    $('.container .my_gift').fadeOut(200);
                });
                $('.container .say').click(function() {
                    $('.container .active_say').fadeIn(200);
                });
                $('.container .gift').click(function() {
                    $('.container .my_gift').fadeIn(200);
                });
                $('.act-rule-wrap').click(function() {
                    $('.act-rule-wrap').fadeOut(200);
                });
                $('.close_b').click(function() {
                    location.href="{php echo $this->createMobileUrl('index', array('rid' => $rid))}";
                });
                $('.container_res .want_retry_wrap .want_help').click(function() {


                    $.post('{php echo $this->createMobileUrl('getShareImgUrl', array('rid' => $rid))}', function(data) {

                        var url = data.msg;

                        $('.container_res .share_content .qrcode').attr('src', url);
                    }, "json");
                    $('.container_res .share_mask,.container_res .share_content').fadeIn(200);

                });
                $('.container_res .share_mask').click(function() {
                    $('.container_res .share_mask,.container_res .share_content').fadeOut(200);
                });
                //按钮点击
                $('.container_index .bg').click(function() {
                 //   $('html,body').scrollTop(0).css('backgroundColor', '#F55E1F;');
                    $.ajax({
                        url: "{php echo $this->createMobileUrl('get_awardd', array('rid' => $rid))}",
                        dataType: "json",
                        data: {
                            t: Math.random()
                        },
                        beforeSend: function () {

                        },
                        success: function (data) {
                            var url = data.url;
                            if(data.status == 2){
                                alert(data.msg);
                                return false;
                            }
                            if(data.status == 6){
                                alert(data.msg);
                                $('.act-rule-wrap').fadeIn(200);
                                return false;
                            }
                            if(data.status ==4){
                                alert(data.msg);
                                location.href=url;
                                return false;
                            }
                             if(data.status ==5){
                                 showValidCodeMask();
                                 var ing = false;
                                 $('.valid_code_mask_loading>img.valid_btn').click(function() {
                                     if (ing) return;
                                     var realname = $("#realname").val();
                                     if (realname == '') {
                                         alert("请输入姓名");
                                         return
                                     }

                                     var mobile = $("#mobile").val();
                                     var bValidate = RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|17[0-9]|14[57])[0-9]{8}$/);
                                     if (mobile == '' || !bValidate.test(mobile)) {
                                         alert("手机号码不能为空或是格式错误！");
                                         $("#mobile").val('');
                                         $("#mobile").focus();
                                         return;
                                     }

                                     var address = $("#address").val();

                                     var submitData = {
                                         realname: realname,
                                         mobile: mobile,
                                         address: address,
                                     };
                                     ing = true;
                                     $.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
                                         if (data.success == 1) {
                                             location.href="{php echo $this->createMobileUrl('index', array('rid' => $rid))}";
                                             return
                                         } else {
                                             alert(data.msg);
                                             return
                                         }

                                         hideValidCodeMask();
                                     }, "json");
                                 });

                                 return false;
                             }
                            selectView();
                                //设置透明层
                                $('.container .transparentMask').height($('.container .bg').height());
                                top = $start.offset().top;
                                left = $start.offset().left;
                                width = $start.width();
                                height = $start.height();

                        },
                        error: function () {

                        },
                        timeout: 15000
                    })

                });
                $('.container .start').click(function(){
                    $('.container .chat_wrap,.container .mj').hide();
                    $('.container .record').show();
                    $(this).hide();
                    $('.container .stop').show();
                    recordVoice();
                });
                $('.container .stop').click(function(){
                    finishRecord();
                });
                $('.container_res .want_retry_wrap .retry').click(function() {
                    if (location.href.indexOf('again=true') > 0) {
                        location.reload();
                    } else {
                        location.href = location.href + '&again=true';
                    }
                });
                //长按录音
                var i1 = new Image();
                i1.src = '../addons/haoman_voice/images/game_init.png';
                var $start = $(".container .start");
                var top, left, width, height;
                var recordTimeout = null;
                var startRecord = false;
                var startReady = false;
                $start.on("touchstart", function(e) {
                 $.ajax({
                    url: "{php echo $this->createMobileUrl('get_awardd', array('rid' => $rid))}",
                            dataType: "json",
                            data: {
                        t: Math.random()
                    },
                    beforeSend: function () {

                    },
                    success: function (data) {
                        var url = data.url;
                        if(data.status == 2){
                            alert(data.msg);
                            return false;
                        }
                        if(data.status == 3){
                            alert(data.msg);
                            return false;
                        }
                        if(data.status ==4){
                            alert(data.msg);
                            location.href=url;
                            return false;
                        }
                        if(data.status == 5){
                            showValidCodeMask();
                            var ing = false;
                            $('.valid_code_mask_loading>img.valid_btn').click(function() {
                                if (ing) return;
                                var realname = $("#realname").val();
                                if (realname == '') {
                                    alert("请输入姓名");
                                    return
                                }

                                var mobile = $("#mobile").val();
                                var bValidate = RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|17[0-9]|14[57])[0-9]{8}$/);
                                if (mobile == '' || !bValidate.test(mobile)) {
                                    alert("手机号码不能为空或是格式错误！");
                                    $("#mobile").val('');
                                    $("#mobile").focus();
                                    return;
                                }

                                var address = $("#address").val();

                                var submitData = {
                                    realname: realname,
                                    mobile: mobile,
                                    address: address,
                                };
                                ing = true;
                                $.post('{php echo $this->createMobileUrl('settel', array('rid' => $rid))}', submitData, function(data) {
                                    if (data.success == 1) {
                                        location.href="{php echo $this->createMobileUrl('index', array('rid' => $rid))}";
                                        return
                                    } else {
                                        alert(data.msg);
                                        return
                                    }

                                    hideValidCodeMask();
                                }, "json");
                            });

                             return false
                        }
                        startRecord = true;
                    },
                    error: function () {

                    },
                    timeout: 15000
                })


                    recordTimeout = setTimeout(function() {
                        if (startRecord) {
                            startReady = true;
                            $('.container .chat_wrap,.container .mj').hide();
                            $('.container .record').show();
                            recordVoice();
                        }
                    }, 500);
                    e.preventDefault();
                }).on("touchmove", function(e) {
                    var touch = e.originalEvent.touches[0];
                    var pageX = touch.pageX;
                    var pageY = touch.pageY;
                    if (pageX < left || pageX > (left + width) || pageY < top || pageY > (top + height)) {
                        if (startReady) {
                            finishRecord();
                        }
                        startReady = startRecord = false;
                    }
                    e.preventDefault();
                }).on("touchend", function(e) {
                    if (startReady) {
                        finishRecord();
                    }
                    startReady = startRecord = false;
                    e.preventDefault();
                });

                //语音录制
                var recordVoiceItv = null;
                var recordVoiceSecondItv = null;
                var finishing = false;

                function finishRecord() {
                 //   $('body').css('backgroundColor', '#F55E1F');
                    showIngMask();

                    Countdown();

                    if (finishing) return;
                    finishing = true;

                    setTimeout(function() {
                        clearInterval(recordVoiceItv);
                        clearInterval(recordVoiceSecondItv);

                        $('.container .record>img').removeClass('visible').eq(0).addClass('visible');
                        //TODO 识别语音，上传语音，判断状态并显示界面;

                        wx.stopRecord({
                            success: function(res) {
                                var localId = res.localId;

                                wx.translateVoice({
                                    localId: localId, // 需要识别的音频的本地Id，由录音相关接口获得
                                    isShowProgressTips: 0, // 默认为1，显示进度提示
                                    fail: function() {
                                        hideIngMask();
                                        $('.container .record').hide();
                                        alert('没有检测到你的声音，大声一点，再试一次吧');
                                        if (location.href.indexOf('again=true') > 0) {
                                            location.reload();
                                        } else {
                                            location.href = location.href + '&again=true';
                                        }
                                    },
                                    success: function(res2) {

                                        wx.uploadVoice({
                                            localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
                                            isShowProgressTips: 0, // 默认为1，显示进度提示
                                            success: function(res3) {
                                                var serverId = res3.serverId; // 返回音频的服务器端ID
                                                res2.translateResult = res2.translateResult ? res2.translateResult : '-';

                                                $.ajax({
                                                    url: "{php echo $this->createMobileUrl('get_award', array('rid' => $rid,'cardrowid'=>$cardArry['card_rowid']))}",
                                                    data: {
                                                        wuid: '234964',
                                                        aidStr: 'EvO7Pj1fM8k=',
                                                        content: '{$data_keys}',
                                                        localId: localId,
                                                        serverId: serverId,
                                                        translateResult: res2.translateResult,
                                                        sn: ''
                                                    },
                                                    dataType: "json",
                                                    success: function(data) {
                                                        clearInterval(timess);
                                                        if (data.status ==2) {
                                                            alert(data.msg);

                                                        }

                                                        if (data.status != 7) {
                                                            $('html,body').scrollTop(0);
                                                            $('.container').hide();
                                                            $('.container_list').hide();
                                                            $('.container_res').show();
                                                            $('.container_list.has_prize').show();
                                                        }
                                                        if (data.status ==8) {
                                                            $('.container_res .want_focus').show();
                                                            $('.container_res .voice_match_sorry').html('很遗憾<br>你与红包擦肩而过').show();
                                                            $('.container_res .want_retry_wrap').show();
                                                            $('.container_res .want_help_wrap').show();
                                                            if(data.surplusHbCount == 99999){
                                                                $('.container_res .want_retry_wrap .retry_tip').html('您很幸运，本次抽奖次数不限制');
                                                            }
                                                            else{
                                                                $('.container_res .want_retry_wrap .retry_tip').html('还有' + data.surplusHbCount + '次尝试机会');
                                                            }

                                                        }
                                                        if (data.status == 3) {
//                                                             匹配失败
                                                            $('.container_res .want_focus').show();
                                                            $('.container_res .voice_match_sorry').html('很遗憾<br>你与红包擦肩而过').show();
                                                            $('.container_res .want_retry_wrap').show();
                                                            $('.container_res .want_help_wrap').show();
                                                            if(data.surplusHbCount == 99999){
                                                                $('.container_res .want_retry_wrap .retry_tip').html('您很幸运，本次抽奖次数不限制');
                                                            }
                                                            else{
                                                                $('.container_res .want_retry_wrap .retry_tip').html('还有' + data.surplusHbCount + '次尝试机会');
                                                            }
                                                        }else if(data.status == 4){
                                                            $('.container_res .want_focus').show();
                                                            $('.container_res .voice_match_sorry').html(data.msg).show();
                                                            $('.container_res .want_retry_wrap').show();
                                                            $('.container_res .want_help_wrap').show();
                                                            if(data.surplusHbCount == 100000){
                                                                $('.container_res .want_retry_wrap .retry_tip').html('您很幸运，本次抽奖次数不限制');
                                                            }
                                                            else{
                                                                $('.container_res .want_retry_wrap .retry_tip').html('还有' + data.surplusHbCount + '次尝试机会');
                                                            }

                                                        } else if (data.status == 5) {

                                                            var prize = data.prizetype;
                                                            var prizename = data.amount.prizename;
                                                            var ptype = data.ptype;
                                                            $('.container_res .voice_match_succ').show();
                                                            $('.container_res .want_retry_wrap').show();
                                                            $('.container_res .want_help_wrap').show();
                                                            if(data.surplusHbCount == 99999){
                                                                $('.container_res .want_retry_wrap .retry_tip').html('您很幸运，本次抽奖次数不限制');
                                                            }
                                                            else{
                                                                $('.container_res .want_retry_wrap .retry_tip').html('还有' + data.surplusHbCount + '次尝试机会');
                                                            }

                                                        }
                                                        else if (data.status == 6) {

                                                            var prize = data.prizetype;
                                                            var prizename = data.amount.prizename;
                                                            var ptype = data.ptype;
                                                            $('.container_res .voice_match_succ').show();
                                                            $('.container_res .voice_match_succ .13').html(data.msg);
                                                            $('.container_res .want_retry_wrap').show();
                                                            $('.container_res .want_help_wrap').show();
                                                            if(data.surplusHbCount == 99999){
                                                                $('.container_res .want_retry_wrap .retry_tip').html('您很幸运，本次抽奖次数不限制');
                                                            }
                                                            else{
                                                                $('.container_res .want_retry_wrap .retry_tip').html('还有' + data.surplusHbCount + '次尝试机会');
                                                            }

                                                        }
                                                        middleText(res2.translateResult);
                                                        window.currPlayer.commandId = localId;
                                                        if(ptype == 0){
                                                            name = '红包';
                                                            namer = data.amount.credit/100 + '元';
                                                            window.currPlayer.amount = namer;
                                                            window.currPlayer.type = name;
                                                        }else if(ptype == 2){
                                                            name = '礼包';
                                                            namer = prizename;
                                                            window.currPlayer.amount = namer;
                                                            window.currPlayer.type = name;
                                                        } else if(ptype == 1){
                                                            name = '卡券';
                                                            namer = prizename;
                                                            window.currPlayer.amount = namer;
                                                            window.currPlayer.type = name;

                                                            setTimeout(function(){

                                                                sendCardd();
                                                                setTimeout(function() {
                                                                    if (location.href.indexOf('again=true') > 0) {
                                                                        location.reload();
                                                                    } else {
                                                                        location.href = location.href + '&again=true';
                                                                    }
                                                                }, 3000);
                                                            },2000)

                                                        }
                                                        window.currPlayer.score = data.match;
                                                        window.currPlayer.surplusHbCount = data.surplusHbCount;

                                                        setResView();
                                                        hideIngMask();

                                                    }
                                                });
                                            }
                                        });

                                    }

                                });
                            }
                        });
                    }, 400);
                }

                function recordVoice() {

                    clearInterval(initItv_stop);
                    wx.stopRecord({
                        success: function(res) {

                        }
                    });
                    //开始录音

                    wx.startRecord();
                    clearInterval(recordVoiceItv);
                    clearInterval(recordVoiceSecondItv);
                    var currIdx = $('.container .record>img.visible').index();
                    recordVoiceItv = setInterval(function() {
                        if (currIdx >= 5) {
                            currIdx = 1;
                        } else {
                            currIdx++;
                        }
                        $('.container .record>img').removeClass('visible').eq(currIdx - 1).addClass('visible');
                    }, 250);
                    var $secondSpan = $('.container .record .time_less span');
                    recordVoiceSecondItv = setInterval(function() {
                        var currSecond = parseInt($secondSpan.html());
                        currSecond--;
                        if (currSecond == 0) {
                            finishRecord();
                            return;
                        }
                        $secondSpan.html(currSecond);
                    }, 1000);
                }
                //语音播放
                HTMLAudioElement.prototype.stop = function() {
                    this.pause();
                    this.currentTime = 0.0;
                }
                var voiceItv = null;
                var currAudio = $('#curr_audio')[0];
                var currCommandId = $('.container_res .curr_voice .voice_play').attr('commandId');

                function playVoice($el) {
                    wx.stopVoice({
                        localId: currCommandId // 需要停止的音频的本地ID，由stopRecord接口获得
                    });
                    try {
                        currAudio.stop();
                        clearInterval(voiceItv);
                    } catch (e) {}
                    $('.container_list .item .voice_play').each(function() {
                        $(this).css({
                            width: '0.92rem'
                        }).removeAttr('play_statu');
                    });
                    $('.container_res .curr_voice .voice_play').css({
                        width: '0.92rem'
                    }).removeAttr('play_statu');
                    if ($el.attr('commandId')) {
                        currCommandId = $el.attr('commandId');
                        wx.playVoice({
                            localId: currCommandId // 需要播放的音频的本地ID，由stopRecord接口获得
                        });
                        wx.onVoicePlayEnd({
                            success: function(res) {
                                clearInterval(voiceItv);
                                $el.css({
                                    width: '0.92rem'
                                }).removeAttr('play_statu');
                            }
                        });
                    } else {
                        currAudio.src = $el.attr('audio-url');
                        currAudio.play();
                        currAudio.addEventListener('ended', function() {
                            stopVoice($el);
                        });
                    }

                    $el.attr('play_statu', '1');
                    voiceItv = setInterval(function() {
                        var currStatu = $el.attr('play_statu');
                        if (currStatu == '2') {
                            $el.css({
                                width: '0.51rem'
                            });
                            $el.attr('play_statu', 3);
                        } else if (currStatu == '3') {
                            $el.css({
                                width: '0.92rem'
                            });
                            $el.attr('play_statu', 1);
                        } else if (currStatu == '1') {
                            $el.css({
                                width: '0.24rem'
                            });
                            $el.attr('play_statu', 2);
                        }
                    }, 500);


                }

                function stopVoice($el) {
                    wx.stopVoice({
                        localId: currCommandId // 需要停止的音频的本地ID，由stopRecord接口获得
                    });
                    clearInterval(voiceItv);
                    $el.css({
                        width: '0.92rem'
                    }).removeAttr('play_statu');
                    currAudio.stop();
                }
                //读取并设置音频的秒数
                function setSecond($el) {
                    var tmpAudio = new Audio();
                    tmpAudio.src = $el.attr('audio-url');
                    getTime(tmpAudio, $el);
                }

                function getTime(audio, $el) {
                    setTimeout(function() {
                        var duration = audio.duration;
                        if (isNaN(duration)) {
                            var t = audio.time;
                            t = t ? parseInt(t) : 0;
                            if (t >= 500) return;
                            audio.time = (++t);
                            getTime(audio, $el);
                        } else {
                            $el.parent().siblings('.second').html(Math.round(duration) + "''");
                        }
                    }, 10);
                }


//                 $('.container_list .item .voice_play_wrap,.container_list .item .voice').click(function() {
//
//                     var $el = $(this).parent().find('.voice_play');
//                     if ($el.attr('play_statu')) {
//                         stopVoice($el);
//                     } else {
//
//                         playVoice($el);
//                     }
//
//                 });


                $('.container_res .curr_voice .voice,.container_res .curr_voice .voice_play_wrap').click(function() {
                    var $el = $(this).parent().find('.voice_play');

                        if ($el.attr('play_statu')) {
                            stopVoice($el);
                        } else {
                            playVoice($el);
                        }
                });
                $('.container_list .voice_play').each(function() {
                    var $self = $(this);
                    if ($self.attr('audio-url')) {
                        setSecond($self);
                    }
                });
                //});

                //如果是ios7/8，则跑以下兼容代码
                if (navigator.appVersion.indexOf('OS') != -1 && (navigator.appVersion.indexOf('7_') != -1 || navigator.appVersion.indexOf('8_') != -1)) {
                    $('.curr_voice .voice').css('height', '3rem');
                }

                var bgIndexImg = new Image();
                bgIndexImg.src = $('.container_index img.bg').attr('src');
                bgIndexImg.onload = function() {
                    if (bgIndexImg.height > $(window).height()) {
                        $('.container_index').height($(window).width() / bgIndexImg.width * bgIndexImg.height);
                        $('.container_index img.bg').height($(window).width() / bgIndexImg.width * bgIndexImg.height + 18);
                    }
                }

            });
        });


    </script>

<script>
        function sendCardd(){

        var temp = '{$cardArry['cardId']}';

        if(temp == null || temp == '' || temp == undefined){
            return;
        }

        wx.addCard({
            cardList: [{
                cardId: '{$cardArry['cardId']}',
                cardExt: '{"code": "", "openid": "{$cardArry['openid']}", "timestamp": "{$cardArry['timestamp']}","nonce_str":"{$cardArry['nonceStr']}", "signature":"{$cardArry['signature']}"}'
            }], // 需要添加的卡券列表
            success: function (res) {
                var cardList = res.cardList; // 添加的卡券列表信息
            }
        });
        }

</script>

    <!--核销-->
 <script type="text/javascript">
$(document).ready(function(){

    //       提现申请

    var click = false;


        $("#butt").click(function(){

            if(click){
                return false
            }else{
                click = true;

            {if $numx ==1}
            alert('您提现次数大于每日提现次数，请明天在来提现！！')
            $('#awards').hide();
            if (location.href.indexOf('again=true') > 0) {
                location.reload();
            } else {
                location.href = location.href + '&again=true';
            }
            {else}

                $("#butt").attr('disabled', true);
                $("#butt").hide();
            var content = $("#money").html()
            var submitData1 = {
                content: content,
            };

            $.post('{php echo $this->createMobileUrl('application', array('rid' => $rid))}', submitData1, function(data) {

                if (data.success == 1) {
                    $('#awards').hide();
                    $(".succeed").show();
                    $(".succeed").html(data.msg);
                    setTimeout(function(){
                        $(".succeed").toggle();
                        if (location.href.indexOf('again=true') > 0) {
                            location.reload();
                        } else {
                            location.href = location.href + '&again=true';
                        }
                    },2000)


                } else {
                    $('#awards').hide();
                    $(".defeat").html(data.msg);
                    $(".defeat").show();

                    setTimeout(function(){
                        $(".defeat").toggle();
                        if (location.href.indexOf('again=true') > 0) {
                            location.reload();
                        } else {
                            location.href = location.href + '&again=true';
                        }
                    },2000)
                }
            },"json")

            {/if}

            }
        })


    //        分享送红包
    $(".share_gold").click(function () {

        $.ajax({
            url: "{php echo $this->createMobileUrl('get_awards', array('rid' => $rid))}",
            dataType: "json",
            data: {
                t: Math.random()
            },
            beforeSend: function () {

            },
            success: function (data) {

                if(data.success == 2){
                    $('.sharebg').hide();
                    alert(data.msg);
                    return false;
                }

                $('.share_gold,.ck').hide();
                $('.share_gold2').css('display', 'block');

                if (data.success == 1) {

                    var credit = data.msg;

                    name = '¥'+ credit/100;
                    namer = '红包'+ credit/100 + '元';



                    // alert(ptype);

                    setTimeout(function() {
                        $('.act-rule-wrap').hide();
                        $('.share_gold2').hide();
                        $('.sharebg').hide();
                        $('#result').show();
                        $('#resimg').attr('src','../addons/haoman_voice/images/noumi.png');
                        $('#restitle').text('恭喜抽中'+namer);
                    }, 1000);

                }

                if(data.success == 3){
                    setTimeout(function() {
                        $('.act-rule-wrap').hide();
                        $('.share_gold2').hide();
                        $('.sharebg').hide();
                        $('#result').show();
                        $('#resimg').show();
                        $('#nothing').text('抽中'+data.content+'已保存到余额中');
                        $('#restitle').text(data.msg);
                        $('#resbg').removeClass('wdeg');
                    }, 1000);
                }
            },
            error: function () {

            },
            timeout: 15000
        })
    })

    $(".mask,#btn1").click(function(){
        $(".mask").hide();
        $(".point").hide();
    })
    $(".duijiang").bind("click",function (){
        $('#awards').hide();
        $(".mask").show();
        $(".point").show();
        $num = $(this).data("id");

        $("#btn0").on("click",function(){

            var submitData = {
                num:$num,
                inputval:$(".numx").val(),
            };

            $.post('{php echo $this->createMobileUrl('duijiang', array('rid' => $rid))}', submitData, function(data) {

                if (data.success == 1) {

                    $(".mask").hide();
                    $(".point").hide();
                    $(".succeed").show();
                    setTimeout(function(){
                        $(".succeed").toggle();
                        if (location.href.indexOf('again=true') > 0) {
                            location.reload();
                        } else {
                            location.href = location.href + '&again=true';
                        }
                    },1000)
                } else {

                    $(".numx").val("").focus();
                    $(".defeat").show();
                    setTimeout(function(){
                        $(".defeat").toggle();
                    },1000)
                }
            },"json")

        })
    });
})


    </script>

</body>

</html>
