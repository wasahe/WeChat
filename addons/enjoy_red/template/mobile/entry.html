<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,user-scalable=no,maximum-scale=1,initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="UTF-8">
    <title>{$actdetail[title]}</title>
    {php echo register_jssdk(false);}
    <link type="text/css" rel="stylesheet" href="../addons/enjoy_red/template/mobile/css/style.css" />
<link rel="stylesheet" href="../addons/enjoy_red/template/mobile/css/sweetalert.css" />
<script type="text/javascript" src="../addons/enjoy_red/template/mobile/js/sweetalert-dev.js"></script>
    <script src="../addons/enjoy_red/template/mobile/js/jquery-1.4.2.min.js"></script>
</head>
<body  style="background: url('{php echo tomedia($actdetail[bgpic])}') no-repeat; background-size: 100% 100%;color:{$actdetail[color]};">
   <script src='http://api.map.baidu.com/api?v=2.0&ak=5PESLgvMcSbSUbPjmDKgvGZ3'></script>

  <!--  <script type="text/javascript">
    function distance(){
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                var position = {
                     lng: r.point.lng,
                     lat: r.point.lat,
                }
                positions(position);
            }else {
                alert('获取当前位置失败,请确定您开启了定位服务');
            }
        },{enableHighAccuracy: true});
    }
    function positions(position){
    	//alert(position.lng);
    	//alert(position.lat);
      //  window.location.href = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('hs_list'),2)}" + '&lng=' + position.lng + '&lat=' + position.lat;
    }
    {if empty($user['lat']) || empty($user['lng'])}
      // window.onload=distance;
    {/if}
    </script> --> 
 <style>
 .gz{
 		background:#E26636;border-radius:7px;
        display:inline-block;text-align:center;margin:0 auto;
        width:120px;height:50px;font-size:20px;line-height:40px; text-decoration:none;
 }
 </style>

<div id="aniamteBox">
		<img src="{php echo tomedia($actdetail[apic]);}" alt="" />
	</div>  
    <div class="main">
        <p id="title">{$actdetail[title]}</p>
        <div class="whiteFont">
{php echo htmlspecialchars_decode($actdetail[adept])}
        </div>
        <div class="whiteFont hide" style="text-align:center;margin-top:20px;" id="gz">
        <a href="{$actdetail[sucai]}" class="gz" style="color:{$actdetail[color]}; ">点我关注</a>
        </div>
{if $flag==0}
        <div id="index">
            <div id="box">
                <div class="row">
                    <div class="card">
                        <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney1"></p></div>
                        <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic1])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                    <div class="card">
                     <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney2"></p></div>
                         <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic2])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                    <div class="card">
                       <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney3"></p></div>
                         <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic3])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="card">
                        <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney4"></p></div>
                         <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic4])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                    <div class="card">
                   <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney5"></p></div>
                          <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic5])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                    <div class="card">
                        <div class="photo" style="background: url('{php echo tomedia($actdetail[redpic])}') no-repeat;background-size: 100% 100%;"><p id="vmoney6"></p></div>
                          <div class="photo-box" style="background: url('{php echo tomedia($actdetail[redpic6])}') no-repeat;background-size: 100% 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
{elseif $flag==1}
		<div class="smallFont smallFont2">
		<img src="../addons/enjoy_red/template/mobile/images/end.png" width="100%" />
		</div>


{elseif $flag==2}
		<div class="smallFont smallFont2">
		<img src="../addons/enjoy_red/template/mobile/images/start.png" width="100%" />
		</div>

{/if}

        <div id="footer">
            <div id="logo"><img src="../addons/enjoy_red/template/mobile/images/v_24.png" alt=""/></div>
        </div>
		<div class="smallFont smallFont2">
		<p>游戏规则：</p>
		{php echo htmlspecialchars_decode($actdetail[rule])}	
		<p style="text-align:right" id="countp">活动已参加：{$countP}人</p>
		<p style="text-align:right">我还剩：<span style="color:#c9222e;font-weight:bold" id="chance">{$chance}</span>{$actdetail[unit]}</p>
		<p style="text-align:right">奖池：可提现<span style="color:#c9222e;font-weight:bold" id="countm1">{if $countM<0}0.00{else}{$countM}{/if}</span>元，累计<span id="countl">{$countL}</span>元  </p>
<div class="fixed-wrap fixed-b">
       
            <a class="btn01 sp2" href="{php echo $this->createMobileUrl('rank',array('puid'=>$puid))}">牛人榜</a>
            <a class="btn01 sp2"  href="{php echo $this->createMobileUrl('mylog',array('puid'=>$puid))}">我的</a>
            <a class="btn01 sp2" id="cash" onclick="cash1()">提现</a>
            </div>
		</div>
			<script type="text/javascript">
			function cash1(){
			
					var openid='{$user[openid]}';
					$("#cash").attr("data","0"); 
					var cashed='{$countM}';
					var myDate = new Date();
					h=myDate.getHours();
				
					var cashstime='{$actdetail[cashstime]}';
					var cashetime='{$actdetail[cashetime]}';
					
					if(cashstime!=null||cashetime!=null){
						
						if(h<cashstime||h>=cashetime){
							
							swal("不在提现时间内","我们的提现时间为"+cashstime+":00~"+cashetime+":00", "info");
							return false;
						}	
					}
					
					swal({  
						title: "红包提现", 
						text: "您的可提现金额是"+cashed+"元",
						type: "info",   
						showCancelButton: true,
						closeOnConfirm: false, 
						showLoaderOnConfirm: true,
						confirmButtonText: "提现", 
 				 		cancelButtonText: "取消",
						}, function(){  
							setTimeout(function(){ 
								 $.ajax({
						                type: "post",
						                url: "{php echo $this->createMobileUrl('cash')}",
						                dataType: "json",
						                data:{openid:openid},
						                success: function (data) {
											if(data.type==-4){
												swal({
													title: "关注我们",
													text: "点击关注我们后可以提现哦",
													showCancelButton: true,
													confirmButtonColor: "#DD6B55",   
													confirmButtonText: "关注", 
											 		cancelButtonText: "取消", 
													closeOnConfirm: false,  
													closeOnCancel: false },
													function(isConfirm){ 
														if (isConfirm) { 
															window.location.href="{$actdetail[sucai]}"; 
														} else {
															swal.close();
														} 
													});
												}else if(data.type == -1){
													if(data.money==null){
														data.money=0.00;
													}
												
												swal("提现失败","您的可提现金额是"+data.money+"元，满"+data.cashmoney+"元才能提现哦", "error");
												}else if(data.type==-2){
												swal("提现失败","抱歉，系统未开放", "error");
											}else if(data.type==-3){
												
												swal("提现失败","系统忙，请稍后重新提现", "error");
											}else if(data.type==1){
												$("#countm1").html("0.00");
												swal("提现成功","提现"+data.money+"元成功，请实时查看您的微信到账通知", "success");
												
											}
						                }
						            });
								}, 1000);
							});
			
				
				
			
				
	
			}
			</script>	
            <style>
            .fixed-b {
			    bottom: 0;
			}
			.fixed-t, .fixed-b {
			    z-index: 800;
			    position: fixed;
			    left: 0;
			    right: 0;
			}
			.fixed-wrap {
			    background: rgba(0,0,0,.7);
			}
            
			.btn01.sp2 {
			    margin: 0.4em 0 0.4em 3.3%;
			}
			.btn01:visited {
			    color: #ffffff;
			}
			.btn01 {
			    display: block;
			    width: 30%;
			    height: 1.5em;
			    line-height: 1.5;
			    background: #f41f3d;
			    border-bottom: 4px solid #c9222e;
			    -webkit-border-radius: 5px;
			    -moz-border-radius: 5px;
			    border-radius: 8px;
			    font-size: 1.3rem;
			    color: #ffffff;
			    text-align: center;
			    float:left;
			    text-decoration:none;
			}
            </style>
		<!--  <div class="smallFont smallFont2">
		<table class="table" cellspacing="0" cellpadding="0">
		<tr><th>序号</th><th>图片</th><th>名称</th><th>数量</th></tr>
		{loop $rulelist $item}
		{php $i++}
		<tr>
		<td class="fontrule">{$i}</td>
		<td><img alt="{$item[rname]}" src="{php echo tomedia($item[rpic])}" width="40%"></td>
		<td>{$item[rname]}</td>
		<td>{$item[count]}</td>
		</tr>
		
		{/loop}
		</table>
		
		</div>-->
		
    </div>
    <div id="sureBox" class="hide">
        <div id="sureInBox">
            <div id="head"><i id="del">x</i></div>
            <p>恭喜您中了<span id="money"></span>元，分享好友获得{$actdetail['share_chance']}{$actdetail['unit']}</p>
            <div id="btn">
                <input id="ok" type="button" value="全部翻开" />
                <input id="no" type="button" value="再来一波" />
                <div style="clear: both;"></div>
            </div>
        </div>
    </div>
    <div style="height:60px;"></div>
    <input id="openid" type="hidden" value="{$user[openid]}"/>
</body>
<script>
    $(function(){
    	var openid=$("#openid").val();
		$('#aniamteBox').css({
			width: $(window).width(),
			height: $(window).height()
		})
		$('#aniamteBox').delay(3000).animate({
			top: '-'+$(window).height()+'px'
		},1000)
        $('body').css({minHeight:$(window).height()});
        $('.photo-box').bind('click',function(){
			var obj = $(this);
			$.ajax({
				type:'post',
				url:"{php echo $this->createMobileurl('chance')}",
				dataType:"JSON",
				data:{openid:openid},
				success:function(data){
					var data = eval('('+data+')');
					//alert(data['ip']);
					if(data['type'] == -4){
						swal({
							title: "关注我们",
							text: "点击关注我们参加活动",
							showCancelButton: true,
							confirmButtonColor: "#DD6B55",   
							confirmButtonText: "关注", 
					 		cancelButtonText: "取消", 
							closeOnConfirm: false,  
							closeOnCancel: false },
							function(isConfirm){ 
								if (isConfirm) { 
									window.location.href="{$actdetail[sucai]}"; 
								} else {
									swal.close();
								} 
							});
					}else if(data['type'] == -2){
						swal("提现失败","抱歉，系统未开放", "error");
						}else if(data['type'] == -1){	

						swal("你的游戏"+data['unit']+"已经用光","喊朋友来玩可以获得额外的"+data['unit']+"哦", "info");
						}else if(data['type'] == -3){
							
							swal("系统太忙，歇口气再玩吧",data['error'], "error");
						//	location.reload();
						}else if(data['type'] == -5){
							
							$("#vmoney1").text((data['vmoney'][0]*0.01).toFixed(2)+'元');
							$("#vmoney2").text((data['vmoney'][1]*0.01).toFixed(2)+'元');
							$("#vmoney3").text((data['vmoney'][2]*0.01).toFixed(2)+'元');
							$("#vmoney4").text((data['vmoney'][3]*0.01).toFixed(2)+'元');
							$("#vmoney5").text((data['vmoney'][4]*0.01).toFixed(2)+'元');
							$("#vmoney6").text((data['vmoney'][5]*0.01).toFixed(2)+'元');
							//obj.prev('.photo').find('p').text('谢谢参与');
							obj.css({
								transform:'rotateY(90deg)',
								webkitTransform:'rotateY(90deg)'
							})
							setTimeout(function(){
								$('.photo-box').css({
					                transform:'rotateY(90deg)',
					                webkitTransform:'rotateY(90deg)'
					            })
							},1000)
								setTimeout(function(){
								$('.photo-box').css({
					                transform:'rotateY(0deg)',
					                webkitTransform:'rotateY(0deg)'
					            })
							},3000)
							$("#chance").html(data['chance']);
						}else if(data['type'] == -6){
							swal("对不起",'您不在本次活动范围,请期待我们下一次活动', "info");
						}else if(data['type'] == -7){
							swal("抢太快了","歇20秒再后试试吧", "error");
						}else{
							$("#vmoney1").text((data['vmoney'][0]*0.01).toFixed(2)+'元');
							$("#vmoney2").text((data['vmoney'][1]*0.01).toFixed(2)+'元');
							$("#vmoney3").text((data['vmoney'][2]*0.01).toFixed(2)+'元');
							$("#vmoney4").text((data['vmoney'][3]*0.01).toFixed(2)+'元');
							$("#vmoney5").text((data['vmoney'][4]*0.01).toFixed(2)+'元');
							$("#vmoney6").text((data['vmoney'][5]*0.01).toFixed(2)+'元');
							obj.prev('.photo').find('p').text(data['rule']['money']+'元');
							$("#money").text(data['rule']['money']);
							obj.css({
								transform:'rotateY(90deg)',
								webkitTransform:'rotateY(90deg)'
							})
						setTimeout(function(){
							$('#sureBox').fadeIn();
							},100)
							//返回次数和总
							$("#chance").html(data['chance']);
							$("#countm1").html(data['countm']);
							$("#countl").html(data['countl']);
						}
				}
			})
			
			



        })
        $('#no,#del').bind('click',function(){

			$('.photo-box').css({
                transform:'rotateY(0deg)',
                webkitTransform:'rotateY(0deg)'
            })
            $('#sureBox').fadeOut();

        })
        $('#ok').bind('click',function(){
            $('#sureBox').fadeOut();

         			setTimeout(function(){
				$('.photo-box').css({
	                transform:'rotateY(90deg)',
	               webkitTransform:'rotateY(90deg)'
	           })
			},1000)
			         			setTimeout(function(){
				$('.photo-box').css({
	                transform:'rotateY(0deg)',
	               webkitTransform:'rotateY(0deg)'
	           })
			},5000)
        })
        $('#formdel').bind('click',function(){
            $('#form').fadeOut();
            $('#address').remove();
            $('.photo-box').css({
                transform:'rotateY(0deg)',
                webkitTransform:'rotateY(0deg)'
            })
            $(window).unbind('touchmove');
        })
    })

</script>
<script>

wx.ready(function () {
    sharedata = {
    	title : "{$actdetail[share_title]}",
   		link :  "{$sharelink}",
   		desc : "{$actdetail[share_content]}",
    	imgUrl:"{php echo tomedia($actdetail[share_icon])}",
      success: function(){
    	// ajax返回加机会
      },
      cancel: function(){
    	//  alert(2);
      }
    };
    wx.onMenuShareAppMessage(sharedata);
    wx.onMenuShareTimeline(sharedata);
    wx.onMenuShareQQ(sharedata);
    wx.onMenuShareWeibo(sharedata);
  });
</script>

<script src="../addons/enjoy_red/template/mobile/js/jweixin-1.0.0.js"></script>













</html>