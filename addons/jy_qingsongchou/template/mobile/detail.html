 {template 'header'}

<style type="text/css">
* { padding: 0; margin: 0; }
.am-share { font-size: 14px; border-radius: 0; bottom: 0; left: 0; position: fixed; text-align: center; -webkit-transform: translateY(100%); -ms-transform: translateY(100%); transform: translateY(100%); -webkit-transition: -webkit-transform 300ms; transition: transform 300ms ; width: 100%; z-index: 1110; }
.am-modal-active { transform: translateY(0px);  -webkit-transform: translateY(0); -ms-transform: translateY(0); transform: translateY(0) }
.am-modal-out { z-index: 1109; -webkit-transform: translateY(100%); -ms-transform: translateY(100%); transform: translateY(100%) }

.am-share-title { background-color: #f7f7f7; border-bottom: 1px solid #fff;  color: #555; font-weight: 400;  padding: 10px 0 0; text-align: center; }
.am-share-title::after { border-bottom: 1px solid #dfdfdf; content: ""; display: block; height: 0; margin-top: 10px; width: 100%; }

.am-share-footer { }
.am-share-footer .share_btn { color: #555;  display: block; width: 100%; background-color: #fff; border: 1px solid #e6e6e6; border-radius: 0; cursor: pointer;  font-size: 16px; font-weight: 400; line-height: 1.2; padding: 0.625em 0; text-align: center; transition: background-color 300ms ease-out 0s, border-color 300ms ease-out 0s; vertical-align: middle; white-space: nowrap;font-family:"微软雅黑";  }

.am-share-sns { background-color: #f7f7f7;  padding-top: 15px; height:auto; zoom:1; overflow:auto; }

.am-share-sns li { margin-bottom: 15px; display: block; float: left; height: auto;  width: 25%; }

.am-share-sns a { color: #555; display: block; text-decoration:none; }
.am-share-sns span { display: block; }

.am-share-sns li i { background-position: center 50%; background-repeat: no-repeat; background-size: 36px 36px; background-color: #ccc; color: #fff; display: inline-block; font-size: 18px; height: 36px; line-height: 36px; margin-bottom: 5px; width: 36px; }
.am-share-sns .share-icon-weibo { background-image: url(); }

.sharebg { background-color: rgba(0, 0, 0, 0.6); bottom: 0; height: 100%; left: 0; opacity: 0; position: fixed; right: 0; top: 0; width: 100%; z-index: 1100; display:none; }
.sharebg-active { opacity: 1; display:block; }
.am-pureview-actions{top: 16px!important;}
.am-pureview-direction{display: none;}
.am-pureview-nav{display: none;}
.am-pureview.am-pureview-bar-active{display: none;}
.am-modal.am-modal-no-btn{display: none}
</style>

  <header class="qsc-bar bar-green bar-fixed project-detail-bar">
      <a href="{php echo $this->createMobileUrl('index')}" class="bar-item pull-left"><i class="icon bar-arrow-left"></i><span>首页</span></a>
      {if $this->memberinfo['openid']==$config['openid']}
      <a href="javascript:void(0)" class="bar-item pull-right  report" onclick="toshare()">项目管理</a>
      {else}
      <a href="{php echo $this->createMobileUrl('jubao',array('id'=>$_GPC['id']))}" class="bar-item pull-right  report"  >举报</a>
      {/if}

      <h1 class="bar-title qsc-logo_white" style="top:6px;">
        <a href=""><img src="{php echo tomedia($this->sys['detaillogo'])}" width="80" height='25' alt="轻松筹"></a>
      </h1>
  </header>



<div class="content-fixed top bottom mod-project mod-project-detail project-7248a5a5-3d0f-496d-b5cc-8d87ad240ca1" >
<div class="mod-project-detail">
<div class="mod-project-card card-type-1" style="margin-bottom:15px;">
<div class="mod-project-card_header clearfix">
<div class="mod-project-card_header__avatar">
<img class="lazy-load" data-original="{$config['avatar']}" width="24" height="24" alt="" style="display: inline;">
</div>
<div class="mod-project-card_header__user">
<span>{php echo urldecode($config['nickname'])}</span>
<em class="mod-project-card_header__time">{$config['rand_day']}</em>
</div>
<div class="mod-project-card_header__lefttime">
剩余<strong> {$less}</strong>天 </div>
</div>
<div class="mod-project-card_content">
<header class="mod-project-card_content__header">
<h2>{$config['name']}</h2>
</header>
<div class="mod-project-card_content__status clearfix">
<span><strong>{$config['tar_monet']}<small>元</small></strong>目标金额</span>
<span><strong>{if !$_sum}0{else}{$_sum}{/if}<small>元</small></strong>已筹金额</span>
<span><strong>{$_count}<small>次</small></strong>支持次数</span>
</div>
<div class="mod-project-card_content__detail">
<div class="view-body">
  {php echo html_entity_decode($config['project_texdesc'])}
</div>
  <div class="mod-project-card_content__img clearfix"  data-am-gallery="{ pureview: true }" >
    <ul data-am-widget="gallery" class="am-gallery am-avg-sm-4 am-avg-md-3 am-avg-lg-4 am-gallery-default" data-am-gallery="{ pureview: true }" >
      {php $i=0;}
     {loop $thumb  $row}

            <div class="am-gallery-item">
            <a href="{$row['pic']}" class="fancybox am-gallery-item"  >
                <img class="lazy-load" src="{$row['thumb']}" width='25%'  data-rel="{$row['pic']}" style="display: block;max-width: 100%;height: auto;border: none;margin: 0;">
            </a>
            </div>
          {if $i==0}
           {php $first = $row['thumb']}
           {/if}
           {php $i++;}
      {/loop}
    </ul>
  </div>
</div>
</div>
</div>
</div>



{if $project['project_plus4']!=1}
<div class="mod-project-card mod-project-card_content__list" data-pager="53bcb1fc-c6c2-4771-9f9f-1bda080aa7ab" data-limit="1">
    <div class="project-detail_title">帮Ta实现</div>
    <div class="qsc-list-group noicon">
      {if $project['project_plus3']!=1}
        <div class="list-item list-thumb list-thumb-md">
        <strong><em>{$config['tar_monet']}</em> 元</strong>
        <p>{$config['name']}</p>
        <span>
        已有 <strong>{$_count}</strong> 人支持
        </span>
        </div>
        {else}
           {php $_dream = json_decode($config['dream'],true);}
           {loop $_dream $row}
           <div class="list-item list-thumb list-thumb-md">
             <strong><em>{$row['money']}</em> 元</strong>
             <p>{$row['content']}</p>
             <span>
               已有 <strong>{php echo _gdream($row['dream_id'])}</strong> 人支持
             </span>
           </div>
           {/loop}
        {/if}
    </div>


</div>
{/if}
{if $_uplist}
<div class="mod-project-card" data-pager="eb75b31d-3bea-44d4-988c-a424aa3b6411" data-limit="2">
<div class="project-detail_title">筹款动态</div>
<div class="project-timeline clearfix">

  {loop $_uplist $row}
  <div class="timeline-item mod-project-support update" data-id="1367627">
    <div class="time">
        <div class="timeline-item_user">
          <img class="lazy-load" src="{$row['avatar']}" data-original="" width="100%" height="100%" style="display: inline;">
          <i class="icon-progress icon-progress_update"></i>
        </div>
    </div>
    <div class="timeline-item_content">
      <h6 class="timeline-item_content_user">{php echo urldecode($row['nickname'])} <small>发布进度更新</small></h6>
        <p class="timeline-item_content_time">{php echo $this->_format_date($row['upbdate'])} <a class="timeline-item_content_comment publish_comment" href="javascript:void(0)"><!--<i class="icon-comment"></i>--></a>
    </p>
    <p class="timeline-item_content_talk">{$row['content']}</p>

    <div class="mod-project-card_content__img clearfix">
        <figure data-am-widget="figure" class="am am-figure am-figure-default "   data-am-figure="{  pureview: 'true' }">
      {php $thumb = json_decode($row['thumb'],true)}
      {if $thumb}
       {loop $thumb $row}
      <a href="" class="fancybox" rel="topic-fancybox">
          <img class="lazy-load" src="{$row}" width="30%" alt="" style="display: block;">
      </a>
      {/loop}
      {/if}
          </figure>
    </div>

    <div class="timeline-item_content_talk__comment">
        <article></article>
    </div>
    </div>
  </div>
{/loop}



</div>
</div>
{/if}
{if $project['project_plus4']==1}
<div class="mod-project-card mod-project-card_content__list" data-pager="e7a6a8dc-da16-41ea-9881-322ed95774cd" data-limit="1">
<div class="project-detail_title">产品回报</div>
<div class="qsc-list-group">

   {loop $_plist $k $row}
    <div class="list-item list-thumb list-thumb-md">
      <strong>
      <i class="icon">
          <img src="{$row['thumb']}" width="60" height="60">
      </i>
      支持 <em>{$row['supportNumber']}</em> 元
      </strong>
    <p>{$row['supportContent']}</p>
    <span>
      {php echo _less($row['places'],$_GPC['id'],$k,$this->weid)}

  </span>
    </div>
    {/loop}
</div>
</div>

{/if}

{if !empty($_slist)}
<div class='mod-project-card mod-project-supporter ajax-loading mod-project-support'>
  <div class="project-detail_title">TA的支持者</div>

{loop $_slist $row}
<div class="mod-project-support_item item J_tpl clearfix" id="supor-{$row['id']}">
  <div class="mod-project-support_item__user">
    <img class="lazy-load" src="{$row['avatar']}" data-original="" width="100%"  style="display: inline;">
  </div>
  <div class="mod-project-support_item__detail">
    <div class="project-support_item__detail__user">{php echo urldecode($row['nickname'])}<small> 支持了 <strong>{$row['fee']}</strong> 元 </small></div>
    <div class="project-support_item__detail__time">{php echo $this->_format_date($row['upbdate'])}
      <a class="project-support_item__detail_comment publish_comment" href="javascript:void(0)"><i class="icon-comment" data-fid="{$row['id']}"></i></a></div>
      <div class="project-support_item__detail__content">{$row['msg']}</div>

      {if !empty($_mess[$row['id']])}
      <div class="mod-project-support_item__detail__comment">
        {loop $_mess[$row['id']] $row}
        <article>
          <i class="icon-triangle"></i>
          <a class="publish_comment publish-comment_shadow-task" href="javascript:void(0)">
            <strong>{php echo urldecode($row['nickname'])}: </strong>{$row['content']}</a>
        </article>
        {/loop}
      </div>
      {/if}
    </div>
</div>
{/loop}
</div>
{/if}

<div class="" style="display:block;height:40px;overflow:hidden;width:100%;"></div>

<footer class="qsc-bar bar-fixed bar-support
bar-7248a5a5-3d0f-496d-b5cc-8d87ad240ca1"> <span class="bar-item"
id="btn-follow" data-url=""> <i class="icon {if $_gz}icon-star{else}icon-star-o{/if}"></i>关注 <small>{$config['shouc']}</small>
</span>
  {if $this->memberinfo['openid']==$config['openid']}
     {if $_sum>=$config['tar_monet']}
        <a href="{php echo $this->createMobileUrl('detail',array('dopost'=>'finish','id'=>$_GPC['id']))}" class="bar-item btn-support"><span>已成功</span></a>
     {else}
       <a href="{php echo $this->createMobileUrl('pay',array('id'=>$_GPC['id']))}" class="bar-item btn-support"><span>我要支持</span></a>
     {/if}
  {else}
      {if $_sum>=$config['tar_monet']}
        <a href="javascript:void(0)" class="bar-item btn-support"><span>众筹已成功</span></a>
      {else}
        <a href="{php echo $this->createMobileUrl('pay',array('id'=>$_GPC['id']))}" class="bar-item btn-support"><span>我要支持</span></a>
      {/if}
  {/if}
    <span onclick='toshare2()' class="bar-item">
        <i class="icon icon-share"></i>分享
        <small>{$config['is_share']}</small>
    </span>

</footer>



<div class="am-share share1">
  <h3 class="am-share-title">项目管理</h3>
  <ul class="am-share-sns">
    <a href="{php echo $this->createMobileUrl('suport',array('id'=>$_GPC['id']))}" class="item"><i class="icon icon-support"></i>支持记录</a>
    <a href="{php echo $this->createMobileUrl('editor',array('id'=>$_GPC['id']))}" class="item"><i class="icon icon-edit"></i>编辑项目</a>
    <a href="{php echo $this->createMobileUrl('editor',array('dopost'=>'update','id'=>$_GPC['id']))}" class="item"><i class="icon icon-update"></i>更新动态</a>
    <a  class="item" id="btn-project-close" onclick='toshare3()'><i class="icon icon-delete"></i>删除项目</a>
    <a href="{php echo $this->createMobileUrl('detail',array('dopost'=>'htu','id'=>$_GPC['id']))}" class="item"><i class="icon icon-help"></i>使用帮助</a>
  </ul>
  <div class="am-share-footer"><button class="share_btn">取消</button></div>
</div>


<div class="am-share share2">
  <h3 class="am-share-title">分享给好友</h3>
  <ul class="am-share-sns">
    <a href="{php echo $this->createMobileUrl('qrcode',array('fid'=>$_GPC['id']))}" id="qrcode" data-dismiss="modal" data-toggle="modal" data-target="#share-qrcode" class="item"><i class="icon icon-qrcode"></i>二维码</a>
    <a href="javascript:void(0);"  onclick='_shareweibo()' class="item h5-share-weibo" data-id="0"><i class="icon icon-weibo"></i>新浪微博</a>
    <a href="javascript:void(0);" onclick="_sharqzon()" class="item h5-share-qzone" data-id="4"><i class="icon icon-qqzone"></i>QQ空间</a>
    <a href="javascript:void(0);" onclick='_shareqweibo()' class="item h5-share-qqweibo" data-id="6"><i class="icon icon-qqweibo"></i>腾讯微博</a>
    <a href="javascript:void(0);" onclick='_shareqq()' class="item h5-share-qq" data-id="5"><i class="icon icon-qq"></i>QQ好友</a>
  </ul>
  <div class="am-share-footer"><button class="share_btn">取消</button></div>
</div>


<div class="am-share share3">
  <h3 class="am-share-title">项目删除确认</h3>
  <div style='display:block;overflow:hidden;padding:15px;text-align:center;background-color:#f7f7f7'>
      项目删除后将无法恢复,已筹金额会全部退还支持者,您确定要删除吗?
  </div>
  {php  $_url = $this->createMobileUrl('editor',array('dopost'=>'del','id'=>$_GPC['id']))}
    <div class="am-share-footer"><button class="share_btn" style='color:red;' onclick="window.location.href='{$_url}'">确认删除</button></div>
  <div class="am-share-footer"><button class="share_btn">取消</button></div>
</div>

{template 'tip'}


<script>
	wx.ready(function () {
		sharedata = {
			title: "{$config['name']}",
			desc: "{php echo strip_tags(htmlspecialchars_decode($config['detail']))}",
			link: "{php echo $_W['siteroot']."app/".substr($this->createMobileUrl('detail',array('id'=>$_GPC['id'])),2)}",
			imgUrl: "{if !empty($first)}{$first}{else}{php echo tomedia($this->sys['share_img'])}{/if}"
		};
		wx.onMenuShareAppMessage(sharedata);
    wx.onMenuShareTimeline(sharedata);
	});

	</script>
<script type="text/javascript">

function _shareweibo(){
  // alert();
  addshare();
   window.open("{$_share['weibo']}");
}
function _sharqzon(){
  addshare();
window.open("{$_share['qqzon']}");
}
function _shareqweibo(){
  addshare();
window.open("{$_share['qqweibo']}");
}
function _shareqq(){
  addshare();
window.open("{$_share['qq']}");
}


function addshare(){
  $.ajax({
     url:"{php echo $this->createMobileUrl('addshare',array('fid'=>$_GPC['id']))}",
     type:"post"
  });
}
  $(function(){
       $("#btn-project-close").bind('click',function(){

       })
       $("#btn-follow").bind('click',function(){
        //
              var icon = $(this).find('i');
              var small = $(this).find('small');
                  small_p = small.html();
                  small_p = parseInt(small_p);
              var sp = $("#toast-default").find('span');
              $("#toast-default").show();
              if(icon.hasClass('icon-star-o')){
                $.ajax({
                    url:"{php echo $this->createMobileUrl('detail')}",
                    type:"post",
                    dataType:'json',
                    async:false,
                    data:{
                      dopost:'ajax',
                      fid:{$_GPC['id']},
                      modal:'jia'
                    },success:function(msg){
                      // alert(msg.status);
                      sp.html('关注成功');
                      icon.removeClass('icon-star-o').addClass('icon-star');
                      small.html(small_p+1);
                      setTimeout(function(){
                        $("#toast-default").hide();
                      },1000)
                    },else:function(){
                      alert(2);
                    }
                })
              }else{
                $.ajax({
                    url:"{php echo $this->createMobileUrl('detail')}",
                    type:"post",
                    dataType:'json',
                    async:false,
                    data:{
                      dopost:'ajax',
                      fid:"{$_GPC['id']}",
                      modal:'jian'
                    },success:function(msg){
                      // alert(msg.status);
                        sp.html('取消成功');
                        icon.removeClass('icon-star').addClass('icon-star-o');
                        small.html(small_p-1);
                        setTimeout(function(){
                          $("#toast-default").hide();
                        },1000)
                    },else:function(){
                      alert(2);
                    }
                })

              }


       });
  });
  function toshare(){
    $(".am-share.share1").addClass("am-modal-active");
    if($(".sharebg").length>0){
      $(".sharebg").addClass("sharebg-active");
    }else{
      $("body").append('<div class="sharebg"></div>');
      $(".sharebg").addClass("sharebg-active");
    }
    $(".sharebg-active,.share_btn").click(function(){
      $(".am-share").removeClass("am-modal-active");
      setTimeout(function(){
        $(".sharebg-active").removeClass("sharebg-active");
        $(".sharebg").remove();
      },300);
    })
  }
  function toshare2(){
    $(".am-share.share2").addClass("am-modal-active");
    if($(".sharebg").length>0){
      $(".sharebg").addClass("sharebg-active");
    }else{
      $("body").append('<div class="sharebg"></div>');
      $(".sharebg").addClass("sharebg-active");
    }
    $(".sharebg-active,.share_btn").click(function(){
      $(".am-share").removeClass("am-modal-active");
      setTimeout(function(){
        $(".sharebg-active").removeClass("sharebg-active");
        $(".sharebg").remove();
      },300);
    })
  }
  function toshare3(){
  $(".am-share.share1").removeClass("am-modal-active");
  $(".am-share.share2").removeClass("am-modal-active");

    $(".am-share.share3").addClass("am-modal-active");
    if($(".sharebg").length>0){
      $(".sharebg").addClass("sharebg-active");
    }else{
      $("body").append('<div class="sharebg"></div>');
      $(".sharebg").addClass("sharebg-active");
    }
    $(".sharebg-active,.share_btn").click(function(){
      $(".am-share").removeClass("am-modal-active");
      setTimeout(function(){
        $(".sharebg-active").removeClass("sharebg-active");
        $(".sharebg").remove();
      },300);
    })
  }
</script>

<script>
      require(['lazyload'],function(lazyload){
           $("img.lazy-load").lazyload();
      })
      $(function(){
           $(".icon-comment").bind('click',function(){
               {if !empty($is_f)}
                 var payid = $(this).attr('data-fid');
                       $("#payid").val(payid);
                     $('body').append('<div class="modal-backdrop in"></div>');
                     $("#modal-comment-new").show();
                     {else}

                       var sp = $("#toast-default").find('span');
                       $("#toast-default").show();
                       sp.html('请支持筹款后发布评论');
                       setTimeout(function(){
                         $("#toast-default").hide();
                       },1000)
                     {/if}
               });

           $(".modal-backdrop.in,#quxiao").bind('click',function(){
               $(".modal-backdrop.in").remove();
             $("#modal-comment-new").hide();
           })
      })
</script>


<div class="qsc-modal dialog in" id="modal-comment-new" aria-hidden="false" style="display: none;">
    <div class="modal-dialog middle">
      <div class="modal-content">
            <form action="" method="POST" name="project-comment" id="project-comment-new">
              <input type="hidden" name="dopost" value='message'>
                <div class="modal-header"> 发表评论</div>
                <div class="modal-body">
                    <textarea class="control-input" id="content" name="content" rows="3" placeholder="我也说一句..."></textarea>
                </div>
                <div class="modal-footer clearfix">
                    <a href="javascript:void(0);" class="btn" id="quxiao" data-dismiss="modal">取消</a>
                    <input type="submit" class="btn active" id="submit" value="回复">
                    <input type="hidden" id="payid" name='payid'>
                    <input type="hidden" id="fid" name='fid' value="{$_GPC['id']}">
                </div>
            </form>
      </div>
    </div>
</div>
<!--  -->
</body>
</html>
