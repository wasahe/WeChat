<?php 

defined('IN_IA') or exit('Access Denied'); class Jy_advModule extends WeModule { public function fieldsFormDisplay($rid = 0) { global $_W; load ()->func ( 'tpl' ); if (! empty ( $rid )) { $reply = pdo_fetch ( "SELECT a.*,b.aname FROM " . tablename ( "jy_adv_rule" ) . " as a left join ".tablename('jy_adv_quan')." as b on a.quan_id=b.id WHERE ruleid = :rid ", array ( ':rid' => $rid ) ); } $quan = pdo_fetchall ( "SELECT * FROM " . tablename ( "jy_adv_quan" ) . " WHERE weid = :weid AND del=0 ORDER BY `id` DESC", array ( ':weid' => $_W ['uniacid'] ) ); include $this->template ( 'display' ); } public function fieldsFormValidate($rid = 0) { return ''; } public function fieldsFormSubmit($rid) { global $_GPC, $_W; if(empty($_GPC['quan_id'])) { message("请选择所属广告平台"); } if(empty($_GPC['news_title'])) { message("请选择图文标题"); } $data = array ( 'ruleid' => $rid, 'weid' => $_W ['uniacid'], 'news_title'=>$_GPC['news_title'], 'news_thumb'=>$_GPC['news_thumb'], 'news_content'=>$_GPC['news_content'], 'quan_id' => $_GPC ['quan_id'] ); if ($_GPC ['id']) { pdo_update ( "jy_adv_rule", $data, array ( 'id' => $_GPC ['id'] ) ); } else { pdo_insert ( "jy_adv_rule", $data ); } } public function ruleDeleted($rid) { pdo_delete ( "jy_adv_rule", array ( 'ruleid' => $rid ) ); } }

?>