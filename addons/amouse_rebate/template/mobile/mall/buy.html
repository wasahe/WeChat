<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>{$goods['title']}</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="{AMOUSE_REBATE_RES}css/foods.css?v=20160421" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="{AMOUSE_REBATE_RES}css/main.css">
    <script src="{AMOUSE_REBATE_RES}js/jquery.js?v=20160421"></script>
    <script type="text/javascript" src="{AMOUSE_REBATE_RES}js/wemall.js?222"></script>
    <script src="{AMOUSE_REBATE_RES}js/foundation.js"></script>
    <script src="{AMOUSE_REBATE_RES}js/main.js"></script>


    <style type="text/css">
        body {
            background: #fff;
            color: #222;
            cursor: auto;
            font-family: "Helvetica Neue", Helvetica, Roboto, Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            position: relative; }
    .viptype {
        min-height: 40px;
    }

    .viptype label {
        display: inline-block;
        float: left;
        width: 100%;
        height: 30px;
        line-height: 30px;
        margin-top: 5px;
        margin-left: 10px;
    }

    .viptype input {
        width: 20px;
        height: 20px;
        margin: 5px;
        float: left;
    }

    .viptype span {
        float: left;
        height: 30px;
        line-height: 30px;
    }

    .btn {
        background: #d00a0a none repeat scroll 0 0;
        border-radius: 5px;
        color: #fff;
        display: inline-block;
        float: left;
        height: 40px;
        line-height: 40px;
        margin-left: 5%;
        margin-top: 15px;
        text-align: center;
    }

    .subdh {
        float: right;
        margin-right: 5%;
    }

    .editnum {
        display: block;
        float: left;
        width: 36px;
        height: 36px;
        line-height: 36px;
        text-align: center;
        border: 1px solid #eee;
    }

    .shownum {
        border-left: none;
        border-right: none;
    }
    select {
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        background-color: #FAFAFA;
        border-radius: 0;
        background-position: 100% center;
        background-repeat: no-repeat;
        border-style: solid;
        border-width: 1px;
        border-color: #cccccc;
        color: rgba(0, 0, 0, 0.75);
        font-family: inherit;
        font-size: 0.875rem;
        line-height: normal;
        padding: 0.5rem;
        border-radius: 0;
        height: 2.3125rem;
    }
    </style>
</head>
<body style="background:#fff">
<div class="body">
    <div class="dialog" id="tip">
        <div class="dialog-cnt">
            <div class="dialog-bd">
                <h3>提示</h3>
                <p class="text"></p>
                <a class="button correct-btn" id="alert_ok">确&nbsp;&nbsp;定</a>
            </div>
        </div>
    </div>
    <article>
        <div class="scroll relative">
            <div class="scroll_box" id="scroll_img">
                <ul class="scroll_wrap">
                    <li><a href="{$set['followurl']}">
                        <img src="{php echo strpos($set['thumb'],'http://')===FALSE?(tomedia($set['thumb'])):$set['thumb']}" class="vipimg" width="100%"></a></li>
                </ul>
            </div>
        </div>
    </article>

    <ul class="mso_ul" style="margin-top:0px;">
        <li class="vipinfo" style="border:none">
            <span style="margin-top:5px;">{$goods['title']}&nbsp;&nbsp;&nbsp;&nbsp;￥{$goods['price']}</span>
        </li>
        <li class="vipdesc" style="margin-bottom:5px;">
            <a href="{php echo $this->createMobileUrl('book',array('op'=>'detail','gid'=>pencode($goods['id'])),true)}" style="float:right;margin-right:15px;color:#666;font-size:small;">查看详情</a>
        </li>
        <li class="g_input">
            <span class="lf">
            购买数量 </span>
            <span class="rt">
                <input type="hidden" name="buynum" value="1">
                <span class="editnum decnum">—</span>
                <input type="tel" style="width:36px;height:36px;padding:0px;margin:0px;float:left;border:none" name="shownum" class="editnum shownum" value="1"/>
                <span class="editnum addnum">+</span>
            </span>
        </li>
        <li class="g_input"><span class="lf">真实姓名
				</span><span class="rt"><input type="text" value="" name="username" placeholder="真实姓名"></span>
        </li>
        <li class="g_input"><span class="lf">手机号码
				</span><span class="rt"><input type="tel" value="" name="moblie" placeholder="手机号码 18677778888"></span>
        </li>

        <li class="g_input citys" style="line-height:85px;height:85px;min-height:80px;padding-bottom:5px;"><span
                style="display:inline-block;float:left;width:100%;line-height:30px;height:30px;" class='lf'>收货城市</span>
            <div id="div_region" style="margin-top:10px;font-size:16px;float:left;width:100%;">
                <select id="id_create_province" name="province" style="width:32%;line-height:25px;font-size:14px;float:left;margin-left:5px;">
                    <option value="" data-code="">—— 省 ——</option>
                </select>
                <select id="city" name="city" style="width:32%;line-height:25px;font-size:14px;float:left;margin-left:5px;">
                    <option value="" data-code="">—— 市 ——</option>
                </select>
                <select id="dist" name="dist" style="width:31%;line-height:25px;font-size:14px;float:left;margin-left:5px;">
                    <option value="" data-code="">—— 区 ——</option>
                </select>
            </div>
        </li>
        <li class="g_input citys" style="margin-top:15px;font-size:16px;float:left">
            <span class="lf">详细地址</span>
            <span class="rt"><input type="text" value="" name="address" placeholder="街道等详细地址确保能收到货"></span>
        </li>
        <li style="border:none;height:60px;text-align:center"><a href="javascript:;" class="subms btn" style="width:90%">立即购买</a>

        </li>
    </ul>
</div>

<script src="{AMOUSE_REBATE_RES}js/distpicker.data.min.a8276dac4366.js"></script>
<script src="{AMOUSE_REBATE_RES}js/distpicker.min.ad9fc6eb4bb4.js"></script>
<input type="hidden" name="alert_type" value="0">
<script>
    $(document).foundation();
    alert_ok = null;
    function new_alert(msg, cb) {
        alert_ok = cb;
        $('#tip .text').html(msg);
        $('#tip').show();
    }
    old_alert = window.alert;
    window.alert = new_alert;
    $('#alert_ok').click(function () {
        if (alert_ok) {
            alert_ok();
        }
        $('#tip').hide();
    });
</script>
<script type="text/javascript">
    var gid = "{$goods['id']}";
    $(function () {
        $("a.subms").click(function () {
            var username = $.trim($('input[name=username]').val());
            if (username == '') {
                alert('请填写真实姓名');
                return;
            }
            var moblie = $.trim($('input[name=moblie]').val());
            if (moblie == '') {
                alert('请填写手机号码');
                return;
            }
            var mobliepreg = /^1[3|4|5|8|7][0-9]\d{8}$/;
            if (!mobliepreg.test($("input[name=moblie]").val())) {
                alert('手机号码有误');
                return;
            }
            var address = $.trim($('input[name=address]').val());
            if (address == '') {
                alert('请填写您的详细街道信息');
                return;
            }
            if($('#id_create_province').val() == ''){
                alert('请设置省份。');
                return false;
            }
            if($('#city').val() == ''){
                alert('请设置城市。');
                return false;
            }
            var province = $("#id_create_province").val();
            var city = $("#city").val();
            var dist = $("#dist").val();
            var buynum = 0;
            if ($('input[name=buynum]').val()) {
                buynum = parseInt($('input[name=buynum]').val());
            }
            var submitData ={
                'username': username,'moblie': moblie, 'gid': gid, 'buynum': buynum,
                'location_p': province,'location_c': city, 'location_d': dist, 'address': address
            };
            $.ajax({
                type : "POST",
                url :"{php echo $this->createMobileUrl('AjaxBuyOrder', array(), true)}",
                data : submitData,
                dataType : "json",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success : function(data){
                    console.log(data);
                    if(data && data.code==200){
                        var oid= data.oid;
                        window.location.href="{php echo $this->createMobileUrl('payment',array(),true)}&orderid="+oid;
                    }else{
                        alert(data.msg);
                        return;
                    }
                },
                error : function(data){
                    alert('网络出错');
                }
            });
        });
        $('#div_region').distpicker({
            province: "",
            city:"",
            district:"",
            autoSelect: false,
        });
        // 编辑购买数量
        $(".addnum").click(function () {
            if (parseInt($('.shownum').val()) > 100) {
                $('.shownum').val(100);
                $('input[name=buynum]').val(100);
            } else {
                $('.shownum').val(parseInt($('.shownum').val()) + 1);
                $('input[name=buynum]').val(parseInt($('.shownum').val()));
            }
        });

        $(".decnum").click(function () {
            if (parseInt($('.shownum').val()) <= 1) {
                $('.shownum').val(1);
                $('input[name=buynum]').val(1);
            } else {
                $('.shownum').val(parseInt($('.shownum').val()) - 1);
                $('input[name=buynum]').val(parseInt($('.shownum').val()));
            }
        });

        $(".shownum").blur(function () {
            var buynum = $(this).val();
            if (parseInt(buynum) > 0) {
                $('input[name=buynum]').val(buynum);
            } else {
                $('input[name=buynum]').val(1);
            }
        });
    })
</script>
</body>
</html>