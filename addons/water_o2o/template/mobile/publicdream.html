{template 'header'}
<body ontouchstart="" class="platform_mobile modal-open">
	<div class="qsc-alert" style="display: none;">
		<i class="info-base64"></i><span id="info"></span>
	</div>
	<div class="modal qsc-modal qsc-modal-loading" id="qsc-modal-loading"
		tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
		aria-hidden="true">
		<div class="modal-dialog middle">
			<div class="modal-content">
				<i class="icon-white icon-loading-base64"><i
					class="icon-white icon-loading-box-base64 icon-spin"></i></i><span>加载中</span>
			</div>
		</div>
	</div>
	<div class="modal qsc-modal qsc-modal-loading"
		id="qsc-modal-loading-new">
		<div class="modal-dialog middle">
			<div class="modal-content">
				<i class="icon-loading-base64"><i
					class="icon-loading-box-base64 icon-spin"></i></i><span>加载中</span>
			</div>
		</div>
	</div>
	<div class="content top bottom">
		<div class="mod-publish-form">
			<form action="{php echo $this->createMobileUrl('doworkadditem')}" class="qsc-form publishForm" name="publishForm"
				id="publishForm" novalidate="novalidate">
				<div id="publishForm-list">
					<div class="mod-publish-list">
						<div class="publish-title">
							<span>服务信息编辑</span>
						</div>
						<div class="want-list-add">
							<ul class="nav nav-tabs" role="tablist">
								<li role="presentation" class="active"><a
									href="#add-list-title" aria-controls="add-list-title"
									data-toggle="tab">服务</a></li>
								<li role="presentation"><a href="#add-list-money"
									aria-controls="add-list-money" data-toggle="tab">金额</a></li>
								<li role="presentation"><a href="#add-list-source"
									aria-controls="add-list-source" data-toggle="tab">其他</a></li>
							</ul>
							<div class="tab-content">
								<div
									class="tab-pane form-group mod-publish-list-group clearfix active"
									id="add-list-title">
									<div class="input-row input-cell">
										<input type="text" id="sname" name="sname" value="{$service['sname']}" class="control-input"
											placeholder="填写服务名称标题">
									</div>
									<div class="input-row input-cell">
										<textarea id="sdesc" name="sdesc" placeholder="填写服务项目简介"
											class="control-input" rows="3">{$service['sdesc']}</textarea>
									</div>
									<div class="input-row input-cell">
										<textarea id="scontent" name="scontent" placeholder="填写服务项目内容"
											class="control-input" rows="3">{$service['scontent']}</textarea>
									</div>									
								</div>
								<div class="tab-pane form-group mod-publish-list-group clearfix"
									id="add-list-source">
									<div class="input-row input-cell">
										<input type="text" id="sreminder" name="sreminder" class="control-input"
											placeholder="温馨提示" value="{$service['sreminder']}">
									</div>
									<div class="input-row input-cell">
										<textarea id="syynotice" name="syynotice" placeholder="预约须知"
											class="control-input" rows="3">{$service['syynotice']}</textarea>
									</div>
								</div>
								<div
									class="tab-pane fade form-group mod-publish-list-group clearfix"
									id="add-list-money">
									<div class="input-row input-cell">
										<input type="number" id="sprice" name="sprice"  class="control-input"
											placeholder="填写服务金额" value="{$service['sprice']}"> <span class="input-group-mb">元</span>
									</div>
									<div class="input-row input-cell">
										<input type="number" id="sminute" name="sminute"  class="control-input"
											placeholder="填写服务时长" value="{$service['sminute']}"> <span class="input-group-mb">分钟</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="input-row input-cell">
						<div id="uploader-100000" class="qsc-uploader clearfix">
							<div class="uploader-list main-images-list" id="fileList">
							</div>
							<div class="webPicPicker webuploader-container">
								<div class="webuploader-pick" onclick="updatewimg()">
									<i class="icon icon-plus"></i>上传图片<br>(最多4张)
								</div>
							
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="input-row lib-options first">
						<input type="hidden" name="defaultstate" value="0"> 
						<input type="checkbox" name="defaultstate" id="defaultstate" value="1">
						<label for="defaultstate" class="radius pull-right"></label>
						<p class="form-control-static publish-help" data-toggle="modal" data-target="#modal-help-userinfo">
							<span>服务上架</span><i class="icon icon-help-sm"></i>
						</p>
					</div>
					<div class="footer-btn">
						<input name="key" value="dream" type="hidden"> 
						<input type="button" name="save-action" onclick="tj()"
							class="btn btn-success btn-lg btn-block" value="发布项目">
					</div>
				</div>
			</form>
		</div>
		<div class="modal qsc-modal" id="modal-help-userinfo" tabindex="-1"
			role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog bottom">
				<div class="modal-content clearfix">
					<div class="modal-header">
						<h4 class="modal-title text-center">正式上线服务</h4>
					</div>
					<div class="modal-body" style="text-align: center;">如果你的服务项目准备完毕可以上线服务，请启用该选项。
					</div>
					<div class="modal-footer">
						<a href="javascript:void(0);" class="btn btn-success btn-block"
							data-dismiss="modal">知道了</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
    <script>
        var appid = '{$_W['account']['jssdkconfig']['appId']}';
        var timestamp = '{$_W['account']['jssdkconfig']['timestamp']}';
        var nonceStr = '{$_W['account']['jssdkconfig']['nonceStr']}';
        var signature = '{$_W['account']['jssdkconfig']['signature']}';

        wx.config({
            debug: false,
            appId: appid,
            timestamp: timestamp,
            nonceStr: nonceStr,
            signature: signature,
            jsApiList: [
                'checkJsApi',
                'getLocation',
                'openLocation',
                'chooseImage',
                'uploadImage',
            ]
        });
        
    	var images = {
    			localId: [],
    			serverId: []
    		};
        
    	function updatewimg () {

    		num = 4;
    		wx.chooseImage({
    			count: num,
    			sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
    			sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
    			success: function (res) {
    				images.localId = res.localIds;
    				var localIds = res.localIds;
    				syncUpload(localIds);
    				//alert('已选择 ' + res.localIds.length + ' 张图片');
    				//doUpload();
    			}
    		});
    		var syncUpload = function(localIds){
    			  var localId = localIds.pop();
    			  var pisnums = 0;
    			  wx.uploadImage({
    			    localId: localId,
    			    isShowProgressTips: 1,
    			    success: function (res) {
    			      var serverId = res.serverId+','; // 返回图片的服务器端ID
	  	    	      $.ajax({
		     	     		 type:'GET',
		     	     		 data:{media_ids:serverId},
		     	     		 url:'{php echo $this->createMobileUrl("Workeruploadpics");}',
		     	     		 success:function(data){
		     	     			  var json = eval("("+data+")");
		     		      	  	  if(json.result == 1){
		     		      	  		var ptitle = '服务图片';
			    			        $("#fileList").append('<div class="WU_FILE_0 file-item thumbnail upload-state-done">'+
			    			    		  '<a class="fancybox" title="图片预览" rel="fancybox" href="'+json.url+'">'+
			    			    		  '<img src="'+json.url+'"></a>'+
			    			    		  '<input name="simgs[]" class="main_files_thumb" value="'+json.nameval+'" type="hidden">'+
			    			    		  '<div class="info">'+ptitle+'</div><div class="file-panel"><span>×</span></div></div>');
		     		       		  }else{
		     		       			 alert('error'); 
		     		       		  }
		     	     		 }
		     	     	 });
    			      
    			      //其他对serverId做处理的代码
    			      if(localIds.length > 0){
    			        syncUpload(localIds);
    			      }
    			    }
    			  });
    		};
    	};
        
    </script>
	
	
	
	
	<script type="text/javascript" src="../addons/water_o2o/template/js/publish.min.js"></script>

<script type="text/javascript">
	function tj(){
		
		 var sname = checksname();
		 if(!sname){
			 tishi('请填写完整服务名称等信息');
			 return false;
		 }
		 var sprice = checksprice();
		 if(!sprice){
			 tishi('请填写完整服务价格');
			 return false;
		 }
		
		 var sminute = checksminute();
		 if(!sminute){
			 tishi('请填写完整服务时长');
			 return false;
		 }
		 
		 
		 
		   $.ajax({
				 type:'POST',
				 data:{sname : $("#sname").val().trim(),sdesc : $("#sdesc").val().trim(),
					   scontent : $("#scontent").val().trim(),syynotice : $("#syynotice").val().trim(),
					   sminute : $("#sminute").val().trim(),sprice : $("#sprice").val().trim(),
					   defaultstate : $("#defaultstate").val().trim(),simgs : $("input[name='simgs']")},
				 url:'{php echo $this->createMobileUrl("Doworkadditem");}',
				 success:function(data){
					  var json = eval("("+data+")");
					  if(json.result == 1){
						  alertToUrl('新增成功',json.url);
					  }else{	 
						  tishi(json.msg);
					  }
				 }
			 });
		
	}
	
	  function alertToUrl(info,url) {
		    tishi(info);
		    setTimeout("window.location.href='" + url + "'", 800);
		  }
	   
	 function checksname(){
			var sname = $("#sname").val();
			if(sname.length < 3){
				 return false;
			}else{
				return true;
			}
	 }
	   
	 function checksminute(){
			var sminute = $("#sminute").val();
			if(sminute.length == 0){
				 return false;
			}else{
				var sminute = !!sminute.match(/^[0-9]*[1-9][0-9]*$/);
				if (sminute) {
					return true;
				}else{
					return false;
				}
			}
	 }
	 
	 
	 function checksprice(){
			var sprice = $("#sprice").val();
			if(sprice.length == 0){
				 return false;
			}else{
				var sprice = !!sprice.match(/^[0-9]*[1-9][0-9]*$/);
				if (sprice) {
					return true;
				}else{
					return false;
				}
			}
	 }
	
	 function tishi(content){
		 $("#info").text(content);
		 $(".qsc-alert").fadeIn(300).delay(1300).fadeOut(700);
	 }
	
	</script>	


</body>
</html>