{template 'header'}
<body ontouchstart="" class="platform_mobile">
	<div class="qsc-alert" style="display: none;">
		<i class="info-base64"></i><span id="info">请完善信息</span>
	</div>
	<div class="modal qsc-modal qsc-modal-loading" id="qsc-modal-loading"
		tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog middle">
			<div class="modal-content">
				<i class="icon-white icon-loading-base64"><i
					class="icon-white icon-loading-box-base64 icon-spin"></i></i><span>加载中</span>
			</div>
		</div>
	</div>
	<div class="modal qsc-modal qsc-modal-loading"
		id="qsc-modal-loading-new">
		<div class="modal-dialog middle">
			<div class="modal-content">
				<i class="icon-loading-base64"><i
					class="icon-loading-box-base64 icon-spin"></i></i><span>加载中</span>
			</div>
		</div>
	</div>
	<div class="content top bottom">
		<form class="qsc-form" method="post" action="" name="addressForm" id="addressForm">
		<input name="shopid" id="shopid" type="hidden" value="{$shopid}">
		<input name="serviceid" id="serviceid" type="hidden" value="{$serviceid}">
		<input name="type" type="hidden" id="type" value="{$type}">
		<input name="fansid" type="hidden" id="fansid" value="{$fans['id']}">
			<div class="input-row">
				<label for="holder" class="control-label">您的姓名</label> <input
					type="text" id="fname" name="fname" class="control-input"
					placeholder="您的姓名" value="{$fans['fname']}">
			</div>
			<div class="input-row">
				<label for="phone" class="control-label">手机号码</label> <input
					type="tel" id="mobile" name="mobile" class="control-input"
					placeholder="输入手机号码" value="{$fans['mobile']}">
			</div>
			<div class="input-row">
				<label for="address" class="control-label">详细地址</label>
				<textarea rows="2" id="address" name="address" class="control-input"
					placeholder="输入详细地址">{$fans['address']}</textarea>
			</div>
			<div class="content-main footer-btn">
				<input type=button name="save-action"
					class="btn btn-success btn-lg btn-block" onclick="tj()" value="保存"> 
			</div>
		</form>
	</div>
		<script type="text/javascript">
	 function tj(){
		 var name = checkname();
		 if(!name){
			 tishi('请填写完整姓名');
			 return false;
		 }
		 var mobile = checkmobile();
		 if(!mobile){
			 tishi('手机号码为11位数字');
			 return false;
		 }
		 var adddress = checkaddress();
		 if(!adddress){
			 tishi('填写详细的地址信息');
			 return false;
		 }
		 
		 var fname = $("#fname").val();
		 var mobile = $("#mobile").val();
		 var address = $("#address").val();
		 var serviceid = $("#serviceid").val();
		 var shopid = $("#shopid").val();
		 var type = $("#type").val();
		 var fansid = $("#fansid").val();
 	     $.ajax({
  	    	type:'POST',
  	    	url:'{php echo $this->createMobileUrl('saveaddress')}',
  	    	data:{fname:fname,mobile:mobile,address:address,fansid:fansid,serviceid:serviceid,shopid:shopid,type:type},
  	    	success:function(data){
  	    		data  = eval("(" + data +")");
  	            if(data.state == "0"){
  	            	tishi('系统繁忙，稍后请重试');
  	            }else{
  	            	window.location.href=data.url;
  	                 
  	            }
  	        }    
  	    });
		 
	 }
	 
	 function checkname(){
			var holder = $("#fname").val();
			if(holder.length < 2){
				 return false;
			}else{
				return true;
			}
	 }
	 
	 
	 function checkmobile(){
			var mobile = $("#mobile").val();
			if(mobile.length != 11){
				 return false;
			}else{
				var mobile = !!mobile.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/);
				if (mobile) {
					return true;
				}else{
					return false;
				}
			}
	 }
	 
	 
	 function checkaddress(){
			var address = $("#address").val();
			if(address.length < 4){
				 return false;
			}else{
				return true;
			}
	 }
	 
	 
	 function tishi(content){
		 $("#info").text(content);
		 $(".qsc-alert").fadeIn(300).delay(1300).fadeOut(700);
	 }
	
	</script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key={$system['gaodekey']}"></script> 
    <script>
        var appid = '{$_W['account']['jssdkconfig']['appId']}';
        var timestamp = '{$_W['account']['jssdkconfig']['timestamp']}';
        var nonceStr = '{$_W['account']['jssdkconfig']['nonceStr']}';
        var signature = '{$_W['account']['jssdkconfig']['signature']}';

        wx.config({
            debug: false,
            appId: appid,
            timestamp: timestamp,
            nonceStr: nonceStr,
            signature: signature,
            jsApiList: [
                'checkJsApi',
                'getLocation',
                'openLocation',
            ]
        });

        wx.ready(function () {
            wx.getLocation({
				type: 'gcj02',
			    success: function (res) {
			        var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
			        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
			        var speed = res.speed; // 速度，以米/每秒计
			        var accuracy = res.accuracy; // 位置精度
			        // 更新用户坐标为实时坐标
					doSynclnglat(longitude,latitude);
			    },
			    fail:function() {
			    	alert('fail');
			    }
			});


        });

        wx.error(function (res) {
        });
        function doSynclnglat(lng,lat){
        	
        	//alert(lng+'---'+lat);
	        AMap.service('AMap.Geocoder',function(){//回调函数
	            //实例化Geocoder
	            geocoder = new AMap.Geocoder({
	                city: "010"//城市，默认：“全国”
	            });
	            //TODO: 使用geocoder 对象完成相关功能
	            var lnglatXY=[lng, lat];//地图上所标点的坐标
	            geocoder.getAddress(lnglatXY, function(status, result) {
	                if (status === 'complete' && result.info === 'OK') {
	                   //获得了有效的地址信息:
	                   var address = result.regeocode.formattedAddress;
	                   $("#address").val(address);
	                }else{
	                   //获取地址失败
	                   alert('稍后再试');
	                }
	            });  
	        });
        }

    </script>
	<script type="text/javascript" src="../addons/water_o2o/template/js/user.min.js"></script>
</body>
</html>