/**
 * 预约下单流程 Controller
 * appointment
 */
//! Zepto v1.1.3
//! 辅助扩展
function k(){}function stopTouchPropagation(t,e){tryClickTrack(t,e),t.stopPropagation(),t.preventDefault(),t.gesture&&t.gesture.preventDefault(),t.gesture&&t.gesture.stopPropagation()}function preventDefault(t){t.preventDefault(),t.gesture&&t.gesture.preventDefault()}function tryClickTrack(t,e){["tap","click"].indexOf(t.type)<0||e&&window.Zepto&&Zepto(e).trackClick()}function property_alias(t,e){for(var i=[].slice.call(arguments,2),n=0,r=i.length;r>n;n++)t[i[n]]=t[e]||null}function json(t){return"string"==typeof t&&(t=JSON.parse(t)),t}(function(t){var e=function(){function t(t){return null==t?String(t):X[U.call(t)]||"object"}function e(e){return"function"==t(e)}function i(t){return null!=t&&t==t.window}function n(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function r(e){return"object"==t(e)}function o(t){return r(t)&&!i(t)&&Object.getPrototypeOf(t)==Object.prototype}function a(t){return!!t&&"number"==typeof t.length}function s(t){return D.call(t,function(t){return null!=t})}function c(t){return t.length>0?x.fn.concat.apply([],t):t}function l(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function u(t){return t in P?P[t]:P[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function d(t,e){return"number"!=typeof e||j[l(t)]?e:e+"px"}function h(t){var e,i;return I[t]||(e=A.createElement(t),A.body.appendChild(e),i=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==i&&(i="block"),I[t]=i),I[t]}function p(t){return"children"in t?$.call(t.children):x.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function f(t,e,i){for(k in e)i&&(o(e[k])||G(e[k]))?(o(e[k])&&!o(t[k])&&(t[k]={}),G(e[k])&&!G(t[k])&&(t[k]=[]),f(t[k],e[k],i)):e[k]!==w&&(t[k]=e[k])}function m(t,e){return null==e?x(t):x(t).filter(e)}function v(t,i,n,r){return e(i)?i.call(t,n,r):i}function g(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}function b(t,e){var i=t.className,n=i&&i.baseVal!==w;return e===w?n?i.baseVal:i:void(n?i.baseVal=e:t.className=e)}function y(t){var e;try{return t?"true"==t||("false"==t?!1:"null"==t?null:/^0/.test(t)||isNaN(e=Number(t))?/^[\[\{]/.test(t)?x.parseJSON(t):t:e):t}catch(i){return t}}function _(t,e){e(t);for(var i=0,n=t.childNodes.length;n>i;i++)_(t.childNodes[i],e)}var w,k,x,S,C,T,E=[],$=E.slice,D=E.filter,A=window.document,I={},P={},j={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},O=/^\s*<(\w+|!)[^>]*>/,M=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,R=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,q=/^(?:body|html)$/i,N=/([A-Z])/g,L=["val","css","html","text","data","width","height","offset"],z=["after","prepend","before","append"],F=A.createElement("table"),B=A.createElement("tr"),V={tr:A.createElement("tbody"),tbody:F,thead:F,tfoot:F,td:B,th:B,"*":A.createElement("div")},H=/complete|loaded|interactive/,Y=/^[\w-]*$/,X={},U=X.toString,W={},Z=A.createElement("div"),J={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},G=Array.isArray||function(t){return t instanceof Array};return W.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var i=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(i)return i.call(t,e);var n,r=t.parentNode,o=!r;return o&&(r=Z).appendChild(t),n=~W.qsa(r,e).indexOf(t),o&&Z.removeChild(t),n},C=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},T=function(t){return D.call(t,function(e,i){return t.indexOf(e)==i})},W.fragment=function(t,e,i){var n,r,a;return M.test(t)&&(n=x(A.createElement(RegExp.$1))),n||(t.replace&&(t=t.replace(R,"<$1></$2>")),e===w&&(e=O.test(t)&&RegExp.$1),e in V||(e="*"),a=V[e],a.innerHTML=""+t,n=x.each($.call(a.childNodes),function(){a.removeChild(this)})),o(i)&&(r=x(n),x.each(i,function(t,e){L.indexOf(t)>-1?r[t](e):r.attr(t,e)})),n},W.Z=function(t,e){return t=t||[],t.__proto__=x.fn,t.selector=e||"",t},W.isZ=function(t){return t instanceof W.Z},W.init=function(t,i){var n;if(!t)return W.Z();if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&O.test(t))n=W.fragment(t,RegExp.$1,i),t=null;else{if(i!==w)return x(i).find(t);n=W.qsa(A,t)}else{if(e(t))return x(A).ready(t);if(W.isZ(t))return t;if(G(t))n=s(t);else if(r(t))n=[t],t=null;else if(O.test(t))n=W.fragment(t.trim(),RegExp.$1,i),t=null;else{if(i!==w)return x(i).find(t);n=W.qsa(A,t)}}return W.Z(n,t)},x=function(t,e){return W.init(t,e)},x.extend=function(t){var e,i=$.call(arguments,1);return"boolean"==typeof t&&(e=t,t=i.shift()),i.forEach(function(i){f(t,i,e)}),t},W.qsa=function(t,e){var i,r="#"==e[0],o=!r&&"."==e[0],a=r||o?e.slice(1):e,s=Y.test(a);return n(t)&&s&&r?(i=t.getElementById(a))?[i]:[]:1!==t.nodeType&&9!==t.nodeType?[]:$.call(s&&!r?o?t.getElementsByClassName(a):t.getElementsByTagName(e):t.querySelectorAll(e))},x.contains=A.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},x.type=t,x.isFunction=e,x.isWindow=i,x.isArray=G,x.isPlainObject=o,x.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},x.inArray=function(t,e,i){return E.indexOf.call(e,t,i)},x.camelCase=C,x.trim=function(t){return null==t?"":String.prototype.trim.call(t)},x.uuid=0,x.support={},x.expr={},x.map=function(t,e){var i,n,r,o=[];if(a(t))for(n=0;n<t.length;n++)i=e(t[n],n),null!=i&&o.push(i);else for(r in t)i=e(t[r],r),null!=i&&o.push(i);return c(o)},x.each=function(t,e){var i,n;if(a(t)){for(i=0;i<t.length;i++)if(e.call(t[i],i,t[i])===!1)return t}else for(n in t)if(e.call(t[n],n,t[n])===!1)return t;return t},x.grep=function(t,e){return D.call(t,e)},window.JSON&&(x.parseJSON=JSON.parse),x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){X["[object "+e+"]"]=e.toLowerCase()}),x.fn={forEach:E.forEach,reduce:E.reduce,push:E.push,sort:E.sort,indexOf:E.indexOf,concat:E.concat,map:function(t){return x(x.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return x($.apply(this,arguments))},ready:function(t){return H.test(A.readyState)&&A.body?t(x):A.addEventListener("DOMContentLoaded",function(){t(x)},!1),this},get:function(t){return t===w?$.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return E.every.call(this,function(e,i){return t.call(e,i,e)!==!1}),this},filter:function(t){return e(t)?this.not(this.not(t)):x(D.call(this,function(e){return W.matches(e,t)}))},add:function(t,e){return x(T(this.concat(x(t,e))))},is:function(t){return this.length>0&&W.matches(this[0],t)},not:function(t){var i=[];if(e(t)&&t.call!==w)this.each(function(e){t.call(this,e)||i.push(this)});else{var n="string"==typeof t?this.filter(t):a(t)&&e(t.item)?$.call(t):x(t);this.forEach(function(t){n.indexOf(t)<0&&i.push(t)})}return x(i)},has:function(t){return this.filter(function(){return r(t)?x.contains(this,t):x(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!r(t)?t:x(t)},last:function(){var t=this[this.length-1];return t&&!r(t)?t:x(t)},find:function(t){var e,i=this;return e=t?"object"==typeof t?x(t).filter(function(){var t=this;return E.some.call(i,function(e){return x.contains(e,t)})}):1==this.length?x(W.qsa(this[0],t)):this.map(function(){return W.qsa(this,t)}):[]},closest:function(t,e){var i=this[0],r=!1;for("object"==typeof t&&(r=x(t));i&&!(r?r.indexOf(i)>=0:W.matches(i,t));)i=i!==e&&!n(i)&&i.parentNode;return x(i)},parents:function(t){for(var e=[],i=this;i.length>0;)i=x.map(i,function(t){return(t=t.parentNode)&&!n(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return m(e,t)},parent:function(t){return m(T(this.pluck("parentNode")),t)},children:function(t){return m(this.map(function(){return p(this)}),t)},contents:function(){return this.map(function(){return $.call(this.childNodes)})},siblings:function(t){return m(this.map(function(t,e){return D.call(p(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return x.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=h(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var i=e(t);if(this[0]&&!i)var n=x(t).get(0),r=n.parentNode||this.length>1;return this.each(function(e){x(this).wrapAll(i?t.call(this,e):r?n.cloneNode(!0):n)})},wrapAll:function(t){if(this[0]){x(this[0]).before(t=x(t));for(var e;(e=t.children()).length;)t=e.first();x(t).append(this)}return this},wrapInner:function(t){var i=e(t);return this.each(function(e){var n=x(this),r=n.contents(),o=i?t.call(this,e):t;r.length?r.wrapAll(o):n.append(o)})},unwrap:function(){return this.parent().each(function(){x(this).replaceWith(x(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var e=x(this);(t===w?"none"==e.css("display"):t)?e.show():e.hide()})},prev:function(t){return x(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return x(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;x(this).empty().append(v(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var i=v(this,t,e,this.textContent);this.textContent=null==i?"":""+i}):0 in this?this[0].textContent:null},attr:function(t,e){var i;return"string"!=typeof t||1 in arguments?this.each(function(i){if(1===this.nodeType)if(r(t))for(k in t)g(this,k,t[k]);else g(this,t,v(this,e,i,this.getAttribute(t)))}):this.length&&1===this[0].nodeType?!(i=this[0].getAttribute(t))&&t in this[0]?this[0][t]:i:w},removeAttr:function(t){return this.each(function(){1===this.nodeType&&g(this,t)})},prop:function(t,e){return t=J[t]||t,1 in arguments?this.each(function(i){this[t]=v(this,e,i,this[t])}):this[0]&&this[0][t]},data:function(t,e){var i="data-"+t.replace(N,"-$1").toLowerCase(),n=1 in arguments?this.attr(i,e):this.attr(i);return null!==n?y(n):w},val:function(t){return 0 in arguments?this.each(function(e){this.value=v(this,t,e,this.value)}):this[0]&&(this[0].multiple?x(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each(function(e){var i=x(this),n=v(this,t,e,i.offset()),r=i.offsetParent().offset(),o={top:n.top-r.top,left:n.left-r.left};"static"==i.css("position")&&(o.position="relative"),i.css(o)});if(!this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(e,i){if(arguments.length<2){var n=this[0],r=getComputedStyle(n,"");if(!n)return;if("string"==typeof e)return n.style[C(e)]||r.getPropertyValue(e);if(G(e)){var o={};return x.each(G(e)?e:[e],function(t,e){o[e]=n.style[C(e)]||r.getPropertyValue(e)}),o}}var a="";if("string"==t(e))i||0===i?a=l(e)+":"+d(e,i):this.each(function(){this.style.removeProperty(l(e))});else for(k in e)e[k]||0===e[k]?a+=l(k)+":"+d(k,e[k])+";":this.each(function(){this.style.removeProperty(l(k))});return this.each(function(){this.style.cssText+=";"+a})},index:function(t){return t?this.indexOf(x(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return t?E.some.call(this,function(t){return this.test(b(t))},u(t)):!1},addClass:function(t){return t?this.each(function(e){S=[];var i=b(this),n=v(this,t,e,i);n.split(/\s+/g).forEach(function(t){x(this).hasClass(t)||S.push(t)},this),S.length&&b(this,i+(i?" ":"")+S.join(" "))}):this},removeClass:function(t){return this.each(function(e){return t===w?b(this,""):(S=b(this),v(this,t,e,S).split(/\s+/g).forEach(function(t){S=S.replace(u(t)," ")}),void b(this,S.trim()))})},toggleClass:function(t,e){return t?this.each(function(i){var n=x(this),r=v(this,t,i,b(this));r.split(/\s+/g).forEach(function(t){(e===w?!n.hasClass(t):e)?n.addClass(t):n.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var e="scrollTop"in this[0];return t===w?e?this[0].scrollTop:this[0].pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var e="scrollLeft"in this[0];return t===w?e?this[0].scrollLeft:this[0].pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),n=q.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(x(t).css("margin-top"))||0,i.left-=parseFloat(x(t).css("margin-left"))||0,n.top+=parseFloat(x(e[0]).css("border-top-width"))||0,n.left+=parseFloat(x(e[0]).css("border-left-width"))||0,{top:i.top-n.top,left:i.left-n.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||A.body;t&&!q.test(t.nodeName)&&"static"==x(t).css("position");)t=t.offsetParent;return t})}},x.fn.detach=x.fn.remove,["width","height"].forEach(function(t){var e=t.replace(/./,function(t){return t[0].toUpperCase()});x.fn[t]=function(r){var o,a=this[0];return r===w?i(a)?a["inner"+e]:n(a)?a.documentElement["scroll"+e]:(o=this.offset())&&o[t]:this.each(function(e){a=x(this),a.css(t,v(this,r,e,a[t]()))})}}),z.forEach(function(e,i){var n=i%2;x.fn[e]=function(){var e,r,o=x.map(arguments,function(i){return e=t(i),"object"==e||"array"==e||null==i?i:W.fragment(i)}),a=this.length>1;return o.length<1?this:this.each(function(t,e){r=n?e:e.parentNode,e=0==i?e.nextSibling:1==i?e.firstChild:2==i?e:null;var s=x.contains(A.documentElement,r);o.forEach(function(t){if(a)t=t.cloneNode(!0);else if(!r)return x(t).remove();r.insertBefore(t,e),s&&_(t,function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},x.fn[n?e+"To":"insert"+(i?"Before":"After")]=function(t){return x(t)[e](this),this}}),W.Z.prototype=x.fn,W.uniq=T,W.deserializeValue=y,x.zepto=W,x}();!function(t){function e(t){return t._zid||(t._zid=h++)}function i(t,i,o,a){if(i=n(i),i.ns)var s=r(i.ns);return(v[e(t)]||[]).filter(function(t){return!(!t||i.e&&t.e!=i.e||i.ns&&!s.test(t.ns)||o&&e(t.fn)!==e(o)||a&&t.sel!=a)})}function n(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function r(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function o(t,e){return t.del&&!b&&t.e in y||!!e}function a(t){return _[t]||b&&y[t]||t}function s(i,r,s,c,u,h,p){var f=e(i),m=v[f]||(v[f]=[]);r.split(/\s/).forEach(function(e){if("ready"==e)return t(document).ready(s);var r=n(e);r.fn=s,r.sel=u,r.e in _&&(s=function(e){var i=e.relatedTarget;return!i||i!==this&&!t.contains(this,i)?r.fn.apply(this,arguments):void 0}),r.del=h;var f=h||s;r.proxy=function(t){if(t=l(t),!t.isImmediatePropagationStopped()){t.data=c;var e=f.apply(i,t._args==d?[t]:[t].concat(t._args));return e===!1&&(t.preventDefault(),t.stopPropagation()),e}},r.i=m.length,m.push(r),"addEventListener"in i&&i.addEventListener(a(r.e),r.proxy,o(r,p))})}function c(t,n,r,s,c){var l=e(t);(n||"").split(/\s/).forEach(function(e){i(t,e,r,s).forEach(function(e){delete v[l][e.i],"removeEventListener"in t&&t.removeEventListener(a(e.e),e.proxy,o(e,c))})})}function l(e,i){return(i||!e.isDefaultPrevented)&&(i||(i=e),t.each(S,function(t,n){var r=i[t];e[t]=function(){return this[n]=w,r&&r.apply(i,arguments)},e[n]=k}),(i.defaultPrevented!==d?i.defaultPrevented:"returnValue"in i?i.returnValue===!1:i.getPreventDefault&&i.getPreventDefault())&&(e.isDefaultPrevented=w)),e}function u(t){var e,i={originalEvent:t};for(e in t)x.test(e)||t[e]===d||(i[e]=t[e]);return l(i,t)}var d,h=1,p=Array.prototype.slice,f=t.isFunction,m=function(t){return"string"==typeof t},v={},g={},b="onfocusin"in window,y={focus:"focusin",blur:"focusout"},_={mouseenter:"mouseover",mouseleave:"mouseout"};g.click=g.mousedown=g.mouseup=g.mousemove="MouseEvents",t.event={add:s,remove:c},t.proxy=function(i,n){var r=2 in arguments&&p.call(arguments,2);if(f(i)){var o=function(){return i.apply(n,r?r.concat(p.call(arguments)):arguments)};return o._zid=e(i),o}if(m(n))return r?(r.unshift(i[n],i),t.proxy.apply(null,r)):t.proxy(i[n],i);throw new TypeError("expected function")},t.fn.bind=function(t,e,i){return this.on(t,e,i)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,i,n){return this.on(t,e,i,n,1)};var w=function(){return!0},k=function(){return!1},x=/^([A-Z]|returnValue$|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(t,e,i){return this.on(e,t,i)},t.fn.undelegate=function(t,e,i){return this.off(e,t,i)},t.fn.live=function(e,i){return t(document.body).delegate(this.selector,e,i),this},t.fn.die=function(e,i){return t(document.body).undelegate(this.selector,e,i),this},t.fn.on=function(e,i,n,r,o){var a,l,h=this;return e&&!m(e)?(t.each(e,function(t,e){h.on(t,i,n,e,o)}),h):(m(i)||f(r)||r===!1||(r=n,n=i,i=d),(f(n)||n===!1)&&(r=n,n=d),r===!1&&(r=k),h.each(function(d,h){o&&(a=function(t){return c(h,t.type,r),r.apply(this,arguments)}),i&&(l=function(e){var n,o=t(e.target).closest(i,h).get(0);return o&&o!==h?(n=t.extend(u(e),{currentTarget:o,liveFired:h}),(a||r).apply(o,[n].concat(p.call(arguments,1)))):void 0}),s(h,e,r,n,i,l||a)}))},t.fn.off=function(e,i,n){var r=this;return e&&!m(e)?(t.each(e,function(t,e){r.off(t,i,e)}),r):(m(i)||f(n)||n===!1||(n=i,i=d),n===!1&&(n=k),r.each(function(){c(this,e,n,i)}))},t.fn.trigger=function(e,i){return e=m(e)||t.isPlainObject(e)?t.Event(e):l(e),e._args=i,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,i)})},t.fn.triggerHandler=function(e,n){var r,o;return this.each(function(a,s){r=u(m(e)?t.Event(e):e),r._args=n,r.target=s,t.each(i(s,e.type||e),function(t,e){return o=e.proxy(r),r.isImmediatePropagationStopped()?!1:void 0})}),o},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),["focus","blur"].forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.each(function(){try{this[e]()}catch(t){}}),this}}),t.Event=function(t,e){m(t)||(e=t,t=e.type);var i=document.createEvent(g[t]||"Events"),n=!0;if(e)for(var r in e)"bubbles"==r?n=!!e[r]:i[r]=e[r];return i.initEvent(t,n,!0),l(i)}}(e),function(t){function e(e,i,n){var r=t.Event(i);return t(e).trigger(r,n),!r.isDefaultPrevented()}function i(t,i,n,r){return t.global?e(i||b,n,r):void 0}function n(e){void 0!==e.loading&&window.DD&&window.DD.loading(e.loading),e.global&&0===t.active++&&i(e,null,"ajaxStart")}function r(e){void 0!==e.loading&&window.DD&&window.DD.loadend(),e.global&&!--t.active&&i(e,null,"ajaxStop")}function o(t,e){var n=e.context;return e.beforeSend.call(n,t,e)===!1||i(e,n,"ajaxBeforeSend",[t,e])===!1?!1:void i(e,n,"ajaxSend",[t,e])}function a(t,e,n,r){var o=n.context,a="success";n.success.call(o,t,a,e),r&&r.resolveWith(o,[t,a,e]),i(n,o,"ajaxSuccess",[e,n,t]),c(a,e,n)}function s(t,e,n,r,o){var a=r.context;r.error.call(a,n,e,t),o&&o.rejectWith(a,[n,e,t]),i(r,a,"ajaxError",[n,r,t||e]),c(e,n,r)}function c(t,e,n){var o=n.context;n.complete.call(o,e,t),i(n,o,"ajaxComplete",[e,n]),r(n)}function l(){}function u(t){return t&&(t=t.split(";",2)[0]),t&&(t==x?"html":t==k?"json":_.test(t)?"script":w.test(t)&&"xml")||"text"}function d(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function h(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=d(e.url,e.data),e.data=void 0)}function p(e,i,n,r){return t.isFunction(i)&&(r=n,n=i,i=void 0),t.isFunction(n)||(r=n,n=void 0),{url:e,data:i,success:n,dataType:r}}function f(e,i,n,r){var o,a=t.isArray(i),s=t.isPlainObject(i);t.each(i,function(i,c){o=t.type(c),r&&(i=n?r:r+"["+(s||"object"==o||"array"==o?i:"")+"]"),!r&&a?e.add(c.name,c.value):"array"==o||!n&&"object"==o?f(e,c,n,i):e.add(i,c)})}var m,v,g=0,b=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,_=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,k="application/json",x="text/html",S=/^\s*$/;t.active=0,t.ajaxJSONP=function(e,i){if(!("type"in e))return t.ajax(e);var n,r,c=e.jsonpCallback,l=(t.isFunction(c)?c():c)||"jsonp"+ ++g,u=b.createElement("script"),d=window[l],h=function(e){t(u).triggerHandler("error",e||"abort")},p={abort:h};return i&&i.promise(p),t(u).on("load error",function(o,c){clearTimeout(r),t(u).off().remove(),"error"!=o.type&&n?a(n[0],p,e,i):s(null,c||"error",p,e,i),window[l]=d,n&&t.isFunction(d)&&d(n[0]),d=n=void 0}),o(p,e)===!1?(h("abort"),p):(window[l]=function(){n=arguments},u.src=e.url.replace(/\?(.+)=\?/,"?$1="+l),b.head.appendChild(u),e.timeout>0&&(r=setTimeout(function(){h("timeout")},e.timeout)),p)},t.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:k,xml:"application/xml, text/xml",html:x,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},t.ajax=function(e){var i=t.extend({},e||{}),r=t.Deferred&&t.Deferred();for(m in t.ajaxSettings)void 0===i[m]&&(i[m]=t.ajaxSettings[m]);n(i),i.crossDomain||(i.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(i.url)&&RegExp.$2!=window.location.host),i.url||(i.url=window.location.toString()),h(i);var c=i.dataType,p=/\?.+=\?/.test(i.url);if(p&&(c="jsonp"),i.cache!==!1&&(e&&e.cache===!0||"script"!=c&&"jsonp"!=c)||(i.url=d(i.url,"_="+Date.now())),"jsonp"==c)return p||(i.url=d(i.url,i.jsonp?i.jsonp+"=?":i.jsonp===!1?"":"callback=?")),t.ajaxJSONP(i,r);var f,g=i.accepts[c],b={},y=function(t,e){b[t.toLowerCase()]=[t,e]},_=/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol,w=i.xhr(),k=w.setRequestHeader;if(r&&r.promise(w),i.crossDomain||y("X-Requested-With","XMLHttpRequest"),y("Accept",g||"*/*"),(g=i.mimeType||g)&&(g.indexOf(",")>-1&&(g=g.split(",",2)[0]),w.overrideMimeType&&w.overrideMimeType(g)),(i.contentType||i.contentType!==!1&&i.data&&"GET"!=i.type.toUpperCase())&&y("Content-Type",i.contentType||"application/x-www-form-urlencoded"),i.headers)for(v in i.headers)y(v,i.headers[v]);if(w.setRequestHeader=y,w.onreadystatechange=function(){if(4==w.readyState){w.onreadystatechange=l,clearTimeout(f);var e,n=!1;if(w.status>=200&&w.status<300||304==w.status||0==w.status&&"file:"==_){c=c||u(i.mimeType||w.getResponseHeader("content-type")),e=w.responseText;try{"script"==c?(1,eval)(e):"xml"==c?e=w.responseXML:"json"==c&&(e=S.test(e)?null:t.parseJSON(e))}catch(o){n=o}n?s(n,"parsererror",w,i,r):a(e,w,i,r)}else s(w.statusText||null,w.status?"error":"abort",w,i,r)}},o(w,i)===!1)return w.abort(),s(null,"abort",w,i,r),w;if(i.xhrFields)for(v in i.xhrFields)w[v]=i.xhrFields[v];var x="async"in i?i.async:!0;w.open(i.type,i.url,x,i.username,i.password);for(v in b)k.apply(w,b[v]);return i.timeout>0&&(f=setTimeout(function(){w.onreadystatechange=l,w.abort(),s(null,"timeout",w,i,r)},i.timeout)),w.send(i.data?i.data:null),w},t.get=function(){return t.ajax(p.apply(null,arguments))},t.post=function(){var e=p.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=p.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,i,n){if(!this.length)return this;var r,o=this,a=e.split(/\s/),s=p(e,i,n),c=s.success;return a.length>1&&(s.url=a[0],r=a[1]),s.success=function(e){o.html(r?t("<div>").html(e.replace(y,"")).find(r):e),c&&c.apply(o,arguments)},t.ajax(s),this};var C=encodeURIComponent;t.param=function(t,e){var i=[];return i.add=function(t,e){this.push(C(t)+"="+C(e))},f(i,t,e),i.join("&").replace(/%20/g,"+")}}(e),function(t){t.fn.serializeArray=function(){var e,i=[];return t([].slice.call(this.get(0).elements)).each(function(){e=t(this);var n=e.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&("radio"!=n&&"checkbox"!=n||this.checked)&&i.push({name:e.attr("name"),value:e.val()})}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(e)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(e),function(t){"__proto__"in{}||t.extend(t.zepto,{Z:function(e,i){return e=e||[],t.extend(e,t.fn),e.selector=i||"",e.__Z=!0,e},isZ:function(e){return"array"===t.type(e)&&"__Z"in e}});try{getComputedStyle(void 0)}catch(e){var i=getComputedStyle;window.getComputedStyle=function(t){try{return i(t)}catch(e){return null}}}}(e),function(t){t&&(t.fn.prevAll=function(e){for(var e=t(this),i=[];;){if(e=e.prev(),!e.size())break;i.push(e[0])}return t(i)},t.fn.nextAll=function(e){for(var e=t(this),i=[];;){if(e=e.next(),!e.size())break;i.push(e[0])}return t(i)},t.fn.removeRegClass=function(t,e){return e=this.attr("class").replace(t,""),this.attr("class",e),this})}(e),function(t){function e(t){var e=this.os={},i=this.browser={},n=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),r=t.match(/(Android);?[\s\/]+([\d.]+)?/),o=!!t.match(/\(Macintosh\; Intel /),a=t.match(/(iPad).*OS\s([\d_]+)/),s=t.match(/(iPod)(.*OS\s([\d_]+))?/),c=!a&&t.match(/(iPhone\sOS)\s([\d_]+)/),l=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),u=t.match(/Windows Phone ([\d.]+)/),d=l&&t.match(/TouchPad/),h=t.match(/Kindle\/([\d.]+)/),p=t.match(/Silk\/([\d._]+)/),f=t.match(/(BlackBerry).*Version\/([\d.]+)/),m=t.match(/(BB10).*Version\/([\d.]+)/),v=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),g=t.match(/PlayBook/),b=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),y=t.match(/Firefox\/([\d.]+)/),_=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),w=!b&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),k=w||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(i.webkit=!!n)&&(i.version=n[1]),r&&(e.android=!0,e.version=r[2]),c&&!s&&(e.ios=e.iphone=!0,e.version=c[2].replace(/_/g,".")),a&&(e.ios=e.ipad=!0,e.version=a[2].replace(/_/g,".")),s&&(e.ios=e.ipod=!0,e.version=s[3]?s[3].replace(/_/g,"."):null),u&&(e.wp=!0,e.version=u[1]),l&&(e.webos=!0,e.version=l[2]),d&&(e.touchpad=!0),f&&(e.blackberry=!0,e.version=f[2]),m&&(e.bb10=!0,e.version=m[2]),v&&(e.rimtabletos=!0,e.version=v[2]),g&&(i.playbook=!0),h&&(e.kindle=!0,e.version=h[1]),p&&(i.silk=!0,i.version=p[1]),!p&&e.android&&t.match(/Kindle Fire/)&&(i.silk=!0),b&&(i.chrome=!0,i.version=b[1]),y&&(i.firefox=!0,i.version=y[1]),_&&(i.ie=!0,i.version=_[1]),k&&(o||e.ios)&&(i.safari=!0,o&&(i.version=k[1])),w&&(i.webview=!0),e.tablet=!!(a||g||r&&!t.match(/Mobile/)||y&&t.match(/Tablet/)||_&&!t.match(/Phone/)&&t.match(/Touch/)),e.phone=!(e.tablet||e.ipod||!(r||c||l||f||m||b&&t.match(/Android/)||b&&t.match(/CriOS\/([\d.]+)/)||y&&t.match(/Mobile/)||_&&t.match(/Touch/)))}e.call(t,navigator.userAgent),t.__detect=e}(e),function(e){function i(i,r){var l=i[c],u=l&&o[l];if(r===t)return u||n(i);if(u){if(r in u)return u[r];var d=s(r);if(d in u)return u[d]}return a.call(e(i),r)}function n(i,n,a){var l=i[c]||(i[c]=++e.uuid),u=o[l]||(o[l]=r(i));return n!==t&&(u[s(n)]=a),u}function r(t){var i={};return e.each(t.attributes||l,function(t,n){0==n.name.indexOf("data-")&&(i[s(n.name.replace("data-",""))]=e.zepto.deserializeValue(n.value))}),i}var o={},a=e.fn.data,s=e.camelCase,c=e.expando="Zepto"+ +new Date,l=[];e.fn.data=function(r,o){return o===t?e.isPlainObject(r)?this.each(function(t,i){e.each(r,function(t,e){n(i,t,e)})}):0 in this?i(this[0],r):t:this.each(function(){n(this,r,o)})},e.fn.removeData=function(t){return"string"==typeof t&&(t=t.split(/\s+/)),this.each(function(){var i=this[c],n=i&&o[i];n&&e.each(t||n,function(e){delete n[t?s(this):e]})})},["remove","empty"].forEach(function(t){var i=e.fn[t];e.fn[t]=function(){var e=this.find("*");return"remove"===t&&(e=e.add(this)),e.removeData(),i.call(this)}})}(e),function(t,e){function i(t){return t.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()}function n(t){return r?r+t:t.toLowerCase()}var r,o,a,s,c,l,u,d,h,p,f="",m={Webkit:"webkit",Moz:"",O:"o"},v=window.document,g=v.createElement("div"),b=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,y={};t.each(m,function(t,i){return g.style[t+"TransitionProperty"]!==e?(f="-"+t.toLowerCase()+"-",r=i,!1):void 0}),o=f+"transform",y[a=f+"transition-property"]=y[s=f+"transition-duration"]=y[l=f+"transition-delay"]=y[c=f+"transition-timing-function"]=y[u=f+"animation-name"]=y[d=f+"animation-duration"]=y[p=f+"animation-delay"]=y[h=f+"animation-timing-function"]="",t.fx={off:r===e&&g.style.transitionProperty===e,speeds:{_default:400,fast:200,slow:600},cssPrefix:f,transitionEnd:n("TransitionEnd"),animationEnd:n("AnimationEnd")},t.fn.animate=function(i,n,r,o,a){return t.isFunction(n)&&(o=n,r=e,n=e),t.isFunction(r)&&(o=r,r=e),t.isPlainObject(n)&&(r=n.easing,o=n.complete,a=n.delay,n=n.duration),n&&(n=("number"==typeof n?n:t.fx.speeds[n]||t.fx.speeds._default)/1e3),a&&(a=parseFloat(a)/1e3),this.anim(i,n,r,o,a)},t.fn.stop=function(){return this.trigger(t.fx.transitionEnd)},t.fn.anim=function(n,r,f,m,v){var g,_,w,k={},x="",S=this,C=t.fx.transitionEnd,T=!1;if(r===e&&(r=t.fx.speeds._default/1e3),v===e&&(v=0),t.fx.off&&(r=0),"string"==typeof n)k[u]=n,k[d]=r+"s",k[p]=v+"s",k[h]=f||"linear",C=t.fx.animationEnd;else{_=[];for(g in n)b.test(g)?x+=g+"("+n[g]+") ":(k[g]=n[g],_.push(i(g)));x&&(k[o]=x,_.push(o)),r>0&&"object"==typeof n&&(k[a]=_.join(", "),k[s]=r+"s",k[l]=v+"s",k[c]=f||"linear")}return w=function(e){if("undefined"!=typeof e){if(e.target!==e.currentTarget)return;t(e.target).unbind(C,w)}else t(this).unbind(C,w);T=!0,t(this).css(y),m&&m.call(this)},r>0&&(this.bind(C,w),setTimeout(function(){T||w.call(S)},1e3*r+25)),this.size()&&this.get(0).clientLeft,this.css(k),0>=r&&setTimeout(function(){S.each(function(){w.call(this)})},0),this},g=null}(e),function(e){function i(t,e,i,n){return Math.abs(t-e)>=Math.abs(i-n)?t-e>0?"Left":"Right":i-n>0?"Up":"Down"}function n(){d=null,p.last&&p.el.trigger("longTap")}function r(){d&&clearTimeout(d),d=null}function o(){c&&clearTimeout(c),l&&clearTimeout(l),u&&clearTimeout(u),d&&clearTimeout(d),c=l=u=d=null,p={}}function a(t){return("touch"==t.pointerType||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function s(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}var c,l,u,d,h,p={},f=750;e(document).ready(function(){var m,v,g,b,y=0,_=0;"MSGesture"in window&&(h=new MSGesture,h.target=document.body),e(document).bind("MSGestureEnd",function(t){var e=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;e&&(p.el.trigger("swipe"),p.el.trigger("swipe"+e))}).on("touchstart MSPointerDown pointerdown",function(i){(!(b=s(i,"down"))||a(i))&&(g=b?i:i.touches[0],i.touches&&1===i.touches.length&&p.x2&&(p.x2=t,p.y2=t),m=Date.now(),v=m-(p.last||m),p.el=e("tagName"in g.target?g.target:g.target.parentNode),c&&clearTimeout(c),p.x1=g.pageX,p.y1=g.pageY,v>0&&250>=v&&(p.isDoubleTap=!0),p.last=m,d=setTimeout(n,f),h&&b&&h.addPointer(i.pointerId))}).on("touchmove MSPointerMove pointermove",function(t){(!(b=s(t,"move"))||a(t))&&(g=b?t:t.touches[0],
r(),p.x2=g.pageX,p.y2=g.pageY,y+=Math.abs(p.x1-p.x2),_+=Math.abs(p.y1-p.y2))}).on("touchend MSPointerUp pointerup",function(t){(!(b=s(t,"up"))||a(t))&&(r(),p.x2&&Math.abs(p.x1-p.x2)>30||p.y2&&Math.abs(p.y1-p.y2)>30?u=setTimeout(function(){p.el.trigger("swipe"),p.el.trigger("swipe"+i(p.x1,p.x2,p.y1,p.y2)),p={}},0):"last"in p&&(30>y&&30>_?l=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=o,p.el.trigger(t),p.isDoubleTap?(p.el&&p.el.trigger("doubleTap"),p={}):c=setTimeout(function(){c=null,p.el&&p.el.trigger("singleTap"),p={}},250)},0):p={}),y=_=0)}).on("touchcancel MSPointerCancel pointercancel",o),e(window).on("scroll",o)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}})}(e),function(t,e){function i(i,n,r,o,a){"function"!=typeof n||a||(a=n,n=e);var s={opacity:r};return o&&(s.scale=o,i.css(t.fx.cssPrefix+"transform-origin","0 0")),i.animate(s,n,null,a)}function n(e,n,r,o){return i(e,n,0,r,function(){a.call(t(this)),o&&o.call(this)})}var r=window.document,o=(r.documentElement,t.fn.show),a=t.fn.hide,s=t.fn.toggle;t.fn.show=function(t,n){return o.call(this),t===e?t=0:this.css("opacity",0),i(this,t,1,"1,1",n)},t.fn.hide=function(t,i){return t===e?a.call(this):n(this,t,"0,0",i)},t.fn.toggle=function(i,n){return i===e||"boolean"==typeof i?s.call(this,i):this.each(function(){var e=t(this);e["none"==e.css("display")?"show":"hide"](i,n)})},t.fn.fadeTo=function(t,e,n){return i(this,t,e,null,n)},t.fn.fadeIn=function(t,e){var i=this.css("opacity");return i>0?this.css("opacity",0):i=1,o.call(this).fadeTo(t,i,e)},t.fn.fadeOut=function(t,e){return n(this,t,null,e)},t.fn.fadeToggle=function(e,i){return this.each(function(){var n=t(this);n[0==n.css("opacity")||"none"==n.css("display")?"fadeIn":"fadeOut"](e,i)})}}(e),"function"==typeof define&&define.amd&&define("zepto",[],function(){return e}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Zepto=e):this.Zepto=e}).call(this),
//! Underscore.js 1.7.0
function(){var t=this,e=t._,i=Array.prototype,n=Object.prototype,r=Function.prototype,o=i.push,a=i.slice,s=i.concat,c=n.toString,l=n.hasOwnProperty,u=Array.isArray,d=Object.keys,h=r.bind,p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):t._=p,p.VERSION="1.7.0";var f=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)}}return function(){return t.apply(e,arguments)}};p.iteratee=function(t,e,i){return null==t?p.identity:p.isFunction(t)?f(t,e,i):p.isObject(t)?p.matches(t):p.property(t)},p.each=p.forEach=function(t,e,i){if(null==t)return t;e=f(e,i);var n,r=t.length;if(r===+r)for(n=0;r>n;n++)e(t[n],n,t);else{var o=p.keys(t);for(n=0,r=o.length;r>n;n++)e(t[o[n]],o[n],t)}return t},p.map=p.collect=function(t,e,i){if(null==t)return[];e=p.iteratee(e,i);for(var n,r=t.length!==+t.length&&p.keys(t),o=(r||t).length,a=Array(o),s=0;o>s;s++)n=r?r[s]:s,a[s]=e(t[n],n,t);return a};var m="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(t,e,i,n){null==t&&(t=[]),e=f(e,n,4);var r,o=t.length!==+t.length&&p.keys(t),a=(o||t).length,s=0;if(arguments.length<3){if(!a)throw new TypeError(m);i=t[o?o[s++]:s++]}for(;a>s;s++)r=o?o[s]:s,i=e(i,t[r],r,t);return i},p.reduceRight=p.foldr=function(t,e,i,n){null==t&&(t=[]),e=f(e,n,4);var r,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;if(arguments.length<3){if(!a)throw new TypeError(m);i=t[o?o[--a]:--a]}for(;a--;)r=o?o[a]:a,i=e(i,t[r],r,t);return i},p.find=p.detect=function(t,e,i){var n;return e=p.iteratee(e,i),p.some(t,function(t,i,r){return e(t,i,r)?(n=t,!0):void 0}),n},p.filter=p.select=function(t,e,i){var n=[];return null==t?n:(e=p.iteratee(e,i),p.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n)},p.reject=function(t,e,i){return p.filter(t,p.negate(p.iteratee(e)),i)},p.every=p.all=function(t,e,i){if(null==t)return!0;e=p.iteratee(e,i);var n,r,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;for(n=0;a>n;n++)if(r=o?o[n]:n,!e(t[r],r,t))return!1;return!0},p.some=p.any=function(t,e,i){if(null==t)return!1;e=p.iteratee(e,i);var n,r,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;for(n=0;a>n;n++)if(r=o?o[n]:n,e(t[r],r,t))return!0;return!1},p.contains=p.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=p.values(t)),p.indexOf(t,e)>=0)},p.invoke=function(t,e){var i=a.call(arguments,2),n=p.isFunction(e);return p.map(t,function(t){return(n?e:t[e]).apply(t,i)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matches(e))},p.findWhere=function(t,e){return p.find(t,p.matches(e))},p.max=function(t,e,i){var n,r,o=-(1/0),a=-(1/0);if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var s=0,c=t.length;c>s;s++)n=t[s],n>o&&(o=n)}else e=p.iteratee(e,i),p.each(t,function(t,i,n){r=e(t,i,n),(r>a||r===-(1/0)&&o===-(1/0))&&(o=t,a=r)});return o},p.min=function(t,e,i){var n,r,o=1/0,a=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var s=0,c=t.length;c>s;s++)n=t[s],o>n&&(o=n)}else e=p.iteratee(e,i),p.each(t,function(t,i,n){r=e(t,i,n),(a>r||r===1/0&&o===1/0)&&(o=t,a=r)});return o},p.shuffle=function(t){for(var e,i=t&&t.length===+t.length?t:p.values(t),n=i.length,r=Array(n),o=0;n>o;o++)e=p.random(0,o),e!==o&&(r[o]=r[e]),r[e]=i[o];return r},p.sample=function(t,e,i){return null==e||i?(t.length!==+t.length&&(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,e,i){return e=p.iteratee(e,i),p.pluck(p.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var v=function(t){return function(e,i,n){var r={};return i=p.iteratee(i,n),p.each(e,function(n,o){var a=i(n,o,e);t(r,n,a)}),r}};p.groupBy=v(function(t,e,i){p.has(t,i)?t[i].push(e):t[i]=[e]}),p.indexBy=v(function(t,e,i){t[i]=e}),p.countBy=v(function(t,e,i){p.has(t,i)?t[i]++:t[i]=1}),p.sortedIndex=function(t,e,i,n){i=p.iteratee(i,n,1);for(var r=i(e),o=0,a=t.length;a>o;){var s=o+a>>>1;i(t[s])<r?o=s+1:a=s}return o},p.toArray=function(t){return t?p.isArray(t)?a.call(t):t.length===+t.length?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:t.length===+t.length?t.length:p.keys(t).length},p.partition=function(t,e,i){e=p.iteratee(e,i);var n=[],r=[];return p.each(t,function(t,i,o){(e(t,i,o)?n:r).push(t)}),[n,r]},p.first=p.head=p.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:0>e?[]:a.call(t,0,e)},p.initial=function(t,e,i){return a.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},p.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},p.rest=p.tail=p.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},p.compact=function(t){return p.filter(t,p.identity)};var g=function(t,e,i,n){if(e&&p.every(t,p.isArray))return s.apply(n,t);for(var r=0,a=t.length;a>r;r++){var c=t[r];p.isArray(c)||p.isArguments(c)?e?o.apply(n,c):g(c,e,i,n):i||n.push(c)}return n};p.flatten=function(t,e){return g(t,e,!1,[])},p.without=function(t){return p.difference(t,a.call(arguments,1))},p.uniq=p.unique=function(t,e,i,n){if(null==t)return[];p.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=p.iteratee(i,n));for(var r=[],o=[],a=0,s=t.length;s>a;a++){var c=t[a];if(e)a&&o===c||r.push(c),o=c;else if(i){var l=i(c,a,t);p.indexOf(o,l)<0&&(o.push(l),r.push(c))}else p.indexOf(r,c)<0&&r.push(c)}return r},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(t){if(null==t)return[];for(var e=[],i=arguments.length,n=0,r=t.length;r>n;n++){var o=t[n];if(!p.contains(e,o)){for(var a=1;i>a&&p.contains(arguments[a],o);a++);a===i&&e.push(o)}}return e},p.difference=function(t){var e=g(a.call(arguments,1),!0,!0,[]);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(t){if(null==t)return[];for(var e=p.max(arguments,"length").length,i=Array(e),n=0;e>n;n++)i[n]=p.pluck(arguments,n);return i},p.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},p.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=p.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}for(;r>n;n++)if(t[n]===e)return n;return-1},p.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=t.length;for("number"==typeof i&&(n=0>i?n+i+1:Math.min(n,i+1));--n>=0;)if(t[n]===e)return n;return-1},p.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),o=0;n>o;o++,t+=i)r[o]=t;return r};var b=function(){};p.bind=function(t,e){var i,n;if(h&&t.bind===h)return h.apply(t,a.call(arguments,1));if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));b.prototype=t.prototype;var r=new b;b.prototype=null;var o=t.apply(r,i.concat(a.call(arguments)));return p.isObject(o)?o:r}},p.partial=function(t){var e=a.call(arguments,1);return function(){for(var i=0,n=e.slice(),r=0,o=n.length;o>r;r++)n[r]===p&&(n[r]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return t.apply(this,n)}},p.bindAll=function(t){var e,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(e=1;n>e;e++)i=arguments[e],t[i]=p.bind(t[i],t);return t},p.memoize=function(t,e){var i=function(n){var r=i.cache,o=e?e.apply(this,arguments):n;return p.has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return i.cache={},i},p.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},p.defer=function(t){return p.delay.apply(p,[t,1].concat(a.call(arguments,1)))},p.throttle=function(t,e,i){var n,r,o,a=null,s=0;i||(i={});var c=function(){s=i.leading===!1?0:p.now(),a=null,o=t.apply(n,r),a||(n=r=null)};return function(){var l=p.now();s||i.leading!==!1||(s=l);var u=e-(l-s);return n=this,r=arguments,0>=u||u>e?(clearTimeout(a),a=null,s=l,o=t.apply(n,r),a||(n=r=null)):a||i.trailing===!1||(a=setTimeout(c,u)),o}},p.debounce=function(t,e,i){var n,r,o,a,s,c=function(){var l=p.now()-a;e>l&&l>0?n=setTimeout(c,e-l):(n=null,i||(s=t.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,a=p.now();var l=i&&!n;return n||(n=setTimeout(c,e)),l&&(s=t.apply(o,r),o=r=null),s}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},p.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},p.before=function(t,e){var i;return function(){return--t>0?i=e.apply(this,arguments):e=null,i}},p.once=p.partial(p.before,2),p.keys=function(t){if(!p.isObject(t))return[];if(d)return d(t);var e=[];for(var i in t)p.has(t,i)&&e.push(i);return e},p.values=function(t){for(var e=p.keys(t),i=e.length,n=Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},p.pairs=function(t){for(var e=p.keys(t),i=e.length,n=Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},p.invert=function(t){for(var e={},i=p.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},p.functions=p.methods=function(t){var e=[];for(var i in t)p.isFunction(t[i])&&e.push(i);return e.sort()},p.extend=function(t){if(!p.isObject(t))return t;for(var e,i,n=1,r=arguments.length;r>n;n++){e=arguments[n];for(i in e)l.call(e,i)&&(t[i]=e[i])}return t},p.pick=function(t,e,i){var n,r={};if(null==t)return r;if(p.isFunction(e)){e=f(e,i);for(n in t){var o=t[n];e(o,n,t)&&(r[n]=o)}}else{var c=s.apply([],a.call(arguments,1));t=new Object(t);for(var l=0,u=c.length;u>l;l++)n=c[l],n in t&&(r[n]=t[n])}return r},p.omit=function(t,e,i){if(p.isFunction(e))e=p.negate(e);else{var n=p.map(s.apply([],a.call(arguments,1)),String);e=function(t,e){return!p.contains(n,e)}}return p.pick(t,e,i)},p.defaults=function(t){if(!p.isObject(t))return t;for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];for(var r in n)void 0===t[r]&&(t[r]=n[r])}return t},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t};var y=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var r=c.call(t);if(r!==c.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=i.length;o--;)if(i[o]===t)return n[o]===e;var a=t.constructor,s=e.constructor;if(a!==s&&"constructor"in t&&"constructor"in e&&!(p.isFunction(a)&&a instanceof a&&p.isFunction(s)&&s instanceof s))return!1;i.push(t),n.push(e);var l,u;if("[object Array]"===r){if(l=t.length,u=l===e.length)for(;l--&&(u=y(t[l],e[l],i,n)););}else{var d,h=p.keys(t);if(l=h.length,u=p.keys(e).length===l)for(;l--&&(d=h[l],u=p.has(e,d)&&y(t[d],e[d],i,n)););}return i.pop(),n.pop(),u};p.isEqual=function(t,e){return y(t,e,[],[])},p.isEmpty=function(t){if(null==t)return!0;if(p.isArray(t)||p.isString(t)||p.isArguments(t))return 0===t.length;for(var e in t)if(p.has(t,e))return!1;return!0},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=u||function(t){return"[object Array]"===c.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){p["is"+t]=function(e){return c.call(e)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),"function"!=typeof/./&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===c.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&l.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(t){return function(e){return e[t]}},p.matches=function(t){var e=p.pairs(t),i=e.length;return function(t){if(null==t)return!i;t=new Object(t);for(var n=0;i>n;n++){var r=e[n],o=r[0];if(r[1]!==t[o]||!(o in t))return!1}return!0}},p.times=function(t,e,i){var n=Array(Math.max(0,t));e=f(e,i,1);for(var r=0;t>r;r++)n[r]=e(r);return n},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=p.invert(_),k=function(t){var e=function(e){return t[e]},i="(?:"+p.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};p.escape=k(_),p.unescape=k(w),p.result=function(t,e){if(null==t)return void 0;var i=t[e];return p.isFunction(i)?t[e]():i};var x=0;p.uniqueId=function(t){var e=++x+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/(.)^/,C={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\u2028|\u2029/g,E=function(t){return"\\"+C[t]};p.template=function(t,e,i){!e&&i&&(e=i),e=p.defaults({},e,p.templateSettings);var n=RegExp([(e.escape||S).source,(e.interpolate||S).source,(e.evaluate||S).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(n,function(e,i,n,a,s){return o+=t.slice(r,s).replace(T,E),r=s+e.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(e.variable||"obj","_",o)}catch(s){throw s.source=o,s}var c=function(t){return a.call(this,t,p)},l=e.variable||"obj";return c.source="function("+l+"){\n"+o+"}",c},p.chain=function(t){var e=p(t);return e._chain=!0,e};var $=function(t){return this._chain?p(t).chain():t};p.mixin=function(t){p.each(p.functions(t),function(e){var i=p[e]=t[e];p.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),$.call(this,i.apply(p,t))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];p.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],$.call(this,i)}}),p.each(["concat","join","slice"],function(t){var e=i[t];p.prototype[t]=function(){return $.call(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),
//! Backbone.js 1.1.2
function(t,e){if("function"==typeof define&&define.amd)define("backbone",["underscore","zepto","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");e(t,exports,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,n){{var r=t.Backbone,o=[],a=(o.push,o.slice);o.splice}e.VERSION="1.1.2",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s=e.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,n){if(!l(this,"once",t,[e,n])||!e)return this;var r=this,o=i.once(function(){r.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var r,o,a,s,c,u,d,h;if(!this._events||!l(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(s=t?[t]:i.keys(this._events),c=0,u=s.length;u>c;c++)if(t=s[c],a=this._events[t]){if(this._events[t]=r=[],e||n)for(d=0,h=a.length;h>d;d++)o=a[d],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=a.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&u(i,e),n&&u(n,arguments),this},stopListening:function(t,e,n){var r=this._listeningTo;if(!r)return this;var o=!e&&!n;n||"object"!=typeof e||(n=this),t&&((r={})[t._listenId]=t);for(var a in r)t=r[a],t.off(e,n,this),(o||i.isEmpty(t._events))&&delete this._listeningTo[a];return this}},c=/\s+/,l=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(c.test(i)){for(var o=i.split(c),a=0,s=o.length;s>a;a++)t[e].apply(t,[o[a]].concat(n));return!1}return!0},u=function(t,e){var i,n=-1,r=t.length,o=e[0],a=e[1],s=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,a);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,a,s);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},d={listenTo:"on",listenToOnce:"once"};i.each(d,function(t,e){s[e]=function(e,n,r){var o=this._listeningTo||(this._listeningTo={}),a=e._listenId||(e._listenId=i.uniqueId("l"));return o[a]=e,r||"object"!=typeof n||(r=this),e[t](n,r,this),this}}),s.bind=s.on,s.unbind=s.off,i.extend(e,s);var h=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(h.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var r,o,a,s,c,l,u,d;if(null==t)return this;if("object"==typeof t?(o=t,n=e):(o={})[t]=e,n||(n={}),!this._validate(o,n))return!1;a=n.unset,c=n.silent,s=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={}),d=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(r in o)e=o[r],i.isEqual(d[r],e)||s.push(r),i.isEqual(u[r],e)?delete this.changed[r]:this.changed[r]=e,a?delete d[r]:d[r]=e;if(!c){s.length&&(this._pending=n);for(var h=0,p=s.length;p>h;h++)this.trigger("change:"+s[h],this,d[s[h]],n)}if(l)return this;if(!c)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in t)i.isEqual(r[o],e=t[o])||((n||(n={}))[o]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),void e.trigger("sync",e,i,t)):!1},q(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,o,a,s=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=i.extend({},s,r)),void 0===n.parse&&(n.parse=!0);var c=this,l=n.success;return n.success=function(t){c.attributes=s;var e=c.parse(t,n);return n.wait&&(e=i.extend(r||{},e)),i.isObject(e)&&!c.set(e,n)?!1:(l&&l(c,t,n),void c.trigger("sync",c,t,n))},q(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=r),a=this.sync(o,this,n),r&&n.wait&&(this.attributes=s),a},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){(t.wait||e.isNew())&&r(),n&&n(e,i,t),e.isNew()||e.trigger("sync",e,i,t)},this.isNew())return t.success(),!1;q(this,t);var o=this.sync("delete",this,t);return t.wait||r(),o},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||R();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];i.each(p,function(t){h.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var f=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},m={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1};i.extend(f.prototype,s,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,v))},remove:function(t,e){var n=!i.isArray(t);t=n?[t]:i.clone(t),e||(e={});var r,o,a,s;for(r=0,o=t.length;o>r;r++)s=t[r]=this.get(t[r]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,e.silent||(e.index=a,s.trigger("remove",s,this,e)),this._removeReference(s,e));return n?t[0]:t},set:function(t,e){e=i.defaults({},e,m),e.parse&&(t=this.parse(t,e));var n=!i.isArray(t);t=n?t?[t]:[]:i.clone(t);var r,o,a,s,c,l,u,d=e.at,p=this.model,f=this.comparator&&null==d&&e.sort!==!1,v=i.isString(this.comparator)?this.comparator:null,g=[],b=[],y={},_=e.add,w=e.merge,k=e.remove,x=!f&&_&&k?[]:!1;for(r=0,o=t.length;o>r;r++){if(c=t[r]||{},a=c instanceof h?s=c:c[p.prototype.idAttribute||"id"],l=this.get(a))k&&(y[l.cid]=!0),w&&(c=c===s?s.attributes:c,e.parse&&(c=l.parse(c,e)),l.set(c,e),f&&!u&&l.hasChanged(v)&&(u=!0)),t[r]=l;else if(_){if(s=t[r]=this._prepareModel(c,e),!s)continue;g.push(s),this._addReference(s,e)}s=l||s,!x||!s.isNew()&&y[s.id]||x.push(s),y[s.id]=!0}if(k){for(r=0,o=this.length;o>r;++r)y[(s=this.models[r]).cid]||b.push(s);b.length&&this.remove(b,e)}if(g.length||x&&x.length)if(f&&(u=!0),this.length+=g.length,null!=d)for(r=0,o=g.length;o>r;r++)this.models.splice(d+r,0,g[r]);else{x&&(this.models.length=0);var S=x||g;for(r=0,o=S.length;o>r;r++)this.models.push(S[r])}if(u&&this.sort({silent:!0}),!e.silent){for(r=0,o=g.length;o>r;r++)(s=g[r]).trigger("add",s,this,e);(u||x&&x.length)&&this.trigger("sort",this,e)}return n?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return a.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},q(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,r=e.success;return e.success=function(t,i){e.wait&&n.add(t,e),r&&r(t,i,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof h)return t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_addReference:function(t){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.each(g,function(t){f.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var b=["groupBy","countBy","sortBy","indexBy"];i.each(b,function(t){f.prototype[t]=function(e,n){var r=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,r,n)}});var y=e.View=function(t){this.cid=i.uniqueId("view"),t||(t={}),i.extend(this,i.pick(t,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];i.extend(y.prototype,s,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=i.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[t[e]]),n){var r=e.match(_),o=r[1],a=r[2];n=i.bind(n,this),o+=".delegateEvents"+this.cid,""===a?this.$el.on(o,n):this.$el.on(o,a,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t["class"]=i.result(this,"className"));var n=e.$("<"+i.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var o=x[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:o,dataType:"json"};if(r.url||(a.url=i.result(n,"url")||R()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",r.emulateJSON&&(a.data._method=o);var s=r.beforeSend;r.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",o),s?s.apply(this,arguments):void 0}}"GET"===a.type||r.emulateJSON||(a.processData=!1),"PATCH"===a.type&&k&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=r.xhr=e.ajax(i.extend(a,r));return n.trigger("request",n,c,r),c};var k=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var S=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,E=/\*\w+/g,$=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(S.prototype,s,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return e.history.route(t,function(i){var a=o._extractParameters(t,i);o.execute(r,a),o.trigger.apply(o,["route:"+n].concat(a)),o.trigger("route",n,a),e.history.trigger("route",o,n,a)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace($,"\\$&").replace(C,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/?]+)"}).replace(E,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var D=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,P=/msie [\w.]+/,j=/\/$/,O=/#.*$/;D.started=!1,i.extend(D.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(j,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(A,"")},start:function(t){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,o=P.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);if(this.root=("/"+this.root+"/").replace(I,"/"),this.historyFragments=[n],o&&this._wantsHashChange){var a=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(n,{trigger:!0,replace:!0})}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){var e=this;return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(n){return n.route.test(t)?i.isFunction(e.options.beforeTrigger)&&0==e.options.beforeTrigger.call(e,t,n)?!0:(n.callback(t),!0):void 0})},historyFragments:[],back:function(){this.historyFragments.length=this.historyFragments.length>1?this.historyFragments.length-1:1,history.back()},navigate:function(t,e){if(!D.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(O,""),this.fragment!==t){if(this.fragment=t,e.replace){var n=this.historyFragments.length;this.historyFragments[n?n-1:0]=t}else this.historyFragments.push(t);if(""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new D;var M=function(t,e){var n,r=this;n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,t&&i.extend(n.prototype,t),n.__super__=r.prototype,n};h.extend=f.extend=S.extend=y.extend=D.extend=M;var R=function(){throw new Error('A "url" property or function must be specified')},q=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}};return e}),
//! catchable.js
function(t){t.extend(t.fn,{catchable:function(e){var i=function(){},n={alternating:!1,container:window,threshold:"0 0",catched:i,lost:i};return t._catchnumber=t._catchnumber||0,this.each(function(){var i=this,r=t.extend({},e||{});t.each(r,function(e,n){return{catched:1,lost:1}[e]?!0:void(r[e]=t.isFunction(n)?n.call(i):n)}),r=t.extend(n,r);{var o=t(r.container),a=o.size()?o[0]:window;t(a)}this._catch_options=r,this._catchabled=!0,t._catchnumber++,this._catch_container=a,a._catch_items=a._catch_items||[],-1==t(a._catch_items).index(this)&&a._catch_items.push(this),t(this).addClass("catchable_"+t._catchnumber).bind("snap",function(){var e=this._catch_options,i=this;if("hidden"!=t(this).css("visibility")&&"none"!=t(this).css("display")&&this._catchabled){var n=t.extend({width:t(this).width(),height:t(this).height()},t(this).offset()),r=this._catch_container;r._catch_box=function(){var e=r===window?{left:t(r).scrollLeft(),top:t(r).scrollTop()}:t(r).offset();return{left:e.left,top:e.top,width:t(r).width(),height:t(r).height()}}();var o=r._catch_box,a=t.map(e.threshold.split(/\s*?[\s\,]\s*?/gi),function(t,e){return/[\d\.]%/.test(t)?n[["width","height"][e]]*parseInt(t)/100:parseInt(t)}),s={x:a[0]||0,y:a[1]||0},c=n.left+n.width-o.left,l=o.left+o.width-n.left,u=n.top+n.height-o.top,d=o.top+o.height-n.top;i._catch_visible=!0,c>s.x&&l>s.x&&u>s.y&&d>s.y?(i._catch_visible=!0,e.alternating&&i._catched||t(i).trigger("catched")):(i._catch_visible=!1,(!e.alternating||i._catched)&&t(i).trigger("catchlost"))}}).bind("catched",function(){var e=this._catch_options.catched;t.isFunction(e)&&e.call(this),this._catched=!0}).bind("catchlost",function(){var e=this._catch_options.lost;t.isFunction(e)&&e.call(this),this._catched=!1})})},catchOptions:function(e){return e=e||{},this.each(function(){var i=this,n=this._catch_options;t.each(e,function(e,r){switch(e){case"container":var o=t(r);i._catch_container=o.size()?o[0]:window;break;case"catched":case"lost":n[e]=r;break;default:n[e]=t.isFunction(r)?r.call(i):r}})})},discatch:function(){return this.each(function(){this._catchabled=null;var e=this,i=this._catch_container;t(this).unbind("snap catched catchlost"),i&&(i._catch_items=t.grep(i._catch_items,function(t){return t!=e}))})},snapit:function(){return this.each(function(){this._catchabled&&t(this).trigger("snap"),this._catch_items&&t.each(this._catch_items,function(){this&&t(this).trigger("snap")})})},defer:function(e,i,n){return i=i||"defer",n=n||5e3,this.each(function(){if(t(this).is("img")&&!this._catchabled&&!this._defered){var r=!!t(this).attr(i);r&&(this._defered=!0,t(this).catchable({catched:function(){function r(){clearTimeout(s),t.isFunction(e)&&0==e.call(o,a)||t(o).css("opacity",.8).attr("src",a).animate({opacity:1},500)}var o=this,a=this.getAttribute(i),s=setTimeout(r,n),c=new Image;c.onload=r,c.src=a,t(this).discatch()}}))}})}}),"function"==typeof define&&define.amd&&define("catchable",[t.jquery?"jquery":"zepto"],function(){})}(window.jQuery||window.Zepto),
//! cookie 读写
!function(t,e,i){function n(t,n,a){if(a=a||{},n===i){var s=null;if(e[r]&&""!=e[r])for(var c=e[r].split(";"),l=0;l<c.length;l++){var u=c[l].replace(/^\s*/,"").replace(/\s*$/,"");if(u.substring(0,t.length+1)==t+"="){s=decodeURIComponent(u.substring(t.length+1));break}}return s}var d={path:"/",domain:arguments.callee.domain||location.host,expires:30,secure:!1};for(var h in d)a[h]===i&&(a[h]=d[h]);null===n&&(n="",a[o]=-1);var p="";if(a[o]&&("number"==typeof a[o]||a[o].toUTCString)){var f;"number"==typeof a[o]?(f=new Date,f.setTime(f.getTime()+24*a[o]*60*60*1e3)):f=a[o],p="expires="+f.toUTCString()}var u=[t+"="+encodeURIComponent(n)];p&&u.push(p),a.path&&u.push("path="+a.path),a.domain&&u.push("domain="+a.domain),a.secure&&u.push("secure"),e[r]=u.join("; ")}var r="cookie",o="expires";n.domain=location.host,"function"==typeof define&&define.amd?define("cookie",[],function(){return n}):t[r]=n}(this,document),
//! iScroll v4.2.5 ~
function(t,e){function i(){}function n(t){return""===s?t:(t=t.charAt(0).toUpperCase()+t.substr(1),s+t)}var r=function(e){function i(t,i){e(t,i).each(function(t,i){1!=e(i).attr("data-keyboard-init")&&(d&&e(i).tap(function(){this.focus()}),e(i).on("focus",function(){l=this,d&&this.focus()}).on("blur",function(){l=null}).attr("data-keyboard-init",1))})}function n(t){"function"==e.type(t)&&h.push(t)}function r(){if(s!=c)if(u){var i=o;o=a,a=i}else o=e(t).width(),a=e(t).height();var n=e(t).height();u=null!==l&&a>n,e.each(h,function(t,e){e.apply(null,[u,l])}),s=c}var o=e(t).width(),a=e(t).height(),s=!!(2&t.orientation),c=s,l=null,u=!1,d=e.os.ios&&parseFloat(e.os.version)>=7,h=[],p=null;return i("input,textarea,select"),e(t).on("orientationchange",function(){c=!!(2&t.orientation),d&&r()}).on("resize",function(){(!d||s==c&&e(t).width()==o)&&(p&&clearTimeout(p),p=setTimeout(r,200))}),{watch:i,onchange:n,fixIScroll4Onchange:function(i,r){n(function(n,o){if("onorientationchange"in t&&i.refresh(),(!e.os.ios||d)&&n&&o){r="number"==e.type(r)?r:5;var a=e(o),s=e(t).height(),c=a.height()+a.offset().top+r;c-i.y>s&&i[M](0,s-c+i.y,0),d&&o.focus()}})}}},o=Math,a=e.createElement("div").style,s=function(){for(var t,e="t,webkitT,MozT,msT,OT".split(","),i=0,n=e.length;n>i;i++)if(t=e[i]+"ransform",t in a)return e[i].substr(0,e[i].length-1);return!1}(),c=s?"-"+s.toLowerCase()+"-":"",l=n("transform"),u=n("transitionProperty"),d=n("transitionDuration"),h=n("transformOrigin"),p=n("transitionTimingFunction"),f=n("transitionDelay"),m=/android/gi.test(navigator.appVersion),v=/iphone|ipad/gi.test(navigator.appVersion),g=/hp-tablet/gi.test(navigator.appVersion),b=n("perspective")in a,y="ontouchstart"in t&&!g,_=s!==!1,w=n("transition")in a,k="onorientationchange"in t?"orientationchange":"resize",x=y?"touchstart":"mousedown",S=y?"touchmove":"mousemove",C=y?"touchend":"mouseup",T=y?"touchcancel":"mouseup",E=function(){if(s===!1)return!1;var t={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return t[s]}(),$=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){return setTimeout(t,1)}}(),D=function(){return t.cancelAnimationFrame||t.cancelRequestAnimationFrame||t.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout}(),A=b?" translateZ(0)":"",I="_unbind",P="options",j="onTouchEnd",O="onScrollEnd",M="scrollTo",R="scroller",q="scrollerW",N="scrollerH",L="maxScrollY",z="maxScrollX",F="minScrollY",B="wrapperOffsetLeft",V="wrapperOffsetTop",H="pageX",Y="pageY",X="pagesX",U="pagesY",W="currPageX",Z="currPageY",J="style",G="useTransform",Q="useTransition",K="wrapper",tt="wrapperH",et="wrapperW",it="Scrollbar",nt="ScrollbarProp",rt="ScrollbarWrapper",ot="ScrollbarIndicator",at="ScrollbarIndicatorSize",st="ScrollbarMaxScroll",ct="hScroll",lt="hScrollbar",ut="hScrollbarIndicator",dt="hScrollbarIndicatorSize",ht="hScrollbarMaxScroll",pt="hScrollbarProp",ft="hScrollbarSize",mt="hScrollbarWrapper",vt="vScroll",gt="vScrollbar",bt="vScrollbarIndicator",yt="vScrollbarIndicatorSize",_t="vScrollbarMaxScroll",wt="vScrollbarProp",kt="vScrollbarSize",xt="vScrollbarWrapper",St=function(n,o){var a,s=this,f="object"==typeof n?n:e.getElementById(n);f[J].overflow="hidden",s[K]=f,s[R]=f.children[0],s[P]={hScroll:!1,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!0,topOffset:0,checkDOMChanges:!1,handleClick:!0,resetDuration:400,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:m,hideScrollbar:v,fadeScrollbar:v&&b,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,snapOffset:{x:0,y:0},onRefresh:null,onRefreshed:null,onResetPos:i,onBeforeScrollStart:function(t){for(var e=t.target;1!=e.nodeType;)e=e.parentNode;/\biscrollinput\b/i.test(e.className)||"SELECT"==e.tagName||"INPUT"==e.tagName||"TEXTAREA"==e.tagName||t.preventDefault()},onScroll:i,onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(a in o)s[P][a]=o[a];var g=s[P];s.x=g.x,s.y=g.y,g[G]=_&&g[G],g[lt]=g[ct]&&g[lt],g[gt]=g[vt]&&g[gt],g.zoom=g[G]&&g.zoom,g[Q]=w&&g[Q],g.zoom&&m&&(A="");var S=s[R][J];S[u]=g[G]?c+"transform":"top left",S[d]="0",S[h]="0 0",g[Q]&&(S[p]="cubic-bezier(0.33,0.66,0.66,1)"),g[G]?S[l]="translate("+s.x+"px,"+s.y+"px)"+A:S.cssText+=";position:absolute;top:"+s.y+"px;left:"+s.x+"px",g[Q]&&(g.fixedScrollbar=!0),s.refresh(),s._bind(k,t),s._bind(x),y||"none"!=g.wheelAction&&(s._bind("DOMMouseScroll"),s._bind("mousewheel")),g.checkDOMChanges&&(s.checkDOMTime=setInterval(function(){s._checkDOMChanges()},500)),r.watch("input,textarea,select",s[K]),r.fixIScroll4Onchange(this)};return St.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(t){var e=this;switch(t.type){case x:if(!y&&0!==t.button)return;e._start(t);break;case S:e._move(t);break;case C:case T:e._end(t);break;case k:e._resize();break;case"DOMMouseScroll":case"mousewheel":e._wheel(t);break;case E:e._transitionEnd(t)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this[q]==this[R].offsetWidth*this.scale&&this[N]==this[R].offsetHeight*this.scale||this.refresh()},_scrollbar:function(t){var i,n=this,r=this[P];return n[t+it]?(n[t+rt]||(i=e.createElement("div"),r.scrollbarClass?i.className=r.scrollbarClass+t.toUpperCase():i[J].cssText="position:absolute;z-index:100;"+("h"==t?"height:7px;bottom:1px;left:2px;right:"+(n.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(n.hScrollbar?"7":"2")+"px;top:2px;right:1px"),i[J].cssText+=";pointer-events:none;"+c+"transition-property:opacity;"+c+"transition-duration:"+(r.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(r.hideScrollbar?"0":"1"),n[K].appendChild(i),n[t+rt]=i,i=e.createElement("div"),r.scrollbarClass||(i[J].cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+c+"background-clip:padding-box;"+c+"box-sizing:border-box;"+("h"==t?"height:100%":"width:100%")+";"+c+"border-radius:3px;border-radius:3px"),i[J].cssText+=";pointer-events:none;"+c+"transition-property:"+c+"transform;"+c+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+c+"transition-duration:0;"+c+"transform: translate(0,0)"+A,r[Q]&&(i[J].cssText+=";"+c+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),n[t+rt].appendChild(i),n[t+ot]=i),"h"==t?(n[ft]=n[mt].clientWidth,n[dt]=o.max(o.round(n[ft]*n[ft]/n[q]),8),n[ut].style.width=n[dt]+"px",n[ht]=n[ft]-n[dt],n[pt]=n[hScrollbarMaxScroll]/n[z]):(n[kt]=n[xt].clientHeight,n[yt]=o.max(o.round(n[kt]*n[kt]/n[N]),8),n[bt].style.height=n[yt]+"px",n[_t]=n[kt]-n[yt],n[wt]=n[_t]/n[L]),void n._scrollbarPos(t,!0)):void(n[t+rt]&&(_&&(n[t+ot].style[l]=""),n[t+rt].parentNode.removeChild(n[t+rt]),n[t+rt]=null,n[t+ot]=null))},_resize:function(){var t=this;setTimeout(function(){t.refresh()},m?200:0)},_pos:function(t,e){var i=this,n=i[P],r=i[R][J];i.zoomed||(t=i.hScroll?t:0,e=i.vScroll?e:0,n[G]?r[l]="translate("+t+"px,"+e+"px) scale("+i.scale+")"+A:(t=o.round(t),e=o.round(e),r.left=t+"px",r.top=e+"px"),i.x=t,i.y=e,n.onScroll.call(this,t,e),i._scrollbarPos("h"),i._scrollbarPos("v"))},_scrollbarPos:function(t,e){var i,n=this,r=n[P],a="h"==t?n.x:n.y,s=n[t+it],c=n[t+st],u=n[t+at],d=n[t+ot],h=n[t+rt];s&&(a=n[t+nt]*a,0>a?(r.fixedScrollbar||(i=u+o.round(3*a),8>i&&(i=8),d[J]["h"==t?"width":"height"]=i+"px"),a=0):a>c&&(r.fixedScrollbar?a=c:(i=u-o.round(3*(a-c)),8>i&&(i=8),d[J]["h"==t?"width":"height"]=i+"px",a=c+(u-i))),h[J][f]="0",h[J].opacity=e&&r.hideScrollbar?"0":"1",d[J][l]="translate("+("h"==t?a+"px,0)":"0,"+a+"px)")+A)},_start:function(e){var i,n,r,a,s,c=this,u=c[P],d=y?e.touches[0]:e;c.enabled&&(u.onBeforeScrollStart&&u.onBeforeScrollStart.call(c,e),(u[Q]||u.zoom)&&c._transitionTime(0),c.moved=!1,c.animating=!1,c.zoomed=!1,c.distX=0,c.distY=0,c.absDistX=0,c.absDistY=0,c.dirX=0,c.dirY=0,u.zoom&&y&&e.touches.length>1&&(a=o.abs(e.touches[0][H]-e.touches[1][H]),s=o.abs(e.touches[0][Y]-e.touches[1][Y]),c.touchesDistStart=o.sqrt(a*a+s*s),c.originX=o.abs(e.touches[0][H]+e.touches[1][H]-2*c[B])/2-c.x,c.originY=o.abs(e.touches[0][Y]+e.touches[1][Y]-2*c[V])/2-c.y,u.onZoomStart&&u.onZoomStart.call(c,e)),u.momentum&&(u[G]?(i=getComputedStyle(c[R],null)[l].replace(/[^0-9\-.,]/g,"").split(","),n=+(i[12]||i[4]),r=+(i[13]||i[5])):(n=+getComputedStyle(c[R],null).left.replace(/[^0-9-]/g,""),r=+getComputedStyle(c[R],null).top.replace(/[^0-9-]/g,"")),(n!=c.x||r!=c.y)&&(u[Q]?c[I](E):D(c.aniTime),c.steps=[],c._pos(n,r),u[O]&&u[O].call(c))),c.absStartX=c.x,c.absStartY=c.y,c.startX=c.x,c.startY=c.y,c.pointX=d[H],c.pointY=d[Y],c.startTime=e.timeStamp||Date.now(),u.onScrollStart&&u.onScrollStart.call(c,e),c._bind(S,t),c._bind(C,t),c._bind(T,t))},_move:function(t){var e,i,n,r=this,a=r[P],s=y?t.touches[0]:t,c=s[H]-r.pointX,u=s[Y]-r.pointY,d=r.x+c,h=r.y+u,p=t.timeStamp||Date.now();return a.onBeforeScrollMove&&a.onBeforeScrollMove.call(r,t),a.zoom&&y&&t.touches.length>1?(e=o.abs(t.touches[0][H]-t.touches[1][H]),i=o.abs(t.touches[0][Y]-t.touches[1][Y]),r.touchesDist=o.sqrt(e*e+i*i),r.zoomed=!0,n=1/r.touchesDistStart*r.touchesDist*this.scale,n<a.zoomMin?n=.5*a.zoomMin*o.pow(2,n/a.zoomMin):n>a.zoomMax&&(n=2*a.zoomMax*o.pow(.5,a.zoomMax/n)),r.lastScale=n/this.scale,d=this.originX-this.originX*r.lastScale+this.x,h=this.originY-this.originY*r.lastScale+this.y,this[R].style[l]="translate("+d+"px,"+h+"px) scale("+n+")"+A,void(a.onZoom&&a.onZoom.call(r,t))):(r.pointX=s[H],r.pointY=s[Y],(d>0||d<r[z])&&(d=a.bounce?r.x+c/2:d>=0||r[z]>=0?0:r[z]),(h>r[F]||h<r[L])&&(h=a.bounce?r.y+u/2:h>=r[F]||r[L]>=0?r[F]:r[L]),r.distX+=c,r.distY+=u,r.absDistX=o.abs(r.distX),r.absDistY=o.abs(r.distY),void(r.absDistX<6&&r.absDistY<6||(a.lockDirection&&(r.absDistX>r.absDistY+5?(h=r.y,u=0):r.absDistY>r.absDistX+5&&(d=r.x,c=0)),r.moved=!0,r._pos(d,h),r.dirX=c>0?-1:0>c?1:0,r.dirY=u>0?-1:0>u?1:0,p-r.startTime>300&&(r.startTime=p,r.startX=r.x,r.startY=r.y),a.onScrollMove&&a.onScrollMove.call(r,t))))},_end:function(i){if(!y||0===i.touches.length){var n,r,a,s,c,u,h,p=this,f=p[P],m=y?i.changedTouches[0]:i,v={dist:0,time:0},g={dist:0,time:0},b=(i.timeStamp||Date.now())-p.startTime,_=p.x,w=p.y;if(p[I](S,t),p[I](C,t),p[I](T,t),f.onBeforeScrollEnd&&f.onBeforeScrollEnd.call(p,i),p.zoomed)return h=p.scale*p.lastScale,h=o.max(f.zoomMin,h),h=o.min(f.zoomMax,h),p.lastScale=h/p.scale,p.scale=h,p.x=p.originX-p.originX*p.lastScale+p.x,p.y=p.originY-p.originY*p.lastScale+p.y,p[R][J][d]="200ms",p[R][J][l]="translate("+p.x+"px,"+p.y+"px) scale("+p.scale+")"+A,p.zoomed=!1,p.refresh(),void(f.onZoomEnd&&f.onZoomEnd.call(p,i));if(!p.moved)return y&&(p.doubleTapTimer&&f.zoom?(clearTimeout(p.doubleTapTimer),p.doubleTapTimer=null,f.onZoomStart&&f.onZoomStart.call(p,i),p.zoom(p.pointX,p.pointY,1==p.scale?f.doubleTapZoom:1),f.onZoomEnd&&setTimeout(function(){f.onZoomEnd.call(p,i)},200)):f.handleClick&&(p.doubleTapTimer=setTimeout(function(){for(p.doubleTapTimer=null,n=m.target;1!=n.nodeType;)n=n.parentNode;"SELECT"!=n.tagName&&"INPUT"!=n.tagName&&"TEXTAREA"!=n.tagName&&(r=e.createEvent("MouseEvents"),r.initMouseEvent("click",!0,!0,i.view,1,m.screenX,m.screenY,m.clientX,m.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,0,null),r._fake=!0,n.dispatchEvent(r))},f.zoom?250:0))),p._resetPos(400),void(f[j]&&f[j].call(p,i));if(300>b&&f.momentum&&(v=_?p._momentum(_-p.startX,b,-p.x,p[q]-p[et]+p.x,f.bounce?p[et]:0):v,g=w?p._momentum(w-p.startY,b,-p.y,p[L]<0?p[N]-p[tt]+p.y-p[F]:0,f.bounce?p[tt]:0):g,_=p.x+v.dist,w=p.y+g.dist,(p.x>0&&_>0||p.x<p[z]&&_<p[z])&&(v={dist:0,time:0}),(p.y>p[F]&&w>p[F]||p.y<p[L]&&w<p[L])&&(g={dist:0,time:0})),v.dist||g.dist)return c=o.max(o.max(v.time,g.time),10),f.snap&&(a=_-p.absStartX,s=w-p.absStartY,o.abs(a)<f.snapThreshold&&o.abs(s)<f.snapThreshold?p[M](p.absStartX,p.absStartY,200):(u=p._snap(_,w),_=u.x,w=u.y,c=o.max(u.time,c))),p[M](o.round(_),o.round(w),c),void(f[j]&&f[j].call(p,i));if(f.snap)return a=_-p.absStartX,s=w-p.absStartY,o.abs(a)<f.snapThreshold&&o.abs(s)<f.snapThreshold?p[M](p.absStartX,p.absStartY,200):(u=p._snap(p.x,p.y),(u.x!=p.x||u.y!=p.y)&&p[M](u.x,u.y,u.time)),void(f[j]&&f[j].call(p,i));f[j]&&f[j].call(p,i),p._resetPos(200)}},_resetPos:function(t){var e=this,i=e[P],n=e.x>=0?0:e.x<e[z]?e[z]:e.x,r=e.y>=e.minScrollY||e[L]>0?e[F]:e.y<e[L]?e[L]:e.y;return i.onResetPos.call(e,t||0),n==e.x&&r==e.y?(e.moved&&(e.moved=!1,i[O]&&i[O].call(e)),e[lt]&&i.hideScrollbar&&("webkit"==s&&(e[mt][J][f]="300ms"),e[mt][J].opacity="0"),void(e[gt]&&i.hideScrollbar&&("webkit"==s&&(e[xt][J][f]="300ms"),e[xt][J].opacity="0"))):void e[M](n,r,t||0)},_wheel:function(t){var e,i,n,r,a,s=this,c=s[P];if("wheelDeltaX"in t)e=t.wheelDeltaX/12,i=t.wheelDeltaY/12;else if("wheelDelta"in t)e=i=t.wheelDelta/12;else{if(!("detail"in t))return;e=i=3*-t.detail}return"zoom"==c.wheelAction?(a=s.scale*o.pow(2,1/3*(i?i/o.abs(i):0)),a<c.zoomMin&&(a=c.zoomMin),a>c.zoomMax&&(a=c.zoomMax),void(a!=s.scale&&(!s.wheelZoomCount&&c.onZoomStart&&c.onZoomStart.call(s,t),s.wheelZoomCount++,s.zoom(t[H],t[Y],a,400),setTimeout(function(){s.wheelZoomCount--,!s.wheelZoomCount&&c.onZoomEnd&&c.onZoomEnd.call(s,t)},400)))):(n=s.x+e,r=s.y+i,n>0?n=0:n<s[z]&&(n=s[z]),r>s.minScrollY?r=s.minScrollY:r<s[L]&&(r=s[L]),void(s[L]<0&&s[M](n,r,0)))},_transitionEnd:function(t){var e=this;t.target==e[R]&&(e[I](E),e._startAni())},_startAni:function(){var t,e,i,n=this,r=n[P],a=n.x,s=n.y,c=Date.now();if(!n.animating){if(!n.steps.length)return void n._resetPos(400);if(t=n.steps.shift(),t.x==a&&t.y==s&&(t.time=0),n.animating=!0,n.moved=!0,r[Q])return n._transitionTime(t.time),n._pos(t.x,t.y),n.animating=!1,void(t.time?n._bind(E):n._resetPos(0));i=function(){var l,u,d=Date.now();return d>=c+t.time?(n._pos(t.x,t.y),n.animating=!1,r.onAnimationEnd&&r.onAnimationEnd.call(n),void n._startAni()):(d=(d-c)/t.time-1,e=o.sqrt(1-d*d),l=(t.x-a)*e+a,u=(t.y-s)*e+s,n._pos(l,u),void(n.animating&&(n.aniTime=$(i))))},i()}},_transitionTime:function(t){var e=this;t+="ms",e[R][J][d]=t,e[lt]&&(e[ut][J][d]=t),e[gt]&&(e[bt][J][d]=t)},_momentum:function(t,e,i,n,r){var a=6e-4,s=o.abs(t)/e,c=s*s/(2*a),l=0,u=0;return t>0&&c>i?(u=r/(6/(c/s*a)),i+=u,s=s*i/c,c=i):0>t&&c>n&&(u=r/(6/(c/s*a)),n+=u,s=s*n/c,c=n),c*=0>t?-1:1,l=s/a,{dist:c,time:o.round(l)}},_offset:function(t){for(var e=-t.offsetLeft,i=-t.offsetTop;t=t.offsetParent;)e-=t.offsetLeft,i-=t.offsetTop;return t!=this[K]&&(e*=this.scale,i*=this.scale),{left:e,top:i}},_snap:function(t,e){var i,n,r,a,s,c,l=this,u=l[P];for(r=l[X].length-1,i=0,n=l[X].length;n>i;i++)if(t>=l[X][i]){r=i;break}for(r==l[W]&&r>0&&l.dirX<0&&r--,t=l[X][r],s=o.abs(t-l[X][l[W]]),s=s?o.abs(l.x-t)/s*500:0,l[W]=r,r=l[U].length-1,i=0;r>i;i++)if(e>=l[U][i]){r=i;break}return r==l[Z]&&r>0&&l.dirY<0&&r--,e=l[U][r],c=o.abs(e-l[U][l[Z]]),c=c?o.abs(l.y-e)/c*500:0,l[Z]=r,a=o.round(o.max(s,c))||200,{x:t+u.snapOffset.x,y:e+u.snapOffset.y,time:a}},_bind:function(t,e,i){(e||this[R]).addEventListener(t,this,!!i)},_unbind:function(t,e,i){(e||this[R]).removeEventListener(t,this,!!i)},destroy:function(){var e=this,i=e[P];e[R].style[l]="",e[lt]=!1,e[gt]=!1,e._scrollbar("h"),e._scrollbar("v"),e[I](k,t),e[I](x),e[I](S,t),e[I](C,t),e[I](T,t),i.hasTouch||(e[I]("DOMMouseScroll"),e[I]("mousewheel")),i[Q]&&e[I](E),i.checkDOMChanges&&clearInterval(e.checkDOMTime),i.onDestroy&&i.onDestroy.call(e)},refresh:function(){var t,e,i,n,r=this,a=this[P],s=r[K],c=r[R],l=0,u=0;if(r.scale<a.zoomMin&&(r.scale=a.zoomMin),r[et]=s.clientWidth||1,r[tt]=s.clientHeight||1,r[F]=-a.topOffset||0,r[q]=o.round(c.offsetWidth*r.scale),r[N]=o.round((c.offsetHeight+r[F])*r.scale),r[z]=r[et]-r[q],r[L]=r[tt]-r[N]+r[F],r.dirX=0,r.dirY=0,a.onRefresh&&a.onRefresh.call(r),r[ct]=a[ct]&&r[z]<0,r[vt]=a[vt]&&(!a.bounceLock&&!r[ct]||r[N]>r[tt]),r[lt]=r[ct]&&a[lt],r[gt]=r[vt]&&a[gt]&&r[N]>r[tt],t=r._offset(s),r[B]=-t.left,r[V]=-t.top,"string"==typeof a.snap)for(r[X]=[],r[U]=[],n=r[R].querySelectorAll(a.snap),e=0,i=n.length;i>e;e++)l=r._offset(n[e]),l.left+=r[B],l.top+=r[V],r[X][e]=l.left<r[z]?r[z]:l.left*r.scale,r[U][e]=l.top<r[L]?r[L]:l.top*r.scale;else if(a.snap){for(r[X]=[];l>=r[z];)r[X][u]=l,l-=r[et],u++;for(r[z]%r[et]&&(r[X][r[X].length]=r[z]-r[X][r[X].length-1]+r[X][r[X].length-1]),l=0,u=0,r[U]=[];l>=r[L];)r[U][u]=l,l-=r[tt],u++;r[L]%r[tt]&&(r[U][r[U].length]=r[L]-r[U][r[U].length-1]+r[U][r[U].length-1])}r._scrollbar("h"),r._scrollbar("v"),r.zoomed||(r[R].style[d]="0",r._resetPos(a.resetDuration)),a.onRefreshed&&a.onRefreshed.call(r)},scrollTo:function(t,e,i,n){var r,o,a=this,s=t;for(a.stop(),s.length||(s=[{x:t,y:e,time:i,relative:n}]),r=0,o=s.length;o>r;r++)s[r].relative&&(s[r].x=a.x-s[r].x,s[r].y=a.y-s[r].y),a.steps.push({x:s[r].x,y:s[r].y,time:s[r].time||0});a._startAni()},scrollToElement:function(t,e){var i,n=this;t=t.nodeType?t:n[R].querySelector(t),t&&(i=n._offset(t),i.left+=n[B],i.top+=n[V],i.left=i.left>0?0:i.left<n[z]?n[z]:i.left,i.top=i.top>n[F]?n[F]:i.top<n[L]?n[L]:i.top,e=void 0===e?o.max(2*o.abs(i.left),2*o.abs(i.top)):e,n[M](i.left,i.top,e))},scrollToPage:function(t,e,i){var n,r,o=this,a=o[P];i=void 0===i?400:i,a.onScrollStart&&a.onScrollStart.call(o),a.snap?(t="next"==t?o[W]+1:"prev"==t?o[W]-1:t,e="next"==e?o[Z]+1:"prev"==e?o[Z]-1:e,t=0>t?0:t>o[X].length-1?o[X].length-1:t,e=0>e?0:e>o[U].length-1?o[U].length-1:e,o[W]=t,o[Z]=e,n=o[X][t],r=o[U][e]):(n=-o[et]*t,r=-o[tt]*e,n<o[z]&&(n=o[z]),r<o[L]&&(r=o[L])),o[M](n,r,i)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this[I](S,t),this[I](C,t),this[I](T,t)},enable:function(){this.enabled=!0},stop:function(){var t=this;t[P][Q]?t[I](E):D(t.aniTime),t.steps=[],t.moved=!1,t.animating=!1},zoom:function(t,e,i,n){var r=this,o=r[R][J],a=i/r.scale;r[P][G]&&(r.zoomed=!0,n=void 0===n?200:n,t=t-r[B]-r.x,e=e-r[V]-r.y,r.x=t-t*a+r.x,r.y=e-e*a+r.y,r.scale=i,r.refresh(),r.x=r.x>0?0:r.x<r[z]?r[z]:r.x,r.y=r.y>r[F]?r[F]:r.y<r[L]?r[L]:r.y,o[d]=n+"ms",o[l]="translate("+r.x+"px,"+r.y+"px) scale("+i+")"+A,r.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},a=null,"undefined"!=typeof exports?exports.iScroll=St:t.iScroll=St,"function"==typeof define&&define.amd?void define("iScroll",["zepto"],function(){return r=r(Zepto),St}):(t.iScroll=St,void(r=r(Zepto||jQuery)))}(window,document),
//! mcahce.js
!function(t,e){function i(){return this.init.apply(this,arguments)}var n=":",r={},o=[],a={length:0,setItem:function(t,e){r[t]=e,-1==o.indexOf(t)&&o.push(t),this.length=o.length},getItem:function(t){return r[t]},removeItem:function(t,i){i=o.indexOf(t),i>=0&&o.splice(i,1),r[t]=e,this.length=o.length},clear:function(){r={},queu=[]},key:function(t){return r[o[t]]}},s=function(){try{return window.localStorage._try=1,delete window.localStorage._try,window.localStorage}catch(t){return a}}();i.prototype={name:null,cache:null,init:function(t,e){this.name=t,this.cache=e},set:function(t,e){return this.cache.set([this.name,t].join(n),e)},get:function(t){return this.cache.get([this.name,t].join(n))},remove:function(t){return this.cache.remove([this.name,t].join(n))},clear:function(){var t=this.cache.store;if(t)for(var e,i,r=0,o=t.length;o>r;r++)e=t.key(r),i=e.split(n),i.length>1&&i[0]==this.name&&(this.cache.remove(e),r--,o--)}};var c={store:s,set:function(t,e){return s.setItem(t,JSON.stringify(e))},get:function(t){var e=s.getItem(t);return e?JSON.parse(e):e},list:function(t){return new i(t,c)},remove:function(t){return s?s.removeItem(t):e},clear:function(){return s?s.clear():e}},l={store:a,set:function(t,e){return a.setItem(t,JSON.stringify(e))},get:function(t){var e=a.getItem(t);return e?JSON.parse(e):e},list:function(t){return new i(t,l)},remove:function(t){return a?a.removeItem(t):e},clear:function(){return a?a.clear():e}},u={localCache:c,runtimeCache:l};"function"==typeof define&&define.amd&&define("mcache",[],function(){return u}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports),exports=u):(this[t]=u,this.LocalCache=c,this.RuntimeCache=l)}.call(this,"mCache"),
//! string.format.js
!function(t){function e(t){return{}.toString.call(t).slice(8,-1)}function i(t){return"Function"===e(t)}function n(e,i){if(e===t)return t;if(i.length){var r=i.shift();return e[r]===t?t:n(e[r],i)}return e}String.prototype.format=function(){var r=[].slice.call(arguments,0);return r.length?this.replace(/\{(.+?)\}/g,function(){var o=arguments[0],a=/^\{(#?)([\d\_\.a-z]+?)(\((.*?)\))?\s*(\[([\d\_a-z]+)\])?(\|(.+))?\}$/i.exec(o),s=a[1],c=a[2],l=a[4],u=a[6],d=a[8],h=t;if(h=s&&/\d+/.test(c)?r[c]:n(r[0],c.split(/\s*?\.\s*?/)),i(h)&&l&&(h=h.apply(null,l.split(/\s*?\,\s*?/))),u&&(h=n(h,u.split(/\s*?\.\s*?/))),h===t)return o;if(d){d=d.split(/\s*?\|\s*?/);for(var p=0,f=d.length;f>p;p++){for(var m=d[p].split(/\s*?\:\s*?/),v=m.shift(),g=null,f=r.length,b=r[0];b=r[p++];)"Object"==e(b)&&(g=i(b[v])?b[v]:g);i(g)?h=g.apply(null,[h].concat(m)):(g=String.prototype.format_modifiers[v],i(g)?h=g.apply(h,m):(g=String.prototype[v],"String"==e(h)&&i(g)?h=g.apply(h.toString(),m):0+h==h&&(h=+h,g=Number.prototype[v],i(g))?h=g.apply(h,m).toString():(g=window[v],i(g)&&(m.unshift(h),h=g.apply(null,m)))))}}return(h===t?o:null===h?"null":h).toString()}):String(this)},String.prototype.format_modifiers={},"function"==typeof define&&define.amd&&define("stringFormat",[],function(){return String.prototype.format})}(),
//! loadimg v1.0.1 ~
!function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("loadimg",function(){return e(t)}):e(t,"loadimg")}(this,function(t,e){var i=function(t,e,i){function n(){return a?!0:(a=!0,clearTimeout(s),clearInterval(c),void e.call(r,t,{width:r.naturalWidth,height:r.naturalHeight},o))}e="function"==typeof e?e:function(){},i=i||6e4;var r=new Image,o="",a=!1,s=setTimeout(function(){o="NetworkTimeout",n()},i);r.onerror=function(){o="NetworkError",n()},r.onabort=function(){o="Abort",n()},r.src=t;var c=setInterval(function(){(r.readyState&&"complete"==r.readyState||1==r.complete)&&setTimeout(n,10)},13)};return e&&(t[e]=i),i}),supportTouch="ontouchstart"in document,touchStartEvent=supportTouch?"touchstart":"mousedown",touchStopEvent=supportTouch?"touchend":"mouseup",touchMoveEvent=supportTouch?"touchmove":"mousemove",tapEvent=supportTouch?"tap":"click",window.QueryString={pickup:function(t,e,i){return e=e||decodeURIComponent,i={},t=t.replace(/^.*\?/,""),t.split("&").forEach(function(t){t=t.split("="),i[t[0]]=e(t[1])}),i},fromObject:function(t,e,i){e=e||encodeURIComponent,i=[];var n,r;for(r in t)n=t[r],i.push(r+"="+e("string"==typeof n?n:JSON.stringify(n)));return i.join("&")},parse:function(){return this.fromObject.apply(this,arguments)}},String.prototype.truncate=function(t,e){return t=t||30,e=null==e?"...":e,this.length>t?this.slice(0,t-Math.ceil(e.length/3))+e:this.toString()},String.prototype.fixPrice=function(){return(+this).fixPrice()},String.prototype.bindImgHost=function(){return IMG_HOST+this.replace(/^\//,"")},Number.prototype.toDigits=function(t){var e=""+this,i=t-e.length;return i>0?new Array(i+1).join("0")+e:e},Number.prototype.fixPrice=function(){var t=/^\-?(\d+)\.(\d)(\d)$/.exec(this.toFixed(2));return+t[3]?+this.toFixed(2):+t[2]?+this.toFixed(1):~~this},"function"==typeof define&&define.amd&&define("utils",[],function(){return null}),
//! app.js
define("app",function(){var t=["zepto","utils","underscore","backbone","cookie","catchable","mcache","iScroll","stringFormat","mcache","ddialog"];return/MicroMessenger\/([\d\.]*)/i.test(navigator.userAgent)&&t.push("wxjssdk"),t}(),function(t){function e(){}t.cookie=require("cookie"),t.cookie.domain=".diandao.org";var i=require("mcache"),n=navigator.userAgent,r={os:t.os};!function(t){t&&(r.weixin=1,r.version=t[1])}(/MicroMessenger\/([\d\.]*)/i.exec(n)),t.extend(window,{mCache:i.localCache,LocalCache:i.localCache,RuntimeCache:i.runtimeCache,OrderCache:i.runtimeCache.list("orders"),serviceCache:i.localCache.list("services"),ContactCache:i.runtimeCache.list("contacts"),iScroll:require("iScroll"),wx:r.weixin?require("wxjssdk"):null,DD:require("ddialog"),DD_IOS_VERSION:null,DD_ANDROID_VERSION:null}),window.DDAndroidInterface&&function(){r.app=r.diandao=1,r.version=DDAndroidInterface.getVersionCode?DDAndroidInterface.getVersionCode():null,DD_ANDROID_VERSION=r.version}(),function(t){t&&(r.app=r.diandao=1,r.version=t[1],DD_IOS_VERSION=r.version)}(/\bdiandao\/([\d\.]*)/i.exec(n)),t.extend(window,{IS_DEBUG:0,IS_TEST:window.IS_TEST||!1,IS_WEIXIN:!!r.weixin,IS_APP:window.IS_APP||!!r.app,IS_DD_ANDROID:!!DD_IOS_VERSION,IS_DD_IOS:!!DD_IOS_VERSION}),window.COOKIE_OPEN_ID="",VERSION=window.VERSION||null,SVER=window.SVER||null,SVER!=serviceCache.get("version")&&serviceCache.clear(),serviceCache.set("version",SVER),window.Caches={therapists:[],therapistCitys:{},therapistIndexer:{},getTherapistById:function(t){return this.therapistIndexer[t]||null},completeTherapist:function(t){t.portraiholder="http://ddimg.net/imgs/blank.gif",t.portraiturl=t.portrait?IMG_HOST+t.portrait:t.portraiholder,t.age=(new Date).getFullYear()-t.borthdate.split("-")[0],t.title=(t.am_pic||t.pf_pic||t.other_pic||"").split("|")[0]},getSexString:function(t){return{1:"男",2:"女"}[t]||"null"},getServiceById:function(t){return serviceCache.get(t)},getDayName:function(t){return["周日","周一","周二","周三","周四","周五","周六"][t]},getOrderStatusString:function(t){var e=t.status,i=t.pay_state,n=t.pay_type;return["待支付","待派单","待服务","服务完成",[3,5].indexOf(+n)>=0?"已取消":null][e]||{3:"退款中",4:"退款成功",7:"退款失败",8:"退款成功"}[i]||["","","","","已取消","客服取消","支付超时取消"][e]||"Unknown"},cities:function(e){return e?t.map(e,function(e){return t.extend({},e,{name:e.local_name,id:e.local_id,region:e.range,firstBlood:e.first_blood})}):(alert("城市数据加载错误! "),[])}(window.CITIES),getCityById:function(t){var e=null;return this.cities.forEach(function(i){return i.id==t?(e=i,!1):void 0}),e}},window.onAndroidResume=function(){},window.onAndroidOff=function(){},window.onAndroidTapCity=function(){App.selectCity&&App.selectCity(1)},window.onAppTapCity=function(){return App.selectCity&&App.selectCity(1),!1},window.onAppTapBack=function(){return alert("onAppTapBack"),!1},window.SHARE_RUNTIME_OPT=t.extend({},SHARE_COMMON_OPT),window.WEIXIN_SHARE_OPTION=t.extend({},SHARE_COMMON_OPT),t.extend(t.ajaxSettings,{error:function(t,e){switch(e){case"timeout":alert("网络连接超时,请稍候重试!")}},timeout:3e4}),e.prototype.init=function(){function e(){for(var e=!0,i=0,a=n.length;a>i;i++)if(!r[n[i]].loaded)return e=!1,!1;e&&o.forEach(function(e){t.isFunction(e)&&e()})}for(var i=[].slice.call(arguments,0),n=[],r={},o=[],a=0,s=i.length;s>a;a++)n.push(i[a]),r[i[a]]={loaded:0,calls:[]};this.fire=function(i){r[i].loaded=1,r[i].calls.forEach(function(e){t.isFunction(e)&&e()}),e()},this.on=function(t,e){r[t]&&r[t].calls.push(e)},this.ready=function(t){o.push(t)}},window._gq=window._gq||[],require._ga_send_error&&_gq.push(["send","event","NetworkError","JsReportedButLoaded",location.host+location.pathname,1]),function(){var e=QueryString.pickup(location.search),i=+e.cityid;i&&"/"==location.pathname&&(cids=CITIES.map(function(t){return+t.local_id}),cids.indexOf(i)>=0&&t.cookie("cityid",i))}();var o=t.cookie("cityid")||DEFAULT_CITY_ID,a=window.App={fw:r,os:t.os,platform:"MobileWeb",search:location.search,cityid:o,city:Caches.getCityById(o),snapInterval:null,geolocation:null,_geotm:null,geoenable:!1,_inits:[],onInit:function(t){this._inits.push(t)},init:function(){var e=this;t.each(this._inits,function(t,i){(i||k).call(e)}),this._inits=[]},query:function(){return QueryString.pickup(location.search)},syncCookieCity:function(){var e=t.cookie("cityid");if(e){var i=Caches.getCityById(e);if(i)return a.city=i,a.cityid=i.id,a.setCityName(i.name),i}return null},autoFixCity:function(){LocalCache.get("ignore_auto_fix_city")||a.getGeoLocation(function(e,i){i||a.getCityByGeo(e.coords.latitude,e.coords.longitude,function(e){var i=t.cookie("cityid");0!=e.status&&(i&&i==e.local_id||DD.showMsg("系统定位到您在{local_name}，要切换城市吗？".format(e),{buttons:{"切换[.btn-primary]":function(){t.cookie("cityid",e.local_id),a.syncCookieCity(),a.citychanged=!0,location.replace("/")},"取消[.btn-default]":function(){LocalCache.set("ignore_auto_fix_city",1)}}}))},e.vendor)})},_geoqueue:[],_geolock:!1,getGeoLocation:function(e,i){function n(e,i){clearTimeout(o._geotm),a.geolocation=e,a.geoenable=!i,t.each(o._geoqueue,function(t,n){n(e,i)}),o._geoqueue=[],o._geolock=!1}var o=this;if(o._geoqueue.push(e),!o._geolock){if(o._geolock=!0,a.geolocation&&a.geolocation.timestamp&&+new Date-a.geolocation.timestamp<6e4)return void n(a.geolocation,null);clearTimeout(o._geotm);var s,c=!1,l=QueryString.pickup(location.search);if(/diandao\/(\d\.)+/.test(navigator.userAgent)){if(l.lat&&l.lng)return s={coords:{longitude:l.lng,latitude:l.lat},timestamp:+new Date,coordtype:"wgs84ll"},mCache.set("iosposition",s),void n(s,null);if(s=mCache.get("iosposition"))return void n(s,null);n(null,"No latlng info.")}console.log("getGeoLocation"),navigator.geolocation.getCurrentPosition(function(t,e){console.log("navigator.geolocation: getted. "),e={coords:{longitude:t.coords.longitude,latitude:t.coords.latitude},timestamp:t.timestamp,vendor:"gps",coordtype:"wgs84ll"},c||n(e,null)},function(){console.log("navigator.geolocation: error. "),c||n(null,arguments)}),console.log("geotimeout",i),o._geotm=setTimeout(function(){console.log("get geo timeout"),r.diandao&&a.os.android?a.Interface.getLocation(function(t){t=json(t),t={coords:{longitude:t.lontitude,latitude:t.latitude},addr:t.addr,timestamp:+new Date,vendor:"baidu",coordtype:"bd09ll"},c=!0,n(t,null)}):n(null,"Timeout.")},i||5e3)}},watchSnap:function(){var t=this;t.stopSnap(),this.snapInterval=setInterval(function(){t.snapit()},200)},stopSnap:function(){clearInterval(this.snapInterval)},parseService:function(t){property_alias(t,"id","putting_id","serID","sid"),property_alias(t,"name","service_name"),property_alias(t,"minutes","serTimeInt")},servicesReady:function(e,i){if(i=i||a.cityid,serviceCache.get("cityloaded_"+i)){var n=[];return t.each(serviceCache.get("queue"),function(t,e){var r=serviceCache.get(e);+r.cityid==+i&&n.push(r)}),void(e||k)(n)}this.loadServices(function(t){(e||k)(t)},i)},loadServices:function(e,i){i=i||a.cityid,e=e||k;var n=this;t.ajax({url:"/api/service/get_service_list?city_id="+i,dataType:"json",success:function(i,r){a.updateLogined(i),r=i.data;var o=serviceCache.get("queue")||[];t.each(r,function(t,e,i){a.parseService(e),i=+e.serID,serviceCache.set(i,e),-1==o.indexOf(i)&&o.push(i),serviceCache.set("cityloaded_"+e.cityid,1)}),serviceCache.set("queue",o),e.call(n,r)}})},loadService:function(e,i,n){function r(){var e=[];t.each(s,function(t,i){e.push(Caches.getServiceById(i))}),(i||k).call(o,e)}var o=this,s=e?(e||"").split(","):[],c=[];return t.each(s,function(t,e){var i=Caches.getServiceById(e);(!i||n&&!i.complex)&&c.push(e)}),c.length?(n=n?1:0,void t.getJSON("/api/service/get?complex="+n+"&ids="+c.join(","),function(t){var e=serviceCache.get("queue")||[];a.updateLogined(t),t.data.forEach(function(t,i){a.parseService(t),i=+t.serID,serviceCache.set(i,t),-1==e.indexOf(i)&&e.push(i)}),serviceCache.set("queue",e),r()})):void r()},snapit:_.throttle(function(){t(window).snapit()},100),uid:null,isLogined:!1,login:function(e){var i={redirect:"",replace:!1};e=e||{},e=t.extend(i,e);var n=e.redirect?"?"+QueryString.parse({redirect:e.redirect}):"",r="/login/"+n;setTimeout(function(){e.replace?location.replace(r):location.href=r},0)},lock_check_login:0,check_login_queue:[],checkLogin:function(e,i){function n(e){t.each(o.check_login_queue,function(t,i){i.call(o,e)}),o.check_login_queue=[],o.lock_check_login=!1}var o=this;return e=e||k,o.isLogined?void(e||k).call(o,!0):(o.check_login_queue.push(e),o.lock_check_login?void 0:(o.lock_check_login=1,r.diandao&&a.os.android&&r.version>1008&&r.version<1010&&!i?void a.Interface.getToken(function(i){return i=json(i),i.uid&&i.mobile?void t.post("/api/user/check_app",{key:i.uid,mobile:i.mobile},function(t){return t=json(t),t.error?o.checkLogin(e,1):(o.updateLogined(t),void n(!0))}):(o.lock_check_login=!1,o.checkLogin(e,1))}):void t.ajax({url:"/api/user/is_login",cache:!1,dataType:"json",success:function(t,e){if(t.error)return void DD.alert(t.error.message);e=t.data;var i=!!t.logined;o.isLogined=i,n(i),o.updateLogined(t)},complete:function(){o.lock_check_login=!1}})))},weixinAuth:function(){r.weixin&&a.checkLogin(function(e){var i=t.cookie("open_id");i||e||(location.href=WEIXIN_AUTH+"?back_url="+escape("http://m.diandao.org/api/index/dispatch?back_url="+location.href))})},updateLogined:function(e,i){e&&(this.isLogined=e.logined,this.uid=+e.uid,!this.isLogined&&i&&(t.isFunction(i)?i():location.href="/login/"),e.utime&&(this.__last_server_time=1e3*e.utime,this.__last_server_stamp=+new Date))},serverTime:function(){var t=+new Date;return this.__last_server_time?this.__last_server_time+(t-this.__last_server_stamp):t},serverDate:function(){return new Date(this.serverTime()-this.timeDiff())},dayTimestamp:function(t){var e=new Date(t),i=[e.getFullYear(),e.getMonth()+1,e.getDate()];return+new Date(i.join("/"))},getDateString:function(t){return[t.getFullYear(),(t.getMonth()+1).toDigits(2),t.getDate().toDigits(2)].join("-")},getTimeString:function(t){return[t.getHours().toDigits(2),t.getMinutes().toDigits(2),t.getSeconds().toDigits(2)].join(":")},_timediff:null,timeDiff:function(){var t=this;return t._timediff?t._timediff:(t._timediff=6e4*(-480-(new Date).getTimezoneOffset()),t._timediff)},dateFormat:function(t,e,i){var n=this.timeDiff();return e=new Date(+e-n),i={Y:e.getFullYear(),M:(e.getMonth()+1).toDigits(2),D:e.getDate().toDigits(2),h:e.getHours().toDigits(2),m:e.getMinutes().toDigits(2),i:e.getSeconds().toDigits(2),cd:a.dateCD(e)},t.format(i)},dateCD:function(t){var e=~~((+t-+new Date)/1e3),i=Math.floor(e/60),n=Math.floor(i/60),r=Math.floor(n/24);return 60>e?e+"秒后":60>i?i+"分钟后":24>n?n+"小时后":r+"天后"},$body:t("body"),setState:function(t){console.log("setState:"+t),this.state=t,this.$body.attr("class","state-"+t)},getOrder:function(e,i,n){var r=OrderCache.get(e);if(r&&!n)return void(i||k).call(o,r);var o=this,s=a.query();t.getJSON("/api/order/getById?order_id="+e+(s.atk?"&atk="+s.atk:""),function(t){t.data&&(t.data.detailFetched=1),OrderCache.set(e,t.data),(i||k).call(o,t.data,t.error)})},cancelOrder:function(e,i,n,r,o){var s=this;n=n||"",r=r||"",!o&&DD.loading("订单取消中..."),a.getOrder(e,function(c){t.post("/api/order/cancel_order",{order_id:e,cancel_id:n,cancel_note:r},function(t){return!o&&DD.loadend(),t=json(t),t.error?void DD.alert(t.error.message):(!o&&DD.popup("订单已取消."),a.ga.trackEvent("Order","cancel_success",[e,c.status,a.uid,r||n].join(","),1),OrderCache.remove(e),void(i||k).call(s,e))})})},goToPayOrder:function(t,e){var i="/pay/No."+t;e?location.replace(i):location.href=i},getTherapist:function(e,i){var n=this;t.getJSON("/api/therapist/get_therapist?tid="+e,function(t,r){return a.updateLogined(t),t.error?void DD.alert(t.error.message):(r=t.data,Caches.therapistIndexer[e]=r,Caches.completeTherapist(r),void i.call(n,r))})},getCoupons:function(e,i,n,r){r=t.extend({start:e,limit:i},r||{});var o=this;t.getJSON("/api/payment/get_coupon_list",r,function(t){return a.updateLogined(t),t.error?void DD.alert(t.error.message):void(n||k).call(o,t.data)})},applyCouponFilter:function(e,i){if(i=i||{},i=t.extend({cityid:a.cityid,source:a.source,therapyid:null,tid:null,price:null},i),e.limit_ser){var n=!1;t.each(e.limit_ser.split(","),function(t,e){return e==i.therapyid?(n=!0,!1):void 0}),n||(e.error=e.limit_desc)}return e.limit_price&&+i.price&&i.price<e.limit_price&&(e.error=e.limit_desc),e.limit_city&&(""+e.limit_city).split(",").indexOf(""+i.cityid)<0&&(e.error="当前城市不可用。"),e.limit_source&&(""+e.limit_source).split(",").indexOf(""+i.source)<0&&(e.error=e.limit_desc),+e.noMasseur&&+i.tid&&(e.error=e.limit_desc),!e.error},batch:function(){var t=new e;return t.init.apply(t,arguments),t},isMobile:function(t){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(t)},getAccountBalance:function(e){t.getJSON("/api/payment/card_amount",function(t){return t.error?void DD.alert(t.error.message):(Caches.accountBalance=t.data,void(e||k)(t.data))})},getShareAward:function(e){t.getJSON("/api/order/get_share_coupon",function(t){(e||k)(t)})},title:null,titles:{DEFAULT:"点到",CITY_PICKER:"选择城市",ADDRESS_COMMIT:"我的位置",SERVICE_LIST:"点到",SERVICE_DETAIL:"服务详情",THERAPIST_LIST:"点到",THERAPIST_DETAIL:"查看技师",THERAPIST_PICKER:"选择技师",BOOKING:"预约下单",PAY:"支付订单",PAY_RESULT:"支付结果",ORDER:"我的订单",ORDER_DETAIL:"查看订单",ORDER_COMMENT:"服务点评",ORDER_BREAK:"取消服务",LOGIN:"登录",MY_HOME:"我的点到",MY_BALANCE:"我的礼金",MY_BALANCE_LOG:"礼金明细",MY_BALANCE_FAQ:"礼品卡FAQ",MY_COUPONS:"我的优惠券"},setTitle:function(e,i){var n=this;if(e=e||n.titles.DEFAULT,i&&(e=e.format(i)),window.IS_TEST&&(e="测试环境"),document.title=e,(r.daojia||r.weixin)&&t.os.ios)var o=t('<iframe src="/favicon.ico"></iframe>').on("load",function(){setTimeout(function(){o.off("load").remove()},10)}).appendTo(n.$body)},markShared:function(e,i){t.post("/api/order/share_order",{order_id:e},function(t){return t=json(t),t.error?void alert(t.error.message):void(i||k)(t)})},flushHistory:function(t){return this.AndroidInterface.clearCache(t)},_InterfaceCallbacks:{},AndroidInterface:{_call:function(t){return r.diandao?(a.os.ios&&(t.timestamp=+new Date),a.os.ios?null:DDAndroidInterface.jsCallMethod(JSON.stringify(t))):void 0},setTitle:function(t){return a.os.ios?this._call({action:"setTitle",params:[t]}):!1},setMenu:function(t,e,i){return this._call({action:"setmenu",visible:t,refreshonly:!!i,params:e})},clearCache:function(t){return App._InterfaceCallbacks.clearcache=t||k,a.os.android?this._call({action:"clearcaches",callback:"App._InterfaceCallbacks.clearcache"}):!1},getUserInfo:function(t){return App._InterfaceCallbacks.getuserinfo=t||k,this._call(a.os.ios?{action:"getUserInfo",params:[],callback:"App._InterfaceCallbacks.getuserinfo"}:{action:"getuserinfo",callback:"App._InterfaceCallbacks.getuserinfo"})},updateImage:function(t,e,i){return App._InterfaceCallbacks.updateimg=i||k,this._call({action:"updateimg",url:t,version:e,callback:"App._InterfaceCallbacks.updateimg"})},openGPS:function(t){return App._InterfaceCallbacks.opengps=t||k,this._call({action:"opengps",callback:"App._InterfaceCallbacks.opengps"})},getLocation:function(t){return App._InterfaceCallbacks.getlocation=t||k,this._call(a.os.ios?{action:"getLocation",params:[],callback:"App._InterfaceCallbacks.getlocation"}:{action:"getLocation",callback:"App._InterfaceCallbacks.getlocation"})},setCity:function(t,e){return this._call(a.os.ios?{action:"setCity",params:[t,e?"1":"0"]}:{action:"setcity",name:t,replace:!!e})},toHome:function(){this.clearCache(),location.href="/"},logined:function(t,e){return a.os.ios?null:this._call({action:"logined",mobile:t,uid:e})},share:function(e){return e=t.extend({},SHARE_COMMON_OPT,e),App._InterfaceCallbacks.share=e.callback||k,a.os.ios?null:this._call({action:"share",title:e.title,url:e.link,desc:e.desc,img:e.imgUrl,callback:"App._InterfaceCallbacks.share"})},setShareButton:function(t){r.version<=1008||a.Interface.setMenu(!0,{},!t)},getToken:function(t){return App._InterfaceCallbacks.gettoken=t||k,a.os.ios?null:this._call({action:"getToken",callback:"App._InterfaceCallbacks.gettoken"})}},invoker:{androidShare:function(){App.Interface.share(SHARE_RUNTIME_OPT)}},ga:{_reset:function(){this.set({page:location.pathname,location:location.href,title:document.title})},send:function(t){return t=["send"].concat([].slice.call(arguments,0)),_gq.push(t)},set:function(t){return t=["set"].concat([].slice.call(arguments,0)),_gq.push(t)},trackPage:function(t){this._reset();var e=[location.protocol,"//",location.hostname,location.pathname,location.search].join("");return t=t||{location:e,title:document.title,page:null},this.send("pageview",t)},trackEvent:function(t){return this._reset(),t=["event"].concat([].slice.call(arguments,0)),this.send.apply(this,t)}},wx:{handshake:function(e){if(r.weixin){var i={protocol:location.protocol,host:location.host,uri:location.pathname+location.search};t.post("/api/weiXin/getsdkconfig?"+QueryString.fromObject(i,escape),function(i){i=json(i),wx.ready(function(){t("html").addClass("wx-ready")}),wx.config(t.extend(i.data,{debug:!!e,jsApiList:"checkJsApi,onMenuShareTimeline,onMenuShareAppMessage,onMenuShareQQ,onMenuShareWeibo".split(",")}))})}},configShare:function(){r.weixin&&wx.ready(function(){t("html").addClass("wx-ready"),a.wx.onShare(SHARE_RUNTIME_OPT)})},onShare:function(e){r.weixin&&(e=t.extend({},SHARE_RUNTIME_OPT,e),wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e))},debug:function(t){alert(t)},shareHelper:function(e,i){var n=t("#wx_share_helper");n.size()||(n=t(['<dl id="wx_share_helper" class="wx-share-helper" style="display:none">',"<dt ><i class=icon-wxshare-arrow></i></dt>","<dd>1. 点击箭头上方按钮 <label><i class=icon-wxshare-opt></i></label></dd>","<dd>2. 点击菜单里的 <label><i class=icon-wxshare-timeline></i><span>分享到朋友圈</span></label></dd>","</dl>"].join("")).appendTo("body"),n.on(tapEvent,function(e){stopTouchPropagation(e),(i||k).call(this)!==!1&&t(this).hide()})),n[e?"show":"hide"]()},formatShareOption:function(e,i,n){return n=t.extend({},e),i=t.extend({firstpayment:FIRST_PAYMENT,tname:"",timg:"",tid:0,uid:0,oid:0,cityid:0,source:"share_common",medium:"weixin",type:""},i||{}),t.each(n,function(t,e){"string"==typeof e&&(n[t]=e.format(i))}),n}},gainsLuckyPacket:function(t,e,i,n,r){r=["<div>","<i></i>","<b>{#0}</b>","<p>{#1}</p>","</div>"].join("").format(t,e),DD.showMsg(r,{buttons:{"不要红包[.btn-default]":n||k,"分享领取[.btn-danger]":i||k},addClass:"lucky-packet"})},history:window.history,isNewYear:function(){return!1}()};return App.Interface=App.AndroidInterface,a.source=0,a.onInit(function(){a.sourceMap={0:"手机网页版",1:"微信客户端",2:"点到iOSApp",3:"点到安卓APP",9:"点到测试",18:"小米生活APP",17:"乐送易才APP",30:"触宝电话APP",20:"58到家APP",25:"360手机助手",10008:"大众点评购买支付",10008:"美团购买支付"},r.weixin&&(a.platform="MicroMessage",a.source=1,a.weixinAuth()),a.source={"360life":11,milife:18,touchlife:30,dj:20}[location.host.split(".")[0]]||a.source,a.fw.app=IS_APP,r.app&&(t("html").addClass("appframework"),a.os.ios&&(a.source=2),a.os.android&&(a.source=3)),r.diandao&&a.os.android&&(a.platform="AndroidWebView",a.Interface.getUserInfo(function(e){e=json(e),a.os.android&&(r.version=e.VersionCode,t.cookie("andr_token",[e.PhoneModel,e.IMEI].join(":")),e.isGPSOpen||t.cookie("requestgps")||(t.cookie("requestgps","1",{expires:.5}),a.Interface.openGPS()))}),a.checkLogin()),IS_DD_IOS&&(a.platform="iOSWebView")}),t.cookie("pf",a.platform,{domain:"diandao.org"}),t("body").on([touchStartEvent].join(" "),".tapable",function(){t(this).addClass("tapped")}).on([touchStopEvent,touchMoveEvent,"touchcancel"].join(" "),".tapable",function(){t(this).removeClass("tapped")}),t("body").on(tapEvent,"input",function(){t(this).focus()}),t("body").on(tapEvent,"[href]",function(e){if(!t(this).is("a")){stopTouchPropagation(e);var i=this.getAttribute("href"),n=this.getAttribute("logined");null===n||"string"==typeof n&&"false"===n.toLowerCase()?location.href=i:a.checkLogin(function(t){t?location.href=i:a.login({redirect:i,replace:!1})})}}),t("body").on(tapEvent,"[clkt]",function(){t(this).trackClick()}),t.fn.trackClick=function(){return this.each(function(){var t=this.getAttribute("clkt");t&&(this._last_clkt&&+new Date-this._last_clkt<1e3||(a.ga.trackEvent("ClickTracks",location.pathname,t,1),this._last_clkt=+new Date))})},t(document).on("ajaxBeforeSend",function(t,e){e._send_timestamp=+new Date}),t(document).on("ajaxError",function(t,e,i,n){a.ga.trackEvent("AjaxError",[e.status,n].join(":"),i.url,1)}),t(document).on("ajaxSuccess",function(t,e,i,n,r){if(window.GA_TRACK_AJAX_DURATION){var o=+new Date-e._send_timestamp,s=i.url.split("?")[0];/^http(s)?/.test(s)||(s=[location.protocol,"//",location.host,s].join("")),a.ga.trackEvent("AjaxDuration",s,a.city?a.city.name:"Unknown",o)}"[object Object]"=={}.toString.call(n)&&(void 0!==n.logined&&a.updateLogined(n),n.error&&(r=n.error,a.ga.trackEvent("AjaxInterrupt",[r.code||0,r.message].join(":"),i.url,1)))}),document.addEventListener("WeixinJSBridgeReady",function(){App.wx.onShare({})},!1),a}),define("ddialog",["zepto","utils"],function(t){var e=DD={$msgview:function(){var e=t("#alert"),i=t("#alert_mask");return i.on(touchStartEvent,stopTouchPropagation),e.on(touchMoveEvent,preventDefault),e.on(tapEvent,"button",function(t){stopTouchPropagation(t);var e=this.__taphandle;e.call(DD)!==!1&&DD.closeMsg()}),e[0].mask=i[0],e}(),$pop:t("#alert_pop"),$loading:function(){var e=t("<div class=net-loading><u></u><div><i class=icon-loading-spin></i><p><span>加载中...</span></p></div></div>").appendTo("body");return e}(),_tm_loading:null,loading:function(t,e){var i=this;e=e||3e4,clearTimeout(i._tm_loading),this.$loading.addClass("processing").find("p").html(t?"<span>"+t+"</span>":""),i._tm_loading=setTimeout(function(){i.loadend()},e)},loadend:function(){this.$loading.removeClass("processing")},closeMsg:function(){t("body").removeRegClass(/\balert-.*\b/),DD.$msgview.removeRegClass(/\balert-.*\b/),t(DD.$msgview[0].mask).removeRegClass(/\balert-mask-.*\b/)},showMsg:function(e,i){var n={"确认[.ok]":k,"取消[.cancel]":k},r={addClass:""};i=i||{},i=t.extend(r,i);var o=i.addClass,a=o?"alert-"+o:"",s=o?"alert-mask-"+o:"",c=o?"alert-show-"+o:"";i.buttons=i.buttons||n,t(DD.$msgview[0].mask).attr("class","alert-mask "+s),DD.$msgview.attr("class","alert "+a).find("h3").html(e);var l=DD.$msgview.find("ul").html(""),u=0;t.each(i.buttons,function(e,i){var n=/^(.*?)(\[\.(.*)\])?$/.exec(e),r=n[1],o=n[3]||"",a=t('<li><button class="tapable alert-btn '+o+'">'+r+"</button></li>");a.find("button")[0].__taphandle=i,l.append(a),u++}),l.find("li").css({width:100/u+"%"}),t("body").addClass("alert-show "+c)},confirm:function(t,e,i){return e=e||k,i=i||k,DD.showMsg(t,{buttons:{"取消[.btn-default]":i,"确定[.btn-primary]":e}})},alert:function(t,e){return e=e||k,DD.showMsg(t,{buttons:{"确定[.btn-primary]":e}})},_poptimeout:null,popup:function(t,e){var i=this;e=e||1500,clearTimeout(this._poptimeout),this.$pop.html(t).addClass("popup"),this._poptimeout=setTimeout(function(){i.$pop.removeClass("popup")},e)}};return e}),
//! appointment appext.js
define("appointment-appext",["app","zepto"],function(t,e){e.extend(t,{$sections:e("#sections"),$wrap:e("#view_appointment"),$categories:e("#appointment_category"),$view:e("#appointments"),curlocation:{},maxScreen:!1,setMaxSceen:function(t){var e=this;if(t){if(e.maxScreen)return;e.maxScreen=!0,e.$wrap.addClass("max-screen")}else{if(!e.maxScreen)return;e.maxScreen=!1,e.$wrap.removeClass("max-screen")}},setApointmentState:function(t){this.$view.removeClass("app-services app-therapists").addClass("app-"+t)},queryPlace:function(i,n,r){e.getJSON("/api/local/bd_query",{kw:i,cityid:r||t.cityid},function(e){return e.error?void t.ga.trackEvent("API_ERROR","/api/local/bd_query","{code}:{message}".format(e.error),1):void(n||k)(e.data)})},placePoi:function(i,n,r){e.getJSON("/api/local/bd_place",{kw:i,cityid:r||t.cityid},function(e){return e.error?void t.ga.trackEvent("API_ERROR","/api/local/bd_query","{code}:{message}".format(e.error),1):void(n||k)(e.data)})},_geocity:null,getCityByGeo:function(t,i,n,r){var o=this;return o._geocity?(n||k)(o._geocity):(r=r||"",void e.getJSON("/api/local/get_current_city",{lat:t,lng:i,vendor:r},function(t){o._geocity=t.data,(n||k)(t.data)}))},geoCoder:function(t,i,n){e.getJSON("http://api.map.baidu.com/geocoder/v2/?callback=?",{ak:BAIDU_API_KEY,location:t,output:"json",coordtype:n||"wgs84ll",pois:1},function(t){(i||k)(t)})},_load_contacts_lock:!1,_load_contacts_queue:[],loadContacts:function(i,n){function r(){e.each(o._load_contacts_queue,function(t,e){(e||k).call(o,ContactCache.get("cityid_"+n)||[],null)}),o._load_contacts_queue=[],o._load_contacts_lock=!1}console.log("loadContacts");var o=this;n=n||t.cityid,o._load_contacts_queue.push(i),o._load_contacts_lock||(o._load_contacts_lock=!0,t.checkLogin(function(){return!t.isLogined||ContactCache.get("cityid_"+n)?void r():void e.ajax({url:"/api/user/get_address",data:{cityid:n},dataType:"json",cache:!1,success:function(t,i){i=[],e.each(t.data,function(t,e){if(!e.location||!+e.location.lat||!e.street)return!0;ContactCache.set(e.cid,e);for(var i=ContactCache.get("cityid_"+e.local_id)||[],n=0,r=i.length;r>n;n++)if(i[n].cid==e.cid)return!0;i.push(e),ContactCache.set("cityid_"+e.local_id,i)}),r()}})}))},getLocationFromContacts:function(i){t.loadContacts(function(n,r){var o=null;e.each(n,function(e,i){return i.local_id==t.cityid?(o=i,!1):void 0}),(i||k)(o,r||(o?null:{message:"none"}))})},locCookie:function(i){t.cityid;return i||null===i?void e.cookie("loc_"+t.cityid,null===i?null:JSON.stringify(i)):(i=e.cookie("loc_"+t.cityid),i=i?json(i):null)},_query_curlocation_lock:!1,_query_curlocation_queue:[],queryCurLocation:function(i){function n(){t.queryGeoLocation(function(t,e){e?(curlocation.error=e,curlocation.disabled=!0):(curlocation.addr=t.result.sematic_description,curlocation.location=t.result.location,curlocation.vendor="baidu",curlocation.error=null),o.fire("getted")})}var r=this;if(r._query_curlocation_queue.push(i),!r._query_curlocation_lock){r._query_curlocation_lock=!0;var o=t.batch("getted");if(curlocation=t.curlocation,o.ready(function(){e.each(r._query_curlocation_queue,function(e,i){(i||k).call(r,t.curlocation)}),r._query_curlocation_lock=!1,r._query_curlocation_queue=[]}),curlocation.location)return void o.fire("getted");var a=t.locCookie();if(a){if(a.location)return t.curlocation=a,void o.fire("getted");t.locCookie(null)}t.checkLogin(function(e){e?t.getLocationFromContacts(function(t,e){return e?void n():(curlocation.addr=t.addr,curlocation.doorplate=t.doorplate||"",curlocation.street=t.street||"",curlocation.location=t.location,curlocation.error=null,curlocation.vendor="baidu",void o.fire("getted"))}):n()})}},queryGeoLocation:function(e,i){t.getGeoLocation(function(i,n){return n?void(e||k)(null,n):void t.geoCoder([i.coords.latitude,i.coords.longitude].join(","),function(t){(e||k)(t,null)},i.coordtype)},i)},set_location_callback:null,setLocation:function(e,i,n){i=i||{},n=i.fragment||"setlocal",this.set_location_callback=e||k,this.set_location_poi=i.poi||null,this.set_location_cityid=i.cityid||t.cityid,Router.navigate(n,{trigger:!0})},BaiduDistance:function(t,e){function i(t){return t*Math.PI/180}var n=6378.137,r=i(+t.lat),o=i(+e.lat),a=r-o,s=i(+t.lng)-i(+e.lng),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin(s/2),2)));return c*=n,c=Math.round(1e4*c)/1e4,1e3*c},serviceReachable:function(i,n,r){e.getJSON("/api/local/in_polygon?_="+(""+ +new Date).substr(0,7),{local_id:i,lng_lat:[n.location.lng,n.location.lat].join(","),vendor:n.vendor||""},function(e){(r||k).call(t,e.data.reachable)})},getTherapistData:function(t,i){var n=this;e.ajax({url:"/api/therapist/get_therapist?tid="+t,cache:!1,dataType:"json",success:function(e,r){return e.error?void DD.alert(e.error.message):(r=e.data,r.detail_cached=1,Caches.therapistIndexer[t]=r,Caches.completeTherapist(r),void i.call(n,r))}})}}),t.onInit(function(){var i=this;t.wx.handshake(),t.getGeoLocation(function(t,e){e||mCache.set("geolocation",t.coords)},1e4),i.$sections.on(tapEvent,function(){t.selectCity(0)}),i.$categories.find("li").each(function(){e(this).click(function(){Router.navigate(this.getAttribute("nav"),{trigger:!0,replace:!0})})}),i.$categories.find("p").on(tapEvent,function(t){t.preventDefault(),t.stopPropagation(),Router.navigate("selcity",{trigger:!0,replace:!0})}),i.$view.on("swipeRight",function(){Router.navigate("#services",{trigger:!0,replace:!0})}).on("swipeLeft",function(){Router.navigate("#therapists",{trigger:!0,replace:!0})}).on("swipeUp",function(){}).on("swipeDown",function(){i.setMaxSceen(0)}).on(touchStartEvent,preventDefault)})}),
//! appointment router.js
define("appointment-router",["app","zepto"],function(t,e,i){var n=(require("ddialog"),{routes:{"":"services",setlocal:"setlocal","setlocal-booking":"setlocal",services:"services",therapists:"therapists","therapist-certs":"therapistcerts","service/:id":"viewService","therapist/:id":"viewTherapist","booking/s:sid/t:tid":"booking"},__beforeAction:function(n){var r=QueryString.pickup(location.search);r.notop&&e("html").addClass("notop"),e("input").blur(),t.lastFragment=t._lastFragment===i?"selcity"==n?"services":null:t._lastFragment,t._lastFragment=n,t.wx.shareHelper(0),t.selectCity&&t.selectCity(0),n&&"services"!=n&&t.noCityName&&t.noCityName(),n&&!/booking/i.test(n)&&e.cookie("loginviewed",null),n&&!/booking|therapistpicker/i.test(n)&&(t._therapist_picker_viewed=null),t.stopSnap()}});return n}),
//! view.citypicker.js
define("appointment-citypicker",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){function r(){return this.init.apply(this,arguments)}require("appointment-appext");return r.prototype={$view:n("#view_selcity"),iscroll:null,init:function(){var e=this;this.render(),e.$view.on("cityselect",function(e,i){t.setCityName(i.name),t.citychanged=!(t.cityid==i.id),t.cityid=i.id,t.city=i,n.cookie("cityid",i.id),t.selectCity(0),t.citychanged&&(console.log("citychanged"),t.curlocation={});var r=Backbone.history.getFragment();null===t.lastFragment||r==t.lastFragment?Router[Router.routes[r]]():(0==t.lastFragment.indexOf("therapists")&&(t.lastFragment="therapists"),Router.navigate(t.lastFragment,{trigger:!0,replace:!0}))}),e.$view.on("swipeDown",function(e){e.stopPropagation(),e.preventDefault(),n.cookie("cityid")&&t.history.back()}),e.$view.on(tapEvent,stopTouchPropagation).on(touchMoveEvent,preventDefault),e.$view.find("li").on("click",function(t){stopTouchPropagation(t),t.preventDefault(),t.stopPropagation();var i=this.getAttribute("cityid");n(this).addClass("selected").siblings().removeClass("selected"),e.$view.trigger("cityselect",Caches.getCityById(i))});var i=t.syncCookieCity();i&&this.$view.find('li[cityid="'+i.id+'"]').addClass("selected").siblings().removeClass("selected")},render:function(){var t=this;t.$view.html(["<div class=iscroll>","<div class=wrap>","<h1>请选择服务城市</h1>","<ul>",function(t,e){return t.forEach(function(t){e.push("<li cityid={id} class=tapable><h2>{name}<i class=icon-ok></i></h2><p>服务范围:{region}</p></li>".format(t))}),e.join("")}(Caches.cities,[]),"</ul>","<h3><span>我们正在筹备更多城市，敬请期待</span></h3>","</div>","</div>"].join("")),this.iscroll?this.iscroll.refresh():this.iscroll=new iScroll(this.$view.find(".iscroll")[0])}},n.extend(t,{setCityName:function(e){e=e||t.city.name,IS_APP?t.Interface.setCity(e,!0):t.$categories.find(".cityname").text(e)},noCityName:function(){t.Interface.setCity("",!1)},selectCity:function(t){n("body")[t?"addClass":"removeClass"]("state-selcity")}}),i.routes.selcity="selcity",i.selcity=function(){t.setTitle(t.titles.CITY_PICKER),"m.diandao.org"==location.host&&t.autoFixCity(),t.selectCity(1),mCache.set("fromSelectCity",1),t.ga.trackPage()},t.onInit(function(){t.CityPickerView=new r}),r}),
//! view.services.js
define("appointment-services",["app","appointment-appext","appointment-router","zepto","loadimg"],function(t,e,i,n){var r=require("ddialog"),o=require("loadimg"),a=function(){return this.init.apply(this,arguments)};return a.prototype={$view:n("#view_services"),$list:n("#list_services"),iscroll:null,init:function(){var e=this;e.$view.html(['<div class="iscroll-wrapper">','<style id="banner_style"></style>','<div id="ad_banner" class="ad-banner" >','<div class="adscroll"><ul></ul></div>',"<dl></dl>","</div>",'<ul id="list_services" class=list-services></ul>',"m.diandao.org"==location.host?["<ul class=links></ul>"].join(""):"","</div>"].join("")),e.$ad=n("#ad_banner"),e.$list=n("#list_services"),e.$links=e.$view.find(".links"),e.adscroll=new iScroll(e.$ad.find(".adscroll")[0],{momentum:!0,bounce:!1,hScroll:!0,vScroll:!1,hScrollbar:!1,vScrollbar:!1,snap:!0,useTransition:!1,onScrollEnd:function(){if(e._banner_imgs&&e._banner_imgs.length>1){var t=~~(-this.x/this.wrapperW);e.setBannerIndex(+n(this.scroller).find("li")[t].getAttribute("index"))}}}),e.autoPlayBanner(5e3),e.$ad.on("touchstart",function(){clearTimeout(e._banner_interval)}).on("touchend",function(){e.autoPlayBanner(5e3)}),this.iscroll=new iScroll(this.$view[0],{vScrollbar:!1,onRefreshed:function(){var e=this.vScrollbarWrapper;e&&t.$wrap.append(this.vScrollbarWrapper)}}),e.$ad.on(tapEvent,"li",function(t){stopTouchPropagation(t,this);var i=e._banner_imgs[this.getAttribute("index")];e._banner_tap_callback&&e._banner_tap_callback.call(i,i)}),e.$ad.on("swipeLeft",function(t){stopTouchPropagation(t)}),n(window).resize(function(){e.updateImgHeight(),e.updateBannerSize()})},load:function(e){e=e||k;var i=this;t.servicesReady(function(t){i.render(t),e.call(i,t)})},render:function(e){var i=this,r=[];if(e.sort(function(t,e){return+t.index>+e.index}),n.each(e,function(t,e){return+e.isq?!0:+e.showflag?void r.push(['<li sid={id} class="tapable li-',t,'" clkt="serIndex:',t,';sid:{id}">',"<dl>",'<dt class="seritem" style="background-image:url({thumbnail})" >',"</dt>","<dd>","<h2>{name}</h2>","<p class=sell><i>{price|fixPrice}元</i><span>/{minutes}分钟</span></p>","</dd>","</dl>","</li>"].join("").format(e)):!0}),i.$list.html(r.join("")),i.updateImgHeight(),i.$list.find("[booking]").on(tapEvent,function(e){e.stopPropagation(),e.preventDefault();var i=this.getAttribute("booking");t.checkLogin(function(e){e?Router.navigate("booking/"+i,{trigger:!0}):t.login({redirect:"/booking/"+i,replace:!1,logined:function(){Router.navigate("booking/"+i,{trigger:!0})}})})}),i.onBannerInit&&i.onBannerInit.call(i),i.$links.html([2==t.cityid?'<div class=bs></div><li clkt="免费康复检测" href="http://form.mikecrm.com/f.php?t=Ftvql1" class=tapable>免费康复检测</li>':"",'<li clkt="企业体验申请" href="http://diandao.org/qiye/index.php/Home/Index/qiyelist" class=tapable>企业体验申请</li>','<li clkt="礼金充值返券" href="/my/balance" class=tapable>礼金充值返券</li>','<li clkt="条款与声明" href="http://m.diandao.org/aboutus/" class="tapable statement">条款与声明&raquo;</li>'].join("<div class=bs></div>")),i._banner_imgs&&i._banner_imgs.length){var a=i._banner_imgs[0].url;o(a,function(t,e,n){return n?void console.log(n):void i.updateBannerSize(e)})}else i.updateBannerSize({width:0,height:0}),setTimeout(function(){i.iscroll.refresh()},1e3);i.$list.find("li").on(tapEvent,function(t){stopTouchPropagation(t,this);var e=this.getAttribute("sid");Router.navigate("service/"+e,{trigger:!0})}),i.iscroll.refresh()},updateImgHeight:function(){var t=this,e=t.$list.find("li dt").eq(0).width();t.$list.find("li dt").height(e/2)},showValidCoupons:function(){var e=this;["touchlife.diandao.org"].indexOf(location.host.toLowerCase())>0||e.$list.find("li").each(function(){var i=null;if(t.isLogined){var r=+n(this).attr("sid"),o=Caches.getServiceById(r),a=o.therapyid;n.each(e.coupons.slice(0),function(e,n){return n.error=null,t.applyCouponFilter(n,{therapyid:a,price:o.price*o.min_num*100})?(i="<b>优惠券立减"+n.value/100+"</b>",!1):void 0})}else i="<b>新用户立减{firstBlood}</b>".format(t.city);i&&n(this).find(".seritem").append(i)})},_banner_img_size:null,_banner_img_index:0,setBanner:function(e,i){var n=this;n._banner_imgs=e,n._banner_tap_callback=i||k;var r=n.$ad.find("ul"),o=n.$ad.find("dl");r.html(function(i){return e.forEach(function(e,n){i.push('<li index={#2} clkt="banner:city{#1};i{#2}" style="background-image:url({url})"></li>'.format(e,t.cityid,n))}),i.join("")}([])),n.$banners=r.find("li"),o.html(e.length>1?new Array(e.length+1).join("<dd></dd>"):""),o.find("dd").eq(0).addClass("current"),n._banner_img_index=0,n.adscroll&&n.adscroll.refresh()},updateBannerSize:function(t){var e=this;if(t=t||e._banner_img_size){e._banner_img_size=t;var i=t.height*(n(window).width()/t.width);n("#banner_style").html([".view-services .ad-banner {height:",i,"px}",".view-services .adscroll li{height:",i,"px; width:",n(window).width(),"px}"].join("")),e.adscroll&&e.adscroll.refresh(),setTimeout(function(){e.iscroll&&e.iscroll.refresh()},1e3)}},setBannerIndex:function(t){t=+t;var e=this,i=e._banner_imgs,n=e.adscroll,r=e.$ad.find("ul"),o=e.$ad.find("dl"),a=r.find("li");a.not("[index='"+t+"']").remove(),a.filter("[index='"+t+"']").slice(1).remove(),n._pos(0,0),i.length<2||(r.prepend(e.getBannerImg(t-1)),r.append(e.getBannerImg(t+1)),n.refresh(),n._pos(-n.wrapperW,0),o.find("dd").eq(t).addClass("current").siblings().removeClass("current"))},getBannerImg:function(t){var e=this,i=e._banner_imgs,n=i.length;return t=(t+n)%n,e.$banners.eq(t).clone()},_banner_interval:null,autoPlayBanner:function(e){var i=this;clearTimeout(i._banner_interval),i._banner_interval=setTimeout(function(){i.autoPlayBanner(e);var n=i.adscroll;"services"==t.state&&n&&i._banner_img_size&&i._banner_imgs&&!(i._banner_imgs.length<2)&&n.scrollTo(n.wrapperW,0,500,!0)},e)},onBannerInit:function(){}},i.routes.services="services",i.services=function(){t.TherapistListView=t.TherapistListView||new(require("appointment-therapists")),t.ServiceListView=t.ServiceListView||new(require("appointment-services")),"m.diandao.org"==location.host&&t.autoFixCity();var e=n.cookie("cityid");if(!e||!Caches.getCityById(e))return void Router.navigate("selcity",{trigger:!0,replace:!0});t.setCityName(t.city.name),t.setTitle(t.titles.SERVICE_LIST),t.setApointmentState("services"),t.setState("services"),t.setMaxSceen(0),t.$categories.find("li").eq(0).addClass("actived").siblings().removeClass("actived");var i=t.batch("serviceready","banner"),o=t.batch("services_rended","coupon_init");r.loading(),t.ServiceListView._banner_imgs=null,t.ServiceListView._banner_tap_callback=null,t.ServiceListView._banner_img_size=null,i.ready(function(){r.loadend(),t.ServiceListView.load(),o.fire("services_rended")}),o.ready(function(){t.ServiceListView.showValidCoupons()}),n.getJSON("/api/Local/home_banner",{cid:e,source:t.source},function(e){if(e.data.length){var n=e.data.map(function(t){return{url:t.img,link:t.link}});t.ServiceListView.setBanner(n,function(t){t.link&&(location.href=t.link)})}i.fire("banner")}),t.servicesReady(function(){i.fire("serviceready")}),t.checkLogin(function(e){t.ServiceListView.coupons=[],e?t.getCoupons(0,20,function(e){t.ServiceListView.coupons=e.list.sort(function(t,e){return e.value-t.value}),o.fire("coupon_init")},{status:0}):o.fire("coupon_init")}),n(t.ServiceListView.iscroll.vScrollbarWrapper).show(),n(t.TherapistListView.iscroll.vScrollbarWrapper).hide(),t.ga.trackPage(),t.Interface.setShareButton(!1)},a}),
//! view.service.js
define("appointment-service",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){var r=(require("ddialog"),function(){return this.init.apply(this,arguments)});return r.prototype={$view:n("#view_service"),taboos:["1、暂不为小儿（12岁以下）、妇女妊娠期及剖腹产后三个月内者、高龄者（68岁以上）提供按摩理疗服务","2、严重心脏病、肿瘤、传染性皮肤病、急性损伤及大病术后伤口愈合不足6月者不宜接受按摩理疗服务","3、严重疾病、身体疼痛者请及时就医治疗，以免耽误治疗"].join("<br/>"),iscroll:null,init:function(){this.$view.on(tapEvent,"[booking]",function(e){stopTouchPropagation(e);var i=this.getAttribute("booking");t.checkLogin(function(e){e?Router.navigate("booking/"+i,{trigger:!0}):t.login({redirect:"/booking/"+i,replace:!1,logined:function(){Router.navigate("booking/"+i,{trigger:!0})}})})}),this.$view.on("swipeRight",function(e){e.stopPropagation(),e.preventDefault(),history.length>1?t.history.back():Router.navigate("services",{trigger:!0,replace:!0})})},render:function(t){var e=this;e.iscroll&&e.iscroll.destroy(),t.efficacy=(t.efficacy||"").replace(/\n/g,"<br/>"),t.service_content=(t.service_content||"").replace(/\n/g,"<br/>"),t.service_taboo=(t.service_taboo||"").replace(/\n/g,"<br/>"),t.service_explain=(t.service_explain||"").replace(/\n/g,"<br/>"),e.$view.html(["<div class=rel>","<div class=iscroll>",'<div class=thumb><img src="',IMG_BLANK,'" style="background-image:url({picurl})" /></div>',"<h1>{name}<span><b><i>{price|fixPrice}</i>元/{minutes}分钟</b></span></h1>","<div class=desc>{service_summary}</div>","<div class=purpose>","<dl><dt>针对部位：</dt><dd>{service_position}</dd></dl>","<dl><dt>调理疾症：</dt><dd>{service_symptom}</dd></dl>","</div>","<dl class=intro><dt>服务内容</dt><dd>{service_content}</dd></dl>","<dl class=intro><dt>预约须知</dt><dd>{service_explain}","</dd></dl>","<dl class=intro><dt>禁忌提示</dt><dd>{service_taboo}</dd></dl>","</div>","<div class=booksvr>",'<button booking="s{serID}/t0">立即预约</button>',"</div>","</div>"].join("").format(t)),e.iscroll=new iScroll(e.$view.find(".rel")[0])},loadService:function(e){var i=this,n=Caches.getServiceById(e);return n&&n.complex?void i.render(n):void t.loadService(e,function(){i.loadService(e)},1)}},i.routes["service/:id"]="viewService",i.viewService=function(e){t.ServiceView=t.ServiceView||new r,t.setTitle(t.titles.SERVICE_DETAIL),t.setState("viewservice"),t.ServiceView.loadService(e),n.cookie("loginviewed",null),t.ga.trackPage(),t.Interface.setShareButton(!1)},r}),
//! view.therapists.js
define("appointment-therapists",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){var r=require("ddialog"),o=function(){return this.init.apply(this,arguments)};return o.prototype={$view:n("#view_therapists"),$list:n("#list_therapists"),$refresh:n("#refresh_therapists"),refreshBoundary:80,refreshing:!1,iscroll:null,pageSize:20,lock_loading:!1,lock_querylocation:!1,nearbyCount:0,overstep:0,init:function(){function e(){t.setLocation(function(t){arguments.callee;return t.disabled?void i(t):void i(t)},{poi:t.curlocation||null})}function i(e){t.curlocation=e,e.disabled||t.locCookie(e),t.TherapistListView.needToRefresh(),history.length>1&&t.history.back()}var r=this;this.iscroll=new iScroll(this.$view[0],{onRefreshed:function(){var e=this.vScrollbarWrapper;e&&t.$wrap.append(this.vScrollbarWrapper)},onScroll:_.throttle(function(){App.snapit()},200),onTouchEnd:function(){r.refreshing&&(r.$refresh.addClass("refresh-loading").find("span").text("加载中..."),r.iscroll.stop(),t.getGeoLocation(function(){r.loadTherapists(function(){r.$refresh.removeClass("refresh-loading")},!0)}))}}),r.$view.on(tapEvent,".fitem",function(t){stopTouchPropagation(t,this);var e=this.getAttribute("value");r.needToRefresh(),Router.navigate("therapists?filter="+e,{trigger:!0,replace:!0})}),r.$list.on("click","li",function(t){stopTouchPropagation(t,this);var e=n(this)[0].getAttribute("tid");n.post("/api/Log/scribe",{type:"TherapistListClick",msg:JSON.stringify({eid:n.cookie("eid"),uid:+App.uid,tid:+e,index:n(this).index()+1})}),Router.navigate("therapist/"+e,{trigger:!0})}),r.$loading=r.$view.find(".loadmore").catchable({catched:function(){r.loadTherapists()}}),r.$view.find("button.btn-changeaddr").on(tapEvent,function(i){stopTouchPropagation(i,this),t.ga.trackEvent("TherapistList","ChangeAddrWhenNoneNearby","city:{city},street:{street},uid:{uid}".format({city:t.city.name,street:t.curlocation.street,uid:t.uid}),1),e()}),r.$view.find("button.btn-more").on(tapEvent,function(e){stopTouchPropagation(e,this),t.ga.trackEvent("TherapistList","ViewOverSteps","city:{city},street:{street},uid:{uid},nearby:{nearby}".format({city:t.city.name,street:t.curlocation.street,uid:t.uid,nearby:r.nearbyCount}),1),r.loadOverStep()}),r.$curlocation.on(tapEvent,function(t){stopTouchPropagation(t,this),e()})},render:function(e){var i=this,r=[],o=i.currentCount();n.each(e,function(t,e){Caches.completeTherapist(e);var n="<span class=tag-green>今日可约</span>";1==e.tm_tag&&1==e.td_tag?n="<span class=tag-red>近2日约满</span>":1==e.td_tag?n="":1==e.tm_tag;var a=+(e.level_tag||0);e.excellent=a?"excellent":"",e.sale=1==+e.cost_tag?"sale":"";var s=(e.overstep?!0:!1,"");r.push(['<li tid="{tid}" cklt="tlist:',o+t,';t:{tid}_{truename}" class="tapable {excellent} {sale}">',"<dl>",'<dt><img defer="{portraiturl}" src="{portraiholder}" /><b></b><i></i></dt>',"<dd>","<h3>",i._tplDistance(e),"{truename}",n,s,"</h3>",'<p class="title">{age}岁·{native_place}人·{title}</p>','<p class="desc">',e.describe.truncate(48,"..."),"</p>","</dd>","</dl>","</li>"].join("").format(e))}),this.$list.append(r.join("")),this.$list.find("img").defer(function(t){return n(this).attr("src",t).css("opacity",1),!1}),this.iscroll.refresh(),setTimeout(function(){t.snapit()},100)},currentCount:function(){return this.$list.find("li").size()},loadTherapists:function(e,i){if("therapists"==t.state){var o=this;if(e=e||k,o.$view.find(".list-filter").remove(),t.city.filter&&t.city.filter.length){var a=QueryString.pickup(location.search).filter||"";o.$view.find(".cur-location-holder").after(["<ul class=list-filter>",function(e,i){return n.each(e,function(e,n){i.push('<li value="{1}" clkt="filter:{0}:{#2}" class="fitem tapable {#1}" >{0}</li>'.format(n,a==n[1]?"selected":"",t.city.name))}),i.join("")}(t.city.filter,[]),"</ul>"].join(""))}if(!t.curlocation.error&&!t.curlocation.location)return o.lock_querylocation?!0:(o.lock_querylocation=!0,r.loading("定位中"),t.queryCurLocation(function(){r.loadend(),o.loadTherapists(e,i),o.lock_querylocation=!1}),!0);if(!o.lock_loading){o.lock_loading=!0;var s=t.cityid,c=QueryString.pickup(location.search),l=this.currentCount();n.ajax({url:"/api/therapist/get_nearby",cache:!1,data:{city_id:s,latlnt:t.curlocation.location?[t.curlocation.location.lat,t.curlocation.location.lng].join(","):"0,0",start:i?0:o.overstep?l-o.nearbyCount:l,limit:o.pageSize,vendor:t.curlocation.vendor,overstep:o.overstep,filter:c.filter||""},dataType:"json",success:function(t,r){var a=t.total;return t.error?void DD.alert(r.error):(r=t.data,i&&o.clear(),function(){var t=o.currentCount(),e=r.length;return t+e>=a||o.overstep&&e<o.pageSize?void o.nomore():t||e?void(e<o.pageSize&&o.nomoreNearby()):(console.log("noneNearby"),void o.noneNearby())}(),n.each(r,function(t,e){Caches.therapistIndexer[e.tid]=e,Caches.therapists.push(e.tid),Caches.therapistCitys[s]=1}),o.render(r),void e.call(o,r))},complete:function(){o.lock_loading=!1}})}}},clear:function(){this.nearbyCount=0,this.overstep=0,this.$list.html(""),this.$view.removeClass("none-nearby load-overstep nomore-nearby nomore")},_tplDistance:function(e,i){return i=e.distance,i=i>1?(+i).toFixed(1)+"km":~~(1e3*i)+"m",t.curlocation.disabled?"":"<span class=distance><i class=icon-location></i><b>"+(e.overstep?"<u>"+(1==e.overstep?"超出范围":"上门费")+"</u>":i)+"</b></span>"},nomore:function(){this.$view.addClass("nomore"),this.iscroll.refresh()},nomoreNearby:function(){this.$view.addClass("nomore-nearby"),this.iscroll.refresh()},noneNearby:function(){t.ga.trackEvent("TherapistList","NoneNearby","city:{city},street:{street},uid:{uid}".format({city:t.city.name,street:t.curlocation.street,uid:t.uid}),1),this.$view.addClass("none-nearby"),this.iscroll.refresh()},loadOverStep:function(){var t=this;t.nearbyCount=t.currentCount(),t.overstep=1,t.$view.addClass("load-overstep")},$curlocation:n("#cur_location"),setCurLocation:function(){var e=this;e.$view.removeClass("located"),t.queryCurLocation(function(t){e.$view.addClass("located"),e.$curlocation.find("i").text((t.disabled?"无法定位 "+(t.street?'"'+t.street+'"':""):t.street||t.addr||"获取定位失败").truncate(15)),t.disabled})},needToRefresh:function(){Caches.therapistCitys[t.cityid]=null}},i.routes.therapists="therapists",i.therapists=function(){t.TherapistListView=t.TherapistListView||new(require("appointment-therapists")),t.ServiceListView=t.ServiceListView||new(require("appointment-services"));var e=t.TherapistListView;return history.length>1&&t.flushHistory(),t.setCityName(),t.setTitle(t.titles.THERAPIST_LIST),t.setApointmentState("therapists"),t.setState("therapists"),t.setMaxSceen(0),t.$categories.find("li").eq(1).addClass("actived").siblings().removeClass("actived"),(t.citychanged||!Caches.therapistCitys[t.cityid])&&(e.setCurLocation(),e.clear(),e.loadTherapists(k,!0)),n(t.ServiceListView.iscroll.vScrollbarWrapper).hide(),n(e.iscroll.vScrollbarWrapper).show(),n.cookie("cityid")?(t.ga.trackPage(),void t.Interface.setShareButton(!1)):void Router.navigate("selcity",{trigger:!0})},o}),
//! view.therapist.js
define("appointment-therapist",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){var r=(require("ddialog"),function(){return this.init.apply(this,arguments)});return r.prototype={$view:n("#view_therapist"),iscroll:null,$commentloadings:[],therapistid:null,commentPageSize:20,init:function(){var e=this;e.$view.on("swipeRight",function(){history.length>1?t.history.back():Router.navigate("/therapists",{trigger:!0,replace:!0})}).on(touchStartEvent,preventDefault),e.$view.on(tapEvent,"[booking]",function(e){stopTouchPropagation(e,this);var i=this.getAttribute("booking");t.checkLogin(function(e){e?Router.navigate("booking/"+i,{trigger:!0}):t.login({redirect:"/booking/"+i,replace:!1,logined:function(){Router.navigate("booking/"+i,{trigger:!0})}})})}),e.$view.on(tapEvent,".comment-navs li",function(){n(this).addClass("actived").siblings().removeClass("actived");var t=n(this).index();e.$commenttabs.eq(t).addClass("actived").siblings().removeClass("actived"),e.iscroll.refresh()}),e.$view.on(tapEvent,".recommend",function(){e.recommend()}),e.$view.on(tapEvent,".viewcerts",function(t){stopTouchPropagation(t,this),Router.navigate("therapist/"+e.therapistid+"/certs",{trigger:!0})})},show:function(e){var i=this,r=Caches.getTherapistById(e);if(!r||!r.detail_cached)return void t.getTherapistData(e,function(){i.show(e)});var i=this,o=t.wx.formatShareOption(SHARE_THERAPIST_OPT,{source:"share_therapist",tname:r.truename,timg:IMG_HOST+"{portrait}".format(r),tid:r.tid,uid:t.uid,cityid:t.cityid});n.extend(o,{success:function(){t.wx.shareHelper(0),t.ga.trackEvent("MobileWeb","ShareTherapist","t"+e,1)}}),n.extend(SHARE_RUNTIME_OPT,o),t.wx.onShare(o),t.loadService(r.sid,function(){i.render(r)}),(3==r.isjob||0==r.status)&&DD.alert(r.truename+"技师暂不提供服务，去看看其他技师吧！",function(){Router.navigate("therapists",{trigger:!0,replace:!0})}),i.therapistid=e},render:function(t){var e=this,i=+(t.level_tag||0);t.excellent=i?"excellent":"",t.sale=1==+t.cost_tag?"sale":"";var r=["<div class=iscroll>","<div>",'<div class="ncard {excellent}">',"<dl>","<dt>",'<div><img src="{portraiturl}" /><b></b><i></i></div>',"<h3>{truename}</h3>",'<p class="tstars">',new Array(6).join("<i class=icon-star></i>"),"</p>","</dt>",t.certs&&t.certs.length?function(t){var e=t[0].title,i=t.length;return'<div class=bs></div><dd clkt="viewcerts:{tid}" class="tapable viewcerts"><label><i class=icon-cert></i><b>{#0}</b></label><span><b>{#1}项资格认证</b><i class=icon-angel-right></i></span></dd>'.format(e,i)}(t.certs,[]):"","</dl>","<div class=bs></div>","<div class=desc>{describe}</div>","</div>","<div class=bs></div>","<div class=services>","<h2>服务项目</h2>","<ul>",function(e,i){return n.each(e,function(e,n){i.push(["<li>","<h3>{name}</h3>","<p><i>{price|fixPrice}元</i>/{minutes}分钟",function(t,e){return t.forEach(function(t){t.sid.split(",").indexOf(""+n.id)<0||e.push(t.name||"")}),e.length?["<span>可选：",e.join("、"),"</span>"].join(""):""}(t.addin_items,[]),"</p>",'<button clkt="book:sid_{id}" class=tapable booking="s{id}/t',t.tid,'">预约</button>',"</li>"].join("").format(n))}),i.join("<div class=bs></div>")}(this._getServiceItems(t),[]),"</ul>","</div>","<div class=comments>","<h2>客户评价</h2>","<ul class=comment-navs><li class=actived>全部(<i>0</i>)</li><li >好评(<i>0</i>)</li><li>一般(<i>0</i>)</li><li>不满意(<i>0</i>)</li>","</ul>","<div class=comment-tabs>",'<div clkt="spring-comments:all" class="comment-tab comment-all actived">{#1}</div>','<div clkt="spring-comments:good" class="comment-tab comment-good">{#1}</div>','<div clkt="spring-comments:normal" class="comment-tab comment-normal">{#1}</div>','<div clkt="spring-comments:bad" class="comment-tab comment-bad">{#1}</div>',"</div>","</div>","</div>","</div>"];this.iscroll&&this.iscroll.destroy(),this.$view.html(r.join("").format(t,"<ul></ul><div class=loadmore><span>加载中...</span></div>")),n.each(e.$commentloadings,function(){this.discatch()}),e.$commentloadings=[],e.$commenttabs=e.$view.find(".comment-tab"),e.$commenttabs.find(".loadmore").each(function(t){e.$commentloadings.push(n(this)),n(this).catchable({catched:function(){e.loadComments(t)}})}),this.iscroll=new iScroll(this.$view.find(".iscroll")[0],{hScrollbar:!1,vScrollbar:!1,hScroll:!1,bounce:!0})},lock_loadcomments:!1,loadComments:function(t){var e=this;e.lock_loadcomments||(e.lock_loadcomments=!0,n.ajax({url:"/api/therapist/get_comment_list",dataType:"json",cache:!1,data:{tid:e.therapistid,tab:t,start:e.$commenttabs.eq(t).find("ul li").size(),limit:e.commentPageSize},success:function(i,n){return i.error?void DD.alert(i.error.message):(n=i.data,n.stat&&e.statComments(n.stat),n.items.length<e.commentPageSize&&e.nomoreComments(t),void e.renderComments(n.items,t))},complete:function(){e.lock_loadcomments=!1}}))},statComments:function(t){var e=[+t.good+ +t.mid+ +t.bad,t.good,t.mid,t.bad,~~(100*t.good/(+t.good+ +t.mid+ +t.bad))+"%"];this.$view.find(".comment-navs li").each(function(t){n(this).find("i").html(e[t])})},renderComments:function(t,e){var i=this,n=[];t.forEach(function(t){t.telmask=t.tel?t.tel.substr(0,3)+"****"+t.tel.substr(7,4):"138********",t.star=+t.star,n.push(["<li class=c>","<dl><dt class=tstars>",new Array(t.star+1).join('<i class="icon-star actived"></i>'),new Array(6-t.star).join("<i class=icon-star></i>"),"</dt><dd>{service_name}</dd></dl>","<p>{pj}</p>","<dl><dt>{telmask}</dt><dd>{addtime}</dd></dl>","</li>"].join("").format(t))});var r=i.$commenttabs.eq(e),o=r.find("ul");o.append(n.join("")),o.find("li").size()||r.append("<div class=nocomment>该项暂无评论.</div>"),i.iscroll.refresh()},nomoreComments:function(t){this.$commenttabs.eq(t).addClass("nomore")},_getTitles:function(t){var e=[];return n.each([t.am_pic,t.pf_pic,t.other_pic],function(t,i){i=i.replace("|",""),i&&e.push(i)}),e},_getServiceItems:function(t){var e=[];return n.each((t.sid||"").split(","),function(t,i){if(!i)return!0;var n=serviceCache.get(i);n&&e.push(n)}),e},recommend:function(){IS_WEIXIN&&(n.os.android&&t.fw.version<"6.2.2"?location.href="/sharetherapist/"+this.therapistid:t.wx.shareHelper(1)),t.fw.diandao&&t.os.android&&t.fw.version>1008&&t.Interface.share(WEIXIN_SHARE_OPTION)}},i.routes["therapist/:id"]="viewTherapist",i.viewTherapist=function(e){t.TherapistView=t.TherapistView||new r,DD.loading(),t.getTherapistData(e,function(){DD.loadend(),t.watchSnap(),t.setTitle(t.titles.THERAPIST_DETAIL),t.Interface.setShareButton(!0),t.setState("viewtherapist"),t.TherapistView.show(e),t.ga.trackPage()})},r}),
//! view.therapist.js
define("appointment-therapist-certs",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){var r=(require("ddialog"),require("loadimg")),o=function(){return this.init.apply(this,arguments)};return o.prototype={$view:n("#view_therapist_certs"),iscroll:null,therapistid:null,init:function(){var e=this;e.$view.on(tapEvent,".preview",function(e){var i=n(this).attr("big"),r=n(this).parent().find(".preview").map(function(){return n(this).attr("big")});t.fw.weixin?(stopTouchPropagation(e),wx.previewImage({current:i,urls:r})):location.href=i})},show:function(e){var i=this,r=Caches.getTherapistById(e);if(!r)return void t.getTherapistData(e,function(){i.show(e)});var i=this,o={title:"强烈推荐按摩师{truename}！点到上门按摩，新用户预约最低38元起".format(r),link:"http://m.diandao.org/wxtherapist/{tid}?utm_source=weixin&utm_medium=moments&utm_term={uid}&utm_content={cityid}&utm_campaign=".format({tid:r.tid,uid:t.uid,cityid:t.cityid}),imgUrl:"http://img.caihongjia.com/{portrait}".format(r),success:function(){t.wx.shareHelper(0),t.ga.trackEvent("MobileWeb","ShareTherapist","t"+e,1)}};t.wx.onShare(o),n.extend(WEIXIN_SHARE_OPTION,o),i.therapistid=e,i.render(r)},render:function(t){var e=this,i=["<div class=iscroll><div>",function(i){return t.certs.forEach(function(t,n){t.imgs=t.images,t.portrait=IMG_HOST+t.path.replace(/^\//,""),i.push(["<dl><dt>证书：{title}</dt>","<dd>","<div class=imgs>","<div>",function(i){return t.imgs.forEach(function(t){i.push('<img class=preview src="{middle|bindImgHost}" big="{big|bindImgHost}" />'.format(t)),r(t.middle.bindImgHost(),function(){e.imgiscrolls&&e.imgiscrolls[n]&&e.imgiscrolls[n].refresh()})}),i.join("")}([]),"</div></div>","</dd></dl>"].join("").format(t))}),i.join("")}([]),"</div></div>"].join("").format(t);e.$view.html(i),this.iscroll&&this.iscroll.destroy(),this.iscroll=new iScroll(e.$view.find(".iscroll")[0]),e.imgiscrolls&&e.imgiscrolls.forEach(function(t){t.destroy()}),e.imgiscrolls=[],e.$view.find(".imgs").each(function(){e.imgiscrolls.push(new iScroll(this,{hScroll:!0,vScroll:!1}))})}},i.routes["therapist/:id/certs"]="therapist_certs",i.therapist_certs=function(e){t.TherapistCertsView=t.TherapistCertsView||new o,t.setState("therapist-certs"),t.TherapistCertsView.show(e)},o}),
//! view.location.js
define("appointment-location",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n){function r(){return this.init.apply(this,arguments)}require("ddialog");return r.prototype={$view:n("#view_location"),$kw:null,$submit:null,currentPoi:null,init:function(){var e=this;e.render();var i=e.$view.find(".loc-form");e.$kw=i.find("input.i-street").eq(0),e.$dp=i.find("input.i-doorplate").eq(0),e.$submit=i.find(".btn-submit").eq(0),e.$qlist=e.$view.find(".query-list").eq(0),e.$location=e.$view.find(".curlocation"),e.$loclist=e.$view.find(".location-list").eq(0),e.$hlist=e.$view.find(".his-list").eq(0),e.$cancelEdit=e.$view.find(".btn-cancel").eq(0),e.$kw.on("input",function(){e.pickWord()}).on(tapEvent,function(t){stopTouchPropagation(t),e.setEditMode(!0)}).blur(function(){}),e.$cancelEdit.on(tapEvent,function(t){stopTouchPropagation(t),n(this).focus(),e.setEditMode(!1)}),e._intval=setInterval(function(){/^setlocal/.test(t.state)&&e.pickWord()},500),e.$qlist.on(tapEvent,"li",function(t){stopTouchPropagation(t);var i=this.getAttribute("name"),n=this.getAttribute("addr"),r=this.getAttribute("city"),o=this.getAttribute("district"),a=this.getAttribute("latlng").split(",");e.setPoi({street:i,addr:n||"",district:[r,o].join(","),vendor:"baidu",location:{lat:a[0],lng:a[1]}})}),e.$loclist.on(tapEvent,"li",function(t){stopTouchPropagation(t);var i=this.getAttribute("name"),n=this.getAttribute("addr"),r=this.getAttribute("latlng").split(",");e.setPoi({street:i,addr:n,location:{lat:r[0],lng:r[1]},vendor:"baidu"})}),e.$hlist.on(tapEvent,"li",function(t){stopTouchPropagation(t);var i=this.getAttribute("name"),n=this.getAttribute("doorplate"),r=this.getAttribute("addr"),o=this.getAttribute("district"),a=this.getAttribute("latlng").split(",");e.setPoi({street:i,addr:r,district:o,doorplate:n,location:{lat:a[0],lng:a[1]},vendor:"baidu"})}),e.$submit.on(tapEvent,function(t){stopTouchPropagation(t),n(this).is(".disabled")||e.submit()}),e.locscroll=new iScroll(e.$view.find(".cur-iscroll")[0],{scrollbarClass:"iscrollbar iscrollbar-"}),e.qscroll=new iScroll(e.$view.find(".query-iscroll")[0],{scrollbarClass:"iscrollbar iscrollbar-"}),e.hscroll=new iScroll(e.$view.find(".his-iscroll")[0],{scrollbarClass:"iscrollbar iscrollbar-"})},query_delay:null,setEditMode:function(t){var e=this;t?(e.editMode=!0,this.lastvalue="",e.$view.addClass("edit-mode")):(e.editMode=!1,e.$view.removeClass("edit-mode show-query show-curlocation"),e.$kw.val(""))},pickWord:function(){var t=this,e=t.$kw,i=e[0],n=t.$submit.is(".disabled");return i.value&&n&&t.$submit.removeClass("disabled"),i.value||n||t.$submit.addClass("disabled"),clearTimeout(t.query_delay),i.value?void(t.query_delay=setTimeout(function(){return i.value==i.lastvalue?void(i.lastvalue=i.value):(t.$view.removeClass("show-curlocation"),t.query(i.value.trim()),void(i.lastvalue=i.value))},200)):(t.editMode?(t.$view.addClass("show-curlocation").removeClass("show-query"),t.locscroll&&t.locscroll.refresh()):(t.$view.removeClass("show-curlocation show-query"),t.hscroll&&t.hscroll.refresh()),void(i.lastvalue=i.value))},render:function(){var t=this;t.$view.html(["<div class=rel>","<div class=loc-form>","<div class=loc-form-body>",'<dl class="tapable loc-street"><dt>上门地址</dt><dd><input class=i-street type=text placeholder="小区、街道或大厦名称" /><button class="btn-cancel tapable">清空</button></dd></dl>','<dl class="tapable"><dt>详细门牌</dt><dd><input class=i-doorplate type=text placeholder="楼栋、单元及门牌号等详细信息" /></dd></dl>',"</div>",'<div class=loc-form-footer><button class="btn-primary btn-submit tapable disabled">确定</button></div>',"</div>",'<div class="history">',"<h2>使用历史地址</h2>","<div class=his-iscroll>","<div>","<ul class=his-list></ul>","</div>","</div>","</div>","<div class=curlocation>","<h2><i class=icon-location>当前位置</i></h2>","<div class=cur-iscroll>","<ul class=location-list></ul>","</div>","</div>","<div class=query>","<h2>您要找的是不是</h2>","<div class=query-iscroll>","<div>","<div class=noquery-desc>无结果<br/>请尝试缩减关键词或选择邻近地址</div>","<ul class=query-list></ul>","</div>","</div>","</div>","</div>"].join(""))},load:function(){var e=this;if(e.cityid=t.set_location_cityid||t.cityid,e.reset(),e.loadContacts(),e.queryLocation(),t.set_location_poi){var i=e.poi=t.set_location_poi;e.$kw[0].lastvalue=i.street,e.$kw.val(i.street||""),e.$dp.val(i.doorplate||"")}},reset:function(){var t=this;t.$kw.val(""),t.$qlist.html(""),t.$location.removeClass("loaded").find("h2 i").html("当前位置"),t.$loclist.html(""),t.qscroll&&t.qscroll.refresh(),t.locscroll&&t.locscroll.refresh()},loadContacts:function(){var e=this;t.loadContacts(function(t){var i=[];n.each(t,function(t,n){n.location&&n.location.lng&&+n.local_id==+e.cityid&&i.push('<li name="{street}" doorplate="{doorplate}" addr="{addr}" district="{district}" latlng="{location.lat},{location.lng}"><h3>{street} {doorplate}</h3><p>{district|replace:,:}</p></li>'.format(n))}),e.$hlist.html(i.join("")),e.hscroll&&e.hscroll.refresh()})},caches:{},queryLocation:function(){var e=this;t.queryGeoLocation(function(t,i){return i?void e.$location.addClass("loaded").find("h2 i").html("获取定位信息失败"):(e.$location.addClass("loaded"),void e.renderLocation(t))})},renderLocation:function(t){var e=this,i=[];n.each(t.result.pois,function(t,e){i.push(['<li class=tapable name="{name}" addr="{addr}" latlng="{point.y},{point.x}"><h3>{name}</h3><p>{addr}</p></li>'].join("").format(e))}),e.$loclist.html(i.join("")),e.locscroll&&e.locscroll.refresh()},query:function(e,i){var n=this;if(n.$view.addClass("show-query"),i){var r=n.caches[e];return r.length?(n.$view.removeClass("noquery"),void n.renderQuery(r)):(n.$view.addClass("noquery"),void n.$qlist.html(""))}return n.caches[e]?void n.query(e,!0):void t.queryPlace(e,function(t){n.caches[e]=t,n.$kw[0].value.trim()==e&&n.query(e,!0)},n.cityid)},renderQuery:function(t){var e=this,i=[];n.each(t,function(t,e){i.push(['<li class=tapable name="{name}" latlng="{location.lat},{location.lng}" city="{city}" cityid="{cityid}" district="{district}" business="{business}">',"<h3>{name}</h3>","<p>{city}{district}{business}</p>","</li>"].join("").format(e))}),e.$qlist.html(i.join("")),e.qscroll&&e.qscroll.refresh()},hideQuery:function(){var t=this;t.$view.removeClass("show-query")},submit:function(){var e=this,i=e.$kw.val().trim();if(i){if(!e.poi&&history.length>1)return void t.history.back();var n=e.poi;n.doorplate=e.$dp.val().trim();var r=t.set_location_callback;r=r==k?function(e){t.curlocation=e,e.disabled||t.locCookie(e),t.TherapistListView.needToRefresh(),history.length>1&&t.history.back()}:r,(r||k).call(e,n),t.set_location_callback=null}},setPoi:function(e){var i=this;i.set_poi_throttle||(e.location||(e.location={lng:0,lat:0}),/[\d\.]+/.test(e.location.lng)||(e.location.lng=0),/[\d\.]+/.test(e.location.lat)||(e.location.lat=0),i.set_poi_throttle=1,clearTimeout(i.set_poi_tm),i.set_poi_tm=setTimeout(function(){i.set_poi_throttle=0},500),DD.loading("正在切换地址..."),t.serviceReachable(i.cityid,e,function(n){if(DD.loadend(),n){i.setEditMode(!1),i.$submit.removeClass("disabled");var r=i.$kw[0];r.value=e.street,r.lastvalue=r.value,i.$dp.val(e.doorplate||""),e.vendor="baidu",e.disabled=!!e.disabled,i.poi=e,e.doorplate&&i.submit()}else t.ga.trackEvent("OutOfReachAddr","SetLocation","city:{city},street:{street},uid:{uid}".format({city:Caches.getCityById(i.cityid.name),street:e.street,uid:t.uid}),1),DD.showMsg("所选地址不在服务范围内，请重新选择!",{buttons:{"知道了[.btn-danger tapable]":function(){}}})}))}},i.routes.setlocal="setlocal",i.routes["setlocal-booking"]="setlocal",i.setlocal=function(){t.LocationView=t.LocationView||new r;var e=Backbone.history.getFragment();t.setTitle(t.titles.ADDRESS_COMMIT),t.setState(e),"setlocal-booking"==e&&(t.BookingView.setlocalView=!0),t.LocationView.load(),t.Interface.setMenu(!1,{},!1)},r}),
//! view.booking.js 
define("appointment-booking",["app","appointment-appext","appointment-router","zepto"],function(t,e,i,n,r){var o=require("ddialog"),a=function(){return this.init.apply(this,arguments)};return a.prototype={$view:n("#view_booking"),$coupons:null,$datetime:null,iscroll:null,couponsScroll:null,couponsPageSize:10,query:null,datepicker:{disabled:!0,leadtime:72e5,reserveds:[],timeSelectedIndex:2,date:null,time:null},formdata:{expressly:0,tid:0,city_id:t.cityid,terminal:t.platform,order_time:null,combo:0,guasha_num:0,guasha_uprice:0,num:1,amount:0,address:null,mobile:null,message:"",cid:0,couponVal:0,couponID:0},reachable:0,datetimeGap:48,init:function(){var e=this;this.render(),e.$datetime=e.$view.find(".sel-datetime"),e.$seramount=e.$view.find(".sel-seramount"),e.$coupons=e.$view.find(".sel-coupons"),e.iscroll=new iScroll(e.$view.find(".iscroll")[0],{vScrollbar:!1}),e.$view.find(".scrapping-info").on(tapEvent,function(t){stopTouchPropagation(t,this),o.alert(['<div class="scrapping-intro">',"<h2>刮痧服务介绍</h2>","<p>用天然刮痧板，配以专业刮痧油，用传统手法推刮，有活血透痧的作用，配合按摩等疗法使用，加强活血化瘀、驱邪排毒的效果</p>","<p><label>价格：</label>",e.formdata.guasha_uprice,"元</p>","<p><label>部位：</label>局部刮痧（头部、肩部、背部三各部位任选其一）</p>","<p><label>禁忌：</label>凝血机制障碍疾病禁刮，过敏体质慎刮</p>","</div>"].join(""))}),e.$view.on(tapEvent,".selectable",function(t){stopTouchPropagation(t,this),n(this).toggleClass("selected"),e.formdata.guasha_num=n(this).is(".selected")?1:0,e.updatePayPrice()}),e.$minus=e.$view.find("i.minus").on(tapEvent,function(t){n(this).is(".disabled")||(stopTouchPropagation(t,this),e.reduceAmount())}),e.$plus=e.$view.find("i.plus").on(tapEvent,function(t){n(this).is(".disabled")||(stopTouchPropagation(t,this),e.increaseAmount())}),e.$view.on(tapEvent,"i.tinfo",function(t){stopTouchPropagation(t,this),DD.showMsg('<p style="text-align:left">系统将根据您的信息<br/>为您分派最合适的技师<br/>如需要自选技师，请使用“技师直约”。</p>',{buttons:{"好的[.btn-danger tapable]":k,"去技师直约[.btn-default tapable]":function(){location.href="/therapists"}}})}),e.$txt_datetime=e.$view.find("span[name=time]").eq(0),e.$txt_tel=e.$view.find("input[name=mobile]").eq(0),e.$txt_msg=e.$view.find("input[name=message]").eq(0),e.$txt_tel.on("keyup",function(t,e){e=this.value,11==e.length&&(this._lastvalue&&e!=this._lastvalue&&n(this).trigger("change",{last:this._lastvalue,value:e}),this._lastvalue=e)}).on("change",function(){e.updateTimeTable()}),e.$curcity=e.$view.find(".curcity"),e.$curcity.on(tapEvent,function(e){stopTouchPropagation(e),o.confirm("您要更换服务城市重新下单吗?",function(){return t.isNewYear?void location.replace("/?jump=selcity"):(Router.navigate("/",{trigger:!0,replace:!0}),void Router.navigate("selcity",{trigger:!0}))})}),e.$submit=e.$view.find("button.btn-submit").eq(0);var i={vScrollbar:!1,hScrollbar:!1,snap:"li",selectedIndex:0,onScroll:function(){var t=this.y,i=~~(-(t-18)/e.datetimeGap)+2;if(this.options.selectedIndex!=i){var r=n(this.wrapper).find("li").eq(i);r.addClass("selected").siblings().removeClass("selected"),this.options.selectedIndex=i,(this.options.onChange||k).call(this,i,r)}}};e.$seramount.size()&&(e.amountscroll=new iScroll(e.$seramount.find(".amount")[0],n.extend({},i,{onChange:function(t,i){i=n(this.wrapper).find("li").eq(t),e.setAmount(+i[0].getAttribute("amount"))}})),e.amountscroll.select=function(t,i){this._pos(0,-(t-2)*e.datetimeGap,i===r?300:i)},this.$seramount.on(tapEvent,".btn-save",function(t){stopTouchPropagation(t),e.closeSelViewHandel(t)}));var a=e.$datetime,s=e.$date=a.find(".date"),c=e.$time=a.find(".time");e.datescroll=new iScroll(s[0],n.extend({},i,{onChange:function(t,i){i=n(this.wrapper).find("li").eq(t),e.datepicker.dateSelectedIndex=t,e.datepicker.date=+i[0].getAttribute("time"),e.updateTimeTable(),e.timescroll.options.onChange.call(e.timescroll,e.datepicker.timeSelectedIndex)}})),e.datescroll.select=function(t,i){this._pos(0,-(t-2)*e.datetimeGap,i===r?300:i)},e.timescroll=new iScroll(c[0],n.extend({},i,{onChange:function(i,r){if(r=n(this.wrapper).find("li").eq(i),r.size()){e.datepicker.timeSelectedIndex=i;var o=r.hasClass("disabled");a[o?"addClass":"removeClass"]("disabled");var s=t.timeDiff(),c=e.datepicker.date+ +r.attr("time"),l=new Date(c-s),u=l.getHours();e.setNoon(u)}}})),e.timescroll.select=function(t,i){this._pos(0,-(t-2)*e.datetimeGap,i===r?300:i)},s.on(tapEvent,".opt",function(t){t.preventDefault(),e.datescroll.select(n(this).index())}),c.on(tapEvent,".opt",function(t){t.preventDefault(),n(this).hasClass("disabled")||(e.timescroll.select(n(this).index()),n(this).is(".selected")&&!e.datepicker.disabled&&e.closeSelViewHandel(t))}),this.$datetime.on(tapEvent,".btn-save",function(t){stopTouchPropagation(t),e.$datetime.is(".disabled")||e.closeSelViewHandel(t)}),this.$datetime.on(tapEvent,".btn-cancel",function(t){stopTouchPropagation(t),e.closeSelViewHandel(t)}),["360life.diandao.org"].indexOf(location.host)<0&&(e.ciscroll=new iScroll(e.$coupons.find(".iscroll")[0],{vScrollbar:!1})),e.$coupons.on(tapEvent,"li",function(t){e.selectCouponItem(this),e.closeSelViewHandel(t)}),e.$coupons.on(tapEvent,"button.cancel-coupons",function(t){e.closeSelViewHandel(t),e.formdata.couponVal=0,e.formdata.couponID=0,e.updatePayPrice(),e.$coupons.find("li").removeClass("selected"),e.ciscroll&&e.ciscroll.refresh()}),this.$view.on("swipeRight",function(){t.history.back()}),this.$view.find("[selview]").each(function(){var i=this.getAttribute("selview");n(this).on(tapEvent,function(n){switch(stopTouchPropagation(n,this),e.$view.removeClass(e.viewclasses),i){case"datetime":e.datescroll.refresh(),e.timescroll.refresh(),e.toValidTime();break;case"location":if(e._set_location_locck)break;e._set_location_locck=!0,clearTimeout(e._set_location_tm),e._set_location_tm=setTimeout(function(){e._set_location_locck=!1},500),t.setLocation(function(i){arguments.callee;return i.disabled?(t.history.back(),void e.setContact(i)):(i.reachable=!0,t.history.back(),void e.setContact(i))},{fragment:"setlocal-booking",poi:e.poi,cityid:e.formdata.city_id});break;case"therapists":if(e.datepicker.disabled)return void DD.popup("请先选择上门时间");t.selTherapist({local_id:e.formdata.city_id,service_putting_id:e.formdata.sid,number:e.formdata.num,lnglat:[e.formdata.lng||0,e.formdata.lat||0].join(","),ytime:e.datepicker.disabled?0:(e.datepicker.date+e.datepicker.time)/1e3,duration:+e.service.minutes},function(i,n){t.history.back(),e.setService(n,function(){e.updatePayPrice()}),e.setTherapist(i)})}setTimeout(function(){e.$view.addClass("booking-sel-"+i),e.$view.find("input,textarea").blur()},0)})}),this.$view.find(".sel-panel").on(touchStartEvent,preventDefault),this.$view.find(".icon-remove-sign").on(tapEvent,e.closeSelViewHandel),this.$view.find(".sel-mask").on(tapEvent,e.closeSelViewHandel).on(touchMoveEvent,preventDefault).on(touchStopEvent,preventDefault),e.$submit.on(tapEvent,function(t){t.preventDefault(),t.stopPropagation(),e.submit()})},selectCouponItem:function(t){var e=this,i=t.getAttribute("cid"),r=t.getAttribute("amount"),o=(t.getAttribute("label"),t.getAttribute("limit"),t.getAttribute("limitname"),t.getAttribute("limitprice"),t.getAttribute("error"));return n(t).is(".disabled")?void DD.popup(o):(e.formdata.couponVal=+r,e.formdata.couponID=+i,e.$view.addClass("coupon-assigned"),n(t).addClass("selected").siblings().removeClass("selected"),e.updatePayPrice(),void(e.ciscroll&&e.ciscroll.refresh()))},viewclasses:"booking-sel-seramount booking-sel-coupons booking-sel-datetime booking-sel-contacts",closeSelViewHandel:function(e){var i=t.BookingView;i.onDatetimeSelected(),e&&e.stopPropagation(),e&&e.preventDefault(),i.$view.removeClass(i.viewclasses),i.updateCoupons()},reset:function(){},render:function(){this.$view.html(["<div class=wraper>",'<div class="form-w iscroll">',"<div class=form >","<div class=bs></div>",'<div class="therapist">',"<dl>",'<dt key=timg><img src="http://ddimg.net/imgs/blank.gif"/></dt>',"<dd><h2 key=tname></h2><p key=tstar></p></dd>","</dl>","<div class=bs></div>","</div>","<div class=service-info>",'<div class="tapable" selview="seramount" cklt="change-quantity">',"<dl>",'<dt><span key="sername"></span><span class=serprice key=serprice></span></dt>','<dd class=amount><span key=amount>1份</span><i class="icon-angel-right"></i></dd>',"</dl>","</div>","<div class=bs></div>",'<div class="selectable scrapping" cklt="toggle-scrapping">',"<dl>","<dt><i class=icon-ok></i><span>需要刮痧&#12288;<b key=scrappingPrice>30</b>元</span></dt>",'<dd><i class="scrapping-info icon-exclamation-sign" cklt="view-scrapping-desc"></i></dd>',"</dl>","</div>","</div>","<div class=fgroup>","<div class=bs></div>","<div class=wrap>",'<div class="fitem">',"<p>",'<label>联系电话</label><input name=mobile key=mobile type=tel placeholder="手机号码" value="',n.cookie("mobile"),'" />',"</p>","<div class=bs></div>","</div>",'<div class="fitem addr tapable" selview="location">',"<p>","<label>服务地址</label>",'<span name=addr key=addr placeholder="小区、街道或大厦名称">小区、街道或大厦名称</span><i class="icon-angel-right" ></i>',"</p>","<div class=bs></div>","</div>",'<div class="fitem tapable" selview=datetime>',"<p>",'<label>上门时间</label><span class=time key=time placeholder="请选择上门时间">请选择上门时间</span><i class=icon-angel-right></i>',"</p>","<div class=bs></div>","</div>",'<div class="fitem message">','<input name=message key=message type=message placeholder="如有特殊情况请留言" />',"</div>","</div>","<div class=bs></div>","</div>",'<div class="fgroup ran-therapist">',"<div class=bs></div>","<div class=wrap>",'<div class="fitem tapable seltherapists" clkt="pick-therapist" selview=therapists >',"<p>","<label>按摩师</label>","<em key=timg></em>","<span key=tname>系统将自动为您安排按摩师</span>",'<i class="icon-angel-right"></i>',"</p>","</div>","</div>","<div class=bs></div>","</div>",'<div class="fgroup settle">',"<div class=bs></div>","<div class=wrap>",'<div class="fitem tapable selcoupons" clkt="view-coupons" selview=coupons>',"<p>","<label>优 惠 券</label><span class=coupon key=coupon ></span><i class=icon-angel-right></i>","</p>","<div class=bs></div>","</div>",'<div class="fitem" >',"<p>","<label>预计实付</label><span class=payprice key=payprice ></span>","</p>","</div>","</div>","<div class=bs></div>","</div>",["touchlife.diandao.org"].indexOf(location.host)<0?'<div class=recommend>高龄、骨质疏松及孕期等客户不宜按摩，详见<a clkt="taboo-tips" href="http://m.diandao.org/help/#help_2_3">禁忌提示</a></div>':"",'<div class=btns><button class="btn-submit tapable">确认预约</button></div>',"<div class=curcity><span>当前城市:<b key=cityname>",t.city?t.city.name:"","</b></span></div>","</div>","</div>","<div class=sel-mask></div>",'<div class="sel-panel sel-seramount">',"<div class=sel-content><h3><b>选择份数</b>",'<span class="tapable btn-save">完成</span></h3>',"<div class=sel-body>","<div class=amount><ul></ul></div>","<div class=indicate></div>","</div>","</div>","</div>",'<div class="sel-panel sel-datetime disabled">',"<div class=sel-content><h3><b>预约上门时间</b>",'<span class="tapable btn-save">完成</span></h3>',"<div class=sel-body>","<div class=date><ul></ul></div>","<div class=time><ul></ul><div class=noontext>上午</div></div>","<div class=indicate></div>","</div>","</div>","</div>",'<div class="sel-panel sel-coupons">',"<div class=sel-content><h3><b>使用优惠券:</b></h3><div class=sel-body><div class=iscroll>","<div>",'<button cklt="unselected-coupon" class="cancel-coupons btn-default tapable" >不使用优惠券</button>',"<ul></ul>","</div>","</div></div></div>","</div>","</div>"].join("")),this.$noontext=this.$view.find(".noontext")},_today:function(){var e=t.serverDate(),i=[e.getFullYear(),e.getMonth()+1,e.getDate()];return+new Date(i.join("/"))},loadData:function(e,i,r){var o=this;o.$view.removeClass("coupon-assigned has-coupons therapist-changeable timeselected"),o.query=QueryString.pickup(location.search),o.formdata.sid=e,o.formdata.tid=+i,o.formdata.num=1,o.formdata.guasha_uprice=0,o.formdata.guasha_num=0,o.timetabled=!1;var a=o._today();o.datescroll.options.selectedIndex=0,o.datepicker.disabled=!0,o.datepicker.date=a,o.datepicker.today=a,o.therapist_changeable=!+i,o.formdata.expressly=+i?1:0,o.iscroll&&o.iscroll._pos(0,0),n.cookie("selectedcoupon")&&(o.formdata.couponID=n.cookie("selectedcoupon"),n.cookie("selectedcoupon",null)),o.closeSelViewHandel(),o.set({time:"请选择上门时间"}).removeClass("inputed");var s=t.batch("services","therapist");s.ready(function(){o.checkScraping(),o.setAmount(o.service.min_num)}),t.loadService(e,function(){var t=Caches.getServiceById(e),i=+t.cityid;o.formdata.city_id=i,o.setService(e,function(){s.fire("services"),o.amountscroll&&o.amountscroll.select(2,0)}),o.set({cityname:Caches.getCityById(i).name,street:"",doorplate:""}),o.loadContacts(o.formdata.city_id),["360life.diandao.org"].indexOf(location.host)<0&&o.updateCoupons()}),o.setTherapist(i,function(){s.fire("therapist")}),o.query.message&&o.set({message:o.query.message}),o.loadTimeTable(i,e,function(){o.setDateTimeSelector(),o.iscroll.refresh(),o.query.time&&"auto"==o.query.time&&setTimeout(function(){o.toValidTime()},100),(r||k).call(this)})},checkScraping:function(){var t=this,e=t.service,i=t.therapist,n=!1;i&&(i.scrapping&&i.scrapping.sid&&(n=i.scrapping.sid.split(",").indexOf(""+e.id)>=0),n?(t.set({scrappingPrice:i.scrapping.price}),t.$view.addClass("has-scrapping"),t.formdata.guasha_uprice=i.scrapping.price):t.$view.removeClass("has-scrapping"),t.$view.find(".scrapping").removeClass("selected"),t.iscroll&&t.iscroll.refresh())},setService:function(e,i){var n=this,r=Caches.getServiceById(e);if(!r)return void t.loadService(e,function(){n.setService(e,i)});n.service=r,n.setAmountSelector(n.service.min_num,n.service.max_num);n.$view;n.formdata.combo=r.therapyid,n.formdata.sid=r.id,n.excellent_assigned=r.params&&r.params.book&&r.putting_id==r.params.book.good.putting_id;var o=(+r.price*n.formdata.num).fixPrice();n.set({total:o,totaltime:o+"元 / "+ +r.minutes*n.formdata.num+"分钟",sername:r.name,serprice:(+r.price).fixPrice()+"元 / "+ +r.minutes+"分钟",sell:"<i>{price|fixPrice}</i>元/{serTime}".format(r)}),n.formdata.city_id=r.cityid,(i||k)()},setTherapist:function(e,i){var n=this;if(e=+e,n.$view[n.therapist_changeable?"addClass":"removeClass"]("therapist-changeable"),n.formdata.tid=+e,!e)return n.set({timg:'<b class="icon-user"></b>',tname:n.excellent_assigned?"将指派优秀技师":"默认指派普通技师"}),void(i||k)(!1);var r=Caches.getTherapistById(e);if(!r)return void t.getTherapistData(e,function(){n.setTherapist(e,i)});n.therapist=r;n.$view;n.set({timg:'<img src="{portraiturl}" />'.format(r),tname:r.truename+(n.therapist_changeable&&r.level_tag>0?"<em>优秀</em>":""),tstar:r.level_tag>0?"<span>优秀</span>":""}),(i||k)(!0)},setDateTimeSelector:function(){var e=this,i=e.$datetime,r=i.find(".date"),o=i.find(".time"),a=t.timeDiff(),s=t.serverDate(),c=[s.getFullYear(),s.getMonth()+1,s.getDate()],l=+new Date(c.join("/"))+a;e.datepicker.today=+l,e.datepicker.date=+l,r.find("ul").html(['<li class="note">上下滚动选取时间</li>',"<li></li>",function(i,n,r,o){i=/^(\d+)(\@(.*))?$/.exec(i);var s=i[3]?+new Date(i[3])-a:+l;days=+i[1];for(var c=0;c<days;c++)r=s+864e5*c,o=new Date(r-a),0==c&&+t.serverTime()>r+e.datepicker.timeEnd+e.datepicker.tail||n.push("<li class=opt time={time}>{name} {day}</li>".format({time:r,name:[s==l?"今天":null,s==l?"明天":null][c]||e.dateString(o),day:Caches.getDayName(o.getDay())}));return n.join("")}(e.datepicker.recentdays,[]),"<li></li>","<li></li>"].join("")),o.find("ul").html(function(i,n){n=e.datepicker.timeStart,i.push("<li class=note>预约时段:{s}-{e}</li><li></li>".format({s:t.dateFormat("{h}:{m}",new Date(e.datepicker.date+e.datepicker.timeStart)),e:t.dateFormat("{h}:{m}",new Date(e.datepicker.date+e.datepicker.timeEnd))}));for(var r,o=0;1&&(r=~~(n/1e3),!(n>e.datepicker.lurkingTimeEnd));o++)i.push('<li class="opt {klass}" time={time}><i>{hours}:{minutes}</i><u class=reserved>约满</u><u class=booked>已约</u><u class=appendable>加单</u></li>'.format({hours:(~~(r/3600)).toDigits(2),minutes:(~~(r/60)%60).toDigits(2),time:n,klass:n>e.datepicker.timeEnd?"lurking":""})),n+=18e5;return i.push("<li></li><li></li>"),i.join("")}([])),e.datescroll.refresh(),e.timescroll.refresh(),e.$date.find("li").each(function(t){n(this).is(".opt")&&(e.datepicker.dateSelectedIndex=t,e.datepicker.date=+this.getAttribute("time"),e.updateTimeTable()||n(this).addClass("disabled"))}),e.datescroll.select(2,0),e.datepicker.disabled=!0,e.set({time:"请选择上门时间"}).removeClass("inputed")},dateString:function(t){return t.getMonth()+1+"月"+t.getDate()+"日"},loadTimeTable:function(t,e,i){var r=this;n.ajax({url:"/api/therapist/get_reserveds",data:{tid:t,sid:e},dataType:"json",success:function(t,e){e=t.data,r.datepicker.services=n.each(e.services,function(t,i){e.services[t]=1e3*i}),r.datepicker.reserveds=n.map(e.reserveds,function(t){var e=/^\d{8}\s\d{2}\:\d{2}\s(\d{10})>\-s(\d+)\-n(\d+)\-u(\d+)\-g([\d\.]+),([\d\.]+)\-m(\d+)$/.exec(t),i={time:1e3*e[1],sid:+e[2],amount:+e[3],uid:+e[4],lat:e[5],lng:e[6],phone:e[7]};return i.phone=i.phone.split("").reverse().join("")-(1024+i.time/1e3),i.count=i.amount,i.end=i.time+r.datepicker.services[i.sid]*i.amount,i}),r.datepicker.splits=n.each(e.splits,function(t,i){e.splits[t]=1e3*i}),r.datepicker.segment=1e3*e.segments.segment,r.datepicker.timeStart=1e3*e.segments.start,r.datepicker.timeEnd=1e3*e.segments.end,r.datepicker.lurkingTimeEnd=1e3*e.segments.lurking_end,r.datepicker.tail=1e3*e.segments.tail||0,r.datepicker.leadtime=1e3*e.leadtime,r.datepicker.recentdays=e.recentdays||7,r.timetabled=!0,(i||k).call(r,e)}})},getTolerant:function(e){var i=this,r=e.distance;if(!e.distance&&+e.lat&&+this.formdata.lat&&(r=t.BaiduDistance(e,this.formdata),e.distance=r),0==r&&e.uid==App.uid)return 0;if(500>r&&e.phone==i.get("mobile"))return 0;var o=n.extend({},i.datepicker.splits),a=o["default"];return null!==r&&n.each(o,function(t,e){return t>=r?(a=e,!1):void 0}),a},updateTimeTable:function(){var e=this,i=e.$datetime,r=(i.find(".date"),i.find(".time")),o=+new Date;return e.datepicker.reserveds&&(e.datepicker.reserveds=n.map(e.datepicker.reserveds,function(t){return t.distance=null,t})),r.find("li.opt").each(function(){var i=n(this);n(this).removeClass("lurking-show reparation splitted appendable"),i[0].reserved=null;var r=e.datepicker.date+ +this.getAttribute("time");secs=r/1e3;var a=!1,s=!1,c=!1;e.datepicker.reserveds.forEach(function(t){var n=0;return r>=t.time&&r<t.end&&(i[0].reserved=t,s=!0),+e.formdata.tid&&(t.sid>0&&(n=e.getTolerant(t)),r>=t.time-n&&r<t.end+n)?(a=!0,!1):0==n&&0==t.sid&&r>=t.time-n&&r<=t.end+n?(a=!0,!1):void 0}),a=a&&!s,i.attr("uid",i[0].reserved?i[0].reserved.uid:null);var l=s&&this.reserved.uid==App.uid,u=i.prev(),d=!1;u[0].reserved&&u[0].reserved.phone==e.get("mobile")?(d=o>u[0].reserved.end+e.datepicker.leadtime,c=!0):d=o>r-e.datepicker.leadtime,u[0].reserved&&u[0].reserved.phone==e.get("mobile")&&n(this).add(n(this).prevAll()).filter(".lurking").addClass("lurking-show"),!+e.formdata.tid&&1e3*secs<=e.datepicker.today+36e6&&(d=!0),!d&&!+e.formdata.tid&&o>=e.datepicker.today+72e6&&(d=d||1e3*secs<=e.datepicker.today+1224e5),n(this)[d?"addClass":"removeClass"]("expired"),n(this)[s?"addClass":"removeClass"]("reserved"),n(this)[a?"addClass":"removeClass"]("splitted");var h=d||s||a&&!c;n(this)[h?"addClass":"removeClass"]("disabled"),n(this).is(".lurking")&&n(this).addClass("disabled"),n(this)[c?"addClass":"removeClass"]("appendable"),!h&&c&&n(this).removeClass("disabled").prevAll().filter(".lurking").addClass("lurking-show"),n(this)[l?"addClass":"removeClass"]("booked"),s&&this.reserved.uid==t.uid&&n(this).prevAll().each(function(){n(this).is(".splitted")||n(this).addClass("reparation"),i[0].reserved.time-e.datepicker.leadtime>+new Date||n(this).hasClass("reserved")||n(this).hasClass("expired")&&n(this).removeClass("disabled").addClass("reparation")})}).each(function(){var i=n(this).prev();i[0].reserved&&i[0].reserved.uid==t.uid&&!function(t,e){t.is(".opt")&&(e=t.next(),e.size()&&(e.is(".reserved")||(t.is(".splitted")&&(t.removeClass("splitted disabled").addClass("tensed"),t.is(".appendable")?t.prevAll().filter(".lurking").addClass("lurking-show"):null),arguments.callee(e))))}(i);var r=n(this).is(".disabled"),o=!1;if(!r&&e.formdata.num&&+e.formdata.tid){var a=e.formdata.num*+e.service.minutes*6e4,s=e.getIdleTime(n(this),a);a>s&&(o=!0)}n(this)[o?"addClass":"removeClass"]("shortage"),n(this)[r||o?"addClass":"removeClass"]("disabled"),!n(this).hasClass("reparation")||o||r||n(this).addClass("appendable").prevAll().removeClass("appendable reparation").filter(".expired").addClass("disabled")}).each(function(){n(this).is(".disabled")&&n(this).is(".selected")&&(e.datepicker.disabled=!0)}),e.timescroll.refresh(),e.$time.find(".opt").filter(function(){return!(n(this).is(".disabled")||n(this).is(".lurking"))}).size()?!0:!1},getIdleTime:function(t,e){var i,n=this;t.find?(i=t,t=+i.attr("time")):i=n.$time.find('li[time="{#0}"]'.format(t));var r=function(n,r,o){return o=arguments.callee,r=n.next(),r.size()?(r.is(".reserved")||r.is(".splitted"))&&r.is(".opt")?r:(e&&+r.attr("time")-t>e&&r.is(".tensed")&&!i.is(".tensed")&&i.addClass("tensed"),o(r)):null}(i),o=r?+r.attr("time"):n.datepicker.timeEnd+n.datepicker.tail;return o-t},toValidTime:function(){var t=this;if(t.timetabled){var e=t.$time.find(".opt.selected").eq(0);if(!e.size()||e.is(".disabled")){var i=!1;if(t.$time.find(".opt").each(function(){return n(this).is(".disabled")?!0:(t.timescroll.select(n(this).index(),0),i=!0,!1)}),!(t.datepicker.dateSelectedIndex>=t.$date.find("li").size()-2))return i?void 0:(t.datescroll.select(t.datepicker.dateSelectedIndex+1,0),void t.toValidTime())}}},noontext:"上午",onDatetimeSelected:function(e){var i=this,n=i.$time.find("li.selected").eq(0);if(n.size()){var r=n.hasClass("disabled");if(!r){i.datepicker.disabled=r?!0:!1,i.datepicker.time=+n[0].getAttribute("time"),i.datepicker.tensedAppend=n.is(".tensed.appendable");var o=t.timeDiff(),a=i.datepicker.date+i.datepicker.time,e=new Date(a-o),s=e.getHours();if(i.datepicker.last_datetime!=a&&i.onDatetimeChange.call(i,a),i.datepicker.last_datetime=a,!i.timetabled)return void(i.datepicker.disabled=!0);var c=i.setNoon(s);i.datepicker.disabled?i.set("time",""):(i.$view.addClass("timeselected"),i.set("time",[e.getMonth()+1,"月",e.getDate(),"日","(",Caches.getDayName(e.getDay()),")"," ",s.toDigits(2),":",e.getMinutes().toDigits(2)," (",c,")"].join("")))}}},setNoon:function(t){var e=this,i=t>=18?"晚上":t>=14?"下午":t>=12?"中午":"上午";return e.noontext!=i&&(e.$noontext.text(i),e.noontext=i),i},onDatetimeChange:function(){var t=this;t.therapist_changeable&&+t.formdata.tid&&(t.setTherapist(0),DD.popup("预约时间变更,请重新选择技师",2e3))},loadContacts:function(e){var i=this;return e=e||t.cityid,t.curlocation.location?i.setContact(t.curlocation):void t.loadContacts(function(t,r){if(!r){var o=null,a=null,s=mCache.get("useHistoryAddress");return n.each(t,function(t,i){i.local_id==e&&(a||(a=i),s&&i.cid==s&&(o=i))}),o?(i.setContact(o),void mCache.remove("useHistoryAddress")):void(a&&i.setContact(a))}})},setContact:function(e){var i=this;i.poi=e,i.set({addr:(e.street||"")+" "+(e.doorplate||""),street:e.street||"",doorplate:e.doorplate||"",mobile:e.mobile||n.cookie("mobile")||""}),i.formdata.address=e.addr||"",i.formdata.lat=e.location.lat,i.formdata.lng=e.location.lng,i.formdata.cid=e.cid||0,i.reachable=!1,!e.location.lat||e.reachable?i.reachable=!0:t.serviceReachable(i.formdata.city_id||t.cityid,e,function(t){i.reachable=t}),(!i.datepicker.disabled||i.therapist_changeable&&+i.formdata.tid)&&o.popup("可预约条件更新<br/>请重新选择时间和技师",4e3),i.therapist_changeable&&+i.formdata.tid&&i.setTherapist(0),i.updateTimeTable()},increaseAmount:function(){var t=this,e=t.maxAmount(),i=t.formdata.num,n=i+1;return n>e?void o.confirm("所选时间已不足以完成{#0}次服务, 是否继续加单并重选时间?".format(n),function(){t.datepicker.disabled=!0,t.onDatetimeSelected(),t.setAmount(n)}):void t.setAmount(n)},reduceAmount:function(){var t=this,e=t.formdata.num,i=e-1;i<+t.service.min_num||t.setAmount(i)},maxAmount:function(){var t,e=this,i=+e.service.max_num,n=(+new Date,6e4*+e.service.minutes),r=e.datepicker.time;if(!e.datepicker.disabled&&r){var t=e.getIdleTime(r);i=Math.min(i,~~(t/n))}return i},setAmount:function(t){var e=this;e.last_amount&&e.last_amount<t&&e.therapist_changeable&&+e.formdata.tid&&(e.setTherapist(0),DD.popup("服务份数变更, 请重新选择技师")),e.last_amount=t,e.formdata.num=+t,e.$minus[t<=+e.service.min_num?"addClass":"removeClass"]("disabled"),e.$plus[t>=+e.service.max_num?"addClass":"removeClass"]("disabled"),e.formdata.guasha_num=e.$view.find(".scrapping.selected").size()?1:0,e.updateTimeTable();var i=(+e.service.price*t).fixPrice();i+=e.formdata.guasha_num*e.formdata.guasha_uprice,e.formdata.amount=100*i,e.set({total:i.fixPrice(),amount:t+"份",price:e.service.price.fixPrice()+"元 / "+e.service.minutes*t+"分钟",totaltime:" / "+e.service.minutes*t+"分钟",payprice:(+e.service.price*t).fixPrice()+"元"}),e.updateCoupons()},setAmountSelector:function(t,e){var i=this;t=t||1,i.$seramount.find("ul").html(function(n,r){r=i.datepicker.timeStart,n.push("<li class=note>将由同一位技师持续为您服务</li><li></li>");for(var o=t;e>o;o++)n.push('<li class="opt" amount={number}><i>{number}份</i></li>'.format({number:o}));return n.push("<li></li><li></li>"),n.join("")}([])),i.amountscroll&&i.amountscroll.refresh()},updatePayPrice:function(){var t=this,e=(+t.service.price*t.formdata.num+t.formdata.guasha_num*t.formdata.guasha_uprice-t.formdata.couponVal/100).fixPrice();e=0>e?0:e,t.set({coupon:function(){return t.coupons&&t.coupons.length?t.formdata.couponID&&t.formdata.couponVal?"减"+(t.formdata.couponVal/100).fixPrice()+"元":"选择优惠券("+t.coupons.length+")":""}(),payprice:e+"元"})},coupons:null,updateCoupons:function(){var t=this;if(t.coupons){if(!t.coupons.length)return;t.$view.addClass("has-coupons"),setTimeout(function(){t.iscroll.refresh()},600),t.renderCoupons(),t.updatePayPrice()}else t.loadCoupons(function(){t.updateCoupons()})},_load_coupons_lock:!1,loadCoupons:function(e){var i=this;i._load_coupons_lock||(i._load_coupons_lock=!0,t.getCoupons(0,100,function(t){i.coupons=t.list.sort(function(t,e){return e.value-t.value}),(e||k)(i.coupons),i._load_coupons_lock=!1},{status:0}))},renderCoupons:function(){var e=this,i=[];n.each(e.coupons,function(r,o){if(o.if_limit=+o.if_limit,o.limit_city=+o.limit_city,o.limit_starttime=+o.limit_starttime,o.limit_endtime=+o.limit_endtime,o.error="",o.label=""+~~(o.value/100).fixPrice()+"元优惠券",o.dayleft=t.dateCD(new Date(1e3*o.end_time)),t.applyCouponFilter(o,{cityid:e.service.cityid,therapyid:e.service.therapyid,tid:e.formdata.tid}),o.limit_price&&e.formdata.amount<o.limit_price&&(o.error=o.limit_desc),e.formdata.order_time&&(+o.limit_starttime||+o.limit_endtime)){var a=t.dayTimestamp(1e3*e.formdata.order_time),s=t.serverTime()-a;(s<1e3*+o.limit_starttime||1e3*+o.limit_endtime>s)&&(o.error=o.limit_desc)}return o.klass=o.error?"disabled":"enabled",(e.couponsFilter||k)(o)!==!1?n.isFunction(e.couponItemFormater)?void i.push(e.couponItemFormater(o)):void i.push(['<li clkt="selected-coupon:{value};cid:{id};batch:{batch_num}" class="tapable {klass}" error="{error}" limit="{limit_ser}" limitname="{limit_sername}" cid={id} amount={value} label="{label}" limitprice="{limit_price}">',"<h4>{label}</h4>","<p>{dayleft}过期 <em>",o.if_limit?"{limit_desc}":"","</em></p>","<i class=icon-ok></i>","</li>"].join("").format(o)):void 0});var r=e.$coupons.find("ul");r.html(i.join("")),e.ciscroll&&e.ciscroll.refresh(),e.formdata.couponVal=0;var o=null;e.formdata.couponID&&(o=r.find("li[cid='"+e.formdata.couponID+"']"),o.size()&&o.is(".enabled")||(o=null)),o||(o=r.find("li.enabled")),o&&o.size()&&o.is(".enabled")&&e.selectCouponItem(o[0])},set:function(t,e,i){var o=this;"[object Object]"=={}.toString.call(t)?i=t:(i={},i[t]=e);var a=[];return n.each(i,function(e,i,n,s){if(i!==r&&($t=o.$view.find("[key="+e+"]"),$t.size())){a.push($t[0]),s=$t.is("input,textarea");var c=$t[0].getAttribute("placeholder");(!s&&""==i||i==c)&&(i=c,$t.removeClass("inputed")),!s&&i&&i.length>0&&i!=c&&$t.addClass("inputed"),$t[s?"val":"html"](i),"mobile"==t&&($t[0]._lastvalue&&i!=$t[0]._lastvalue&&$t.trigger("change",{last:$t[0]._lastvalue,value:i}),$t[0]._lastvalue=i)}}),n(a)},get:function(t){var e=this.$view.find("[key="+t+"]"),i=e[e.is("input,textarea")?"val":"text"](),n=e.attr("placeholder")||"";return i==n?"":e[e.is("input,textarea")?"val":"text"]()},validate:function(e){var i=this,n=i.formdata,r=i.datepicker.date+i.datepicker.time;if(i.datepicker.disabled)return e&&o.alert("请选择上门时间"),!1;if(n.order_time=~~(r/1e3),!i.poi||!i.poi.street)return e&&o.alert("请输入地址"),!1;if(n.street=i.poi.street,n.doorplate=i.poi.doorplate,!n.doorplate)return e&&o.alert("请输入门牌号"),!1;if(n.mobile=i.get("mobile"),!t.isMobile(n.mobile))return e&&o.alert("请输入正确的手机号码"),!1;if(n.message=i.get("message"),!i.reachable)return e&&o.alert("抱歉，您的地址不在服务范围内！我们正在努力扩展服务范围^_^"),!1;var a=mCache.get("geolocation");return n.geo=a?[a.latitude,a.longitude].join(","):"",n.guasha_num=i.$view.find(".scrapping.selected").size()?1:0,!0},lock_submit:!1,submit:function(e){var i=this,r=i.datepicker.date+i.datepicker.time;return!e&&!i.datepicker.disabled&&r<+new Date?void o.confirm("您正在进行加单，请与技师当面确认后继续，否则订单可能被取消！",function(){i.submit(!0)}):!e&&i.datepicker.tensedAppend?void o.showMsg("当前所选时间距技师其它服务单时间过近，技师可能无足够时间服务。",{buttons:{"取消[.btn-default]":function(){},"继续预约[.btn-primary ]":function(){i.submit(!0)}}}):void(i.lock_submit||i.validate(!0)&&(i.lock_submit=!0,n.ajax({url:"/api/order/add_order",type:"post",loading:"正在创建订单",data:this.formdata,dataType:"json",success:function(e){return e.error?void o.alert(e.error.message):e.data.surcharge>0?void o.showMsg("按摩师距您较远，将收取{#0|fixPrice}元上门费。建议选择距您较近的按摩师！".format(e.data.surcharge/100),{buttons:{"更换技师[.btn-primary]":function(){Router.navigate("therapists",{trigger:!0,replace:!0}),t.ga.trackEvent("remoteServiceHint","changeMasseur",[t.uid,i.formdata.tid].join(","),1)},"继续预约[.btn-default]":function(){i.formdata.confirmToken=e.data.confirmToken,i.submit(!0),t.ga.trackEvent("remoteServiceHint","continue",[t.uid,i.formdata.tid].join(","),1)}}}):e.data.distance&&e.data.distance>e.data.reach?(o.alert("您的上门地址不在{name}服务范围内，请更换地址或切换服务城市！".format(App.city)),void t.ga.trackEvent("MobileWeb","OutOfReach","{mobile}->{tid}".format(i.formdata),1)):e.data.confirmToken&&e.data.distance>e.data.limit_distance?void o.confirm("您的上门地址距技师较远，技师可能无法准时上门。继续预约吗？".format(e.data),function(){i.formdata.confirmToken=e.data.confirmToken,i.submit(!0),t.ga.trackEvent("MobileWeb","LongDistanceConfirm","Forward",1)},function(){t.ga.trackEvent("MobileWeb","LongDistanceConfirm","Canceled",1)}):(n.cookie("selectedcoupon",i.formdata.couponID),t.ga.trackEvent("MobileWeb","OrderViaPlatform",t.platform,1),void t.goToPayOrder(e.data.order_id,!0))},complete:function(){i.lock_submit=!1}})))}},i.routes["booking/s:sid/t:tid"]="booking",i.booking=function(e,i){function r(){history.length>1?history.back():Router.navigate("/",{trigger:!0,replace:!0})}function s(){t.BookingView.loadData(e,i,function(){o.loadend(),t.ga.trackPage()}),n.extend(t.BookingView.formdata,{tid:i})}if(t.BookingView=t.BookingView||new a,t.setTitle(t.titles.BOOKING),t.setState("booking"),t.BookingView.setlocalView)return void(t.BookingView.setlocalView=!1);if(t._therapist_picker_viewed)return void(t._therapist_picker_viewed=null);o.loading();var c=t.batch("logined","unpaid_getted"),l=!1,u=[];c.ready(function(){o.loadend();var e=u[0];l?o.showMsg("您有一个{datetime}{booking}的订单正等待支付！".format({datetime:t.dateFormat("{Y}年{M}月{D}日 {h}:{m} ",new Date(1e3*e.order_time)),booking:e.tech_name?"预约"+e.tech_name:""}),{buttons:{"查看订单[.btn-danger tapable]":function(){t.ga.trackEvent("UnpaidOrder","toViewOrder","u{#0},o{#1}".format(t.uid,e.id),1),location.href="/order/view/"+e.id},"重新预约[.btn-default tapable]":function(){t.ga.trackEvent("UnpaidOrder","Reset","u{#0},o{#1}".format(t.uid,e.id),1),o.loading("重置预约中...",1e3),t.cancelOrder(e.id,function(){o.loadend(),s()},null,null,!0)}}}):s()}),t.checkLogin(function(n){return n?void c.fire("logined"):void t.login({redirect:"/booking/s{#0}/t{#1}".format(e,i),replace:!0,logined:function(){Router.booking(e,i)},canceled:function(){r()}})}),n.getJSON("/api/Order/get_unpaid?_="+ +new Date,function(t){return t.error?void c.fire("unpaid_getted"):(t.data.length&&(l=!0),
u=t.data,void c.fire("unpaid_getted"))}),t.Interface.setShareButton(!1)},a}),
//! view.citypicker.js
define("appointment-therapist-picker",["app","appointment-router","zepto"],function(t,e,i){function n(){return this.init.apply(this,arguments)}return n.prototype={$view:null,iscroll:null,pageSize:20,_opt:{},_sel_callback:null,init:function(){var e=this;i("#sections").append(['<section class="view-therapist-picker" id="view_therapist_picker">',"<div class=filter>","<ul>",'<li class="selected tapable">普通技师</li>','<li class="tapable">优秀技师</li>',"</ul>","</div>","<div class=iscroll>","<div class=iscroll-wrapper>",'<ul class="list list-therapists"></ul>',"<div class=loadmore><span>加载中...</span></div>","<div class=nonedata-tips>","<p>所选时间暂时没有可推荐的<span class=curtype>普通技师</span></p>","<p>客服将人工为您指派技师</p>",'<b class="btn-back btn-danger tapable">确定</b>',"</div>","</div>","</div>","</section>"].join("")),e.$view=i("#view_therapist_picker"),e.$list=e.$view.find(".list").eq(0),e.$nav=e.$view.find(".filter>ul").eq(0),e.$nav.on(tapEvent,"li",function(t){stopTouchPropagation(t,this);var n=i.extend({},e._opt,{service_putting_id:+this.getAttribute("sid")});Router.navigate("therapistpicker?"+QueryString.parse(n),{trigger:!0,replace:!0})}),e.$view.on(tapEvent,".btn-back",function(t){stopTouchPropagation(t,this),e.back()}),e.iscroll=new iScroll(e.$view.find(".iscroll")[0],{onScroll:_.throttle(function(){App.snapit()},200)}),e.$loading=e.$view.find(".loadmore").catchable({catched:function(){e.loadTherapists()}}),e.$list.on(tapEvent,"li",function(){var n=+i(this).attr("tid");i.isFunction(e._sel_callback)?e._sel_callback.call(t,n,e._opt.service_putting_id):location.replace("/")}),e.$view.on("swipeRight",function(){e.back()}).on(touchStartEvent,preventDefault)},applyFilter:function(t){var e=this,i=t.params.book,n=[i.normal,i.good],r=[];n.forEach(function(t){var i=t.putting_id==e._opt.service_putting_id?"selected":"";i&&e.$view.find(".curtype").text(t.tag),r.push('<li sid="{putting_id}" class="tapable {#1}">{tag}<span>{price|fixPrice}元/{#2}分钟</span></li>'.format(t,i,e._opt.duration))}),e.$nav.html(r.join(""))},load:function(){Backbone.history.historyFragments.length>1&&(t._therapist_picker_viewed=!0);var e=this;e._reset(),e._parseOpts()},_reset:function(){var t=this;t.$view.removeClass("nomore nonedata"),t.$list.html(""),t.iscroll&&t.iscroll.refresh()},_parseOpts:function(){this._opt=i.extend({local_id:1,service_putting_id:0,number:1,lnglat:"",ytime:0,tid:0},QueryString.pickup(location.search))},_lock_load_therapists:null,loadTherapists:function(){var t=this;t._lock_load_therapists||(t._lock_load_therapists=!0,i.ajax({url:"/api/therapist/getJishiList",cache:!1,dataType:"json",data:i.extend({},t._opt,{limit:t.pageSize,start:t.$list.find("li.appointed").size()}),success:function(e){return e.error&&(DD.alert(e.error.message),t.nonedata()),e.data.length||t.$list.find("li").size()?void t.renderTherapists(e.data):void t.nonedata()},complete:function(){t._lock_load_therapists=!1}}))},renderTherapists:function(t){var e=this,n=[];t.length<e.pageSize&&e.nomore();var r=e.$list.find("li.appointed").size();!r&&t.length&&n.push(['<li tid="0" clkt="plist:0;t0_系统" class="autoassign tapable">',"<dl>","<dt><p class=icon-user></p></dt>","<dd>","<h3>系统选派</h3>",'<p class="title">系统将自动为您选派最合适的技师</p>',"</dd>","</dl>","</li>","<div class=bs></div>"].join("")),i.each(t,function(t,e){Caches.completeTherapist(e),e.star=+e.tecstar,n.push(['<li tid="{tid}" clkt="plist:',r+t+1,';t{tid}_{truename}" class="appointed tapable">',"<dl>",'<dt><img defer="{portraiturl}" src="{portraiholder}" /></dt>',"<dd>","<h3>","{truename}","</h3>",'<p class="title">{age}岁·{native_place}人·{title}</p>',"<p class=stars>",new Array(e.star+1).join('<i class="icon-star actived"></i>'),new Array(6-e.star).join("<i class=icon-star></i>"),"<i class=rate>{star|toFixed:1}</i>","</p>","</dd>","</dl>","</li>","<div class=bs></div>"].join("").format(e))}),e.$list.append(n.join("")),e.$list.find("img").defer(function(t){return i(this).attr("src",t).css("opacity",1),!1}),e.iscroll&&e.iscroll.refresh()},nomore:function(){var t=this;t.$view.addClass("nomore")},nonedata:function(){var t=this;t.nomore(),t.$view.addClass("nonedata")},back:function(){history.length>1?t.history.back():Router.navigate("/",{trigger:!0,replace:!0})}},i.extend(t,{selTherapist:function(e,i){e=e||{},t.TherapistPickerView=t.TherapistPickerView||new n,t.TherapistPickerView._sel_callback=i,Router.navigate("therapistpicker?"+QueryString.parse(e),{trigger:!0})}}),i.extend(e.routes,{therapistpicker:"therapistpicker"}),i.extend(e,{therapistpicker:function(){var e=t.TherapistPickerView||new n;t.TherapistPickerView=e,e._parseOpts(),App.loadService(e._opt.service_putting_id,function(i){t.setState("therapistpicker"),t.setTitle(t.titles.THERAPIST_PICKER),e.applyFilter(i[0]),e.load(),t.watchSnap(),t.ga.trackPage()})}}),n}),requirejs.ddinjected=1,
//! appointment Controller
requirejs.config({paths:{loadimg:"amd/loadimg","appointment-appext":"m/js/appointment/appext","appointment-router":"m/js/appointment/router","appointment-citypicker":"m/js/appointment/view.citypicker","appointment-services":"m/js/appointment/view.services","appointment-therapists":"m/js/appointment/view.therapists","appointment-service":"m/js/appointment/view.service","appointment-therapist":"m/js/appointment/view.therapist","appointment-therapist-certs":"m/js/appointment/view.therapist-certs","appointment-location":"m/js/appointment/view.location","appointment-booking":"m/js/appointment/view.booking","appointment-therapist-picker":"m/js/appointment/view.therapist-picker"}}),require(["app","zepto","utils","backbone","cookie","catchable","mcache","iScroll","ddialog","loadimg","appointment-appext","appointment-router","appointment-citypicker","appointment-services","appointment-service","appointment-therapists","appointment-therapist","appointment-therapist-certs","appointment-location","appointment-booking","appointment-therapist-picker"],function(t,e){t.init();var i=Backbone.Router.extend(require("appointment-router"));window.Router=t.router=new i,Backbone.history.start({pushState:!0,root:"/",beforeTrigger:function(){return Router.__beforeAction.apply(Router,arguments)}})||Router.navigate("/",{trigger:!0}),e("html").addClass("page-load"),window.preloaded&&window.preloaded()});