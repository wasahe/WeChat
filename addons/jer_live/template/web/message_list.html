{template 'common/header'}{php load()->func('tpl')}<link rel="stylesheet" href="/addons/jer_live/static/css/style.css"><ul class="nav nav-tabs">    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'list'))}">直播列表</a></li>    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'post'))}">创建直播</a></li>    <li class="active"><a href="{php echo $this->createWebUrl('live', array('op' => 'put', 'ac'=>'list', 'lid' => $lid))}">信息列表</a></li>    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'put', 'ac'=>'post', 'lid' => $lid))}">发布信息</a></li>    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'put', 'ac'=>'ban_list', 'lid' => $lid))}">禁言列表</a></li>    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'put', 'ac'=>'reward_list', 'lid' => $lid))}">打赏列表</a></li>    {if $live_data['live_charge']}    <li><a href="{php echo $this->createWebUrl('live', array('op' => 'put', 'ac'=>'charge_list', 'lid' => $lid))}">付费列表</a></li>    {/if}</ul><div class="main">    <div class="panel panel-info">        <div class="panel-heading">筛选</div>        <div class="panel-body">            <form action="./index.php" method="get" class="form-inline ng-pristine ng-valid" role="form">                <input type="hidden" name="c" value="site" />                <input type="hidden" name="a" value="entry" />                <input type="hidden" name="m" value="jer_live" />                <input type="hidden" name="do" value="live" />                <input type="hidden" name="op" value="put" />                <input type="hidden" name="ac" value="list" />                <input type="hidden" name="lid" value="{$lid}" />                <input type="hidden" name="is" value="1">                <div class="form-group col-md-4">                    <label class="control-label">标题： </label>                    <input type="text" class="form-control" name="title" value="{$title}">                </div>                <div class="form-group col-md-4">                    <label class="control-label">发布时间： </label>                    {php load()->func('tpl');}                    {php echo tpl_form_field_daterange('time', array('starttime'=>date('Y-m-d', $starttime),'endtime'=>date('Y-m-d', $endtime)));}                </div>                <div class="form-group">                    <label class="control-label"></label>                    <button class="btn btn-default" data-original-title="" title=""><i class="fa fa-search"></i>搜索</button>                </div>            </form>        </div>    </div>    <div class="panel message_list" id="SendBoxWrap">        <div class="col-sm-12" id="SendBox">            <div class="chatPanel form">                <div class="page-header">                    <h4>直播消息</h4>                </div>                {if $list}                <div id="list" class="chatItem you">                {loop $list $v}                    <div class="media mediaFullText {if $v[status] == 0}nopass{/if}">                        <div class="mediaPanel">                            <div class="mediaHead">                                <span class="title">                                    {if $v[avatar]}                                        <img src="{$v[avatar]}" class="img-rounded useravatar">                                        <span class="nickname">{$v[nickname]}：</span>                                    {else}                                        <img src="./resource/images/noavatar_middle.gif" class="img-rounded useravatar">                                        <span class="nickname">主持人：</span>                                    {/if}                                    {$v[title]}                                </span>                            </div>                            {if $v['attachment']['images']}                            <div class="mediaImg">                                {loop $v['attachment']['images'] $img}                                <img src="{$img}">                                {/loop}                            </div>                            {/if}                            {if $v['attachment']['videos']}                            <div class="mediaVideo">                                <video src="{$v['attachment']['videos']}" controls="controls" preload="none"></video>                            </div>                            {/if}                            <div class="time">发布时间：{php echo date('Y-m-d H:i:s',$v['createtime'])}</div>                            <div class="set">                                <span class="btn btn-warning btn-xs zan_btn" title="赞" data-mid="{$v[id]}" page="1"><i class="fa fa-heart"></i> ({$v[zan_count]})</span>                                <span class="btn btn-primary btn-xs comment_btn" title="评论" data-mid="{$v[id]}" page="1"><i class="fa fa-comments"></i> ({$v[comment_count]})</span>                                <a href="{php echo $this->createWebUrl('live',array('op'=>'put', 'ac' => 'post', 'id' => $v['id'], 'lid' => $lid));}"  title="编辑"><span class="btn btn-info btn-xs"><i class="fa fa-edit"></i></span></a>                                {if $v[status] == 0}                                <span class="btn btn-success btn-xs pass_message" title="审核通过" data-mid="{$v[id]}"><i class="fa fa-check"></i></span>                                {/if}                                <a href="{php echo $this->createWebUrl('live',array('op'=>'put', 'ac' => 'del', 'id' => $v['id'], 'lid' => $lid));}" onclick="return confirm('确定删除信息吗?')" title="删除"><span class="btn btn-danger btn-xs"><i class="fa fa-times"></i></span></a>                            </div>                            <div id="comment_{$v['id']}" class="comment">                                <div class="tooltip-arrow"></div>                                <button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>                                <div class="comment_con" data-mid="{$v[id]}">                                    <div class="comm_list"></div>                                    <div class="comm_page"></div>                                    <div class="comm_form">                                        <div class="input-group">                                            <div class="input-group-btn">                                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="presenter_nickname_{$v[id]}">{$uid_list[0][nickname]}</span> <span class="caret"></span></button>                                                <ul class="dropdown-menu">                                                    {loop $uid_list $user}                                                    <li><a data-uid="{$user[uid]}" data-mid="{$v[id]}" class="comm_presenter_select">{$user[nickname]}</a></li>                                                    {/loop}                                                </ul>                                            </div>                                            <input type="text" id="reply_con_{$v[id]}" class="form-control noradius reply_con" placeholder="说点什么...">                                            <span class="input-group-btn">                                                <button id="reply_btn_{$v[id]}" class="btn btn-default noradius reply_btn" data-mid="{$v[id]}" data-uid="{$uid_list[0][uid]}" data-reuid="0" type="button"><i class="fa fa-reply"></i></button>                                            </span>                                        </div>                                    </div>                                </div>                            </div>                            <div id="zan_{$v['id']}" class="zan">                                <div class="tooltip-arrow"></div>                                <button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>                                <div class="zan_con" data-mid="{$v[id]}">                                    <div class="zan_list"></div>                                    <div class="zan_page"></div>                                </div>                            </div>                        </div>                    </div>                {/loop}                </div>                <div class="page">                    {$pager}                </div>                {else}                <h3 class="text-center text-muted">暂时还没有信息</h3>                {/if}            </div>        </div>        <div class="clearfix"></div>    </div></div><script>    var lid = '{$lid}';    $(document).on("click",".chatPanel .media .comment .close",function(){        $(this).parent().hide();    });    require(['moment', '../../../addons/jer_live/static/js/preventScroll.js'], function (moment){        /**         * 留言         */        $(document).on("click",".comment_btn, .comm_page .pagination a",function(e){            if(e.currentTarget.localName == 'span'){                var mid = $(this).attr("data-mid");            }else{                var mid = $(this).parents(".comment_con").attr("data-mid");            }            var page = $(this).attr("page");            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'getCommentList'))}", {mid: mid, page: page}, function (json) {                var html = '';                if(json.status == '1'){                    $.each(json.data, function (i, v) {                        var retxt = '';                        if(v.renickname){                            retxt = '回复：<span class="label label-success">' + v.renickname + '</span> ';                        }                        if(v.status == 1){                            var np = '';                            var np_a = '';                        }else{                            var np = 'nopass';                            var np_a = '<a href="javascript:;" data-cid="' + v.id + '" class="pass_comm"><i class="fa fa-check" title="审核通过"></i></a>';                        }                        html += '<dl class="clearfix '+ np + '"><dt><img src="' + util.tomedia(v.avatar) + '" class="img-rounded useravatar"></dt><dd><p class="c_user"><span class="nickname">' + v.nickname + '</span> <span class="date">' + moment(v.createtime * 1000).format('YYYY-MM-DD HH:mm:ss') + '</span>&nbsp;&nbsp;<span class="ban"><a data-toggle="popover" data-trigger="focus" data-content="" data-uid="' + v.uid + '"><i class="fa fa-ban" title="禁言"></i></a></span></p><p class="c_con">' + retxt + v.content + '</p><div class="operating">' + np_a + '&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" title="回复" class="comm_reply" data-uid="' + v.uid + '"><i class="fa fa-reply"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" title="删除" class="comm_del" data-cid="' + v.id + '"><i class="fa fa-times"></i></a></div></dd></dl>';                    });                    $("#comment_" + mid).find(".comm_page").html(json.page);                }else {                    html = '<p class="empty">暂时没有评论</p>';                }                $("#comment_" + mid).find(".comm_list").html(html)            });            $(".chatPanel .media .comment").hide();            $(".chatPanel .media .zan").hide();            $("#comment_" + mid).show();            //滚动到信息顶部            var top = $(this).parents(".media").offset().top;            $("html,body").animate({scrollTop:parseInt(top) - 13},500);        });        $(document).on("click", ".zan_btn, .zan_page .pagination a", function (e) {            if(e.currentTarget.localName == 'span'){                var mid = $(this).attr("data-mid");            }else{                var mid = $(this).parents(".zan_con").attr("data-mid");            }            var page = $(this).attr("page");            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'getZanList'))}", {mid: mid, page: page}, function (json) {                var html = '';                if(json.status == '1'){                    $.each(json.data, function (i, v) {                        html += '<dl class="clearfix"><dt><img src="' + util.tomedia(v.avatar) + '" class="img-rounded useravatar"></dt><dd><p class="c_user"> <span class="nickname">' + v.nickname + '</span> <span class="zan_text">在</span> <span class="date">' + moment(v.createtime * 1000).format('YYYY-MM-DD HH:mm:ss') + '</span> <span>对此信息点了个赞</span> </p></dd></dl>';                    });                    $("#zan_" + mid).find(".zan_page").html(json.page);                }else {                    html = '<p class="empty">暂时没人有点赞</p>';                }                $("#zan_" + mid).find(".zan_list").html(html);            });            $(".chatPanel .media .comment").hide();            $(".chatPanel .media .zan").hide();            $("#zan_" + mid).show();            //滚动到信息顶部            var top = $(this).parents(".media").offset().top;            $("html,body").animate({scrollTop:parseInt(top) - 13},500);        });        /**         * 发布留言         */        $(".reply_btn").on("click", function () {            var mid = $(this).attr("data-mid");            var con = $("#reply_con_" + mid).val();            var uid = $(this).attr("data-uid");            var reuid = $(this).attr("data-reuid");            var html = '';            var comm_list = $("#comment_" + mid).find(".comm_list");            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'sendReply'))}", {mid: mid, con: con, uid: uid, reuid: reuid}, function (json) {                if(json.status == '1'){                    var data = json.data;                    var retxt = '';                    if(data.renickname){                        retxt = '回复：<span class="label label-success">' + data.renickname + '</span> ';                    }                    html = '<dl class="clearfix"><dt><img src="' + data.avatar + '" class="img-rounded useravatar"></dt><dd><p class="c_user"><span class="nickname">' + data.nickname + '</span> <span class="date">' + moment(data.createtime * 1000).format('YYYY-MM-DD HH:mm:ss') + '</span>&nbsp;&nbsp;<span class="ban"><a data-toggle="popover" data-trigger="focus" data-content="" data-uid="' + data.uid + '"><i class="fa fa-ban" title="禁言"></i></a></span></p><p class="c_con">' + retxt + data.content + '</p><div class="operating"><a href="javascript:;" title="回复" class="comm_reply" data-uid="' + data.uid + '"><i class="fa fa-reply"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" title="删除" class="comm_del" data-cid="' + data.cid + '"><i class="fa fa-times"></i></a></div></dd></dl>';                    if(comm_list.find(".empty").length > 0){                        $("#comment_" + mid).find(".comm_list").empty().prepend(html);                    }else if(comm_list.find("dl").length >= 10){                        $("#comment_" + mid).find(".comm_list dl:last").remove();                        $("#comment_" + mid).find(".comm_list").prepend(html);                    }else{                        $("#comment_" + mid).find(".comm_list").prepend(html);                    }                }            });            $("#reply_btn_" + mid).attr("data-reuid", 0);            $("#reply_con_" + mid).val("");            $("#reply_con_" + mid).attr("placeholder", "说点什么...");        });        $(document).on("mouseenter",".comm_list dl",function(){            $(this).find(".operating").show();            $(this).find(".ban").show();        });        $(document).on("mouseleave",".comm_list dl",function(){            $(this).find(".operating").hide();            $(this).find(".ban").hide();        });        /**         * 禁言         */        $(document).on("click",".comm_list dd .ban a",function(){            var o = $(this);            var uid = o.attr("data-uid");            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'banUser'))}", {lid: lid, uid: uid}, function (json) {                o.attr("data-content", json.msg);                o.popover('show');                setTimeout(function(){                    o.popover('hide');                },2000);            });        });        /**         * 回复留言         */        $(document).on("click",".comm_reply",function(){            var nickname = $(this).parents("dl").find(".nickname").html();            var uid = $(this).attr("data-uid");            $(this).parents(".comment_con").find(".reply_con").attr("placeholder", "回复 " + nickname + ":");            $(this).parents(".comment_con").find(".reply_btn").attr("data-reuid", uid);        });        /**         * 删除留言         */        $(document).on("click",".comm_del",function(){            if(confirm("确定要删除这条留言吗？")) {                var cid = $(this).attr("data-cid");                var o = $(this);                $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'delComm'))}", {cid: cid}, function (json) {                    if(json.status == '1'){                        o.parents("dl").remove();                    }                });            }        });        /**         * 审核信息         */        $(document).on("click",".pass_message",function(){            var mid = $(this).attr("data-mid");            var o = $(this);            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'passMessage'))}", {mid: mid}, function (json) {                if(json.status == '1'){                    o.parents().removeClass('nopass');                    o.remove();                }            });        });        /**         * 审核留言         */        $(document).on("click",".pass_comm",function(){            var cid = $(this).attr("data-cid");            var o = $(this);            $.getJSON("{php echo $this->createWebUrl('ajax', array('op'=>'passComm'))}", {cid: cid}, function (json) {                if(json.status == '1'){                    o.parents("dl").removeClass('nopass');                    o.remove();                }            });        });        /**         * 选择主持人         */        $(".comm_presenter_select").on("click", function () {            var uid = $(this).attr("data-uid");            var mid = $(this).attr("data-mid");            var nickname = $(this).html();            $("#presenter_nickname_" + mid).html(nickname);            $("#reply_btn_" + mid).attr("data-uid", uid);        });        $(".comm_list").preventScroll();    });</script>{template 'common/footer'}