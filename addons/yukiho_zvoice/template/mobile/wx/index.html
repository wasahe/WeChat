<html lang="en" class="ui-pixel-ratio-1"><head>
    <meta charset="UTF-8">
    <title></title>
    <meta id="wxKeywords" name="Keywords" content="<keywords />">
    <meta id="wxDescription" name="Description" content="<description />">
    <meta name="apple-touch-fullscreen" content="YES">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="pragram" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
 
   
    <link rel="stylesheet" href="{MODULE_URL}assets/styles/user/cell.css">
    <link rel="stylesheet" href="{MODULE_URL}assets/styles/user/text.css">
    <link rel="stylesheet" href="{MODULE_URL}assets/styles/user/common.css">
    <link rel="stylesheet" href="{MODULE_URL}assets/styles/user/index.css">
	<style type="text/css">*{font-family:"Microsoft YaHei",Arial,Helvetica,sans-serif,"宋体";}</style>
	<link href="{MODULE_URL}assets/styles/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
	<link href="{MODULE_URL}assets/styles/font-awesome.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="{MODULE_URL}public/libs/jquery_weui/lib/jquery-2.1.4.js"></script>
	<script type="text/javascript" src="{MODULE_URL}assets/scripts/elink-framework.js"></script>
	<script type="text/javascript" src="{MODULE_URL}assets/scripts/noty/packaged/jquery.noty.packaged.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
   <script>
        var jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
        // 是否启用调试
        jssdkconfig.debug = false;
        jssdkconfig.jsApiList = [
            'checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ',
            'onMenuShareWeibo',
            'hideMenuItems',
            'showMenuItems',
            'hideAllNonBaseMenuItem',
            'showAllNonBaseMenuItem',
            'translateVoice',
            'startRecord',
            'stopRecord',
            'onRecordEnd',
            'playVoice',
            'pauseVoice',
            'stopVoice',
            'uploadVoice',
            'downloadVoice',
            'chooseImage',
            'previewImage',
            'uploadImage',
            'downloadImage',
            'getNetworkType',
            'openLocation',
            'getLocation',
            'hideOptionMenu',
            'showOptionMenu',
            'closeWindow',
            'scanQRCode',
            'chooseWXPay',
            'openProductSpecificView',
            'addCard',
            'chooseCard',
            'openCard',
			'translateVoice',
            'openAddress'
        ];
        wx.config(jssdkconfig);
        var _TUTOR_URL = "{php echo $this->createMobileUrl('tutor')}";
        var _follow = "{php echo intval($_W['fans']['follow'])}";
        var _openid = "{php echo $_W['openid']}";
        var _qrcode = "{php echo $_W['account']['qrcode']}";
    </script>
	<script type="text/javascript" src="{MODULE_URL}assets/scripts/raty/jquery.raty.js"></script>
    <script type="text/javascript" src="{MODULE_URL}public/libs/jquery_weui/jquery-weui.js"></script>
	<link href="{MODULE_URL}assets/styles/weui.css" rel="stylesheet" type="text/css">
</head>
		<style type="text/css">
		textarea,select,input{-webkit-appearance: none; -moz-appearance: none; -o-appearance: none; appearance: none;}
		
		/*
		 */
		/* height width line-height */
		/* left right top bottom */
		/* padding margin */
		/* font-size */
		/* border */
		.error-popup .error-popup-hd i {
		  font-size: 40px;
		  color: #ffffff;
		}
		li{list-style:none}
		.error-popup .error-popup-bd {
		  margin-top: 10px;
		  line-height: 20px;
		}
		
		</style>
		
		
		
	<body>
		
		 <!--菜单栏-->
	{php $menu='find'}
	{template '/wx/menu'}
	<!--搜索-->
	
		<div id="popup" align=center style="display:none;background-color:#FFF;position:fixed;top:45;z-index:1000;">
		
					{php $category = M('category')->getall()}
					<a class="weui-grid" style="padding:15px;width:20%;height:50px;" href="http://www.cnkr.cc/app/index.php?i=2&c=entry&do=find&m=yukiho_zvoice">
					<p  style="display: block;text-align: center;color: #000000;font-size: 14px;" >全部</p>
					</a>
					{loop $category $c}
					<a class="weui-grid" style="padding:15px;height:50px;width:20%;" href="{php echo $this->createMobileUrl('find',array('cid'=>$c['id'],'act'=>'cate'))}">
					<p style="display: block;text-align: center;color: #000000;font-size: 14px;" >{$c['title']}</p>
					</a>
					{/loop}
					
		</div>
		<style type="text/css">
			#embedding{
			  position: absolute; background-color:#E0E0E0; bottom:0px;height:40px; width:100%;line-height:40px;text-align:center;
			}
			.icon_vip{
				position:absolute;
				bottom:-5px;
				left:15px;
				background-size:80px 320px;
				width:26px;
				height:26px;
				background-position:0px 0;
				background-image:url({MODULE_URL}assets/images/icon.png?t=234143);
				
			}
			</style> 
	
		<div id="loadingDiv" style="position:fixed;display:none;z-index:500;top:45px;margin:0 0 50px 0;left:0px;width:100%;height:100%;background-color:rgba(0,0,0,0.3)"></div>
		<div class="page" >
            <div style="height:30px" align="center" >
						<div class="weui-search-bar" id="searchBar">
							<button id="btn1" style="font-size:14px;width:15%;color:#808080; margin:0 10px 0 0;border:1px solid #808080;padding:3px 3px 3px 3px " class="weui-media-box__info__meta">{$cate['title']}</button>
			
							
							<form class="weui-search-bar__form" style="vertical-align:middle">
								<div class="weui-search-bar__box">
									<i class="weui-icon-search"></i>
									<input type="search" style="height:20px" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required/>
									<a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
								</div>
								<label class="weui-search-bar__label" id="searchText">
									<i class="weui-icon-search"></i>
									<span>搜索</span>
								</label>
							</form>
							<button id="btn2" style="font-size:14px;width:62px;color:#808080; margin:0 0 0 10px;;border:1px solid #808080;padding:3px 3px 3px 3px " class="weui-media-box__info__meta">排序</button>
						</div>
            </div>
		</div>
	
		<script type="text/javascript">
		$(function(){
		 $("#btn1").click(function(){
			
			$('#loadingDiv').toggle();  
			$('#popup').toggle(500);
		  }); 
		  });
		  </script>
		  <script type="text/javascript">
		  
		  
		  
		  
		 $(function(){
		 $("#loadingDiv").click(function(){
			
			$('#loadingDiv').hide(200);
			$('#popup').hide(200);
		  }); 
		  
		});
		
		</script>
		<script type="text/javascript">
			$(function(){
		 $("#btn2").click(function(){ 
			$('#popup1').toggle(500);
			$("v1").style.width=$("btn2").style.width;
			$("v2").style.width=$("btn2").style.width;
			$("v3").style.width=$("btn2").style.width;
		  }); 
		  });
		  
		</script>
		<div  id="popup1" align=center style="padding:0px 10px 10px 10px;;font-size:13px;background:#F0F0F0;display:none;right:0;position:absolute;top:45;z-index:1000;">
				<li id="v1" align=center style="width:40px;list-style-type:none;padding:5px 10px 5px 10px;height:20px;font-size:13px;color:#808080; border:1px solid #808080;" >按人气</li>
				<li id="v2" align=center style="width:40px;margin-top:10px;list-style-type:none;padding:5px 10px 5px 10px;height:20px;font-size:13px;color:#808080; border:1px solid #808080;" >按星级</li>
				<li id="v3" align=center style="width:40px;margin-top:10px;list-style-type:none;padding:5px 10px 5px 10px;height:20px;font-size:13px;color:#808080; border:1px solid #808080;" >按经验</li>
		</div>
	
		
		
		
		
		<!--内容列表-->
		
		<div   style="margin:15px 0 0 0 ;padding:0 0 60px 0"class="weui-panel weui-panel_access">
				<div style='padding-top:10pxpx;' class="portfolio-filter">
					{if !empty($questions['list'])}
						<div  id="questions"  >
							{loop $questions['list'] $li} 
							<div class="weui-media-box weui-media-box_text" >
								{php $to_member = M('member')->getInfo($li['to_openid'])}
								{if $li['istask']=='1'}
									<div  onclick="window.location.href='{php echo $this->createMobileUrl('task_answer',array('id'=>$li['id']))}'">
										{php $quser = M('member')->getInfo($li['openid'])}
											<span style="color:#A9A9A9;font-size:14px; margin:0 3px 0 0;border:1px solid  #A9A9A9;padding:2px 2px 2px 2px " >
											{php $cate = M('category')->getInfo($li['category_id'])}{$cate['title']}
											</span>
											<span style="font-size:15px;">{$li['title']}</span>
									</div>					
									<div style="padding: 5px 5px;display: -webkit-box;display: -webkit-flex;display: flex;-webkit-box-align: center;-webkit-align-items: center;">
										{php $ans = M('answer')->getone(array('question_id'=>$li['id']))}
										{php $user = M('member')->getInfo($ans['openid'])}
										{php $count = M('answer')->getTotal(array('question_id'=>$li['id']))}
										<p class="user-list-follow">
											{if $li['isanonymous']=='1'}
												<div class="weui-cell__hd" style="position: relative;margin-right: 10px;">
												<img style="border-radius:2px; width:33px;height:33px;display: block" src="{MODULE_URL}assets/images/anonymous_avatar.jpg" alt="img">
												</div>
												<div class="weui-cell__bd">
													<p style="font-size:13px;color:#8E8E8E">匿名用户提问</p>
													<p style="margin-top:0px;font-size: 12px;color:#8E8E8E">{if $li['credit']>0}赏金{$li['credit']}元{/if}</p>
												</div>
											{else}
												<div class="weui-cell__hd" style="position: relative;margin-right: 10px;">
												<img style="border-radius:2px; width:33px;height:33px;display: block" src="{php echo $quser['avatar']}" alt="img">
												</div>
												<div class="weui-cell__bd">
													<p style="font-size:13px;color:#8E8E8E">{$quser['nickname']}提问</p>
													<p style="margin-top:0px;font-size: 12px;color:#8E8E8E">{if $li['credit']>0}赏金{$li['credit']}元{/if}</p>
												</div>
												
											{/if}
											{php $time = $hour2-intval((time()-$li['create_time'])/3600)}
											{php $mark = $li['status']=='2' || $time<=0}
											
											
											<div  class="weui-cell__ft" style="font-size:13px;">
											{if $count>0}{$count}人已抢答{/if}<br>
											{if !$mark}
											<a href="{php echo $this->createMobileUrl('task_answer',array('id'=>$li['id']))}" style='margin-bottom:10px;' class="follow2 button-green"><span class="tip">还剩{$time}小时</span></a>
											{else}
											<a href="{php echo $this->createMobileUrl('task_answer',array('id'=>$li['id']))}" style='margin-bottom:10px;' class="follow2 button-orange"><span class="tip">已结束</span></a>
											{/if}
											</div>
											
										</p>
										<div class="decoration"></div>
									</div>
								{else}
									<div  onclick="window.location.href='{php echo $this->createMobileUrl('question',array('id'=>$li['id']))}'">
										{php $quser = M('member')->getInfo($li['openid'])}
										<span style="color:#A9A9A9;font-size:14px; margin:0 3px 0 0;border:1px solid  #A9A9A9;padding:2px 2px 2px 2px " >
										{php $cate = M('category')->getInfo($li['category_id'])}{$cate['title']}</span>
										<span style="font-size:15px;">{$li['title']}</span>
									</div>
									<div style="padding: 5px 5px;display: -webkit-box;display: -webkit-flex;display: flex;-webkit-box-align: center;-webkit-align-items: center;">
										{php $ans = M('answer')->getone(array('question_id'=>$li['id']))}
										{php $user = M('member')->getInfo($ans['openid'])}
										<p class="user-list-follow">
											<a href="{php echo $this->createMobileUrl('tutor',array('openid'=>$to_member['openid']))}">
												<div class="weui-cell__hd" style="position: relative;margin-right: 10px;">
													<img style="border-radius:2px; width:33px;height:33px;display: block" src="{php echo $to_member['avatar']}" alt="img">
													<!---{if $to_member['isrecommend']=='1'}<i class="icon icon_vip"></i>{/if}--->
													
												</div>
											</a> 
											<a href="{php echo $this->createMobileUrl('tutor',array('openid'=>$to_member['openid']))}">
												<div class="weui-cell__bd">
													<p style="margin-top:0px;font-size: 13px;color:#8E8E8E">{$to_member['tags']}</p>
													<p style="font-size:13px;color:#8E8E8E">{$to_member['realname']}</p>
												</div>
											</a> 
											<div style="position: absolute;right:20px;">
												{if $ans['mode']=='0'}
															<a data-id="{$ans['id']}" data-mode="{$ans['mode']}" data-timelong="{$ans['timelong']}" data-question_id="{$li['id']}" class="listen weui-btn weui-btn_mini weui-btn_primary">
															{php $listen_log = M('listen_log')->getOpenid($li['id'],$_W['openid'])}
															{if empty($listen_log) || $listen_log['status'] == 0}
																{if ($li['openid']==$_W['openid'] || $li['to_openid'] == $_W['openid'])}
																<span class="tip">▶ 播放解答 {$ans['timelong']}''</span>
																{else}
																<span class="tip">▶ 播放解答 {$ans['timelong']}'' (¥{php echo $this->system['listen_price']})</span>
																{/if}
															{/if}
															</a>											
														{else}
															<a data-id="{$ans['id']}" data-mode="{$ans['mode']}" data-question_id="{$li['id']}" class="lookup weui-btn weui-btn_mini weui-btn_primary">
															{php $listen_log = M('listen_log')->getOpenid($li['id'],$_W['openid'])}
															{if empty($listen_log) || $listen_log['status'] == 0}
																{if ($li['openid']==$_W['openid'] || $li['to_openid'] == $_W['openid'])}
																<span class="tip">查看图文解答 <i class="fa fa-angle-right"></i></span>
																{else}
																<span class="tip">查看图文解答 (¥{php echo $this->system['listen_price']})</span>
																{/if}
															{/if}</a>
												{/if}
											</div>
											
										</p>
									<div class="decoration"></div>
									</div>
								{/if}
								</div>
							{/loop}
						</div>
					<div id="mask" class="mask"></div>
					{else}
					<div class="content" style="margin-top:150px;">
						<div class="show-no-detection device-detected">
							<h5>暂时还没有解答哦</h5>
							<a href="{php echo $this->createMobileUrl('find')}" class="button-small button-orange button-center" style="margin-top:20px;">寻找{php echo $this->template['authname']}</a>
						</div>
					</div>
					{/if}
				</div>
			</div>
		</div>
	{if $_SESSION['pro']=='1'}
	<div class="footer-menu-controls light-footer-menu" style="-webkit-transform:inherit;">
		<div class="column" style="z-index:9999;">
			<div id="sb-search" class="sb-search">
				<form id="sb-form" action="{php echo $this->createMobileUrl('searchm')}" method="post">
					<a href="{php echo $this->createMobileUrl('task_post')}" id="sb-icon-search" class="sb-icon-search footer-menu-open" style="filter:alpha(opacity=80); -moz-opacity:0.8; -khtml-opacity: 0.8; opacity: 0.8; transform: translateX(0px); transition: all 250ms ease;"><i class="fa fa-pencil bg-blue-dark"></i> </a>
				</form>
			</div>
		</div>
	</div>	
	{/if}
	<audio controls="controls" id="player" style="display:none;" autoplay preload="auto"></audio>
	<script src="{MODULE_URL}public/js/loadmore.js"></script>	
	<script>
    var player = document.getElementById('player');
	initload("{php echo $this->createMobileUrl('index',array('cid'=>$cid,'act'=>$act))}",callback);
	loadmore("{php echo $this->createMobileUrl('index',array('cid'=>$cid,'act'=>$act))}",callback);
	function callback(html){
		$('#questions').append(html);
	}
	
	$("#mask,#catemore").click(function(){
		if($(".answers-list-header-ft").hasClass('show')){			
			$(".answers-list-header-ft").removeClass("show");
			$("#mask").hide();  
		}else{
			$(".answers-list-header-ft").addClass("show"); 
			$("#mask").css("height",$(document).height());     
			$("#mask").css("width",$(document).width()+28);     
			$("#mask").show();  
		}
	});
	var timer;
    function playData(data){
        player.src = data.src;
        player.play();
        var timelong = parseInt(data.timelong) * 1000;
		var count = data.timelong;
		timer = window.setInterval(function(){
			if((count--)>1){
				$(data.target).find('span').html("播放中..."+count+"''");
			}else{
				clearInterval(timer);
				$(data.target).find('span').html("再放一次 "+data.timelong+"''");
			}
		},1000);
		/**
        setTimeout(function(){
			$(data.target).find('span').html("再放一次");
        },timelong);*/
    }
	$("#content").delegate(".lookup","click",function(){
		var dd = {};
        var question_id = $(this).data('question_id');
        var target = $(this);
        if(!question_id){
            warn('question_id为空');
            return '';
        }
        $.get("{php echo $this->createMobileUrl('question')}&id="+question_id,{answer_id:$(this).data('id'),act:'src'},function(data){
            if(data.status == 8){
				dd.status = 2;
                warn(data.message,function(){});
                return '';
            }
            if(data.status == 0){
				target.parent().parent().prev().trigger('click');
                return '';
            }
            wx.ready(function(){
                wx.chooseWXPay({
                    timestamp: data.timeStamp,
                    nonceStr: data.nonceStr,
                    package: data.package,
                    signType: data.signType,
                    paySign: data.paySign,
                    success: function (res) {
                        if(res.errMsg == 'chooseWXPay:ok') {
                            data.act == 'paySuccess';
                            $.post("{php echo $this->createMobileUrl('question')}&id="+question_id,{act:'paySuccess',listen_id:data.listen_id,answer_id:data.answer_id},function(d){
                                if(d.status == 1){
									target.parent().parent().prev().trigger('click');
                                    return '';
                                }else{
									dd.status = 2;
                                    warn('系统错误',2000,'cancel');
                                }
                            },'json');
                        }else{
							dd.status = 2;
                            window.location.href = "{php echo $_W['siteurl']}";
                        }
                    }
                });
            });
        },'json');
    });
	
	$("#content").delegate(".listen","click",function(){
		clearInterval(timer);
		var dd = {};
        var question_id = $(this).data('question_id');
        var target = $(this)[0];
        var timelong = $(this).data('timelong');
        if(!question_id){
            warn('question_id为空');
            return '';
        }
        $.get("{php echo $this->createMobileUrl('question')}&id="+question_id,{answer_id:$(this).data('id'),act:'src'},function(data){
            if(data.status == 8){
				dd.status = 2;
                warn(data.message,function(){});
                return '';
            }
            if(data.status == 0){
				dd.status = 1;
                dd.target = target;
                dd.src = data.src;
                dd.timelong = timelong;
                return '';
            }
            if(!data.listen_id){
				dd.status = 2;
                warn('listen_id为空');
                return '';
            }
            if(!data.answer_id){
				dd.status = 2;
                warn('answer_id为空');
                return '';
            }
            wx.ready(function(){
                wx.chooseWXPay({
                    timestamp: data.timeStamp,
                    nonceStr: data.nonceStr,
                    package: data.package,
                    signType: data.signType,
                    paySign: data.paySign,
                    success: function (res) {
                        if(res.errMsg == 'chooseWXPay:ok') {
                            data.act == 'paySuccess';
                            $.post("{php echo $this->createMobileUrl('question')}&id="+question_id,{act:'paySuccess',listen_id:data.listen_id,answer_id:data.answer_id},function(d){
                                if(d.status == 1){
									dd.status = 1;
                                    dd.target = target;
                                    dd.src = d.src;
                                    dd.timelong = timelong;
                                    return '';
                                }else{
									dd.status = 2;
                                    warn('系统错误',2000,'cancel');
                                }
                            },'json');
                        }else{
							dd.status = 2;
                            window.location.href = "{php echo $_W['siteurl']}";
                        }
                    }
                });
            });
        },'json');
		$(target).find('span').html("数据搬运中...");
        player.play();
		var timer1 = window.setInterval(function(){
			if(dd.status>0){
				clearInterval(timer1);
				if(dd.status==1){
					playData(dd);
				}else{ 
					$(target).find('span').html("重试一下");
				}
			}
		},1000);
    });
	
    $(function(){
        var $searchBar = $('#searchBar'),
            $searchResult = $('#searchResult'),
            $searchText = $('#searchText'),
            $searchInput = $('#searchInput'),
            $searchClear = $('#searchClear'),
            $searchCancel = $('#searchCancel');
        function hideSearchResult(){
            $searchResult.hide();
            $searchInput.val('');
        }
        function cancelSearch(){
            hideSearchResult();
            $searchBar.removeClass('weui-search-bar_focusing');
            $searchText.show();
        }
        $searchText.on('click', function(){
            $searchBar.addClass('weui-search-bar_focusing');
            $searchInput.focus();
        });
        $searchInput
            .on('blur', function () {
                if(!this.value.length) cancelSearch();
            })
            .on('input', function(){
                if(this.value.length) {
                    $searchResult.show();
                } else {
                    $searchResult.hide();
                }
            })
        ;
        $searchClear.on('click', function(){
            hideSearchResult();
            $searchInput.focus();
        });
        $searchCancel.on('click', function(){
            cancelSearch();
            $searchInput.blur();
        });
    });
</script>
</body>
</html>