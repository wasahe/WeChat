{php $g_title=$this->template['authname'].'信息'}{php $menu='4'}{template 'common/header1'} {template 'common/menu'}		{if !empty($this->pro['cateScrollWidth'])}		{php $field_width = intval($this->pro['cateScrollWidth'])-100}		{else}		{php $field_width = 100}		{php $this->pro['cateScrollWidth'] = 100}		{/if}		<style type="text/css">		.formFieldWrap{			width:{$field_width}%;		} 		.formTextareaWrap{			width:{$field_width}%;		}		.formSubmitButtonErrorsWrap{			width:{$field_width}%;		}		.imagesShowArea{ 			float:left;			width:20%;			height:50px;			padding-left:3px;		} 		.imagesUploadArea{ 			float:left;			width:20%;			height:50px;		} 		.images-content{ 			position: absolute; 			z-index: 1;			color: #fff; 			background: rgba(0,0,0,.7); 			overflow: hidden; 			margin-top:-15px;			opacity:0.8;filter:alpha(opacity=80);			width:50px;			line-height:15px;			font-size:12px;			padding-left:15px;		} 		</style>   		<link rel="stylesheet" href="{MODULE_URL}assets/admin/css/select2.min.css">		<script type="text/javascript" src="{MODULE_URL}assets/scripts/fastclick.js"></script>		<script src="{MODULE_URL}assets/admin/js/select2.full.min.js"></script> 		<div id="content" class="snap-content">			<div class="content">				<div class="one-half-responsive">					<div class="container heading-style-5"></div>				</div>				<form method="post" action="" id="contactForm" class="contactForm" enctype="multipart/form-data">					<input type="hidden" name="MAX_FILE_SIZE" value="2000000">					<fieldset>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">我的姓名：<span>请填写真实姓名或公司名称</span></label>							<input value="{$member['realname']}" type="text" name="realname" id="realname" placeholder="请输入真实姓名或公司名..." class="contactField requiredField">						</div>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">我的头衔：<span>请填写一项个人标签12个字以内</span></label>							<input value="{$member['tags']}" type="text" name="tags" id="tags" placeholder="例如：XX工作经验,XX专家,XX大学在校生,XX顾问..." class="contactField requiredField">						</div>						<div class="formTextareaWrap">							<label class="field-title contactMessageTextarea"								for="contactMessageTextarea">介绍下我自己： <span>请填写100个字以内的个人介绍</span></label>							<textarea placeholder="例如：任职于XX，XX年工作经验，获得过XX比赛XX奖项。参与多次XX活动，得到XX的普遍认可与反馈，希望通过自己能帮助到更多人..."								id="desc" name="desc" class="contactTextarea">{$member['desc']}</textarea>						</div>						<div class="formFieldWrap" style="padding-bottom:5px;">							<label class="field-title contactNameField" for="contactNameField">专业领域: 								<span>									{if !empty($member['labels'])}									已选：									{php $labels = explode(',',$member['labels'])}									{loop $labels $item}									{if !empty($item)}									{php $category = M('category')->getInfo($item)}										<a>{$category['title']}&nbsp;&nbsp;</a> 									{/if} 									{/loop}									{else}									最多可选择3项									{/if}								</span>							</label>							<div class="portfolio-filter-categories2">								<div id="wrapper">  									<div id="scroller" style='width:{php echo $this->pro['cateScrollWidth']}%'>									{php $options = M('category')->getall()}									{loop $options $c}									<a data-id="{$c['id']}" class="filter-category">{$c['title']}</a>									{/loop}									</div>								</div>							</div>						</div>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">向我提问需要支付：<span>0-100元之间</span></label>							<input value="{$member['credit']}" type="tel" name="credit" id="credit" placeholder="支付费用必须为一个小于100元的整数" class="contactField requiredField">						</div>						{if $member['status']!='3'}						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">资质证明：<span>请上传名片,学生证,身份证或营业执照等相关证明,此项只用于审核，不会向其他会员公开展示！</span></label>							<span id='imagesTr' style="width:100%;border:0px" type="text" class="contactField requiredField">								<div class='imagesUploadIcon' style="float:left;height:50px;width:50px;border: 1px dotted #cacaca">									<a style='padding:6px;'>+添加</a>								</div>							</span>						</div>						<div class="clear"></div>						{/if}						<div style='margin-top:20px;' class="formSubmitButtonErrorsWrap contactFormButton">							<button type="button" class="buttonWrap button button-green contactSubmitButton"								id="save">{if '0' == $member['status']}开始申请{else}保存信息{/if}</button>						</div>						</fieldset>				</form>			</div>		</div>	</div>	<script>	var images = {		localId: [],		serverId: []	};	var imagePath = '';	var labels = ',';		var myScroll = new IScroll('#wrapper', { 		scrollX: true, 		scrollY: false, 		mouseWheel: true,		disableMouse: false,		disablePointer: false,		click: true	});		$("#imagesTr").delegate(".imagesUploadIcon,.imagesUploadArea","click",function(){		var that =$(this);				// 删除已上传的图片		if(that.data('edit')=='1'){			that.remove();			$(".imagesUploadIcon").show();			return false;		}		images.localId = [];		var canChooseCount = 5;		$('.imagesUploadArea').each(function(){			if($(this).data('edit')=='1') canChooseCount--;		});		wx.chooseImage({			count: canChooseCount,			sizeType: ['original', 'compressed'],			sourceType: ['album', 'camera'],			success: function (res) {			images.localId = res.localIds;			if (images.localId.length == 0) {				warn('请先使用 chooseImage 接口选择图片');				return;			}			if(images.localId.length > 5) {				warn('最多支持1张照片,请重新选择');				images.localId = [];				return;			}			var i = 0, length = images.localId.length;			images.serverId = [];			$('.imagesUploadDesc').hide();			function upload() {				wx.uploadImage({					localId: images.localId[i],					success: function (res) {									$('.imagesUploadIcon').before('<div align="left" class="imagesUploadArea" data-sid="'+res.serverId+'" data-edit="1">'							+'<img id="imagePreview" src="'+images.localId[i]+'" style="display:block;width:50px;height:50px;"><span class="images-content">删除<span></div>');									imagePath = res.serverId;						i++;						if (i < length) {							upload();						}						var count = 0;						$('.imagesUploadArea').each(function(){							if($(this).data('edit')=='1'){								count++;							}						});						if(count>=5){							$(".imagesUploadIcon").hide();						}					},					fail: function (res) {						warn(JSON.stringify(res));					}				});			}			upload();		  }		});	});    $('.filter-category').click(function(){		if($(this).hasClass("selected-filter")){			$(this).removeClass("selected-filter");			labels = labels.replace(','+$(this).data("id")+',', ',');		}else{			if($('.filter-category.selected-filter').length>=3){				warn("最多可以选择3个标签！");			}else{				$(this).addClass("selected-filter");				labels += $(this).data("id")+',';			}		} 		console.log(labels);    });	    var post = {};    $('#save').click(function(){		_b = $(this);        post.realname= $('#realname').val();        post.tags= $('#tags').val();        post.desc = $('#desc').val();        post.credit = parseFloat($('#credit').val());		if($(".selected-filter").length>0){			post.labels = labels;		}		{if $member['status']!='3'}        post.images = [];		$('.imagesUploadArea').each(function(){			if($(this).data('edit')=='1'){				post.images = post.images.concat($(this).data('sid'));			}		});        if(!(post.images.length>0)){            warn("请上传您的资质证明");            return '';        }		{/if}        if(!post.realname){            warn("请填写您的真实姓名");            return '';        }        if(!post.tags){            warn("请填写您的头衔");            return '';        }        if(!post.desc){            warn("请填写您的介绍");            return '';        }        if(post.credit!= 0 && !post.credit){            warn("请填写提问支付费用");            return '';        }        if(post.category_id=='-1'){            warn("请选择专业领域");            return '';        }		if(post.credit!= 0 && (!(/^(\+|-)?\d+$/.test(post.credit))|| post.credit < 0 || post.credit>=100)){  			warn("支付费用必须为一个小于100元的正整数");              return '';		}		_b.attr("disabled", "disabled");		_b.html("数据传输中，请稍等...");        $.post('',post,function(data){            bingo(data.message,function(){				window.location.href = "{php echo $this->createMobileUrl('home')}";            });        },'json');        return false;    });	</script></body>