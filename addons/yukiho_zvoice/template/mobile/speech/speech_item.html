{template 'common/speech_header'}<title>{$speech_item['title']}</title><body>	<div id="AppBar"><div></div></div>	<div id="freebar"></div>	<div class="main">		<div id="SpeechPlayer">			<div>				<div class="speech-player">					<a class="player-back" href="{php echo $this->createMobileUrl('speech',array('id'=>$speech['id']))}">						<i class="icon-arrow"></i>						<span>返回小讲</span>					</a>					<div class="player-header">						<div class="speech-content">							<h1>{$speech_item['title']}</h1>						</div>					</div>					<div class="player-console">						<span class="time">00:<e id="currentTime">00</e></span>						<span class="time">{php echo gmstrftime('%M:%S',$speech_item['timelong'])}</span>						<input type="range" id="range" min="0" step="any" value="0" style="margin-top:1rem;" max="{$speech_item['timelong']}">						{php $f = strpos($speech_item['src'], 'http://')===0;}						<audio id="audio" preload="auto" src="{if !$f}../attachment/{/if}{$speech_item['src']}"></audio>						<div class="options">							<button class="menu-icon">目录</button>							<div class="btn-wrap">								{php $one = M('speech_item')->hasNextItem($speech_item['speech_id'],$speech_item['dsporder'],'<','dsporder desc')}								<button {if !empty($one['id'])}onclick="window.location.href='{php echo $this->createMobileUrl('speech_item',array('id'=>$one['id']))}&autoplay=1'"{/if} class="prev-icon {if empty($one['id'])}disable{/if}">上一条</button>								<button class="play-btn play-icon">播放</button>								{php $one = M('speech_item')->hasNextItem($speech_item['speech_id'],$speech_item['dsporder'])}								<button id="nextBtn" {if !empty($one['id'])}onclick="window.location.href='{php echo $this->createMobileUrl('speech_item',array('id'=>$one['id']))}&autoplay=1'"{/if} class="next-icon {if empty($one['id'])}disable{/if}">下一条</button>							</div>							{php $info = M('thumbup')->getSpecInfo('speech_item',$speech_item['id'])}							<button data-itemid={$speech_item['id']}" class="thumbUpBtn2 like-icon {if !empty($info['item'])}like-icon-red{else}like-icon-gray{/if}">								<span>点赞</span>								<span class="like-count">{$info['nums']}</span>							</button>						</div>					</div>				</div>				<div>					<div class="speech-timeline" id="speechTimeline">						<h2 class="title">							<span>小讲圈</span>							{if $speech['last_reply']!='0'}							<span class="highlight">								<span>{php echo M('common')->tranTime($speech['last_reply'])}</span>								<span>主讲回复</span>							</span>							{/if}							<a class="editPostBtn edit"></a>						</h2>						<div id='first'></div>						{loop $comments['list'] $li}						{php $member = M('member')->getInfo($li['openid'])}						<div class="timeline-item">							<div class="author-avatar">								<a>									<div class="avatar" style="position:relative;width:1.7rem;height:1.7rem;border-radius:50%;display:inline-block;">										<img style="position:relative;width:1.7rem;height:1.7rem;border-radius:50%;display:inline-block;" class="avatarImg" src="{php echo $member['avatar']}">										<span></span>									</div>								</a>							</div>							<div class="author-nickname">{$member['nickname']}</div>							<div class="content">								<p class="fold">									<span>{$li['title']}</span>									<a class="btn-expansion">全文</a></p>							</div>							{php $info = M('thumbup')->getSpecInfo('comment',$li['id'])}							<div class="options">								<span>{php echo M('common')->tranTime($li['create_time'])}</span>								<span data-id="{$li['id']}" data-holder="回复{$member['nickname']}" class="btn btn-reply editPostBtn"></span>								<span style='background-image:none;width:1.2rem;' class="btn btn-poll">								{if !empty($info['item'])}									<a class="activeUp thumbUpBtn" data-itemid="{$li['id']}"><i class="ion-ios-heart"></i> <e id='nums{$li['id']}'>{$info['nums']}</e></a>								{else}									<a class="thumbUpBtn" data-itemid="{$li['id']}"><i class="ion-ios-heart-outline"></i> <e id='nums{$li['id']}'>{$info['nums']}</e></a>								{/if} 									</span>							</div>							{php $comments = M('comment')->getall(array("pid"=>$li['id'],"speech_id"=>$li['speech_id']))}							{if !empty($comments)}							<div class="replies">								<div>									{loop $comments $c}									{php $member = M('member')->getInfo($c['openid'])}									<div class="reply">										<p>											<span class="nickname">{$member['nickname']}</span>											<span>：</span>											<span>{$c['title']}</span>										</p>									</div>									{/loop}								</div>							</div>							{/if}						</div>						{/loop}					</div>					<div class="loading" style="display: none;">正在加载...</div></div>			</div>		</div>	</div>	<div style='display:none;' id="layermbox" class="layermbox layermbox0" index="0">		<div class="laymshade"></div>		<div class="layermmain">			<div id="section" class="section"></div>		</div>	</div>	<script type="text/javascript" src="{MODULE_URL}assets/scripts/jquery-2.2.4.min.js"></script>	<script type="text/javascript" src="{MODULE_URL}assets/scripts/jquery.tmpl.min.js"></script>	<script type="text/javascript" src="{MODULE_URL}assets/scripts/elink-framework.js"></script>	<script type="text/javascript" src="{MODULE_URL}assets/scripts/noty/packaged/jquery.noty.packaged.js"></script>    <script>   	var range = document.getElementById("range");	var audio = document.getElementById("audio");  	setInterval(checkPlayStatus,1000);			function checkPlayStatus(){		if(!audio.paused && audio.readyState==4){			range.value++;			$num = parseInt(range.value);			$('#currentTime').html($num<10?"0"+$num:$num);			var percent = range.value/{$speech_item['timelong']}*100; 			$('#range').css("background-image","-webkit-linear-gradient(left, rgb(248, 95, 72) 0%, rgb(248, 95, 72) "+percent+"%, rgb(242, 242, 242) "+percent+"%, rgb(242, 242, 242) 100%)");		}else if(audio.ended){			range.value = 0;			$('#currentTime').html("00");			$('#range').css("background-image","-webkit-linear-gradient(left, rgb(248, 95, 72) 0%, rgb(248, 95, 72) 0%, rgb(242, 242, 242) 0%, rgb(242, 242, 242) 100%)");			$('.play-btn').addClass("play-icon");			$('.play-btn').removeClass("pause-icon");			$('#nextBtn').trigger("click");			}	}		$(document).ready(function(){		var pid = 0;		var audio = $("#audio")[0];    		$('.play-btn').click(function(){			if(audio.paused){				audio.play();				$(this).removeClass("play-icon");				$(this).addClass("pause-icon");			}else{				audio.pause();				$(this).removeClass("pause-icon");				$(this).addClass("play-icon");			}		});				{if $autoplay=='1'}		document.addEventListener("WeixinJSBridgeReady", function(){ 			$('.play-btn').trigger("click");		}, false);  		{/if}				$("#range").on("input change", function(){ 			var percent = range.value/{$speech_item['timelong']}*100;			audio.currentTime = range.value; 			$('.play-btn').removeClass("play-icon");			$('.play-btn').addClass("pause-icon");			$('#range').css("background-image","-webkit-linear-gradient(left, rgb(248, 95, 72) 0%, rgb(248, 95, 72) "+percent+"%, rgb(242, 242, 242) "+percent+"%, rgb(242, 242, 242) 100%)");			audio.play();		});		$(".editPostBtn").click(function(){			$("#layermbox").show();			var holder = $(this).data("holder");			if(isNull(holder)){				holder = "发布小讲圈";			}else{				pid = $(this).data("id");			}			$("#section").html($("#commentBoxTpl").tmpl({holder:holder}));		});		$(".menu-icon").click(function(){			$("#layermbox").show();			$("#section").html($("#chaptersTpl").tmpl());		});		$("#section").delegate(".cancel","click",function(){			$("#layermbox").hide();		});		$("#section").delegate("#saveCommentBtn","click",function(){			console.log(pid);			$.post("{php echo $this->createMobileUrl('comment')}",			{act:"saveComment", title:$("#speechPostArea").val(), pid:pid, speech_id:"{$speech['id']}", item_id:"{$speech_item['id']}"},			function(data){				if(data.status == 1){					$("#layermbox").hide();					//$("#commentTpl").tmpl({title:$("#speechPostArea").val()}).appendTo("#first");					bingo("发布成功！",function(){});				}			},'json');		});			$('.thumbUpBtn').click(function(){			var _b = $(this);			$.post("{php echo $this->createMobileUrl('thumbup')}",				{act:"up",type:"comment",itemid:_b.data('itemid')},function(data){				console.log(data);				if(data.status == 1){					var child = $('#nums'+_b.data('itemid'));					if(_b.hasClass('activeUp')){						_b.removeClass('activeUp');						child.html(parseInt(child.html())-1);						child.parent().css('color','#999');						child.prev().removeClass('ion-ios-heart');						child.prev().addClass('ion-ios-heart-outline');					}else{						_b.addClass('activeUp');						child.html(parseInt(child.html())+1);						child.parent().css('color','#f85f48');						child.prev().removeClass('ion-ios-heart-outline');						child.prev().addClass('ion-ios-heart');					}				}				posting = false;			},'json');		});				$('.thumbUpBtn2').click(function(){			var _b = $(this);			$.post("{php echo $this->createMobileUrl('thumbup')}",				{act:"up",type:"speech_item",itemid:_b.data('itemid')},function(data){				console.log(data);				if(data.status == 1){					var child = _b.children('span').eq(1);					if(_b.hasClass('like-icon-red')){						_b.removeClass('like-icon-red');						_b.addClass('like-icon-gray');						child.html(parseInt(child.html())-1);					}else{						_b.addClass('like-icon-red');						_b.removeClass('like-icon-gray');						child.html(parseInt(child.html())+1);					}				}				posting = false;			},'json');		});		});		function isNull(data){ 		return (data == "" || data == undefined || data == null) ? true : false; 	}	</script>	<script id="commentTpl" type="text/x-jquery-tmpl"> 	<div class="timeline-item">		<div class="author-avatar">			<a>				<div class="avatar" style="position:relative;width:1.7rem;height:1.7rem;border-radius:50%;display:inline-block;">					<img style="position:relative;width:1.7rem;height:1.7rem;border-radius:50%;display:inline-block;" class="avatarImg" src="{php echo $now['avatar']}">					<span></span>				</div>			</a>		</div>		<div class="author-nickname">{$now['nickname']}</div>		<div class="content">			<p class="fold">				<span>${title}</span>				<a class="btn-expansion">全文</a>			</p>		</div>	</script>	<script id="commentBoxTpl" type="text/x-jquery-tmpl"> 	<div class="layermchild layer-speech-post layermanim">		<div class="layermcont">			<div id="postForm">				<div class="speech-post" id="speechPost">					<div class="btn-wrap">						<span class="cancel">取消</span>						<span class="error"></span>						<span id="saveCommentBtn" class="sub">提交</span></div>					<textarea id="speechPostArea" maxlength="1000" placeholder="${holder}"></textarea>					<!--<span class="counter">						<i>0</i>						<span>/</span>						<span>1000</span></span>-->				</div>			</div>		</div>	</div>	</script>		<script id="chaptersTpl" type="text/x-jquery-tmpl"> 	<div class="layermchild menu-layer layermanim">		<h3 style="">{$speech['title']}</h3>		<button class="layermend"></button>		<div class="layermcont">			<ul>			{php $index=0}			{loop $speech_items $li}				{if $li['istitle']=='1'}				{if $index!=0}</ul><ul>{/if}				<h4 class="chapter-title">{$li['title']}</h4>				{else}				<li class="item {if $speech_item['id']==$li['id']}active{/if}">					<p class="content">						<i class="voice-icon"></i>{$li['title']}</p>					<span class="duration">{php echo gmstrftime('%M:%S',$li['timelong'])}</span>				</li>				{/if}				{php $index=$index+1}			{/loop}			</ul>		</div>		<div class="layermbtn">			<span class='cancel'>关闭</span>		</div>	</div>	</script></body></html>