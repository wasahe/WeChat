{php $g_title='编辑小讲信息'}{php $menu='4'}{template 'common/header1'}		<style type="text/css">		.imagesShowArea{ 			float:left;			width:20%;			height:50px;			padding-left:3px;		} 		.imagesUploadArea{ 			float:left;			width:20%;			height:50px;		} 		.images-content{ 			position: absolute; 			z-index: 1;			color: #fff; 			background: rgba(0,0,0,.7); 			overflow: hidden; 			margin-top:-15px;			opacity:0.8;filter:alpha(opacity=80);			width:50px;			line-height:15px;			font-size:12px;			padding-left:15px;		} 		</style> 		<div id="content" class="snap-content">			<div class="content">				<div class="one-half-responsive">					<div class="container heading-style-5"></div>				</div>				<form method="post" action="" id="contactForm" class="contactForm" enctype="multipart/form-data">					<input type="hidden" name="MAX_FILE_SIZE" value="2000000">					<fieldset>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">选择分类: <span>请选择小讲的分类</span></label>							<select id='category_id' name="category_id" class="contactField requiredField">									{php $category = M('category')->getByType(3)}								{loop $category $c}								<option value='{$c['id']}' {if $c['id']==$member['category_id']}selected{/if}>{$c['title']}</option>								{/loop}							</select>						</div>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">小讲标题：<span>50字以内</span></label>							<input value="{$speech['title']}" type="text" name="title" id="title" placeholder="请输入小讲标题..." class="contactField requiredField">						</div>						<div class="formTextareaWrap">							<label class="field-title contactMessageTextarea"								for="contactMessageTextarea">内容简介： <span>请填写小讲内容介绍</span></label>							<textarea style='height:200px;' placeholder="例如：听完我的小讲，能学会如何谈离职原因、如何向面试官提问，抓住各个环节的机会...购买之后就可以向我提问并与票友互动交流，获取更多经验..."								id="description" name="description" class="contactTextarea">{$speech['description']}</textarea>						</div>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">选择状态: <span>选择私密后将不公开显示</span></label>							<select name="status" class="contactField requiredField">									<option value='2' {if $speech['status']==2}selected{/if}>公开</option>								<option value='0' {if $speech['status']==0}selected{/if}>私密</option>							</select>						</div>						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">讲票价格：<span>0-100元之间</span></label>							<input value="{$speech['credit']}" type="tel" name="credit" id="credit" placeholder="讲票价格必须为一个小于100元的正整数" class="contactField requiredField">						</div> 						<div class="formFieldWrap">							<label class="field-title contactNameField" for="contactNameField">宣传图片：<span>请上传小讲悬赏图片</span></label>							<span id='imagesTr' style="width:100%;border:0px">								<div class='imagesUploadIcon' style="text-align:center;height:50px;width:100%;border: 1px dotted #cacaca">									<a style='font-size:15px;padding:6px;'>+添加</a>								</div>							</span>						</div>						<div class="clear"></div>						<div style='margin-top:20px;' class="formSubmitButtonErrorsWrap contactFormButton">							<button type="button" class="buttonWrap button button-green contactSubmitButton"								id="save">{if '0' == $member['status']}开始申请{else}保存信息{/if}</button>						</div>						</fieldset>				</form>			</div>		</div>	</div>	<script>	var images = {		localId: [],		serverId: []	};	var imagePath = "";		$("#imagesTr").delegate(".imagesUploadIcon,.imagesUploadArea","click",function(){		var that =$(this);		// 删除已上传的图片		if(that.data('edit')=='1'){			that.remove();			$(".imagesUploadIcon").show();			return false;		}				images.localId = [];		var canChooseCount = 1;		$('.imagesUploadArea').each(function(){			if($(this).data('edit')=='1') canChooseCount--;		});		wx.chooseImage({			count: canChooseCount,			sizeType: ['original', 'compressed'],			sourceType: ['album', 'camera'],			success: function (res) {			images.localId = res.localIds;			if (images.localId.length == 0) {				warn('请先使用 chooseImage 接口选择图片');				return;			}			if(images.localId.length > 1) {				warn('最多支持1张照片,请重新选择');				images.localId = [];				return;			}			var i = 0, length = images.localId.length;			images.serverId = [];			$('.imagesUploadDesc').hide();			function upload() {				wx.uploadImage({					localId: images.localId[i],					success: function (res) {									$('.imagesUploadIcon').before('<div align="left" class="imagesUploadArea" data-sid="'+res.serverId+'" data-edit="1">'							+'<img id="imagePreview" src="'+images.localId[i]+'" style="display:block;width:50px;height:50px;"><span class="images-content">删除<span></div>');									imagePath = res.serverId;						i++;						if (i < length) {							upload();						}						var count = 0;						$('.imagesUploadArea').each(function(){							if($(this).data('edit')=='1'){								count++;							}						});						if(count>=1){							$(".imagesUploadIcon").hide();						}					},					fail: function (res) {						warn(JSON.stringify(res));					}				});			}			upload();		  }		});	});	    var post = {};    $('#save').click(function(){		_b = $(this);        post.id= "{$speech['id']}";        post.title= $('#title').val();        post.category_id = $('#category_id').val();        post.status = $("input[name='status']").val();        post.description = $('#description').val();        post.credit = parseFloat($('#credit').val());        post.image = imagePath;        if(!post.category_id){            warn("请选择一个分类");            return '';        }        if(!post.title){            warn("请填写标题");            return '';        }        if(!post.description){            warn("请填写描述内容");            return '';        }        if(post.credit!= 0 && !post.credit){            warn("请填写讲票费用");            return '';        }		if(post.credit!= 0 && (!(/^(\+|-)?\d+$/.test(post.credit))|| post.credit < 0 || post.credit>=100)){  			warn("讲票费用必须为一个小于100元的正整数");              return '';		}		{if empty($speech['id'])}        if(!(post.image.length>0)){            warn("请上传您的宣传图片");            return '';        }		{/if}		_b.attr("disabled", "disabled");		_b.html("数据传输中，请稍等...");        $.post('',post,function(data){            bingo(data.message,function(){				window.location.href = "{php echo $this->createMobileUrl('create_speech_list')}";            });        },'json');        return false;    });	</script></body>