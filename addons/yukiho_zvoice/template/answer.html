<!DOCTYPE html>
<html>
{if empty($_W['isajax'])}
{template 'common/top'}
{/if}
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">回答列表</h3>
				<div class="box-tools">
					<a href="{php echo $this->createWebUrl('answer',array('act'=>'edit'))}" class="btn btn-info">新增回答</a>
					<a data-href="{php echo $this->createWebUrl('answer',array('act'=>'mutdelete'))}" href="javascript:;" class="btn btn-danger mutdelete">删除选中</a>
				</div>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <table id="example2" class="table  table-hover">
                <thead>
                <tr>
                    <th style="width:5%;">
                        <input type="checkbox" id="checkall"/>
                    </th>
                    <th style="width:6%;">类型</th>
                    <th style="width:6%;">方式</th>
                    <th style="width:35%;">内容</th>
                    <th style="width:13%;">用户</th>
                    <th style="width:14%;">日期</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {loop $list['list'] $li}
                <tr>
                    <td><input type="checkbox" name="ids[]" value="{$li['id']}"/></td>
                    {php $question = M('question')->getInfo($li['question_id'])}
                    <td>
                        <label class="label label-{if $li['openid']==$question['openid']}info{else if $li['openid']==$question['to_openid']}success{else}warning{/if}">
                            {if $li['openid']==$question['openid']}追问
							{else if $li['openid']==$question['to_openid']}回答
							{else}悬赏{/if}
						</label>
                    </td>
                    <td>
                        <label class="label label-{if $li['mode']==0}info{else if $li['mode']==1}success{/if}">
                            {if $li['mode']==0}语音{else if $li['mode']==1}图文{/if}
						</label>
                    </td>	
                    <td>{if $li['mode']==0}{else if $li['mode']==1}{$li['contents']}{/if}</td>
                    {php $member = M('member')->getInfo($li['openid'])}
                    <td>{$member['nickname']}</td>
					<td>
						<label class="label label-success">{php echo date('Y-m-d H:i',$li['create_time'])}</label>
					</td>
                    <td>
						{if $li['status']==0}
						<a href="{php echo $this->createWebUrl('answer',array('act'=>'pass','id'=>$li['id']))}" class="btn btn-primary btn-sm">通过</a>
						{/if}
                        <a href="{php echo $this->createWebUrl('answer',array('act'=>'edit','id'=>$li['id']))}" class="btn btn-success btn-sm">编辑</a>
                        <a href="{php echo $this->createWebUrl('question',array('act'=>'edit','id'=>$li['question_id']))}" class="btn btn-warning btn-sm">问题</a>
                        <a href="{php echo $this->createWebUrl('answer',array('act'=>'delete','id'=>$li['id']))}" class="btn btn-danger btn-sm">删除</a>
                    </td>
                </tr>
                {/loop}
                </tbody>
              </table>
            </div>
			<div class="box-footer">
				{php echo $list['pager']}
			</div>
            <!-- /.box-body -->
          </div>
        </div>
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
</div>
<!-- ./wrapper -->
{if empty($_W['isajax'])}
{template 'common/foot'}
<script>
	$('.mutdelete').click(function(){
		var url = $(this).data('href');
		var ids = [];
		var idss = [];
		$('input:checkbox[name="ids[]"]').each(function() {
			var _that = $(this)[0];
			if(_that.checked){
				ids = ids.concat($(this).val());
			}else{
				idss = idss.concat($(this).val());
			}
		});
		console.log(ids);
		if(confirm("您确定要删除么？")){
			$.post(url,{ids:ids},function(data){
				util.message("删除成功","{php echo $_W['siteurl']}",'success');
			},'json');
		}
	});
	$('.unmutdelete').click(function(){
		var ids = [];
		var idss = [];
		$('input:checkbox[name="ids[]"]').each(function() {
			var _that = $(this)[0];
			if(_that.checked){
				ids = ids.concat($(this).val());
			}else{
				idss = idss.concat($(this).val());
			}
		});
		console.log(idss);
		if(confirm("您确定要删除么？")){
			$.post(url,{ids:idss},function(data){
				util.message("删除成功","{php echo $_W['siteurl']}",'success');
			},'json');
		}
	})
	$("#checkall").click(function(){
		console.log('checkall');
		$('input[name="ids[]"').each(function(){
			var _that = $(this)[0];
			if(_that.checked){
				_that.checked = false;
			}else{
				_that.checked = true;
			}
		});
	});
	$('body').on('click','.open_modal',function(){
		var title = '';
		var url = $(this).data('href');
		var name = $(this).data('name');
		console.log(url);
		$.get(url,function(data){
			var content = data;
			var footer = '<button class="btn btn-danger close2">关闭</button>';
			var options = {containerName:''+name};
			var model = name+'_modal';
			eval(model+'=util.dialog(title, content, footer,options);');
			eval(model+'.show();');
			eval(model+'.removeClass("fade");');
			eval(model+'.find(".close2").click(function(){'+model+'.hide();})');
		},'html');
	});
</script>
{/if}